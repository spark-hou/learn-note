(self.webpackChunklearn_note=self.webpackChunklearn_note||[]).push([[624],{53236:function(t){t.exports=(()=>{"use strict";var n={458:t=>{t.exports=function(t,e,n,i){var r,o=self||window;try{try{try{r=new o.Blob([t])}catch(e){(r=new(o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder)).append(t),r=r.getBlob()}var a=o.URL||o.webkitURL,s=a.createObjectURL(r),u=new o[e](s,n);return a.revokeObjectURL(s),u}catch(i){return new o[e]("data:application/javascript,".concat(encodeURIComponent(t)),n)}}catch(t){if(!i)throw Error("Inline worker is not supported");return new o[e](i,n)}}}},i={};function j(t){var e=i[t];if(void 0!==e)return e.exports;e=i[t]={exports:{}};return n[t](e,e.exports,j),e.exports}j.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return j.d(e,{a:e}),e},j.d=(t,e)=>{for(var n in e)j.o(e,n)&&!j.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},j.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),j.p="./dist";var W={};return(()=>{j.d(W,{default:()=>z});const S=function(t,n){var e=t.nodes,t=t.edges,i=[],r={};if(!e)throw new Error("invalid nodes data!");return e&&e.forEach(function(t,e){r[t.id]=e,i.push([])}),t&&t.forEach(function(t){var e=t.source,t=t.target,e=r[e],t=r[t];!e&&0!==e||!t&&0!==t||(i[e][t]=1,n||(i[t][e]=1))}),i};function e(t,e){return t===e}var n=(t.prototype.toString=function(t){return t?t(this.value):""+this.value},t);function t(t,e){void 0===e&&(e=null),this.value=t,this.next=e}const i=(o.prototype.prepend=function(t){t=new n(t,this.head);return this.head=t,this.tail||(this.tail=t),this},o.prototype.append=function(t){t=new n(t);return this.head?this.tail.next=t:this.head=t,this.tail=t,this},o.prototype.delete=function(t){if(!this.head)return null;for(var e=null;this.head&&this.compare(this.head.value,t);)e=this.head,this.head=this.head.next;var n=this.head;if(null!==n)for(;n.next;)this.compare(n.next.value,t)?(e=n.next,n.next=n.next.next):n=n.next;return this.compare(this.tail.value,t)&&(this.tail=n),e},o.prototype.find=function(t){var e=t.value,n=void 0===e?void 0:e,t=t.callback,i=void 0===t?void 0:t;if(!this.head)return null;for(var r=this.head;r;){if(i&&i(r.value))return r;if(void 0!==n&&this.compare(r.value,n))return r;r=r.next}return null},o.prototype.deleteTail=function(){var t=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,t;for(var e=this.head;e.next;)e.next.next?e=e.next:e.next=null;return this.tail=e,t},o.prototype.deleteHead=function(){if(!this.head)return null;var t=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),t},o.prototype.fromArray=function(t){var e=this;return t.forEach(function(t){return e.append(t)}),this},o.prototype.toArray=function(){for(var t=[],e=this.head;e;)t.push(e),e=e.next;return t},o.prototype.reverse=function(){for(var t,e=this.head,n=null;e;)t=e.next,e.next=n,n=e,e=t;this.tail=this.head,this.head=n},o.prototype.toString=function(e){return void 0===e&&(e=void 0),this.toArray().map(function(t){return t.toString(e)}).toString()},o),l=(r.prototype.isEmpty=function(){return!this.linkedList.head},r.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},r.prototype.enqueue=function(t){this.linkedList.append(t)},r.prototype.dequeue=function(){var t=this.linkedList.deleteHead();return t?t.value:null},r.prototype.toString=function(t){return this.linkedList.toString(t)},r);function r(){this.linkedList=new i}function o(t){void 0===t&&(t=e),this.head=null,this.tail=null,this.compare=t}function v(e,t){return t.filter(function(t){return t.source===e||t.target===e})}function p(t){return(t=void 0===t?0:t)+"-"+(""+Math.random()).split(".")[1].substr(0,5)+(""+Math.random()).split(".")[1].substr(0,5)}function a(t){var e={},n=t.nodes,t=void 0===(t=t.edges)?[]:t;return(void 0===n?[]:n).forEach(function(t){e[t.id]={degree:0,inDegree:0,outDegree:0}}),t.forEach(function(t){e[t.source].degree++,e[t.source].outDegree++,e[t.target].degree++,e[t.target].inDegree++}),e}var E=function(e,t,n){t=(t=void 0===t?[]:t).filter(function(t){return t.source===e||t.target===e});return"target"===n?t.filter(function(t){return t.source===e}).map(function(t){return t.target}):"source"===n?t.filter(function(t){return t.target===e}).map(function(t){return t.source}):t.map(function(t){return t.source===e?t.target:t.source})};const w=a;function u(t,e,n){function i(){}var r;!function e(n,i,r,o){o.enter({current:i,previous:r});var t=n.edges;E(i,void 0===t?[]:t,"target").forEach(function(t){o.allowTraversal({previous:r,current:i,next:t})&&e(n,t,i,o)}),o.leave({current:i,previous:r})}(t,e,"",(e=t=void 0===(t=n)?{}:t,r={},n=function(t){t=t.next;return!r[t]&&(r[t]=!0)},e.allowTraversal=t.allowTraversal||n,e.enter=t.enter||i,e.leave=t.leave||i,e))}function tt(t,e){for(var n=0,i=e.length,r=t.length;n<i;n++,r++)t[r]=e[n];return t}Object.create,Object.create;var s={}.toString;const y=function(t){return Array.isArray?Array.isArray(t):(e=t,t="Array",s.call(e)==="[object "+t+"]");var e};Object.keys;var c=Array.prototype;c.splice,c.indexOf,Array.prototype.splice,Object.prototype.hasOwnProperty,Number.isInteger&&Number.isInteger,Math.PI,parseInt,Math.PI,Object.values,Object.prototype;const h=function t(e){if("object"!=typeof e||null===e)return e;if(y(e))for(var n=[],i=0,r=e.length;i<r;i++)"object"==typeof e[i]&&null!=e[i]?n[i]=t(e[i]):n[i]=e[i];else for(var o in n={},e)"object"==typeof e[o]&&null!=e[o]?n[o]=t(e[o]):n[o]=e[o];return n};Object.prototype.hasOwnProperty,Object.prototype.hasOwnProperty;const et=function(t,n,o,a){var e=t.nodes,s=void 0===e?[]:e,t=t.edges,u=void 0===t?[]:t,i=[],c={},h={},l={};s.forEach(function(t,e){t=t.id;i.push(t),h[t]=1/0,t===n&&(h[t]=0)});for(var r=s.length,d=0;d<r;d++)!function(){var e,i=function(t,e,n){for(var i,r=1/0,o=0;o<e.length;o++){var a=e[o].id;!n[a]&&t[a]<=r&&(r=t[a],i=e[o])}return i}(h,s,c),r=i.id;if(c[r]=!0,h[r]===1/0)return;(o?(e=r,u.filter(function(t){return t.source===e})):v(r,u)).forEach(function(t){var e=t.target,n=t.source,e=e===r?n:e,t=a&&t[a]?t[a]:1;h[e]>h[i.id]+t?(h[e]=h[i.id]+t,l[e]=[i.id]):h[e]===h[i.id]+t&&l[e].push(i.id)})}();l[n]=[n];var f={};for(p in h)h[p]!==1/0&&function t(e,n,i,r){if(e===n)return[e];if(r[n])return r[n];for(var o=[],a=0,s=i[n];a<s.length;a++){var u=t(e,s[a],i,r);if(!u)return;for(var c=0,h=u;c<h.length;c++){var l=h[c];y(l)?o.push(tt(tt([],l),[n])):o.push([l,n])}}return r[n]=o,r[n]}(n,p,l,f);var p,g={};for(p in f)g[p]=f[p][0];return{length:h,path:g,allPath:f}};const nt=function(t,e){for(var n=S(t,e),i=[],r=n.length,o=0;o<r;o+=1){i[o]=[];for(var a=0;a<r;a+=1)o===a?i[o][a]=0:0!==n[o][a]&&n[o][a]?i[o][a]=n[o][a]:i[o][a]=1/0}for(var s=0;s<r;s+=1)for(o=0;o<r;o+=1)for(a=0;a<r;a+=1)i[o][a]>i[o][s]+i[s][a]&&(i[o][a]=i[o][s]+i[s][a]);return i};const d=(f.prototype.find=function(t){for(;this.parent[t]!==t;)t=this.parent[t];return t},f.prototype.union=function(t,e){var n=this.find(t),i=this.find(e);n!==i&&(n<i?(this.parent[e]!==e&&this.union(this.parent[e],t),this.parent[e]=this.parent[t]):(this.parent[t]!==t&&this.union(this.parent[t],e),this.parent[t]=this.parent[e]))},f.prototype.connected=function(t,e){return this.find(t)===this.find(e)},f);function f(t){this.count=t.length,this.parent={};for(var e=0,n=t;e<n.length;e++){var i=n[e];this.parent[i]=i}}function g(t,e){return t-e}const m=(x.prototype.getLeft=function(t){return 2*t+1},x.prototype.getRight=function(t){return 2*t+2},x.prototype.getParent=function(t){return 0===t?null:Math.floor((t-1)/2)},x.prototype.isEmpty=function(){return this.list.length<=0},x.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},x.prototype.delMin=function(){var t=this.top(),e=this.list.pop();return 0<this.list.length&&(this.list[0]=e,this.moveDown(0)),t},x.prototype.insert=function(t){if(null===t)return!1;this.list.push(t);t=this.list.length-1;return this.moveUp(t),!0},x.prototype.moveUp=function(t){for(var e=this.getParent(t);t&&0<t&&0<this.compareFn(this.list[e],this.list[t]);){var n=this.list[e];this.list[e]=this.list[t],this.list[t]=n,e=this.getParent(t=e)}},x.prototype.moveDown=function(t){var e=t,n=this.getLeft(t),i=this.getRight(t),r=this.list.length;null!==n&&n<r&&0<this.compareFn(this.list[e],this.list[n])?e=n:null!==i&&i<r&&0<this.compareFn(this.list[e],this.list[i])&&(e=i),t!==e&&(i=[this.list[e],this.list[t]],this.list[t]=i[0],this.list[e]=i[1],this.moveDown(e))},x);function x(t){this.compareFn=t=void 0===t?g:t,this.list=[]}function b(t,e,n,i){void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i="-1"),this.id=t=void 0===t?-1:t,this.from=e,this.to=n,this.label=i}var k=function(t,e){var n=[],i=t.nodes,i=void 0===i?[]:i,t=t.edges;if(0===i.length)return n;var r=(void 0===t?[]:t).map(function(t){return t});e&&r.sort(function(t,e){return t.weight-e.weight});for(var o=new d(i.map(function(t){return t.id}));0<r.length;){var a=r.shift(),s=a.source,u=a.target;o.connected(s,u)||(n.push(a),o.union(s,u))}return n},C="-1",_=(L.prototype.addEdge=function(t){this.edges.push(t),this.edgeMap[t.id]=t},L),it=(O.prototype.getNodeNum=function(){return this.nodes.length},O.prototype.addNode=function(t,e){var n;this.nodeMap[t]||(n=new _(t,e),this.nodes.push(n),this.nodeMap[t]=n,this.nodeLabelMap[e]||(this.nodeLabelMap[e]=[]),this.nodeLabelMap[e].push(t))},O.prototype.addEdge=function(t,e,n,i){var r;!this.edgeIdAutoIncrease&&void 0!==t||(t=this.counter++),this.nodeMap[e]&&this.nodeMap[n]&&this.nodeMap[n].edgeMap[t]||(r=new b(t,e,n,i),this.edges.push(r),this.edgeMap[t]=r,this.nodeMap[e].addEdge(r),this.edgeLabelMap[i]||(this.edgeLabelMap[i]=[]),this.edgeLabelMap[i].push(r),this.directed||(e=new b(t,n,e,i),this.nodeMap[n].addEdge(e),this.edgeLabelMap[i].push(e)))},O),M=(N.prototype.equalTo=function(t){return this.fromNode===t.formNode&&this.toNode===t.toNode&&this.nodeEdgeNodeLabel===t.nodeEdgeNodeLabel},N.prototype.notEqualTo=function(t){return!this.equalTo(t)},N),I=(D.prototype.equalTo=function(t){var e=this.dfsEdgeList.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(this.dfsEdgeList[n]!==t[n])return!1;return!0},D.prototype.notEqualTo=function(t){return!this.equalTo(t)},D.prototype.pushBack=function(t,e,n,i,r){return this.dfsEdgeList.push(new M(t,e,n,i,r)),this.dfsEdgeList},D.prototype.toGraph=function(t,e){var o=new it(t=void 0===t?-1:t,!0,e=void 0===e?!1:e);return this.dfsEdgeList.forEach(function(t){var e=t.fromNode,n=t.toNode,i=t.nodeEdgeNodeLabel,r=i.nodeLabel1,t=i.edgeLabel,i=i.nodeLabel2;r!==C&&o.addNode(e,r),i!==C&&o.addNode(n,i),o.addEdge(void 0,e,n,t)}),o},D.prototype.buildRmpath=function(){this.rmpath=[];for(var t=void 0,e=this.dfsEdgeList.length-1;0<=e;e--){var n=this.dfsEdgeList[e],i=n.fromNode,n=n.toNode;i<n&&(void 0===t||n===t)&&(this.rmpath.push(e),t=i)}return this.rmpath},D.prototype.getNodeNum=function(){var e={};return this.dfsEdgeList.forEach(function(t){e[t.fromNode]||(e[t.fromNode]=!0),e[t.toNode]||(e[t.toNode]=!0)}),Object.keys(e).length},D),T=(P.prototype.hasNode=function(t){return 1===this.nodesUsed[t.id]},P.prototype.hasEdge=function(t){return 1===this.edgesUsed[t.id]},P),rt=(A.prototype.findForwardRootEdges=function(t,e){var n=this,i=[],r=t.nodeMap;return e.edges.forEach(function(t){(n.directed||e.label<=r[t.to].label)&&i.push(t)}),i},A.prototype.findBackwardEdge=function(t,e,n,i){if(!this.directed&&e===n)return null;for(var r=t.nodeMap,o=r[n.to].edges,a=o.length,s=0;s<a;s++){var u=o[s];if(!i.hasEdge(u)&&u.to===e.from)if(this.directed){if(r[e.from].label<r[n.to].label||r[e.from].label===r[n.to].label&&e.label<=u.label)return u}else if(e.label<u.label||e.label===u.label&&r[e.to].label<=r[n.to].label)return u}return null},A.prototype.findForwardPureEdges=function(t,e,n,i){for(var r=[],e=e.to,o=t.nodeMap[e].edges,a=o.length,s=0;s<a;s++){var u=o[s],c=t.nodeMap[u.to];n<=c.label&&!i.hasNode(c)&&r.push(u)}return r},A.prototype.findForwardRmpathEdges=function(t,e,n,i){for(var r=[],o=t.nodeMap,a=o[e.to].label,s=o[e.from].edges,u=s.length,c=0;c<u;c++){var h=s[c],l=o[h.to].label;e.to===h.to||l<n||i.hasNode(o[h.to])||(e.label<h.label||e.label===h.label&&a<=l)&&r.push(h)}return r},A.prototype.getSupport=function(t){var e={};return t.forEach(function(t){e[t.graphId]||(e[t.graphId]=!0)}),Object.keys(e).length},A.prototype.findMinLabel=function(i){var r=void 0;return Object.keys(i).forEach(function(t){var e=i[t],n=e.nodeLabel1,t=e.edgeLabel,e=e.nodeLabel2;(!r||n<r.nodeLabel1||n===r.nodeLabel1&&t<r.edgeLabel||n===r.nodeLabel1&&t===r.edgeLabel&&e<r.nodeLabel2)&&(r={nodeLabel1:n,edgeLabel:t,nodeLabel2:e})}),r},A.prototype.isMin=function(){var p=this,g=this.dfsCode;if(this.verbose,1===g.dfsEdgeList.length)return!0;var v=this.directed,y=g.toGraph(-1,v),m=y.nodeMap,x=new I,r={};y.nodes.forEach(function(i){p.findForwardRootEdges(y,i).forEach(function(t){var e=m[t.to],n=i.label+"-"+t.label+"-"+e.label;r[n]||(r[n]={projected:[],nodeLabel1:i.label,edgeLabel:t.label,nodeLabel2:e.label});t={graphId:y.id,edge:t,preNode:null};r[n].projected.push(t)})});var t=this.findMinLabel(r);x.dfsEdgeList.push(new M(0,1,t.nodeLabel1,t.edgeLabel,t.nodeLabel2));var b=function(i){for(var r=x.buildRmpath(),o=x.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,e=x.dfsEdgeList[r[0]].toNode,a={},s=!1,u=0,t=v?-1:0,n=r.length-1;t<n&&"break"!==function(n){if(s)return"break";i.forEach(function(t){var e=new T(t),e=p.findBackwardEdge(y,e.edges[r[n]],e.edges[r[0]],e);e&&(a[e.label]||(a[e.label]={projected:[],edgeLabel:e.label}),a[e.label].projected.push({graphId:y.id,edge:a,preNode:t}),u=x.dfsEdgeList[r[n]].fromNode,s=!0)})}(n);n--);if(s){var c=p.findMinLabel(a);x.dfsEdgeList.push(new M(e,u,C,c.edgeLabel,C));var h=x.dfsEdgeList.length-1;return p.dfsCode.dfsEdgeList[h]===x.dfsEdgeList[h]&&b(a[c.edgeLabel].projected)}var l={},s=!1,d=0;i.forEach(function(n){var t=new T(n),t=p.findForwardPureEdges(y,t.edges[r[0]],o,t);0<t.length&&(s=!0,d=e,t.forEach(function(t){var e=t.label+"-"+m[t.to].label;l[e]||(l[e]={projected:[],edgeLabel:t.label,nodeLabel2:m[t.to].label}),l[e].projected.push({graphId:y.id,edge:t,preNode:n})}))});for(var f=r.length,n=0;n<f&&"break"!==function(t){if(s)return"break";var e=r[t];i.forEach(function(n){var t=new T(n),t=p.findForwardRmpathEdges(y,t.edges[e],o,t);0<t.length&&(s=!0,d=x.dfsEdgeList[e].fromNode,t.forEach(function(t){var e=t.label+"-"+m[t.to].label;l[e]||(l[e]={projected:[],edgeLabel:t.label,nodeLabel2:m[t.to].label}),l[e].projected.push({graphId:y.id,edge:t,preNode:n})}))})}(n);n++);if(!s)return!0;h=p.findMinLabel(l);x.dfsEdgeList.push(new M(d,e+1,C,h.edgeLabel,h.nodeLabel2));c=x.dfsEdgeList.length-1;return g.dfsEdgeList[c]===x.dfsEdgeList[c]&&b(l[h.edgeLabel+"-"+h.nodeLabel2].projected)},t=t.nodeLabel1+"-"+t.edgeLabel+"-"+t.nodeLabel2;return b(r[t].projected)},A.prototype.report=function(){var t;this.dfsCode.getNodeNum()<this.minNodeNum||(this.counter++,t=this.dfsCode.toGraph(this.counter,this.directed),this.frequentSubgraphs.push(h(t)))},A.prototype.subGraphMining=function(t){var s,u,c,h,l,d,f=this;this.getSupport(t)<this.minSupport||!this.isMin()||(this.report(),s=this.dfsCode.getNodeNum(),u=this.dfsCode.buildRmpath(),c=this.dfsCode.dfsEdgeList[u[0]].toNode,h=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,l={},d={},t.forEach(function(i){for(var t=f.graphs[i.graphId],r=t.nodeMap,e=new T(i),n=u.length-1;0<=n;n--){var o,a=f.findBackwardEdge(t,e.edges[u[n]],e.edges[u[0]],e);a&&(o=f.dfsCode.dfsEdgeList[u[n]].fromNode+"-"+a.label,d[o]||(d[o]={projected:[],toNodeId:f.dfsCode.dfsEdgeList[u[n]].fromNode,edgeLabel:a.label}),d[o].projected.push({graphId:i.graphId,edge:a,preNode:i}))}if(!(s>=f.maxNodeNum)){f.findForwardPureEdges(t,e.edges[u[0]],h,e).forEach(function(t){var e=c+"-"+t.label+"-"+r[t.to].label;l[e]||(l[e]={projected:[],fromNodeId:c,edgeLabel:t.label,nodeLabel2:r[t.to].label}),l[e].projected.push({graphId:i.graphId,edge:t,preNode:i})});for(n=0;n<u.length;n++)!function(n){f.findForwardRmpathEdges(t,e.edges[u[n]],h,e).forEach(function(t){var e=f.dfsCode.dfsEdgeList[u[n]].fromNode+"-"+t.label+"-"+r[t.to].label;l[e]||(l[e]={projected:[],fromNodeId:f.dfsCode.dfsEdgeList[u[n]].fromNode,edgeLabel:t.label,nodeLabel2:r[t.to].label}),l[e].projected.push({graphId:i.graphId,edge:t,preNode:i})})}(n)}}),Object.keys(d).forEach(function(t){var e=d[t],n=e.toNodeId,e=e.edgeLabel;f.dfsCode.dfsEdgeList.push(new M(c,n,"-1",e,"-1")),f.subGraphMining(d[t].projected),f.dfsCode.dfsEdgeList.pop()}),Object.keys(l).forEach(function(t){var e=l[t],n=e.fromNodeId,i=e.edgeLabel,e=e.nodeLabel2;f.dfsCode.dfsEdgeList.push(new M(n,c+1,C,i,e)),f.subGraphMining(l[t].projected),f.dfsCode.dfsEdgeList.pop()}))},A.prototype.generate1EdgeFrequentSubGraphs=function(){var e=this.graphs,c=this.directed,n=this.minSupport,i=this.frequentSize1Subgraphs,r={},h={},o={},l={};return Object.keys(e).forEach(function(s){var t=e[s],u=t.nodeMap;t.nodes.forEach(function(t,e){var n,a=t.label,i=s+"-"+a;o[i]||(n=r[a]||0,r[a]=++n),o[i]={graphKey:s,label:a},t.edges.forEach(function(t){var e=a,n=u[t.to].label;!c&&n<e&&(o=n,n=e,e=o);var i=t.label,r=s+"-"+e+"-"+i+"-"+n,o=e+"-"+i+"-"+n;h[o]||(t=h[o]||0,h[o]=++t),l[r]={graphId:s,nodeLabel1:e,edgeLabel:i,nodeLabel2:n}})})}),Object.keys(r).forEach(function(t){var e;r[t]<n||((e={nodes:[],edges:[]}).nodes.push({id:"0",label:t}),i.push(e))}),i},A.prototype.run=function(){var e,a,s=this;this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),this.maxNodeNum<2||(e=this.graphs,this.directed,a={},Object.keys(e).forEach(function(r){var t=e[r],o=t.nodeMap;t.nodes.forEach(function(i){s.findForwardRootEdges(t,i).forEach(function(t){var e=o[t.to],n=i.label+"-"+t.label+"-"+e.label;a[n]||(a[n]={projected:[],nodeLabel1:i.label,edgeLabel:t.label,nodeLabel2:e.label}),a[n].projected.push({graphId:r,edge:t,preNode:null})})})}),Object.keys(a).forEach(function(t){var e=a[t],n=e.projected,i=e.nodeLabel1,t=e.edgeLabel,e=e.nodeLabel2;s.dfsCode.dfsEdgeList.push(new M(0,1,i,t,e)),s.subGraphMining(n),s.dfsCode.dfsEdgeList.pop()}))},A),ot="cluster";function A(t){var e=t.graphs,n=t.minSupport,i=void 0===n?2:n,r=t.minNodeNum,o=void 0===r?1:r,a=t.maxNodeNum,n=void 0===a?4:a,r=t.top,a=void 0===r?10:r,r=t.directed,r=void 0!==r&&r,t=t.verbose,t=void 0!==t&&t;this.graphs=e,this.dfsCode=new I,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=i,this.top=a,this.directed=r,this.counter=0,this.maxNodeNum=n,this.minNodeNum=o,this.verbose=t,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}function P(t){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],t){for(;t;){var e=t.edge;this.edges.push(e),this.nodesUsed[e.from]=1,this.nodesUsed[e.to]=1,this.edgesUsed[e.id]=1,t=t.preNode}this.edges=this.edges.reverse()}}function D(){this.rmpath=[],this.dfsEdgeList=[]}function N(t,e,n,i,r){this.fromNode=t,this.toNode=e,this.nodeEdgeNodeLabel={nodeLabel1:n||C,edgeLabel:i||"-1",nodeLabel2:r||C}}function O(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1),this.id=t=void 0===t?-1:t,this.edgeIdAutoIncrease=e,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=n}function L(t,e){void 0===e&&(e=C),this.id=t=void 0===t?-1:t,this.label=e,this.edges=[],this.edgeMap={}}function at(t,e,n,i){void 0===n&&(n="cluster"),void 0===i&&(i=2);var r=[],o=t.nodes;return e.forEach(function(t,e){r.push(dt(o,t,e,n,i))}),r}function st(c,h,l,d){var f=l.nodes;return d=d||{},Object.keys(c).forEach(function(e){if(!d||!d[e]){d[e]={nodes:[],edges:[]};var t=c[e],n=null===(n=h[t.start])||void 0===n?void 0:n.nodeIdxs,t=null===(t=h[t.end])||void 0===t?void 0:t.nodeIdxs;if(n&&t){var i=new Set(t),r=n.filter(function(t){return i.has(t)});if(r&&r.length){for(var o={},a=r.length,s=0;s<a;s++){var u=f[r[s]];d[e].nodes.push(u),o[u.id]=!0}l.edges.forEach(function(t){o[t.source]&&o[t.target]&&d[e].edges.push(t)})}}}}),d}function ut(t,a,s,u){var c={};t.nodes.forEach(function(t){c[t.id]=t});var h=0;return t.edges.forEach(function(t){var e=c[t.source][s],n=c[t.target][s],i=a.nodes[0][s],r=a.nodes[1][s],o=a.edges[0][u];t[u]===o&&(e===i&&n===r||e===r&&n===i)&&h++}),h}function ct(t,n){var i={},r={};return t.forEach(function(t,e){i[t.id]={idx:e,node:t,degree:0};e=t[n];r[e]||(r[e]=[]),r[e].push(t)}),{nodeMap:i,nodeLabelMap:r}}function ht(t,n,i){var r={},o={};return t.forEach(function(t,e){r[""+p]={idx:e,edge:t};e=t[n];o[e]||(o[e]=[]),o[e].push(t);e=i[t.source];e&&e.degree++;t=i[t.target];t&&t.degree++}),{edgeMap:r,edgeLabelMap:o}}function lt(a,t,s){var u=t.length,c={};return t.forEach(function(t,e){for(var n,i,r=a[e].id,o=s?0:e+1;o<u;o++)e!==o&&(n=a[o].id,i=t[o],c[r+"-"+n]=i,s||(c[n+"-"+r]=i))}),c}var dt=function(n,t,i,r,o){var a=[i],s=[],u={};return t.forEach(function(t,e){t<=o&&i!==e&&(a.push(e),s.push(n[e]),e=n[e][r],u[e]?(u[e].count++,u[e].dists.push(t)):u[e]={count:1,dists:[t]})}),Object.keys(u).forEach(function(t){u[t].dists=u[t].dists.sort(function(t,e){return t-e})}),{nodeIdx:i,nodeId:n[i].id,nodeIdxs:a,neighbors:s,neighborNum:a.length-1,nodeLabelCountMap:u}},R=(Object.defineProperty(B.prototype,"length",{get:function(){return this.linkedList.toArray().length},enumerable:!1,configurable:!0}),B.prototype.isEmpty=function(){return!this.linkedList.head},B.prototype.isMaxStack=function(){return this.toArray().length>=this.maxStep},B.prototype.peek=function(){return this.isEmpty()?null:this.linkedList.head.value},B.prototype.push=function(t){this.linkedList.prepend(t),this.length>this.maxStep&&this.linkedList.deleteTail()},B.prototype.pop=function(){var t=this.linkedList.deleteHead();return t?t.value:null},B.prototype.toArray=function(){return this.linkedList.toArray().map(function(t){return t.value})},B.prototype.clear=function(){for(;!this.isEmpty();)this.pop()},B);function B(t){void 0===t&&(t=10),this.linkedList=new i,this.maxStep=t}var c=j(458),G=j.n(c);function U(){return G()('(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{GADDI:()=>re,breadthFirstSearch:()=>f,connectedComponent:()=>h,depthFirstSearch:()=>b,detectCycle:()=>E,dijkstra:()=>k,findAllPath:()=>x,findShortestPath:()=>I,floydWarshall:()=>O,getAdjMatrix:()=>r,getDegree:()=>l,getInDegree:()=>p,getNeighbors:()=>d,getOutDegree:()=>v,labelPropagation:()=>S,louvain:()=>P,minimumSpanningTree:()=>R,pageRank:()=>U});const r=function(e,t){var r=e.nodes,n=e.edges,o=[],i={};if(!r)throw new Error("invalid nodes data!");return r&&r.forEach((function(e,t){i[e.id]=t,o.push([])})),n&&n.forEach((function(e){var r=e.source,n=e.target,a=i[r],d=i[n];!a&&0!==a||!d&&0!==d||(o[a][d]=1,t||(o[d][a]=1))})),o};var n=function(e,t){return e===t},o=function(){function e(e,t){void 0===t&&(t=null),this.value=e,this.next=t}return e.prototype.toString=function(e){return e?e(this.value):""+this.value},e}();const i=function(){function e(e){void 0===e&&(e=n),this.head=null,this.tail=null,this.compare=e}return e.prototype.prepend=function(e){var t=new o(e,this.head);return this.head=t,this.tail||(this.tail=t),this},e.prototype.append=function(e){var t=new o(e);return this.head?(this.tail.next=t,this.tail=t,this):(this.head=t,this.tail=t,this)},e.prototype.delete=function(e){if(!this.head)return null;for(var t=null;this.head&&this.compare(this.head.value,e);)t=this.head,this.head=this.head.next;var r=this.head;if(null!==r)for(;r.next;)this.compare(r.next.value,e)?(t=r.next,r.next=r.next.next):r=r.next;return this.compare(this.tail.value,e)&&(this.tail=r),t},e.prototype.find=function(e){var t=e.value,r=void 0===t?void 0:t,n=e.callback,o=void 0===n?void 0:n;if(!this.head)return null;for(var i=this.head;i;){if(o&&o(i.value))return i;if(void 0!==r&&this.compare(i.value,r))return i;i=i.next}return null},e.prototype.deleteTail=function(){var e=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,e;for(var t=this.head;t.next;)t.next.next?t=t.next:t.next=null;return this.tail=t,e},e.prototype.deleteHead=function(){if(!this.head)return null;var e=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),e},e.prototype.fromArray=function(e){var t=this;return e.forEach((function(e){return t.append(e)})),this},e.prototype.toArray=function(){for(var e=[],t=this.head;t;)e.push(t),t=t.next;return e},e.prototype.reverse=function(){for(var e=this.head,t=null,r=null;e;)r=e.next,e.next=t,t=e,e=r;this.tail=this.head,this.head=t},e.prototype.toString=function(e){return void 0===e&&(e=void 0),this.toArray().map((function(t){return t.toString(e)})).toString()},e}(),a=function(){function e(){this.linkedList=new i}return e.prototype.isEmpty=function(){return!this.linkedList.head},e.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},e.prototype.enqueue=function(e){this.linkedList.append(e)},e.prototype.dequeue=function(){var e=this.linkedList.deleteHead();return e?e.value:null},e.prototype.toString=function(e){return this.linkedList.toString(e)},e}();var d=function(e,t,r){void 0===t&&(t=[]);var n=t.filter((function(t){return t.source===e||t.target===e}));return"target"===r?n.filter((function(t){return t.source===e})).map((function(e){return e.target})):"source"===r?n.filter((function(t){return t.target===e})).map((function(e){return e.source})):n.map((function(t){return t.source===e?t.target:t.source}))},s=function(e,t){return t.filter((function(t){return t.source===e||t.target===e}))},u=function(e){return void 0===e&&(e=0),e+"-"+(""+Math.random()).split(".")[1].substr(0,5)+(""+Math.random()).split(".")[1].substr(0,5)};const f=function(e,t,r){var n=function(e){void 0===e&&(e={});var t,r=e,n=function(){},o=(t={},function(e){var r=e.next;return!t[r]&&(t[r]=!0,!0)});return r.allowTraversal=e.allowTraversal||o,r.enter=e.enter||n,r.leave=e.leave||n,r}(r),o=new a,i=e.edges,s=void 0===i?[]:i;o.enqueue(t);for(var u="",f=function(){var e=o.dequeue();n.enter({current:e,previous:u}),d(e,s,"target").forEach((function(t){n.allowTraversal({previous:u,current:e,next:t})&&o.enqueue(t)})),n.leave({current:e,previous:u}),u=e};!o.isEmpty();)f()};function h(e,t){return t?function(e){for(var t=e.nodes,r=void 0===t?[]:t,n=e.edges,o=void 0===n?[]:n,i=[],a={},s={},u={},f=[],h=0,c=function(e){s[e.id]=h,u[e.id]=h,h+=1,i.push(e),a[e.id]=!0;for(var t=d(e.id,o,"target").filter((function(e){return r.map((function(e){return e.id})).indexOf(e)>-1})),n=function(n){var o=t[n];if(s[o]||0===s[o])a[o]&&(u[e.id]=Math.min(u[e.id],s[o]));else{var i=r.filter((function(e){return e.id===o}));i.length>0&&c(i[0]),u[e.id]=Math.min(u[e.id],u[o])}},l=0;l<t.length;l++)n(l);if(u[e.id]===s[e.id]){for(var p=[];i.length>0;){var v=i.pop();if(a[v.id]=!1,p.push(v),v===e)break}p.length>0&&f.push(p)}},l=0,p=r;l<p.length;l++){var v=p[l];s[v.id]||0===s[v.id]||c(v)}return f}(e):function(e){for(var t=e.nodes,r=void 0===t?[]:t,n=e.edges,o=void 0===n?[]:n,i=[],a={},s=[],u=function(e){s.push(e),a[e.id]=!0;for(var t=d(e.id,o),n=function(e){var n=t[e];if(!a[n]){var o=r.filter((function(e){return e.id===n}));o.length>0&&u(o[0])}},i=0;i<t.length;++i)n(i)},f=0;f<r.length;f++){var h=r[f];if(!a[h.id]){u(h);for(var c=[];s.length>0;)c.push(s.pop());i.push(c)}}return i}(e)}var c=function(e){var t={},r=e.nodes,n=void 0===r?[]:r,o=e.edges,i=void 0===o?[]:o;return n.forEach((function(e){t[e.id]={degree:0,inDegree:0,outDegree:0}})),i.forEach((function(e){t[e.source].degree++,t[e.source].outDegree++,t[e.target].degree++,t[e.target].inDegree++})),t};const l=c;var p=function(e,t){return c(e)[t]?c(e)[t].inDegree:0},v=function(e,t){return c(e)[t]?c(e)[t].outDegree:0};function g(e,t,r,n){n.enter({current:t,previous:r});var o=e.edges;d(t,void 0===o?[]:o,"target").forEach((function(o){n.allowTraversal({previous:r,current:t,next:o})&&g(e,o,t,n)})),n.leave({current:t,previous:r})}function b(e,t,r){g(e,t,"",function(e){void 0===e&&(e={});var t,r=e,n=function(){},o=(t={},function(e){var r=e.next;return!t[r]&&(t[r]=!0,!0)});return r.allowTraversal=e.allowTraversal||o,r.enter=e.enter||n,r.leave=e.leave||n,r}(r))}const E=function(e){var t=null,r=e.nodes,n={},o={},i={},a={};(void 0===r?[]:r).forEach((function(e){o[e.id]=e}));for(var d={enter:function(e){var r=e.current,a=e.previous;if(i[r]){t={};for(var d=r,s=a;s!==r;)t[d]=s,d=s,s=n[s];t[d]=s}else i[r]=r,delete o[r],n[r]=a},leave:function(e){var t=e.current;a[t]=t,delete i[t]},allowTraversal:function(e){var r=e.next;return!t&&!a[r]}};Object.keys(o).length;)b(e,Object.keys(o)[0],d);return t};function m(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e}Object.create,Object.create;var y={}.toString;const L=function(e,t){return y.call(e)==="[object "+t+"]"},N=function(e){return Array.isArray?Array.isArray(e):L(e,"Array")};Object.keys;var M=Array.prototype;M.splice,M.indexOf,Array.prototype.splice,Object.prototype.hasOwnProperty;Number.isInteger&&Number.isInteger,Math.PI,parseInt,Math.PI,Object.values,Object.prototype;const j=function e(t){if("object"!=typeof t||null===t)return t;var r;if(N(t)){r=[];for(var n=0,o=t.length;n<o;n++)"object"==typeof t[n]&&null!=t[n]?r[n]=e(t[n]):r[n]=t[n]}else for(var i in r={},t)"object"==typeof t[i]&&null!=t[i]?r[i]=e(t[i]):r[i]=t[i];return r};Object.prototype.hasOwnProperty,Object.prototype.hasOwnProperty,function(){function e(){this.map={}}e.prototype.has=function(e){return void 0!==this.map[e]},e.prototype.get=function(e,t){var r=this.map[e];return void 0===r?t:r},e.prototype.set=function(e,t){this.map[e]=t},e.prototype.clear=function(){this.map={}},e.prototype.delete=function(e){delete this.map[e]},e.prototype.size=function(){return Object.keys(this.map).length}}();const k=function(e,t,r,n){var o=e.nodes,i=void 0===o?[]:o,a=e.edges,d=void 0===a?[]:a,u=[],f={},h={},c={};i.forEach((function(e,r){var n=e.id;u.push(n),h[n]=1/0,n===t&&(h[n]=0)}));for(var l=i.length,p=function(e){var t=function(e,t,r){for(var n,o=1/0,i=0;i<t.length;i++){var a=t[i].id;!r[a]&&e[a]<=o&&(o=e[a],n=t[i])}return n}(h,i,f),o=t.id;if(f[o]=!0,h[o]===1/0)return"continue";(r?function(e,t){return t.filter((function(t){return t.source===e}))}(o,d):s(o,d)).forEach((function(e){var r=e.target,i=e.source,a=r===o?i:r,d=n&&e[n]?e[n]:1;h[a]>h[t.id]+d?(h[a]=h[t.id]+d,c[a]=[t.id]):h[a]===h[t.id]+d&&c[a].push(t.id)}))},v=0;v<l;v++)p();c[t]=[t];var g={};for(var b in h)h[b]!==1/0&&w(t,b,c,g);var E={};for(var b in g)E[b]=g[b][0];return{length:h,path:E,allPath:g}};function w(e,t,r,n){if(e===t)return[e];if(n[t])return n[t];for(var o=[],i=0,a=r[t];i<a.length;i++){var d=w(e,a[i],r,n);if(!d)return;for(var s=0,u=d;s<u.length;s++){var f=u[s];N(f)?o.push(m(m([],f),[t])):o.push([f,t])}}return n[t]=o,n[t]}var I=function(e,t,r,n,o){var i=k(e,t,n,o),a=i.length,d=i.path,s=i.allPath;return{length:a[r],path:d[r],allPath:s[r]}},x=function(e,t,r,n){var o;if(t===r)return[[t]];var i=e.edges,a=void 0===i?[]:i,s=[t],u=((o={})[t]=!0,o),f=[],h=[],c=n?d(t,a,"target"):d(t,a);for(f.push(c);s.length>0&&f.length>0;){var l=f[f.length-1];if(l.length){var p=l.shift();if(p&&(s.push(p),u[p]=!0,c=n?d(p,a,"target"):d(p,a),f.push(c.filter((function(e){return!u[e]})))),s[s.length-1]===r){var v=s.map((function(e){return e}));h.push(v),g=s.pop(),u[g]=!1,f.pop()}}else{var g=s.pop();u[g]=!1,f.pop()}}return h};const O=function(e,t){for(var n=r(e,t),o=[],i=n.length,a=0;a<i;a+=1){o[a]=[];for(var d=0;d<i;d+=1)a===d?o[a][d]=0:0!==n[a][d]&&n[a][d]?o[a][d]=n[a][d]:o[a][d]=1/0}for(var s=0;s<i;s+=1)for(a=0;a<i;a+=1)for(d=0;d<i;d+=1)o[a][d]>o[a][s]+o[s][d]&&(o[a][d]=o[a][s]+o[s][d]);return o},S=function(e,t,n,o){void 0===t&&(t=!1),void 0===n&&(n="weight"),void 0===o&&(o=1e3);var i=e.nodes,a=void 0===i?[]:i,d=e.edges,s=void 0===d?[]:d,f={},h={};a.forEach((function(e,t){var r=u();e.clusterId=r,f[r]={id:r,nodes:[e]},h[e.id]={node:e,idx:t}}));var c=r(e,t),l=[],p={};c.forEach((function(e,t){var r=0,n=a[t].id;p[n]={},e.forEach((function(e,t){if(e){r+=e;var o=a[t].id;p[n][o]=e}})),l.push(r)}));for(var v=0,g=function(){var e=!1;if(a.forEach((function(t){var r={};Object.keys(p[t.id]).forEach((function(e){var n=p[t.id][e],o=h[e].node.clusterId;r[o]||(r[o]=0),r[o]+=n}));var n=-1/0,o=[];if(Object.keys(r).forEach((function(e){n<r[e]?(n=r[e],o=[e]):n===r[e]&&o.push(e)})),1!==o.length||o[0]!==t.clusterId){var i=o.indexOf(t.clusterId);if(i>=0&&o.splice(i,1),o&&o.length){e=!0;var a=f[t.clusterId],d=a.nodes.indexOf(t);a.nodes.splice(d,1);var s=Math.floor(Math.random()*o.length),u=f[o[s]];u.nodes.push(t),t.clusterId=u.id}}})),!e)return"break";v++};v<o&&"break"!==g(););Object.keys(f).forEach((function(e){var t=f[e];t.nodes&&t.nodes.length||delete f[e]}));var b=[],E={};s.forEach((function(e){var t=e.source,r=e.target,o=e[n]||1,i=h[t].node.clusterId,a=h[r].node.clusterId,d=i+"---"+a;if(E[d])E[d].weight+=o,E[d].count++;else{var s={source:i,target:a,weight:o,count:1};E[d]=s,b.push(s)}}));var m=[];return Object.keys(f).forEach((function(e){m.push(f[e])})),{clusters:m,clusterEdges:b}};var C=function(e,t,r,n){for(var o=t.length,i=2*n,a=0,d=0;d<o;d++)for(var s=e[d].clusterId,u=0;u<o;u++)s===e[u].clusterId&&(a+=(t[d][u]||0)-(r[d]||0)*(r[u]||0)/i);return a*(1/i)};const P=function(e,t,n,o){void 0===t&&(t=!1),void 0===n&&(n="weight"),void 0===o&&(o=1e-4);var i=e.nodes,a=void 0===i?[]:i,d=e.edges,s=void 0===d?[]:d,u=1,f={},h={};a.forEach((function(e,t){var r=String(u++);e.clusterId=r,f[r]={id:r,nodes:[e]},h[e.id]={node:e,idx:t}}));var c=r(e,t),l=[],p={},v=0;c.forEach((function(e,t){var r=0,n=a[t].id;p[n]={},e.forEach((function(e,t){if(e){r+=e;var o=a[t].id;p[n][o]=e,v+=e}})),l.push(r)})),v/=2;for(var g=1/0,b=1/0,E=0;g=C(a,c,l,v),!(Math.abs(g-b)<o||E>100);)b=g,E++,Object.keys(f).forEach((function(e){var t=0;s.forEach((function(r){var o=r.source,i=r.target,a=h[o].node.clusterId,d=h[i].node.clusterId;(a===e&&d!==e||d===e&&a!==e)&&(t+=r[n]||1)})),f[e].sumTot=t})),a.forEach((function(e,t){var r,o=f[e.clusterId],i=0,a=l[t]/(2*v),d=0;o.nodes.forEach((function(e){var r=h[e.id].idx;d+=c[t][r]||0}));var u=d-o.sumTot*a,g=p[e.id];if(Object.keys(g).forEach((function(n){var o=h[n].node.clusterId;if(o!==e.clusterId){var d=f[o],s=d.nodes;if(s&&s.length){var l=0;s.forEach((function(e){var r=h[e.id].idx;l+=c[t][r]||0}));var p=l-d.sumTot*a-u;p>i&&(i=p,r=d)}}})),i>0){r.nodes.push(e);var b=e.clusterId;e.clusterId=r.id;var E=o.nodes.indexOf(e);o.nodes.splice(E,1);var m=0,y=0;s.forEach((function(e){var t=e.source,o=e.target,i=h[t].node.clusterId,a=h[o].node.clusterId;(i===r.id&&a!==r.id||a===r.id&&i!==r.id)&&(m+=e[n]||1),(i===b&&a!==b||a===b&&i!==b)&&(y+=e[n]||1)})),r.sumTot=m,o.sumTot=y}}));var m={},y=0;Object.keys(f).forEach((function(e){var t=f[e];if(t.nodes&&t.nodes.length){var r=String(y+1);r!==e&&(t.id=r,t.nodes=t.nodes.map((function(e){return{id:e.id,clusterId:r}})),f[r]=t,m[e]=r,delete f[e],y++)}else delete f[e]})),a.forEach((function(e){e.clusterId&&m[e.clusterId]&&(e.clusterId=m[e.clusterId])}));var L=[],N={};s.forEach((function(e){var t=e.source,r=e.target,o=e[n]||1,i=h[t].node.clusterId,a=h[r].node.clusterId,d=i+"---"+a;if(N[d])N[d].weight+=o,N[d].count++;else{var s={source:i,target:a,weight:o,count:1};N[d]=s,L.push(s)}}));var M=[];return Object.keys(f).forEach((function(e){M.push(f[e])})),{clusters:M,clusterEdges:L}},T=function(){function e(e){this.count=e.length,this.parent={};for(var t=0,r=e;t<r.length;t++){var n=r[t];this.parent[n]=n}}return e.prototype.find=function(e){for(;this.parent[e]!==e;)e=this.parent[e];return e},e.prototype.union=function(e,t){var r=this.find(e),n=this.find(t);r!==n&&(r<n?(this.parent[t]!==t&&this.union(this.parent[t],e),this.parent[t]=this.parent[e]):(this.parent[e]!==e&&this.union(this.parent[e],t),this.parent[e]=this.parent[t]))},e.prototype.connected=function(e,t){return this.find(e)===this.find(t)},e}();var q=function(e,t){return e-t};const F=function(){function e(e){void 0===e&&(e=q),this.compareFn=e,this.list=[]}return e.prototype.getLeft=function(e){return 2*e+1},e.prototype.getRight=function(e){return 2*e+2},e.prototype.getParent=function(e){return 0===e?null:Math.floor((e-1)/2)},e.prototype.isEmpty=function(){return this.list.length<=0},e.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},e.prototype.delMin=function(){var e=this.top(),t=this.list.pop();return this.list.length>0&&(this.list[0]=t,this.moveDown(0)),e},e.prototype.insert=function(e){if(null!==e){this.list.push(e);var t=this.list.length-1;return this.moveUp(t),!0}return!1},e.prototype.moveUp=function(e){for(var t=this.getParent(e);e&&e>0&&this.compareFn(this.list[t],this.list[e])>0;){var r=this.list[t];this.list[t]=this.list[e],this.list[e]=r,e=t,t=this.getParent(e)}},e.prototype.moveDown=function(e){var t,r=e,n=this.getLeft(e),o=this.getRight(e),i=this.list.length;null!==n&&n<i&&this.compareFn(this.list[r],this.list[n])>0?r=n:null!==o&&o<i&&this.compareFn(this.list[r],this.list[o])>0&&(r=o),e!==r&&(t=[this.list[r],this.list[e]],this.list[e]=t[0],this.list[r]=t[1],this.moveDown(r))},e}();var D=function(e,t){var r=[],n=e.nodes,o=void 0===n?[]:n,i=e.edges,a=void 0===i?[]:i;if(0===o.length)return r;var d=o[0],u=new Set;u.add(d);var f=new F((function(e,r){return t?e.weight-r.weight:0}));for(s(d.id,a).forEach((function(e){f.insert(e)}));!f.isEmpty();){var h=f.delMin(),c=h.source,l=h.target;u.has(c)&&u.has(l)||(r.push(h),u.has(c)||(u.add(c),s(c,a).forEach((function(e){f.insert(e)}))),u.has(l)||(u.add(l),s(l,a).forEach((function(e){f.insert(e)}))))}return r},A=function(e,t){var r=[],n=e.nodes,o=void 0===n?[]:n,i=e.edges,a=void 0===i?[]:i;if(0===o.length)return r;var d=a.map((function(e){return e}));t&&d.sort((function(e,t){return e.weight-t.weight}));for(var s=new T(o.map((function(e){return e.id})));d.length>0;){var u=d.shift(),f=u.source,h=u.target;s.connected(f,h)||(r.push(u),s.union(f,h))}return r};const R=function(e,t,r){return r?{prim:D,kruskal:A}[r](e,t):A(e,t)},U=function(e,t,r){"number"!=typeof t&&(t=1e-6),"number"!=typeof r&&(r=.85);for(var n,o=1,i=0,a=1e3,s=e.nodes,u=void 0===s?[]:s,f=e.edges,h=void 0===f?[]:f,c=u.length,p={},v={},g=0;g<c;++g)p[E=(M=u[g]).id]=1/c,v[E]=1/c;for(var b=l(e);a>0&&o>t;){for(i=0,g=0;g<c;++g){var E=(M=u[g]).id;if(n=0,0===b[M.id].inDegree)p[E]=0;else{for(var m=d(E,h,"source"),y=0;y<m.length;++y){var L=m[y],N=b[L].outDegree;N>0&&(n+=v[L]/N)}p[E]=r*n,i+=p[E]}}for(i=(1-i)/c,o=0,g=0;g<c;++g){var M;n=p[E=(M=u[g]).id]+i,o+=Math.abs(n-v[E]),v[E]=n}a-=1}return v};var G="-1",_=function(e,t,r,n){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===r&&(r=-1),void 0===n&&(n="-1"),this.id=e,this.from=t,this.to=r,this.label=n},z=function(){function e(e,t){void 0===e&&(e=-1),void 0===t&&(t=G),this.id=e,this.label=t,this.edges=[],this.edgeMap={}}return e.prototype.addEdge=function(e){this.edges.push(e),this.edgeMap[e.id]=e},e}(),B=function(){function e(e,t,r){void 0===e&&(e=-1),void 0===t&&(t=!0),void 0===r&&(r=!1),this.id=e,this.edgeIdAutoIncrease=t,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=r}return e.prototype.getNodeNum=function(){return this.nodes.length},e.prototype.addNode=function(e,t){if(!this.nodeMap[e]){var r=new z(e,t);this.nodes.push(r),this.nodeMap[e]=r,this.nodeLabelMap[t]||(this.nodeLabelMap[t]=[]),this.nodeLabelMap[t].push(e)}},e.prototype.addEdge=function(e,t,r,n){if((this.edgeIdAutoIncrease||void 0===e)&&(e=this.counter++),!(this.nodeMap[t]&&this.nodeMap[r]&&this.nodeMap[r].edgeMap[e])){var o=new _(e,t,r,n);if(this.edges.push(o),this.edgeMap[e]=o,this.nodeMap[t].addEdge(o),this.edgeLabelMap[n]||(this.edgeLabelMap[n]=[]),this.edgeLabelMap[n].push(o),!this.directed){var i=new _(e,r,t,n);this.nodeMap[r].addEdge(i),this.edgeLabelMap[n].push(i)}}},e}(),H=function(){function e(e,t,r,n,o){this.fromNode=e,this.toNode=t,this.nodeEdgeNodeLabel={nodeLabel1:r||G,edgeLabel:n||"-1",nodeLabel2:o||G}}return e.prototype.equalTo=function(e){return this.fromNode===e.formNode&&this.toNode===e.toNode&&this.nodeEdgeNodeLabel===e.nodeEdgeNodeLabel},e.prototype.notEqualTo=function(e){return!this.equalTo(e)},e}(),K=function(){function e(){this.rmpath=[],this.dfsEdgeList=[]}return e.prototype.equalTo=function(e){var t=this.dfsEdgeList.length;if(t!==e.length)return!1;for(var r=0;r<t;r++)if(this.dfsEdgeList[r]!==e[r])return!1;return!0},e.prototype.notEqualTo=function(e){return!this.equalTo(e)},e.prototype.pushBack=function(e,t,r,n,o){return this.dfsEdgeList.push(new H(e,t,r,n,o)),this.dfsEdgeList},e.prototype.toGraph=function(e,t){void 0===e&&(e=-1),void 0===t&&(t=!1);var r=new B(e,!0,t);return this.dfsEdgeList.forEach((function(e){var t=e.fromNode,n=e.toNode,o=e.nodeEdgeNodeLabel,i=o.nodeLabel1,a=o.edgeLabel,d=o.nodeLabel2;i!==G&&r.addNode(t,i),d!==G&&r.addNode(n,d),r.addEdge(void 0,t,n,a)})),r},e.prototype.buildRmpath=function(){this.rmpath=[];for(var e=void 0,t=this.dfsEdgeList.length-1;t>=0;t--){var r=this.dfsEdgeList[t],n=r.fromNode,o=r.toNode;n<o&&(void 0===e||o===e)&&(this.rmpath.push(t),e=n)}return this.rmpath},e.prototype.getNodeNum=function(){var e={};return this.dfsEdgeList.forEach((function(t){e[t.fromNode]||(e[t.fromNode]=!0),e[t.toNode]||(e[t.toNode]=!0)})),Object.keys(e).length},e}(),W=function(){function e(e){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],e){for(;e;){var t=e.edge;this.edges.push(t),this.nodesUsed[t.from]=1,this.nodesUsed[t.to]=1,this.edgesUsed[t.id]=1,e=e.preNode}this.edges=this.edges.reverse()}}return e.prototype.hasNode=function(e){return 1===this.nodesUsed[e.id]},e.prototype.hasEdge=function(e){return 1===this.edgesUsed[e.id]},e}(),J=function(){function e(e){var t=e.graphs,r=e.minSupport,n=void 0===r?2:r,o=e.minNodeNum,i=void 0===o?1:o,a=e.maxNodeNum,d=void 0===a?4:a,s=e.top,u=void 0===s?10:s,f=e.directed,h=void 0!==f&&f,c=e.verbose,l=void 0!==c&&c;this.graphs=t,this.dfsCode=new K,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=n,this.top=u,this.directed=h,this.counter=0,this.maxNodeNum=d,this.minNodeNum=i,this.verbose=l,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}return e.prototype.findForwardRootEdges=function(e,t){var r=this,n=[],o=e.nodeMap;return t.edges.forEach((function(e){(r.directed||t.label<=o[e.to].label)&&n.push(e)})),n},e.prototype.findBackwardEdge=function(e,t,r,n){if(!this.directed&&t===r)return null;for(var o=e.nodeMap,i=o[r.to].edges,a=i.length,d=0;d<a;d++){var s=i[d];if(!n.hasEdge(s)&&s.to===t.from)if(this.directed){if(o[t.from].label<o[r.to].label||o[t.from].label===o[r.to].label&&t.label<=s.label)return s}else if(t.label<s.label||t.label===s.label&&o[t.to].label<=o[r.to].label)return s}return null},e.prototype.findForwardPureEdges=function(e,t,r,n){for(var o=[],i=t.to,a=e.nodeMap[i].edges,d=a.length,s=0;s<d;s++){var u=a[s],f=e.nodeMap[u.to];r<=f.label&&!n.hasNode(f)&&o.push(u)}return o},e.prototype.findForwardRmpathEdges=function(e,t,r,n){for(var o=[],i=e.nodeMap,a=i[t.to].label,d=i[t.from].edges,s=d.length,u=0;u<s;u++){var f=d[u],h=i[f.to].label;t.to===f.to||r>h||n.hasNode(i[f.to])||(t.label<f.label||t.label===f.label&&a<=h)&&o.push(f)}return o},e.prototype.getSupport=function(e){var t={};return e.forEach((function(e){t[e.graphId]||(t[e.graphId]=!0)})),Object.keys(t).length},e.prototype.findMinLabel=function(e){var t=void 0;return Object.keys(e).forEach((function(r){var n=e[r],o=n.nodeLabel1,i=n.edgeLabel,a=n.nodeLabel2;t?(o<t.nodeLabel1||o===t.nodeLabel1&&i<t.edgeLabel||o===t.nodeLabel1&&i===t.edgeLabel&&a<t.nodeLabel2)&&(t={nodeLabel1:o,edgeLabel:i,nodeLabel2:a}):t={nodeLabel1:o,edgeLabel:i,nodeLabel2:a}})),t},e.prototype.isMin=function(){var e=this,t=this.dfsCode;if(this.verbose&&console.log("isMin checking",t),1===t.dfsEdgeList.length)return!0;var r=this.directed,n=t.toGraph(-1,r),o=n.nodeMap,i=new K,a={};n.nodes.forEach((function(t){e.findForwardRootEdges(n,t).forEach((function(e){var r=o[e.to],i=t.label+"-"+e.label+"-"+r.label;a[i]||(a[i]={projected:[],nodeLabel1:t.label,edgeLabel:e.label,nodeLabel2:r.label});var d={graphId:n.id,edge:e,preNode:null};a[i].projected.push(d)}))}));var d=this.findMinLabel(a);i.dfsEdgeList.push(new H(0,1,d.nodeLabel1,d.edgeLabel,d.nodeLabel2));var s=function(a){for(var d=i.buildRmpath(),u=i.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,f=i.dfsEdgeList[d[0]].toNode,h={},c=!1,l=0,p=r?-1:0,v=function(t){if(c)return"break";a.forEach((function(r){var o=new W(r),a=e.findBackwardEdge(n,o.edges[d[t]],o.edges[d[0]],o);a&&(h[a.label]||(h[a.label]={projected:[],edgeLabel:a.label}),h[a.label].projected.push({graphId:n.id,edge:h,preNode:r}),l=i.dfsEdgeList[d[t]].fromNode,c=!0)}))},g=d.length-1;g>p&&"break"!==v(g);g--);if(c){var b=e.findMinLabel(h);i.dfsEdgeList.push(new H(f,l,G,b.edgeLabel,G));var E=i.dfsEdgeList.length-1;return e.dfsCode.dfsEdgeList[E]===i.dfsEdgeList[E]&&s(h[b.edgeLabel].projected)}var m={};c=!1;var y=0;a.forEach((function(t){var r=new W(t),i=e.findForwardPureEdges(n,r.edges[d[0]],u,r);i.length>0&&(c=!0,y=f,i.forEach((function(e){var r=e.label+"-"+o[e.to].label;m[r]||(m[r]={projected:[],edgeLabel:e.label,nodeLabel2:o[e.to].label}),m[r].projected.push({graphId:n.id,edge:e,preNode:t})})))}));var L=d.length,N=function(t){if(c)return"break";var r=d[t];a.forEach((function(t){var a=new W(t),d=e.findForwardRmpathEdges(n,a.edges[r],u,a);d.length>0&&(c=!0,y=i.dfsEdgeList[r].fromNode,d.forEach((function(e){var r=e.label+"-"+o[e.to].label;m[r]||(m[r]={projected:[],edgeLabel:e.label,nodeLabel2:o[e.to].label}),m[r].projected.push({graphId:n.id,edge:e,preNode:t})})))}))};for(g=0;g<L&&"break"!==N(g);g++);if(!c)return!0;var M=e.findMinLabel(m);i.dfsEdgeList.push(new H(y,f+1,G,M.edgeLabel,M.nodeLabel2));var j=i.dfsEdgeList.length-1;return t.dfsEdgeList[j]===i.dfsEdgeList[j]&&s(m[M.edgeLabel+"-"+M.nodeLabel2].projected)},u=d.nodeLabel1+"-"+d.edgeLabel+"-"+d.nodeLabel2;return s(a[u].projected)},e.prototype.report=function(){if(!(this.dfsCode.getNodeNum()<this.minNodeNum)){this.counter++;var e=this.dfsCode.toGraph(this.counter,this.directed);this.frequentSubgraphs.push(j(e))}},e.prototype.subGraphMining=function(e){var t=this;if(!(this.getSupport(e)<this.minSupport)&&this.isMin()){this.report();var r=this.dfsCode.getNodeNum(),n=this.dfsCode.buildRmpath(),o=this.dfsCode.dfsEdgeList[n[0]].toNode,i=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,a={},d={};e.forEach((function(e){for(var s=t.graphs[e.graphId],u=s.nodeMap,f=new W(e),h=n.length-1;h>=0;h--){var c=t.findBackwardEdge(s,f.edges[n[h]],f.edges[n[0]],f);if(c){var l=t.dfsCode.dfsEdgeList[n[h]].fromNode+"-"+c.label;d[l]||(d[l]={projected:[],toNodeId:t.dfsCode.dfsEdgeList[n[h]].fromNode,edgeLabel:c.label}),d[l].projected.push({graphId:e.graphId,edge:c,preNode:e})}}if(!(r>=t.maxNodeNum)){t.findForwardPureEdges(s,f.edges[n[0]],i,f).forEach((function(t){var r=o+"-"+t.label+"-"+u[t.to].label;a[r]||(a[r]={projected:[],fromNodeId:o,edgeLabel:t.label,nodeLabel2:u[t.to].label}),a[r].projected.push({graphId:e.graphId,edge:t,preNode:e})}));var p=function(r){t.findForwardRmpathEdges(s,f.edges[n[r]],i,f).forEach((function(o){var i=t.dfsCode.dfsEdgeList[n[r]].fromNode+"-"+o.label+"-"+u[o.to].label;a[i]||(a[i]={projected:[],fromNodeId:t.dfsCode.dfsEdgeList[n[r]].fromNode,edgeLabel:o.label,nodeLabel2:u[o.to].label}),a[i].projected.push({graphId:e.graphId,edge:o,preNode:e})}))};for(h=0;h<n.length;h++)p(h)}})),Object.keys(d).forEach((function(e){var r=d[e],n=r.toNodeId,i=r.edgeLabel;t.dfsCode.dfsEdgeList.push(new H(o,n,"-1",i,"-1")),t.subGraphMining(d[e].projected),t.dfsCode.dfsEdgeList.pop()})),Object.keys(a).forEach((function(e){var r=a[e],n=r.fromNodeId,i=r.edgeLabel,d=r.nodeLabel2;t.dfsCode.dfsEdgeList.push(new H(n,o+1,G,i,d)),t.subGraphMining(a[e].projected),t.dfsCode.dfsEdgeList.pop()}))}},e.prototype.generate1EdgeFrequentSubGraphs=function(){var e=this.graphs,t=this.directed,r=this.minSupport,n=this.frequentSize1Subgraphs,o={},i={},a={},d={};return Object.keys(e).forEach((function(r){var n=e[r],s=n.nodeMap;n.nodes.forEach((function(e,n){var u=e.label,f=r+"-"+u;if(!a[f]){var h=o[u]||0;h++,o[u]=h}a[f]={graphKey:r,label:u},e.edges.forEach((function(e){var n=u,o=s[e.to].label;if(!t&&n>o){var a=o;o=n,n=a}var f=e.label,h=r+"-"+n+"-"+f+"-"+o,c=n+"-"+f+"-"+o;if(!i[c]){var l=i[c]||0;l++,i[c]=l}d[h]={graphId:r,nodeLabel1:n,edgeLabel:f,nodeLabel2:o}}))}))})),Object.keys(o).forEach((function(e){if(!(o[e]<r)){var t={nodes:[],edges:[]};t.nodes.push({id:"0",label:e}),n.push(t)}})),n},e.prototype.run=function(){var e=this;if(this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),!(this.maxNodeNum<2)){var t=this.graphs,r=(this.directed,{});Object.keys(t).forEach((function(n){var o=t[n],i=o.nodeMap;o.nodes.forEach((function(t){e.findForwardRootEdges(o,t).forEach((function(e){var o=i[e.to],a=t.label+"-"+e.label+"-"+o.label;r[a]||(r[a]={projected:[],nodeLabel1:t.label,edgeLabel:e.label,nodeLabel2:o.label});var d={graphId:n,edge:e,preNode:null};r[a].projected.push(d)}))}))})),Object.keys(r).forEach((function(t){var n=r[t],o=n.projected,i=n.nodeLabel1,a=n.edgeLabel,d=n.nodeLabel2;e.dfsCode.dfsEdgeList.push(new H(0,1,i,a,d)),e.subGraphMining(o),e.dfsCode.dfsEdgeList.pop()}))}},e}(),Q="cluster";var V=function(e,t,r,n){void 0===r&&(r="cluster"),void 0===n&&(n=2);var o=[],i=e.nodes;return t.forEach((function(e,t){o.push(X(i,e,t,r,n))})),o},X=function(e,t,r,n,o){var i=[r],a=[],d={};return t.forEach((function(t,s){if(t<=o&&r!==s){i.push(s),a.push(e[s]);var u=e[s][n];d[u]?(d[u].count++,d[u].dists.push(t)):d[u]={count:1,dists:[t]}}})),Object.keys(d).forEach((function(e){d[e].dists=d[e].dists.sort((function(e,t){return e-t}))})),{nodeIdx:r,nodeId:e[r].id,nodeIdxs:i,neighbors:a,neighborNum:i.length-1,nodeLabelCountMap:d}},Y=function(e,t,r,n){var o=r.nodes;return n||(n={}),Object.keys(e).forEach((function(i){var a,d;if(!n||!n[i]){n[i]={nodes:[],edges:[]};var s=e[i],u=null===(a=t[s.start])||void 0===a?void 0:a.nodeIdxs,f=null===(d=t[s.end])||void 0===d?void 0:d.nodeIdxs;if(u&&f){var h=new Set(f),c=u.filter((function(e){return h.has(e)}));if(c&&c.length){for(var l={},p=c.length,v=0;v<p;v++){var g=o[c[v]];n[i].nodes.push(g),l[g.id]=!0}r.edges.forEach((function(e){l[e.source]&&l[e.target]&&n[i].edges.push(e)}))}}}})),n},Z=function(e,t,r,n){var o={};e.nodes.forEach((function(e){o[e.id]=e}));var i=0;return e.edges.forEach((function(e){var a=o[e.source][r],d=o[e.target][r],s=t.nodes[0][r],u=t.nodes[1][r],f=t.edges[0][n];e[n]===f&&(a===s&&d===u||a===u&&d===s)&&i++})),i},$=function(e,t){var r={},n={};return e.forEach((function(e,o){r[e.id]={idx:o,node:e,degree:0};var i=e[t];n[i]||(n[i]=[]),n[i].push(e)})),{nodeMap:r,nodeLabelMap:n}},ee=function(e,t,r){var n={},o={};return e.forEach((function(e,i){n[""+u]={idx:i,edge:e};var a=e[t];o[a]||(o[a]=[]),o[a].push(e);var d=r[e.source];d&&d.degree++;var s=r[e.target];s&&s.degree++})),{edgeMap:n,edgeLabelMap:o}},te=function(e,t,r){var n=t.length,o={};return t.forEach((function(t,i){for(var a=r?0:i+1,d=e[i].id,s=a;s<n;s++)if(i!==s){var u=e[s].id,f=t[s];o[d+"-"+u]=f,r||(o[u+"-"+d]=f)}})),o};const re=function(e,t,r,n,o,i,a){if(void 0===r&&(r=!1),void 0===i&&(i="cluster"),void 0===a&&(a="cluster"),e&&e.nodes){var d=e.nodes.length;if(d){var s=O(e,r),u=O(t,r),f=te(e.nodes,s,r),h=te(t.nodes,u,r),c=$(e.nodes,i),l=c.nodeMap,p=c.nodeLabelMap,v=$(t.nodes,i),g=v.nodeMap,b=v.nodeLabelMap;ee(e.edges,a,l);var E=ee(t.edges,a,g).edgeLabelMap;o||(o=Math.max.apply(Math,m(m([],u[0]),[2]))),n||(n=o);var y=V(e,s,i,n),L=V(t,u,i,n),N=function(e,t,r,n,o){var i=Math.ceil(r/t),a={},d=0;return n.forEach((function(e,n){for(var s=0,u=0,f=e.nodeIdxs,h=e.neighborNum-1;s<i;){for(var c=f[1+Math.floor(Math.random()*h)],l=0;(a[n+"-"+c]||a[c+"-"+n])&&(c=Math.floor(Math.random()*t),!(++l>2*t)););if(l<2*t&&(a[n+"-"+c]={start:n,end:c,distance:o[n][c]},s++,++d>=r))return a;if(++u>2*t)break}s<i&&(i=(i+(i-s))/(t-n-1))})),a}(0,d,Math.min(100,d*(d-1)/2),L,s),M=Y(N,y,e),j=function(e){var t=e.graphs,r=e.directed,n=void 0!==r&&r,o=e.nodeLabelProp,i=void 0===o?Q:o,a=e.edgeLabelProp,d=void 0===a?Q:a,s=function(e,t,r,n){var o={};return Object.keys(e).forEach((function(i,a){var d=e[i],s=new B(a,!0,t),u={};d.nodes.forEach((function(e,t){s.addNode(t,e[r]),u[e.id]=t})),d.edges.forEach((function(e,t){var r=u[e.source],o=u[e.target];s.addEdge(-1,r,o,e[n])})),s&&s.getNodeNum()&&(o[s.id]=s)})),o}(t,n,i,d),u=e.minSupport,f=e.maxNodeNum,h=e.minNodeNum,c=e.verbose,l=e.top,p=new J({graphs:s,minSupport:u,maxNodeNum:f,minNodeNum:h,top:l,verbose:c,directed:n});return p.run(),function(e,t,r){var n=[];return e.forEach((function(e){var o={nodes:[],edges:[]};e.nodes.forEach((function(e){var r;o.nodes.push(((r={id:""+e.id})[t]=e.label,r))})),e.edges.forEach((function(e){var t;o.edges.push(((t={source:""+e.from,target:""+e.to})[r]=e.label,t))})),n.push(o)})),n}(p.frequentSubgraphs,i,d)}({graphs:M,nodeLabelProp:i,edgeLabelProp:a,minSupport:1,minNodeNum:1,maxNodeNum:4,directed:r}).slice(0,10),w=j.length,I=[];j.forEach((function(e,t){I[t]={},Object.keys(M).forEach((function(r){var n=M[r],o=Z(n,e,i,a);I[t][r]=o}))}));var x=function(e,t,r){for(var n=1/0,o=0,i=function(t){var r=e[t],i=Object.keys(r).sort((function(e,t){return r[e]-r[t]})),a=[];i.forEach((function(e,t){a[t%10]||(a[t%10]={graphs:[],totalCount:0,aveCount:0}),a[t%10].graphs.push(e),a[t%10].totalCount+=r[e]}));var d=0,s=[];a.forEach((function(e){var t=e.totalCount/e.graphs.length;e.aveCount=t,s.push(t);var n=0,o=e.length;e.graphs.forEach((function(t,o){var i=r[t];e.graphs.forEach((function(e,t){o!==t&&(n+=Math.abs(i-r[e]))}))})),d+=n/=o*(o-1)/2})),d/=a.length;var u=0;s.forEach((function(e,t){s.forEach((function(r,n){t!==n&&(u+=Math.abs(e-r))})),u/=s.length*(s.length-1)/2}));var f=u-d;n<f&&(n=f,o=t)},a=0;a<t;a++)i(a);return{structure:r[o],structureCountMap:e[o]}}(I,w,j),S=x.structure,C=x.structureCountMap,P=t.nodes[0],T=P[i],q=p[T],F={},D={},A={},R={},U={};Object.keys(b).forEach((function(r,n){U[r]=[];var o=-1/0,d=b[r],s={};d.forEach((function(e){var t=h[P.id+"-"+e.id];t&&U[r].push(t),o<t&&(o=t),s[P.id+"-"+e.id]={start:0,end:g[e.id].idx,distance:t}})),U[r]=U[r].sort((function(e,t){return e-t})),D=Y(s,L,t,D);var u=[];if(Object.keys(s).forEach((function(e){if(A[e])u.push(A[e]);else{var t=D[e];A[e]=Z(t,S,i,a),u.push(A[e])}})),u=u.sort((function(e,t){return t-e})),R[P.id+"-"+r]=u,r!==T)for(var c=function(t){var n=q[t],o=y[l[n.id].idx],d=o.nodeLabelCountMap[r],s=b[r].length;if(!d||d.count<s)return q.splice(t,1),"continue";for(var h=!1,c=0;c<s;c++)if(d.dists[c]>U[r][c]){h=!0;break}if(h)return q.splice(t,1),"continue";var p={};o.neighbors.forEach((function(e){var t=f[n.id+"-"+e.id];p[n.id+"-"+e.id]={start:l[n.id].idx,end:l[e.id].idx,distance:t}})),M=Y(p,y,e,M);var v=[];Object.keys(p).forEach((function(e){if(C[e])v.push(C[e]);else{var t=M[e];C[e]=Z(t,S,i,a),v.push(C[e])}})),v=v.sort((function(e,t){return t-e}));var g=!1;for(c=0;c<s;c++)if(v[c]<u[c]){g=!0;break}return g?(q.splice(t,1),"continue"):void 0},p=q.length-1;p>=0;p--)c(p)}));var G=[];q.forEach((function(r){for(var n=l[r.id].idx,d=X(e.nodes,s[n],n,i,o).neighbors,u=d.length,h=!1,c=function(n){if(d.length+1<t.nodes.length)return h=!0,{value:void 0};var o=d[n],s=o[i];if(!b[s]||!b[s].length)return d.splice(n,1),"continue";var u=r.id+"-"+o.id;if(!U[s]||!U[s].length)return d.splice(n,1),"continue";var c=f[u];if(c>U[s][U[s].length-1])return d.splice(n,1),"continue";var p=C[u]?C[u]:function(e,t,r,n,o,i,a,d,s,u,f){var h,c=t.id+"-"+r.id;if(u&&u[c])return u[c];var l=f?f[c]:void 0;if(!l){var p=((h={})[c]={start:n[t.id].idx,end:n[r.id].idx,distance:o},h);l=(f=Y(p,i,e,f))[c]}return Z(l,a,d,s)}(e,r,o,l,c,y,S,i,a,C,M),v=P.id+"-"+s;if(p<R[v][R[v].length-1])return d.splice(n,1),"continue";var E=F[s];return void 0===E&&(E=1/0,b[s].forEach((function(e){var t=g[e.id].degree;E>t&&(E=t)})),F[s]=E),l[o.id].degree<E?(d.splice(n,1),"continue"):void 0},p=u-1;p>=0;p--){var v=c(p);if("object"==typeof v)return v.value}h||G.push({nodes:[r].concat(d)})}));var _=k(t,P.id,!1).length,z={};r?(Object.keys(_).forEach((function(e){var t=g[e].node[i];z[t]?z[t].push(_[e]):z[t]=[_[e]]})),Object.keys(z).forEach((function(e){z[e].sort((function(e,t){return e-t}))}))):z=U;for(var H=function(n){var o=G[n],d=o.nodes[0],s={},u={};o.nodes.forEach((function(e,t){u[e.id]={idx:t,node:e,degree:0};var r=e[i];s[r]?s[r]++:s[r]=1}));var f=[],h={};e.edges.forEach((function(e){u[e.source]&&u[e.target]&&(f.push(e),h[e[a]]?h[e[a]]++:h[e[a]]=1,u[e.source].degree++,u[e.target].degree++)}));for(var c=Object.keys(E).length,p=!1,v=0;v<c;v++){var m=Object.keys(E)[v];if(!h[m]||h[m]<E[m].length){p=!0;break}}if(p)return G.splice(n,1),"continue";var y=f.length;if(y<t.edges.length)return G.splice(n,1),"break";var L=!1,N=function(e){var t=f[e],n=t[a],o=E[n];if(!o||!o.length)return h[n]--,o&&h[n]<o.length?(L=!0,"break"):(f.splice(e,1),u[t.source].degree--,u[t.target].degree--,"continue");var d=u[t.source].node[i],s=u[t.target].node[i],c=!1;return o.forEach((function(e){var t=g[e.source].node,n=g[e.target].node;t[i]===d&&n[i]===s&&(c=!0),r||t[i]!==s||n[i]!==d||(c=!0)})),c?void 0:(h[n]--,o&&h[n]<o.length?(L=!0,"break"):(f.splice(e,1),u[t.source].degree--,u[t.target].degree--,"continue"))};for(v=y-1;v>=0&&"break"!==N(v);v--);if(L)return G.splice(n,1),"continue";o.edges=f;var M=k(o,o.nodes[0].id,!1).length;if(Object.keys(M).reverse().forEach((function(e){if(e!==o.nodes[0].id&&!L){if(M[e]===1/0){var t=u[e].node[i];if(s[t]--,s[t]<b[t].length)return void(L=!0);var r=o.nodes.indexOf(u[e].node);return o.nodes.splice(r,1),void(u[e]=void 0)}var n=l[e].node[i];if(!z[n]||!z[n].length||M[e]>z[n][z[n].length-1]){if(t=u[e].node[i],s[t]--,s[t]<b[t].length)return void(L=!0);r=o.nodes.indexOf(u[e].node),o.nodes.splice(r,1),u[e]=void 0}}})),L)return G.splice(n,1),"continue";for(var j=!0,w=0;j&&!L;){if(j=!1,u[d.id].degree<g[P.id].degree){L=!0;break}if(s[d[i]]<b[d[i]].length){L=!0;break}for(var I=o.nodes.length-1;I>=0;I--){var x=o.nodes[I],O=u[x.id].degree,S=x[i];if(O<F[S]){if(s[x[i]]--,s[x[i]]<b[x[i]].length){L=!0;break}o.nodes.splice(I,1),u[x.id]=void 0,j=!0}}if(L||!j&&0!==w)break;for(var C=(y=f.length)-1;C>=0;C--){var T=f[C];if(!u[T.source]||!u[T.target]){f.splice(C,1);var q=T[a];if(h[q]--,u[T.source]&&u[T.source].degree--,u[T.target]&&u[T.target].degree--,E[q]&&h[q]<E[q].length){L=!0;break}j=!0}}w++}return L||L||o.nodes.length<t.nodes.length||f.length<t.edges.length?(G.splice(n,1),"continue"):void 0},K=G.length-1;K>=0&&"break"!==H(K);K--);var W=G.length,re=function(e){var t=G[e],r={};t.edges.forEach((function(e){var t=e.source+"-"+e.target+"-"+e.label;r[t]?r[t]++:r[t]=1}));for(var n=function(e){var t=G[e],n={};t.edges.forEach((function(e){var t=e.source+"-"+e.target+"-"+e.label;n[t]?n[t]++:n[t]=1}));var o=!0;Object.keys(n).length!==Object.keys(r).length?o=!1:Object.keys(r).forEach((function(e){n[e]!==r[e]&&(o=!1)})),o&&G.splice(e,1)},o=W-1;o>e;o--)n(o);W=G.length};for(K=0;K<=W-1;K++)re(K);return G}}};var ne=self;ne.onmessage=function(e){var r=e.data,n=r._algorithmType,o=r.data;if(n)if("function"!=typeof t[n])ne.postMessage({_algorithmType:"FAILURE"});else{var i=t[n].apply(t,o);ne.postMessage({_algorithmType:"SUCCESS",data:i})}}})();\n//# sourceMappingURL=index.worker.js.map',"Worker",void 0,j.p+"index.worker.js")}const F=function(o){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Promise(function(n,i){var r=new U;r.postMessage({_algorithmType:o,data:t}),r.onmessage=function(t){var e=t.data,t=e.data;"SUCCESS"===e._algorithmType?n(t):i(),r.terminate()}})}},z={getAdjMatrix:S,breadthFirstSearch:function(t,e,n){var i,r,o,a=(o=i=void 0===(i=n)?{}:i,r={},n=function(t){t=t.next;return!r[t]&&(r[t]=!0)},o.allowTraversal=i.allowTraversal||n,o.enter=i.enter||c,o.leave=i.leave||c,o),s=new l,t=t.edges,u=void 0===t?[]:t;function c(){}s.enqueue(e);for(var h="";!s.isEmpty();)!function(){var e=s.dequeue();a.enter({current:e,previous:h}),E(e,u,"target").forEach(function(t){a.allowTraversal({previous:h,current:e,next:t})&&s.enqueue(t)}),a.leave({current:e,previous:h}),h=e}()},connectedComponent:function(p,t){return(t?function(){for(var t=p.nodes,o=void 0===t?[]:t,t=p.edges,a=void 0===t?[]:t,s=[],u={},c={},h={},l=[],d=0,f=function(n){c[n.id]=d,h[n.id]=d,d+=1,s.push(n),u[n.id]=!0;for(var i=E(n.id,a,"target").filter(function(t){return-1<o.map(function(t){return t.id}).indexOf(t)}),t=0;t<i.length;t++)!function(t){var e=i[t];c[e]||0===c[e]?u[e]&&(h[n.id]=Math.min(h[n.id],c[e])):(0<(t=o.filter(function(t){return t.id===e})).length&&f(t[0]),h[n.id]=Math.min(h[n.id],h[e]))}(t);if(h[n.id]===c[n.id]){for(var e=[];0<s.length;){var r=s.pop();if(u[r.id]=!1,e.push(r),r===n)break}0<e.length&&l.push(e)}},e=0,n=o;e<n.length;e++){var i=n[e];c[i.id]||0===c[i.id]||f(i)}return l}:function(){for(var t=p.nodes,i=void 0===t?[]:t,t=p.edges,r=void 0===t?[]:t,e=[],o={},a=[],s=function(t){a.push(t),o[t.id]=!0;for(var n=E(t.id,r),e=0;e<n.length;++e)!function(t){var e=n[t];o[e]||0<(t=i.filter(function(t){return t.id===e})).length&&s(t[0])}(e)},n=0;n<i.length;n++){var u=i[n];if(!o[u.id]){s(u);for(var c=[];0<a.length;)c.push(a.pop());e.push(c)}}return e})()},getDegree:w,getInDegree:function(t,e){return a(t)[e]?a(t)[e].inDegree:0},getOutDegree:function(t,e){return a(t)[e]?a(t)[e].outDegree:0},detectCycle:function(t){var r=null,e=t.nodes,o={},a={},s={},n={};(void 0===e?[]:e).forEach(function(t){a[t.id]=t});for(var i={enter:function(t){var e=t.current,t=t.previous;if(s[e]){r={};for(var n=e,i=t;i!==e;)r[n]=i,i=o[n=i];r[n]=i}else s[e]=e,delete a[e],o[e]=t},leave:function(t){t=t.current;n[t]=t,delete s[t]},allowTraversal:function(t){t=t.next;return!r&&!n[t]}};Object.keys(a).length;)u(t,Object.keys(a)[0],i);return r},depthFirstSearch:u,dijkstra:et,findAllPath:function(t,e,n,i){if(e===n)return[[e]];var t=t.edges,r=void 0===t?[]:t,o=[e],a=((t={})[e]=!0,t),s=[],u=[],c=i?E(e,r,"target"):E(e,r);for(s.push(c);0<o.length&&0<s.length;){var h,l=s[s.length-1];l.length?((l=l.shift())&&(o.push(l),a[l]=!0,c=i?E(l,r,"target"):E(l,r),s.push(c.filter(function(t){return!a[t]}))),o[o.length-1]===n&&(h=o.map(function(t){return t}),u.push(h),h=o.pop(),a[h]=!1,s.pop())):(h=o.pop(),a[h]=!1,s.pop())}return u},findShortestPath:function(t,e,n,i,r){e=et(t,e,i,r),i=e.length,r=e.path,e=e.allPath;return{length:i[n],path:r[n],allPath:e[n]}},floydWarshall:nt,labelPropagation:function(t,e,r,n){void 0===e&&(e=!1),void 0===r&&(r="weight"),void 0===n&&(n=1e3);var i=t.nodes,o=void 0===i?[]:i,i=t.edges,i=void 0===i?[]:i,s={},u={};o.forEach(function(t,e){var n=p();t.clusterId=n,s[n]={id:n,nodes:[t]},u[t.id]={node:t,idx:e}});var e=S(t,e),a=[],c={};e.forEach(function(t,e){var n=0,i=o[e].id;c[i]={},t.forEach(function(t,e){t&&(n+=t,e=o[e].id,c[i][e]=t)}),a.push(n)});for(var h=0;h<n&&"break"!==function(){var a=!1;if(o.forEach(function(n){var i={};Object.keys(c[n.id]).forEach(function(t){var e=c[n.id][t],t=u[t].node.clusterId;i[t]||(i[t]=0),i[t]+=e});var t,e,r=-1/0,o=[];Object.keys(i).forEach(function(t){r<i[t]?(r=i[t],o=[t]):r===i[t]&&o.push(t)}),1===o.length&&o[0]===n.clusterId||(0<=(e=o.indexOf(n.clusterId))&&o.splice(e,1),o&&o.length&&(a=!0,e=(t=s[n.clusterId]).nodes.indexOf(n),t.nodes.splice(e,1),e=Math.floor(Math.random()*o.length),(e=s[o[e]]).nodes.push(n),n.clusterId=e.id))}),!a)return"break";h++}(););Object.keys(s).forEach(function(t){var e=s[t];e.nodes&&e.nodes.length||delete s[t]});var l=[],d={};i.forEach(function(t){var e=t.source,n=t.target,i=t[r]||1,t=u[e].node.clusterId,e=u[n].node.clusterId,n=t+"---"+e;d[n]?(d[n].weight+=i,d[n].count++):(d[n]=i={source:t,target:e,weight:i,count:1},l.push(i))});var f=[];return Object.keys(s).forEach(function(t){f.push(s[t])}),{clusters:f,clusterEdges:l}},louvain:function(t,e,d,n){void 0===e&&(e=!1),void 0===d&&(d="weight"),void 0===n&&(n=1e-4);var i=t.nodes,r=void 0===i?[]:i,i=t.edges,f=void 0===i?[]:i,o=1,p={},g={};r.forEach(function(t,e){var n=String(o++);t.clusterId=n,p[n]={id:n,nodes:[t]},g[t.id]={node:t,idx:e}});var v=S(t,e),y=[],m={},x=0;v.forEach(function(t,e){var n=0,i=r[e].id;m[i]={},t.forEach(function(t,e){t&&(n+=t,e=r[e].id,m[i][e]=t,x+=t)}),y.push(n)}),x/=2;for(var a,s=1/0,u=0;a=function(t,e,n,i){for(var r=e.length,o=2*i,a=0,s=0;s<r;s++)for(var u=t[s].clusterId,c=0;c<r;c++)u===t[c].clusterId&&(a+=(e[s][c]||0)-(n[s]||0)*(n[c]||0)/o);return a*(1/o)}(r,v,y,x),!(Math.abs(a-s)<n||100<u);)s=a,u++,Object.keys(p).forEach(function(i){var r=0;f.forEach(function(t){var e=t.source,n=t.target,e=g[e].node.clusterId,n=g[n].node.clusterId;(e===i&&n!==i||n===i&&e!==i)&&(r+=t[d]||1)}),p[i].sumTot=r}),r.forEach(function(i,r){var o,t=p[i.clusterId],a=0,s=y[r]/(2*x),e=0;t.nodes.forEach(function(t){t=g[t.id].idx;e+=v[r][t]||0});var u,c,h,l=e-t.sumTot*s,n=m[i.id];Object.keys(n).forEach(function(t){var e,n=g[t].node.clusterId;n===i.clusterId||(n=(t=p[n]).nodes)&&n.length&&(e=0,n.forEach(function(t){t=g[t.id].idx;e+=v[r][t]||0}),n=e-t.sumTot*s-l,a<n&&(a=n,o=t))}),0<a&&(o.nodes.push(i),u=i.clusterId,i.clusterId=o.id,n=t.nodes.indexOf(i),t.nodes.splice(n,1),h=c=0,f.forEach(function(t){var e=t.source,n=t.target,e=g[e].node.clusterId,n=g[n].node.clusterId;(e===o.id&&n!==o.id||n===o.id&&e!==o.id)&&(c+=t[d]||1),(e===u&&n!==u||n===u&&e!==u)&&(h+=t[d]||1)}),o.sumTot=c,t.sumTot=h)});var c={},h=0;Object.keys(p).forEach(function(t){var e,n=p[t];n.nodes&&n.nodes.length?(e=String(h+1))!==t&&(n.id=e,n.nodes=n.nodes.map(function(t){return{id:t.id,clusterId:e}}),p[e]=n,c[t]=e,delete p[t],h++):delete p[t]}),r.forEach(function(t){t.clusterId&&c[t.clusterId]&&(t.clusterId=c[t.clusterId])});var l=[],b={};f.forEach(function(t){var e=t.source,n=t.target,i=t[d]||1,t=g[e].node.clusterId,e=g[n].node.clusterId,n=t+"---"+e;b[n]?(b[n].weight+=i,b[n].count++):(b[n]=i={source:t,target:e,weight:i,count:1},l.push(i))});var E=[];return Object.keys(p).forEach(function(t){E.push(p[t])}),{clusters:E,clusterEdges:l}},minimumSpanningTree:function(t,e,n){return n?{prim:function(t,n){var e=[],i=t.nodes,i=void 0===i?[]:i,t=t.edges,r=void 0===t?[]:t;if(0===i.length)return e;var i=i[0],o=new Set;o.add(i);var a=new m(function(t,e){return n?t.weight-e.weight:0});for(v(i.id,r).forEach(function(t){a.insert(t)});!a.isEmpty();){var s=a.delMin(),u=s.source,c=s.target;o.has(u)&&o.has(c)||(e.push(s),o.has(u)||(o.add(u),v(u,r).forEach(function(t){a.insert(t)})),o.has(c)||(o.add(c),v(c,r).forEach(function(t){a.insert(t)})))}return e},kruskal:k}[n](t,e):k(t,e)},pageRank:function(t,e,n){"number"!=typeof e&&(e=1e-6),"number"!=typeof n&&(n=.85);for(var i=1,r=0,o=1e3,a=t.nodes,s=void 0===a?[]:a,a=t.edges,u=void 0===a?[]:a,c=s.length,h={},l={},d=0;d<c;++d)h[g=(f=s[d]).id]=1/c,l[g]=1/c;for(var f,p=w(t);0<o&&e<i;){for(d=r=0;d<c;++d){var g=(f=s[d]).id,v=0;if(0===p[f.id].inDegree)h[g]=0;else{for(var y=E(g,u,"source"),m=0;m<y.length;++m){var x=y[m],b=p[x].outDegree;0<b&&(v+=l[x]/b)}h[g]=n*v,r+=h[g]}}for(r=(1-r)/c,d=i=0;d<c;++d)v=h[g=(f=s[d]).id]+r,i+=Math.abs(v-l[g]),l[g]=v;--o}return l},getNeighbors:E,Stack:R,GADDI:function(w,k,C,t,i,_,M){if(void 0===C&&(C=!1),void 0===_&&(_="cluster"),void 0===M&&(M="cluster"),w&&w.nodes){var e=w.nodes.length;if(e){var r=nt(w,C),n=nt(k,C),d=lt(w.nodes,r,C),o=lt(k.nodes,n,C),a=ct(w.nodes,_),I=a.nodeMap,s=a.nodeLabelMap,u=ct(k.nodes,_),T=u.nodeMap,A=u.nodeLabelMap;ht(w.edges,M,I);var P=ht(k.edges,M,T).edgeLabelMap;i=i||Math.max.apply(Math,tt(tt([],n[0]),[2]));var f=at(w,r,_,t=t||i),c=at(k,n,_,t),u=(H=e,q=Math.min(100,e*(e-1)/2),a=c,K=r,J=Math.ceil(q/H),Q={},$=0,a.forEach(function(t,e){for(var n=0,i=0,r=t.nodeIdxs,o=t.neighborNum-1;n<J;){for(var a=r[1+Math.floor(Math.random()*o)],s=0;(Q[e+"-"+a]||Q[a+"-"+e])&&(a=Math.floor(Math.random()*H),!(++s>2*H)););if(s<2*H&&(Q[e+"-"+a]={start:e,end:a,distance:K[e][a]},n++,++$>=q))return Q;if(++i>2*H)break}n<J&&(J=(J+(J-n))/(H-e-1))}),Q),p=st(u,f,w),a=(F=(n={graphs:p,nodeLabelProp:_,edgeLabelProp:M,minSupport:1,minNodeNum:1,maxNodeNum:4,directed:C}).graphs,z=e=void 0!==(t=n.directed)&&t,j=u=void 0===(a=n.nodeLabelProp)?ot:a,W=a=void 0===(t=n.edgeLabelProp)?ot:t,X={},Object.keys(F).forEach(function(t,e){var t=F[t],r=new it(e,!0,z),o={};t.nodes.forEach(function(t,e){r.addNode(e,t[j]),o[t.id]=e}),t.edges.forEach(function(t,e){var n=o[t.source],i=o[t.target];r.addEdge(-1,n,i,t[W])}),r&&r.getNodeNum()&&(X[r.id]=r)}),(e=new rt({graphs:t=X,minSupport:n.minSupport,maxNodeNum:n.maxNodeNum,minNodeNum:n.minNodeNum,top:n.top,verbose:n.verbose,directed:e})).run(),e=e.frequentSubgraphs,Z=u,V=a,Y=[],e.forEach(function(t){var n={nodes:[],edges:[]};t.nodes.forEach(function(t){var e;n.nodes.push(((e={id:""+t.id})[Z]=t.label,e))}),t.edges.forEach(function(t){var e;n.edges.push(((e={source:""+t.from,target:""+t.to})[V]=t.label,e))}),Y.push(n)}),Y.slice(0,10)),e=a.length,h=[];a.forEach(function(n,i){h[i]={},Object.keys(p).forEach(function(t){var e=p[t],e=ut(e,n,_,M);h[i][t]=e})});var a=function(s,t,e){for(var u=1/0,c=0,n=0;n<t;n++)!function(t){var o=s[t],e=Object.keys(o).sort(function(t,e){return o[t]-o[e]}),n=[];e.forEach(function(t,e){n[e%10]||(n[e%10]={graphs:[],totalCount:0,aveCount:0}),n[e%10].graphs.push(t),n[e%10].totalCount+=o[t]});var i=0,a=[];n.forEach(function(e){var t=e.totalCount/e.graphs.length;e.aveCount=t,a.push(t);var r=0,t=e.length;e.graphs.forEach(function(t,n){var i=o[t];e.graphs.forEach(function(t,e){n!==e&&(r+=Math.abs(i-o[t]))})}),i+=r/=t*(t-1)/2}),i/=n.length;var r=0;a.forEach(function(n,i){a.forEach(function(t,e){i!==e&&(r+=Math.abs(n-t))}),r/=a.length*(a.length-1)/2});e=r-i;u<e&&(u=e,c=t)}(n);return{structure:e[c],structureCountMap:s[c]}}(h,e,a),g=a.structure,v=a.structureCountMap,D=k.nodes[0],y=D[_],m=s[y],N={},x={},b={},E={},S={};Object.keys(A).forEach(function(h,t){S[h]=[];var n=-1/0,e=A[h],i={};e.forEach(function(t){var e=o[D.id+"-"+t.id];e&&S[h].push(e),n<e&&(n=e),i[D.id+"-"+t.id]={start:0,end:T[t.id].idx,distance:e}}),S[h]=S[h].sort(function(t,e){return t-e}),x=st(i,c,k,x);var l=[];if(Object.keys(i).forEach(function(t){var e;b[t]||(e=x[t],b[t]=ut(e,g,_,M)),l.push(b[t])}),l=l.sort(function(t,e){return e-t}),E[D.id+"-"+h]=l,h!==y)for(var r=m.length-1;0<=r;r--)!function(t){var n=m[t],e=f[I[n.id].idx],i=e.nodeLabelCountMap[h],r=A[h].length;if(!i||i.count<r)return m.splice(t,1);for(var o=!1,a=0;a<r;a++)if(i.dists[a]>S[h][a]){o=!0;break}if(o)return m.splice(t,1);var s={};e.neighbors.forEach(function(t){var e=d[n.id+"-"+t.id];s[n.id+"-"+t.id]={start:I[n.id].idx,end:I[t.id].idx,distance:e}}),p=st(s,f,w,p);var u=[];Object.keys(s).forEach(function(t){var e;v[t]||(e=p[t],v[t]=ut(e,g,_,M)),u.push(v[t])});for(var u=u.sort(function(t,e){return e-t}),c=!1,a=0;a<r;a++)if(u[a]<l[a]){c=!0;break}c&&m.splice(t,1)}(r)});var O=[];m.forEach(function(l){for(var t=I[l.id].idx,o=dt(w.nodes,r[t],t,_,i).neighbors,t=o.length,a=!1,e=t-1;0<=e;e--){var n=function(t){if(o.length+1<k.nodes.length)return a=!0,{value:void 0};var c=o[t],e=c[_];if(!A[e]||!A[e].length)return o.splice(t,1),"continue";var n=l.id+"-"+c.id;if(!S[e]||!S[e].length)return o.splice(t,1),"continue";var h=d[n];if(h>S[e][S[e].length-1])return o.splice(t,1),"continue";var i=v[n]||function(t,e,n,i,r,o){var a,s=l.id+"-"+c.id;if(v&&v[s])return v[s];var u=o?o[s]:void 0;return u||((a={})[s]={start:I[l.id].idx,end:I[c.id].idx,distance:h},u=(o=st(a,e,t,o))[s]),ut(u,n,i,r)}(w,f,g,_,M,p),n=D.id+"-"+e;if(i<E[n][E[n].length-1])return o.splice(t,1),"continue";var r=N[e];return void 0===r&&(r=1/0,A[e].forEach(function(t){t=T[t.id].degree;t<r&&(r=t)}),N[e]=r),I[c.id].degree<r?(o.splice(t,1),"continue"):void 0}(e);if("object"==typeof n)return n.value}a||O.push({nodes:[l].concat(o)})});var l=et(k,D.id,!1).length,L={};C?(Object.keys(l).forEach(function(t){var e=T[t].node[_];L[e]?L[e].push(l[t]):L[e]=[l[t]]}),Object.keys(L).forEach(function(t){L[t].sort(function(t,e){return t-e})})):L=S;for(var R=function(t){var r=O[t],e=r.nodes[0],o={},s={};r.nodes.forEach(function(t,e){s[t.id]={idx:e,node:t,degree:0};t=t[_];o[t]?o[t]++:o[t]=1});var u=[],c={};w.edges.forEach(function(t){s[t.source]&&s[t.target]&&(u.push(t),c[t[M]]?c[t[M]]++:c[t[M]]=1,s[t.source].degree++,s[t.target].degree++)});for(var n=Object.keys(P).length,i=!1,a=0;a<n;a++){var h=Object.keys(P)[a];if(!c[h]||c[h]<P[h].length){i=!0;break}}if(i)return O.splice(t,1),"continue";var l=u.length;if(l<k.edges.length)return O.splice(t,1),"break";for(var d=!1,a=l-1;0<=a&&"break"!==function(t){var e=u[t],n=e[M],i=P[n];if(!i||!i.length)return c[n]--,i&&c[n]<i.length?(d=!0,"break"):(u.splice(t,1),s[e.source].degree--,s[e.target].degree--,"continue");var r=s[e.source].node[_],o=s[e.target].node[_],a=!1;return i.forEach(function(t){var e=T[t.source].node,t=T[t.target].node;e[_]===r&&t[_]===o&&(a=!0),C||e[_]!==o||t[_]!==r||(a=!0)}),a?void 0:(c[n]--,i&&c[n]<i.length?(d=!0,"break"):(u.splice(t,1),s[e.source].degree--,s[e.target].degree--,"continue"))}(a);a--);if(d)return O.splice(t,1),"continue";r.edges=u;var f=et(r,r.nodes[0].id,!1).length;if(Object.keys(f).reverse().forEach(function(t){if(t!==r.nodes[0].id&&!d){if(f[t]===1/0){var e=s[t].node[_];if(o[e]--,o[e]<A[e].length)return void(d=!0);var n=r.nodes.indexOf(s[t].node);return r.nodes.splice(n,1),void(s[t]=void 0)}var i=I[t].node[_];L[i]&&L[i].length&&!(f[t]>L[i][L[i].length-1])||(e=s[t].node[_],o[e]--,o[e]<A[e].length?d=!0:(n=r.nodes.indexOf(s[t].node),r.nodes.splice(n,1),s[t]=void 0))}}),d)return O.splice(t,1),"continue";for(var p=!0,g=0;p&&!d;){if(p=!1,s[e.id].degree<T[D.id].degree){d=!0;break}if(o[e[_]]<A[e[_]].length){d=!0;break}for(var v=r.nodes.length-1;0<=v;v--){var y=r.nodes[v],m=s[y.id].degree,x=y[_];if(m<N[x]){if(o[y[_]]--,o[y[_]]<A[y[_]].length){d=!0;break}r.nodes.splice(v,1),p=!(s[y.id]=void 0)}}if(d||!p&&0!==g)break;for(var b=u.length-1;0<=b;b--){var E=u[b];if(!s[E.source]||!s[E.target]){u.splice(b,1);var S=E[M];if(c[S]--,s[E.source]&&s[E.source].degree--,s[E.target]&&s[E.target].degree--,P[S]&&c[S]<P[S].length){d=!0;break}p=!0}}g++}return d||d||r.nodes.length<k.nodes.length||u.length<k.edges.length?(O.splice(t,1),"continue"):void 0},B=O.length-1;0<=B&&"break"!==R(B);B--);for(var G=O.length,U=function(t){var e=O[t],r={};e.edges.forEach(function(t){t=t.source+"-"+t.target+"-"+t.label;r[t]?r[t]++:r[t]=1});for(var n=G-1;t<n;n--)!function(t){var e=O[t],n={};e.edges.forEach(function(t){t=t.source+"-"+t.target+"-"+t.label;n[t]?n[t]++:n[t]=1});var i=!0;Object.keys(n).length!==Object.keys(r).length?i=!1:Object.keys(r).forEach(function(t){n[t]!==r[t]&&(i=!1)}),i&&O.splice(t,1)}(n);G=O.length},B=0;B<=G-1;B++)U(B);return O}}var F,z,j,W,X,Z,V,Y,H,q,K,J,Q,$},getAdjMatrixAsync:function(t,e){return F("getAdjMatrix").apply(void 0,[t,e])},connectedComponentAsync:function(t,e){return F("connectedComponent").apply(void 0,[t,e])},getDegreeAsync:function(t){return F("getDegree")(t)},getInDegreeAsync:function(t,e){return F("getInDegree")(t,e)},getOutDegreeAsync:function(t,e){return F("getOutDegree")(t,e)},detectCycleAsync:function(t){return F("detectCycle")(t)},dijkstraAsync:function(t,e,n,i){return F("dijkstra").apply(void 0,[t,e,n,i])},findAllPathAsync:function(t,e,n,i){return F("findAllPath").apply(void 0,[t,e,n,i])},findShortestPathAsync:function(t,e,n,i,r){return F("findShortestPath").apply(void 0,[t,e,n,i,r])},floydWarshallAsync:function(t,e){return F("floydWarshall").apply(void 0,[t,e])},labelPropagationAsync:function(t,e,n,i){return void 0===i&&(i=1e3),F("labelPropagation")(t,e,n,i)},louvainAsync:function(t,e,n,i){return F("louvain")(t,e,n,i)},minimumSpanningTreeAsync:function(t,e,n){return F("minimumSpanningTree").apply(void 0,[t,e,n])},pageRankAsync:function(t,e,n){return F("pageRank").apply(void 0,[t,e,n])},getNeighborsAsync:function(t,e,n){return F("getNeighbors").apply(void 0,[t,e,n])},GADDIAsync:function(t,e,n,i,r,o,a){return void 0===n&&(n=!1),void 0===o&&(o="cluster"),void 0===a&&(a="cluster"),F("GADDI").apply(void 0,[t,e,n,i,r,o,a])}}})(),W.default})()},20499:function(){},64851:function(){},59518:function(){},26199:function(){},14156:function(){},71468:function(){},48871:function(){},9871:function(){},25612:function(){},92777:function(){},20159:function(){},61622:function(){},96053:function(t,e,n){"use strict";n.d(e,{ZP:function(){return zx}});var i={};n.r(i),n.d(i,{Line:function(){return $t},applyMatrix:function(){return Gt},compare:function(){return Nt},distance:function(){return zt},floydWarshall:function(){return Wt},fractionToLine:function(){return ae},getAdjMatrix:function(){return Xt},getBBoxBoundLine:function(){return re},getCircleCenterByPoints:function(){return Ft},getCircleIntersectByPoint:function(){return Rt},getDegree:function(){return qt},getEllipseIntersectByPoint:function(){return Bt},getLineIntersect:function(){return Ot},getPointsCenter:function(){return se},getRectIntersectByPoint:function(){return Lt},intersectBBox:function(){return Jt},invertMatrix:function(){return Ut},isPointInPolygon:function(){return Kt},isPointsOverlap:function(){return he},isPolygonsIntersect:function(){return Qt},itemIntersectByLine:function(){return oe},move:function(){return Vt},pointLineDistance:function(){return de},pointLineSquareDist:function(){return ce},pointRectSquareDist:function(){return le},rotate:function(){return Ht},scale:function(){return Yt},scaleMatrix:function(){return jt},squareDist:function(){return ue},translate:function(){return Zt}});var r={};n.r(r),n.d(r,{cloneBesidesImg:function(){return Fe},getBBox:function(){return Te},getComboBBox:function(){return Ge},getLabelPosition:function(){return Pe},getLetterWidth:function(){return Oe},getLoopCfgs:function(){return Ae},getTextSize:function(){return Le},plainCombosToTrees:function(){return Re},reconstructTree:function(){return Be},shouldRefreshEdge:function(){return Ue},traverseTree:function(){return De},traverseTreeUp:function(){return Ne}});var o={};n.r(o),n.d(o,{catmullRomToBezier:function(){return on},fillPath:function(){return gn},fillPathByDiff:function(){return yn},formatPath:function(){return bn},intersection:function(){return dn},parsePathArray:function(){return hn},parsePathString:function(){return rn},pathToAbsolute:function(){return an},pathToCurve:function(){return un},rectPath:function(){return ln}});var a={};n.r(a),n.d(a,{calculationItemsBBox:function(){return Tr},cloneEvent:function(){return _r},formatPadding:function(){return Cr},isNaN:function(){return Ir},isViewportChanged:function(){return Mr},processParallelEdges:function(){return Ar},uniqueId:function(){return kr}});var s={};n.r(s),n.d(s,{getClosedSpline:function(){return ko},getControlPoint:function(){return Eo},getSpline:function(){return bo},paddedHull:function(){return To},pathToPoints:function(){return wo},pointsToPolygon:function(){return So},roundedHull:function(){return Io}});var u={};n.r(u),n.d(u,{defaultSubjectColors:function(){return Ko}});var c={};n.r(c),n.d(c,{Base:function(){return Xa},Circle:function(){return Ya},Ellipse:function(){return Ja},Image:function(){return es},Line:function(){return os},Marker:function(){return ss},Path:function(){return xs},Polygon:function(){return ws},Polyline:function(){return _s},Rect:function(){return Ts},Text:function(){return Ds}});var h={};n.r(h),n.d(h,{Base:function(){return eu},Circle:function(){return ru},Dom:function(){return su},Ellipse:function(){return hu},Image:function(){return fu},Line:function(){return vu},Marker:function(){return Eu},Path:function(){return ku},Polygon:function(){return Mu},Polyline:function(){return Au},Rect:function(){return Nu},Text:function(){return Gu}});var l={};n.r(l),n.d(l,{getColorSetsBySubjectColors:function(){return Mc},getColorsWithSubjectColor:function(){return _c},mixColor:function(){return Cc}});var d={};n.r(d),n.d(d,{gpuDetector:function(){return yg}});var f={};n.r(f),n.d(f,{arrayToTextureData:function(){return Zg},attributesToTextureData:function(){return Xg},buildTextureData:function(){return zg},buildTextureDataWithOneEdgeAttr:function(){return jg},buildTextureDataWithTwoEdgeAttr:function(){return Wg},proccessToFunc:function(){return Fg},radialLayout:function(){return Vg}});function g(t){var e=typeof t;return null!==t&&"object"==e||"function"==e}var p={}.toString,v=function(t,e){return p.call(t)==="[object "+e+"]"},y=function(t){return v(t,"Function")},m=function(t){return Array.isArray?Array.isArray(t):v(t,"Array")};var S=function(t,e){if(t)if(m(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if(g(t))for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break};Object.keys;var x=function(t){return"object"==typeof t&&null!==t},w=function(t){if(!x(t)||!v(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var b=function(t){if(m(t))return t.reduce(function(t,e){return Math.max(t,e)},t[0])},E=function(t){if(m(t))return t.reduce(function(t,e){return Math.min(t,e)},t[0])},k=function(t){var e=t.filter(function(t){return!isNaN(t)});if(!e.length)return{min:0,max:0};if(m(t[0])){for(var n=[],i=0;i<t.length;i++)n=n.concat(t[i]);e=n}var r=b(e);return{min:E(e),max:r}},C=Array.prototype,_=(C.splice,C.indexOf,Array.prototype.splice,function(t){return v(t,"String")});var M=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)};function z(t){if(M(t))return t[0]}function j(t){if(M(t))return t[t.length-1]}var I=function(t,e){if(!M(t))return t;for(var n=[],i=0;i<t.length;i++){var r=t[i];e(r,i)&&n.push(r)}return n},T=Object.prototype.hasOwnProperty;var A=function(t,e){if(!e||!m(t))return{};for(var n={},i=y(e)?e:function(t){return t[e]},r=0;r<t.length;r++){var o=t[r],a=i(o);T.call(n,a)?n[a].push(o):n[a]=[o]}return n};var P=function(e,n){return e["_wrap_"+n]||(e["_wrap_"+n]=t);function t(t){e[n](t)}};var D=function(t,e){var n=e.toString(),e=n.indexOf(".");if(-1===e)return Math.round(t);e=n.substr(e+1).length;return 20<e&&(e=20),parseFloat(t.toFixed(e))},N=function(t){return v(t,"Number")},O=(Number.isInteger,1e-5);var L=function(t,e){return(t%e+e)%e},R=(Math.PI,parseInt,Math.PI/180),B=function(t){return R*t},G=(Object.values,function(t){return null==t}),U=function(t){t=G(t=t)?"":t.toString();return t.charAt(0).toUpperCase()+t.substring(1)},F={}.toString,W=function(t){return F.call(t).replace(/^\[object /,"").replace(/]$/,"")},X=function(t){return v(t,"Boolean")},Z=function(t){return v(t,"Date")};var V=Object.prototype,Y=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||V)};var H=function(t){if("object"!=typeof t||null===t)return t;if(m(t))for(var e=[],n=0,i=t.length;n<i;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=H(t[n]):e[n]=t[n];else for(var r in e={},t)"object"==typeof t[r]&&null!=t[r]?e[r]=H(t[r]):e[r]=t[r];return e},q=H;var K=function(i,r,o){var a;return function(){var t=this,e=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||i.apply(t,e)},r),n&&i.apply(t,e)}},J=5;var Q=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i+=1)!function t(e,n,i,r){for(var o in i=i||0,r=r||J,n){var a;n.hasOwnProperty(o)&&(null!==(a=n[o])&&w(a)?(w(e[o])||(e[o]={}),i<r?t(e[o],a,i+1,r):e[o]=n[o]):m(a)?(e[o]=[],e[o]=e[o].concat(a)):void 0!==a&&(e[o]=a))}}(t,e[i]);return t},$=function(t,e){if(!M(t))return-1;var n=Array.prototype.indexOf;if(n)return n.call(t,e);for(var i=-1,r=0;r<t.length;r++)if(t[r]===e){i=r;break}return i},tt=Object.prototype.hasOwnProperty;var et=function(t){if(G(t))return!0;if(M(t))return!t.length;var e,n=W(t);if("Map"===n||"Set"===n)return!t.size;if(Y(t))return!Object.keys(t).length;for(e in t)if(tt.call(t,e))return!1;return!0},nt=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(_(t)||_(e))return!1;if(M(t)||M(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=nt(t[i],e[i]));i++);return n}if(x(t)||x(e)){var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(n=!0,i=0;i<r.length&&(n=nt(t[r[i]],e[r[i]]));i++);return n}return!1},it=nt,rt=function(t,e){if(!M(t))return t;for(var n=[],i=0;i<t.length;i++){var r=t[i];n.push(e(r,i))}return n};function ot(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}function at(t,e,n,i){return e&&ot(t,e),n&&ot(t,n),i&&ot(t,i),t}function st(t,e,n){for(var i=0,r=_(e)?e.split("."):e;t&&i<r.length;)t=t[r[i++]];return void 0===t||i<r.length?n:t}function ut(n,i,r){var o,a,s,u,c=0;function h(){c=!1===r.leading?0:Date.now(),o=null,u=n.apply(a,s),o||(a=s=null)}function t(){var t=Date.now();c||!1!==r.leading||(c=t);var e=i-(t-c);return a=this,s=arguments,e<=0||i<e?(o&&(clearTimeout(o),o=null),c=t,u=n.apply(a,s),o||(a=s=null)):o||!1===r.trailing||(o=setTimeout(h,e)),u}return r=r||{},t.cancel=function(){clearTimeout(o),c=0,o=a=s=null},t}Object.prototype.hasOwnProperty;function ct(t){return dt[t=t||"g"]?dt[t]+=1:dt[t]=1,t+dt[t]}function ht(){}var lt=function(t){return M(t)?Array.prototype.slice.call(t):[]},dt={};function ft(t){return G(t)?0:(M(t)?t:Object.keys(t)).length}pt.prototype.has=function(t){return void 0!==this.map[t]},pt.prototype.get=function(t,e){t=this.map[t];return void 0===t?e:t},pt.prototype.set=function(t,e){this.map[t]=e},pt.prototype.clear=function(){this.map={}},pt.prototype.delete=function(t){delete this.map[t]},pt.prototype.size=function(){return Object.keys(this.map).length};function pt(){this.map={}}var gt={getDefaultCfg:function(){return{}},getEvents:function(){return{}},updateCfg:function(t){return Object.assign(this,t),!0},shouldBegin:function(){return!0},shouldUpdate:function(){return!0},shouldEnd:function(){return!0},bind:function(n){var t=this,e=this.events;this.graph=n,"drag-canvas"!==this.type&&"brush-select"!==this.type&&"lasso-select"!==this.type||n.get("canvas").set("draggable",!0),S(e,function(t,e){n.on(e,t)}),document.addEventListener("visibilitychange",function(){t.keydown=!1})},unbind:function(n){var t=this.events;"drag-canvas"!==this.type&&"brush-select"!==this.type&&"lasso-select"!==this.type||n.get("canvas").set("draggable",!1),S(t,function(t,e){n.off(e,t)})},get:function(t){return this[t]},set:function(t,e){return this[t]=e,this}};function vt(){}var yt=(vt.registerBehavior=function(t,e){if(!e)throw new Error("please specify handler for this behavior: "+t);var n=q(gt);Object.assign(n,e);e=function(t){var n=this;Object.assign(this,this.getDefaultCfg(),t);t=this.getEvents();this.events=null;var i={};t&&(S(t,function(t,e){i[e]=P(n,t)}),this.events=i)};e.prototype=n,vt.types[t]=e},vt.hasBehavior=function(t){return!!vt.types[t]},vt.getBehavior=function(t){return vt.types[t]},vt.types={},vt),mt=yt,xt=function(t,e){return(xt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function bt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}xt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Et=function(){return(Et=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function St(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}Object.create;function wt(t,e){for(var n=0,i=e.length,r=t.length;n<i;n++,r++)t[r]=e[n];return t}Object.create;function kt(){this._events={}}var Ct=(kt.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},kt.prototype.once=function(t,e){return this.on(t,e,!0),this},kt.prototype.emit=function(o){for(var a=this,s=[],t=1;t<arguments.length;t++)s[t-1]=arguments[t];function e(t){for(var e,n,i=t.length,r=0;r<i;r++)t[r]&&(n=(e=t[r]).callback,e.once&&(t.splice(r,1),0===t.length&&delete a._events[o],i--,r--),n.apply(a,s))}var n=this._events[o]||[],i=this._events["*"]||[];e(n),e(i)},kt.prototype.off=function(t,e){if(t)if(e){for(var n=this._events[t]||[],i=n.length,r=0;r<i;r++)n[r].callback===e&&(n.splice(r,1),i--,r--);0===n.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},kt.prototype.getEvents=function(){return this._events},kt),_t=n(35600);function Mt(t,e){for(var n,i,r,o,a,s,u,c,h=t?[].concat(t):[1,0,0,0,1,0,0,0,1],l=0,d=e.length;l<d;l++){var f=e[l];switch(f[0]){case"t":s=a=h,u=[f[1],f[2]],c=void 0,c=[0,0,0,0,0,0,0,0,0],_t.fromTranslation(c,u),_t.multiply(a,c,s);break;case"s":o=a=h,c=[f[1],f[2]],s=void 0,s=[0,0,0,0,0,0,0,0,0],_t.fromScaling(s,c),_t.multiply(a,s,o);break;case"r":i=n=h,o=f[1],r=void 0,r=[0,0,0,0,0,0,0,0,0],_t.fromRotation(r,o),_t.multiply(n,r,i);break;case"m":r=n=h,i=f[1],_t.multiply(n,i,r)}}return h}function It(t,e,n){return e<=t&&t<=n}var Tt=n(53236),At=n(77160),Pt=n(31437),Dt=Mt,Nt=function(n){return function(t,e){return t[n]-e[n]}},Ot=function(t,e,n,i){var r=n.x-t.x,o=n.y-t.y,a=e.x-t.x,s=e.y-t.y,u=i.x-n.x,e=i.y-n.y,i=a*e-s*u,n=1/i;if(1e-4*(a*a+s*s)*(u*u+e*e)<i*i){u=(r*e-o*u)*n;return It(u,0,1)&&It((r*s-o*a)*n,0,1)?{x:t.x+u*a,y:t.y+u*s}:null}return null},Lt=function(t,e){var n=t.x,i=t.y,r=t.width,t=t.height,o=[],a={x:n+r/2,y:i+t/2};o.push({x:n,y:i}),o.push({x:n+r,y:i}),o.push({x:n+r,y:i+t}),o.push({x:n,y:i+t}),o.push({x:n,y:i});for(var s=null,u=1;u<o.length&&!(s=Ot(o[u-1],o[u],a,e));u++);return s},Rt=function(t,e){var n=t.x,i=t.y,r=t.r,o=e.x-n,a=e.y-i;if(Math.sqrt(o*o+a*a)<r)return null;t=Math.sign(o),e=Math.sign(a),o=Math.atan(a/o);return{x:n+Math.abs(r*Math.cos(o))*t,y:i+Math.abs(r*Math.sin(o))*e}},Bt=function(t,e){var n=t.rx,i=t.ry,r=t.x,o=t.y,t=e.x-r,e=e.y-o,t=Math.atan2(e/i,t/n);return t<0&&(t+=2*Math.PI),{x:r+n*Math.cos(t),y:o+i*Math.sin(t)}},Gt=function(t,e,n){n=[t.x,t.y,n=void 0===n?1:n];return e&&!isNaN(e[0])||(e=[1,0,0,0,1,0,0,0,1]),At.kK(n,n,e),{x:n[0],y:n[1]}},Ut=function(t,e,n){void 0===n&&(n=1),e&&!isNaN(e[0])||(e=[1,0,0,0,1,0,0,0,1]);e=_t.invert([1,0,0,0,1,0,0,0,1],e),n=[t.x,t.y,n];return At.kK(n,n,e=e||[1,0,0,0,1,0,0,0,1]),{x:n[0],y:n[1]}},Ft=function(t,e,n){var i=t.x-e.x,r=t.y-e.y,o=t.x-n.x,a=t.y-n.y,e=(t.x*t.x-e.x*e.x-e.y*e.y+t.y*t.y)/2,n=(t.x*t.x-n.x*n.x-n.y*n.y+t.y*t.y)/2,t=r*o-i*a;return{x:-(a*e-r*n)/t,y:-(i*n-o*e)/t}},zt=function(t,e){var n=t.x-e.x,e=t.y-e.y;return Math.sqrt(n*n+e*e)},jt=function(t,n){var i=[];return t.forEach(function(t){var e=[];t.forEach(function(t){e.push(t*n)}),i.push(e)}),i},Wt=function(t){for(var e=[],n=t.length,i=0;i<n;i+=1){e[i]=[];for(var r=0;r<n;r+=1)i===r?e[i][r]=0:0!==t[i][r]&&t[i][r]?e[i][r]=t[i][r]:e[i][r]=1/0}for(var o=0;o<n;o+=1)for(i=0;i<n;i+=1)for(r=0;r<n;r+=1)e[i][r]>e[i][o]+e[o][r]&&(e[i][r]=e[i][o]+e[o][r]);return e},Xt=function(t,n){var e=t.nodes,t=t.edges,i=[],r={};if(!e)throw new Error("invalid nodes data!");return e&&e.forEach(function(t,e){r[t.id]=e;i.push([])}),t&&t.forEach(function(t){var e=t.source,t=t.target,e=r[e],t=r[t];i[e][t]=1,n||(i[t][e]=1)}),i},Zt=function(t,e){t.translate(e.x,e.y)},Vt=function(t,e){var n=(n=t.getMatrix())||[1,0,0,0,1,0,0,0,1],i=t.getCanvasBBox(),r=e.x-i.minX,i=e.y-i.minY,i=Dt(n,[["t",r,i]]);t.setMatrix(i)},Yt=function(t,e){var n=(n=t.getMatrix())||[1,0,0,0,1,0,0,0,1],i=e;m(e)||(i=[e,e]),m(e)&&1===e.length&&(i=[e[0],e[0]]),n=Dt(n,[["s",i[0],i[1]]]),t.setMatrix(n)},Ht=function(t,e){var n=t.getMatrix();n=Dt(n=n||[1,0,0,0,1,0,0,0,1],[["r",e]]),t.setMatrix(n)},qt=function(t,e,n){for(var i=[],r=0;r<t;r++)i[r]=0;return n.forEach(function(t){t.source&&(i[e[t.source]]+=1),t.target&&(i[e[t.target]]+=1)}),i};var Kt=function(t,e,n){var i=!1,r=t.length,o=1e-6;function a(t){return Math.abs(t)<o?0:t<0?-1:1}if(r<=2)return!1;for(var s,u,c,h=0;h<r;h++){var l=t[h],d=t[(h+1)%r];if(u=d,((c=[e,n])[0]-(s=l)[0])*(u[1]-s[1])==(u[0]-s[0])*(c[1]-s[1])&&Math.min(s[0],u[0])<=c[0]&&c[0]<=Math.max(s[0],u[0])&&Math.min(s[1],u[1])<=c[1]&&c[1]<=Math.max(s[1],u[1]))return!0;0<a(l[1]-n)!=0<a(d[1]-n)&&a(e-(n-l[1])*(l[0]-d[0])/(l[1]-d[1])-l[0])<0&&(i=!i)}return i},Jt=function(t,e){return!(e.minX>t.maxX||e.maxX<t.minX||e.minY>t.maxY||e.maxY<t.minY)},Qt=function(e,n){var t=function(t){var e=t.map(function(t){return t[0]}),t=t.map(function(t){return t[1]});return{minX:Math.min.apply(null,e),maxX:Math.max.apply(null,e),minY:Math.min.apply(null,t),maxY:Math.max.apply(null,t)}},i=function(t){for(var e,n,i=[],r=t.length,o=0;o<r-1;o++){var a=t[o],s=t[o+1];i.push({from:{x:a[0],y:a[1]},to:{x:s[0],y:s[1]}})}return 1<i.length&&(e=t[0],n=t[r-1],i.push({from:{x:n[0],y:n[1]},to:{x:e[0],y:e[1]}})),i};if(e.length<2||n.length<2)return!1;var r=t(e),t=t(n);if(!Jt(r,t))return!1;var o=!1;if(S(n,function(t){if(Kt(e,t[0],t[1]))return!(o=!0)}),o)return!0;if(S(e,function(t){if(Kt(n,t[0],t[1]))return!(o=!0)}),o)return!0;var a=i(e),i=i(n),s=!1;return S(i,function(t){if(e=t,n=!1,S(a,function(t){if(Ot(t.from,t.to,e.from,e.to))return!(n=!0)}),n)return!(s=!0);var e,n}),s},$t=(te.prototype.getBBox=function(){var t=Math.min(this.x1,this.x2),e=Math.min(this.y1,this.y2),n=Math.max(this.x1,this.x2),i=Math.max(this.y1,this.y2);return{x:t,y:e,minX:t,minY:e,maxX:n,maxY:i,width:n-t,height:i-e}},te);function te(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i}function ee(t,e){if(!1===e(t))return!1;if(t&&t.children)for(var n=t.children.length-1;0<=n;n--)if(!ee(t.children[n],e))return!1;return!0}function ne(t,e){if(t&&t.children)for(var n=t.children.length-1;0<=n;n--)if(!ne(t.children[n],e))return;return!1!==e(t)}function ie(t){if(t){var e=t.nodes,n=t.edges,i=void 0===(i=t.combos)?[]:i;if(!e&&!n){var r=!0;return De(t,function(t){return!!_(t.id)||(r=!1)}),r}if(!(t=(e||[]).find(function(t){return!_(t.id)}))){var e=(e||[]).map(function(t){return t.id}),i=i.map(function(t){return t.id}),o=wt(wt([],e),i);return!(n=(n||[]).find(function(t){return!o.includes(t.source)||!o.includes(t.target)}))}}}var re=function(t,e){return{top:[t.minX,t.minY,t.maxX,t.minY],left:[t.minX,t.minY,t.minX,t.maxY],bottom:[t.minX,t.maxY,t.maxX,t.maxY],right:[t.maxX,t.minY,t.maxX,t.maxY]}[e]},oe=function(t,e){for(var n=["top","left","bottom","right"],i=t.getBBox(),r=0,o=[],a=0;a<4;a++){var s=re(i,n[a]),u=s[0],c=s[1],h=s[2],s=s[3];o[a]=Ot({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},{x:u,y:c},{x:h,y:s}),o[a]&&(r+=1)}return[o,r]},ae=function(t,e){for(var n=["top","left","bottom","right"],i=t.getBBox(),r=Number.POSITIVE_INFINITY,o=0,a=0;a<4;a++){var s=re(i,n[a]),u=s[0],c=s[1],h=s[2],s=s[3],s=function(t,e){var n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),t=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(t){n=n/t,t=i/t;if(0<=n&&n<=1&&0<=t&&t<=1)return n}return Number.POSITIVE_INFINITY}(e,new $t(u,c,h,s));0<=(s=Math.abs(s-.5))&&s<=1&&(o+=1,r=s<r?s:r)}return 0===o?-1:r},se=function(t){var e=0,n=0;if(0<t.length){for(var i=0,r=t;i<r.length;i++){var o=r[i];e+=o.x,n+=o.y}e/=t.length,n/=t.length}return{x:e,y:n}},ue=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},ce=function(t,e){var n=e.x1,i=e.y1,r=e.x2-n,e=e.y2-i,n=t.x-n,t=t.y-i,i=n*r+t*e,e=i<=0||(i=(n=r-n)*r+(t=e-t)*e)<=0?0:i*i/(r*r+e*e),e=n*n+t*t-e;return e=e<0?0:e},he=function(t,e,n){return void 0===n&&(n=.001),Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<Math.pow(n,2)},le=function(t,e){var n=t.x<e.x,i=t.x>e.x+e.width,r=t.y>e.y+e.height,o=t.y<e.y;if(!(n||i||r||o))return 0;if(r&&!n&&!i)return Math.pow(e.y+e.height-t.y,2);if(o&&!n&&!i)return Math.pow(t.y-e.y,2);if(n&&!r&&!o)return Math.pow(e.x-t.x,2);if(i&&!r&&!o)return Math.pow(e.x+e.width-t.x,2);o=Math.min(Math.abs(e.x-t.x),Math.abs(e.x+e.width-t.x)),t=Math.min(Math.abs(e.y-t.y),Math.abs(e.y+e.height-t.y));return o*o+t*t},de=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],t=e.x,e=e.y,o=[r-n,o-i];if(Pt.I6(o,[0,0]))return NaN;o=[-o[1],o[0]];return Pt.Fv(o,o),Math.abs(Pt.AK([t-n,e-i],o))},fe="rgb(95, 149, 255)",pe="rgb(0, 0, 0)",ge="rgb(247, 250, 255)",ve="rgb(239, 244, 255)",ye="rgb(253, 253, 253)",me="rgb(250, 250, 250)",xe="rgb(224, 224, 224)",be="rgb(234, 234, 234)",Ee="#4572d9",Se={version:"0.2.7",rootContainerClassName:"root-container",nodeContainerClassName:"node-container",edgeContainerClassName:"edge-container",comboContainerClassName:"combo-container",delegateContainerClassName:"delegate-container",defaultLoopPosition:"top",nodeLabel:{style:{fill:"#000",fontSize:12,textAlign:"center",textBaseline:"middle"},offset:4},defaultNode:{type:"circle",style:{lineWidth:1,stroke:fe,fill:ve},size:20,color:fe,linkPoints:{size:8,lineWidth:1,fill:ge,stroke:fe}},nodeStateStyles:{active:{fill:ge,stroke:fe,lineWidth:2,shadowColor:fe,shadowBlur:10},selected:{fill:"rgb(255, 255, 255)",stroke:fe,lineWidth:4,shadowColor:fe,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{fill:"rgb(223, 234, 255)",stroke:Ee,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{fill:ge,stroke:"rgb(191, 213, 255)",lineWidth:1},disable:{fill:me,stroke:xe,lineWidth:1}},edgeLabel:{style:{fill:pe,textAlign:"center",textBaseline:"middle",fontSize:12}},defaultEdge:{type:"line",size:1,style:{stroke:xe,lineAppendWidth:2},color:xe},edgeStateStyles:{active:{stroke:fe,lineWidth:1},selected:{stroke:fe,lineWidth:2,shadowColor:fe,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:fe,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{stroke:be,lineWidth:1},disable:{stroke:"rgb(245, 245, 245)",lineWidth:1}},comboLabel:{style:{fill:pe,textBaseline:"middle",fontSize:12},refY:10,refX:10},defaultCombo:{type:"circle",style:{fill:ye,lineWidth:1,stroke:xe,r:5,width:20,height:10},size:[20,5],color:xe,padding:[25,20,15,20]},comboStateStyles:{active:{stroke:fe,lineWidth:1,fill:ge},selected:{stroke:fe,lineWidth:2,fill:ye,shadowColor:fe,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:Ee,lineWidth:2,fill:ye,"text-shape":{fontWeight:500}},inactive:{stroke:xe,fill:ye,lineWidth:1},disable:{stroke:be,fill:me,lineWidth:1}},delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]}},we={" ":.3329986572265625,a:.5589996337890625,A:.6569992065429687,b:.58599853515625,B:.6769989013671875,c:.5469985961914062,C:.7279998779296875,d:.58599853515625,D:.705999755859375,e:.554998779296875,E:.63699951171875,f:.37299957275390627,F:.5769989013671875,g:.5909988403320312,G:.7479995727539063,h:.555999755859375,H:.7199996948242188,i:.255999755859375,I:.23699951171875,j:.26699981689453123,J:.5169998168945312,k:.5289993286132812,K:.6899993896484375,l:.23499908447265624,L:.5879989624023437,m:.854998779296875,M:.8819992065429687,n:.5589996337890625,N:.7189987182617188,o:.58599853515625,O:.7669998168945312,p:.58599853515625,P:.6419998168945312,q:.58599853515625,Q:.7669998168945312,r:.3649993896484375,R:.6759994506835938,s:.504998779296875,S:.6319992065429687,t:.354998779296875,T:.6189987182617187,u:.5599990844726562,U:.7139999389648437,v:.48199920654296874,V:.6389999389648438,w:.754998779296875,W:.929998779296875,x:.5089996337890625,X:.63699951171875,y:.4959991455078125,Y:.66199951171875,z:.48699951171875,Z:.6239990234375,0:.6,1:.40099945068359377,2:.6,3:.6,4:.6,5:.6,6:.6,7:.5469985961914062,8:.6,9:.6,"[":.3329986572265625,"]":.3329986572265625,",":.26399993896484375,".":.26399993896484375,";":.26399993896484375,":":.26399993896484375,"{":.3329986572265625,"}":.3329986572265625,"\\":.5,"|":.19499969482421875,"=":.604998779296875,"+":.604998779296875,"-":.604998779296875,_:.5,"`":.3329986572265625," ~":.8329986572265625,"!":.3329986572265625,"@":.8579986572265625,"#":.6,$:.6,"%":.9699996948242188,"^":.517999267578125,"&":.7259994506835937,"*":.505999755859375,"(":.3329986572265625,")":.3329986572265625,"<":.604998779296875,">":.604998779296875,"/":.5,"?":.53699951171875},ke=Math.PI,Ce=Math.sin,_e=Math.cos,Me=Ce(ke/8),Ie=_e(ke/8),Te=function(t,e){var n=t.getBBox(),t={x:n.minX,y:n.minY},n={x:n.maxX,y:n.maxY};e&&(i=e.getMatrix(),t=Gt(t,i=i||[1,0,0,0,1,0,0,0,1]),n=Gt(n,i));var e=t.x,i=t.y,t=n.x,n=n.y;return{x:e,y:i,minX:e,minY:i,maxX:t,maxY:n,width:t-e,height:n-i}},Ae=function(t){var e=t.sourceNode||t.targetNode,n=(n=e.get("group").getMatrix())||[1,0,0,0,1,0,0,0,1],i=e.getKeyShape().getBBox(),r=t.loopCfg||{},o=r.dist||2*Math.max(i.width,i.height),e=r.position||Se.defaultLoopPosition,a=[n[6],n[7]],s=[t.startPoint.x,t.startPoint.y],u=[t.endPoint.x,t.endPoint.y],c=i.height/2,h=i.height/2,l=c*Me,d=c*Ie,f=h*Me,p=h*Ie;if(s[0]===u[0]&&s[1]===u[1]){switch(e){case"top":s=[a[0]-l,a[1]-d],u=[a[0]+f,a[1]-p];break;case"top-right":c=i.height/2,h=i.width/2,s=[a[0]+(l=c*Me),a[1]-(d=c*Ie)],u=[a[0]+(p=h*Ie),a[1]-(f=h*Me)];break;case"right":c=i.width/2,h=i.width/2,s=[a[0]+(d=c*Ie),a[1]-(l=c*Me)],u=[a[0]+(p=h*Ie),a[1]+(f=h*Me)];break;case"bottom-right":c=i.width/2,h=i.height/2,s=[a[0]+(d=c*Ie),a[1]+(l=c*Me)],u=[a[0]+(f=h*Me),a[1]+(p=h*Ie)];break;case"bottom":c=i.height/2,h=i.height/2,s=[a[0]+(l=c*Me),a[1]+(d=c*Ie)],u=[a[0]-(f=h*Me),a[1]+(p=h*Ie)];break;case"bottom-left":c=i.height/2,h=i.width/2,s=[a[0]-(l=c*Me),a[1]+(d=c*Ie)],u=[a[0]-(p=h*Ie),a[1]+(f=h*Me)];break;case"left":c=i.width/2,h=i.width/2,s=[a[0]-(d=c*Ie),a[1]+(l=c*Me)],u=[a[0]-(p=h*Ie),a[1]-(f=h*Me)];break;case"top-left":c=i.width/2,h=i.height/2,s=[a[0]-(d=c*Ie),a[1]-(l=c*Me)],u=[a[0]-(f=h*Me),a[1]-(p=h*Ie)];break;default:c=i.width/2,h=i.width/2,s=[a[0]-(l=c*Me),a[1]-(d=c*Ie)],u=[a[0]+(f=h*Me),a[1]-(p=h*Ie)]}!1===r.clockwise&&(g=[s[0],s[1]],s=[u[0],u[1]],u=[g[0],g[1]])}var n=[s[0]-a[0],s[1]-a[1]],e=(c+o)/c,g=(h+o)/h;!1===r.clockwise&&(e=(h+o)/h,g=(c+o)/c);n=Pt.bA([0,0],n,e),e=[a[0]+n[0],a[1]+n[1]],n=[u[0]-a[0],u[1]-a[1]],g=Pt.bA([0,0],n,g),g=[a[0]+g[0],a[1]+g[1]];return t.startPoint={x:s[0],y:s[1]},t.endPoint={x:u[0],y:u[1]},t.controlPoints=[{x:e[0],y:e[1]},{x:g[0],y:g[1]}],t},Pe=function(t,e,n,i,r){var o=[],a=t.getPoint(e);if(null===a)return{x:0,y:0,angle:0};e<1e-4?o=t.getStartTangent().reverse():.9999<e?o=t.getEndTangent():(e=t.getPoint(e+1e-4),o.push([a.x,a.y]),o.push([e.x,e.y]));o=Math.atan2(o[1][1]-o[0][1],o[1][0]-o[0][0]);o<0&&(o+=2*ke),n&&(a.x+=_e(o)*n,a.y+=Ce(o)*n),i&&(n=o-ke/2,.5*ke<o&&o<1.5*ke&&(n-=ke),a.x+=_e(n)*i,a.y+=Ce(n)*i);a={x:a.x,y:a.y,angle:o};return r?(.5*ke<o&&o<1.5*ke&&(o-=ke),Et({rotate:o},a)):a},De=function(t,e){"function"==typeof e&&ee(t,e)},Ne=function(t,e){"function"==typeof e&&ne(t,e)},Oe=function(t,e){return e*(we[t]||1)},Le=function(t,e){var n=0,i=new RegExp("[一-龥]+");return t.split("").forEach(function(t){i.test(t)?n+=e:n+=Oe(t,e)}),[n,e]},Re=function(t,e){var o=[],a={},s={};t.forEach(function(t){s[t.id]=t}),t.forEach(function(t,e){var n=q(t);n.itemType="combo",n.children=void 0,(n.parentId===n.id||n.parentId&&!s[n.parentId])&&delete n.parentId;var i,r=a[n.id];r?(n.children=r.children,(r=a[n.id]=n).parentId?(i=a[r.parentId])?i.children?i.children.push(n):i.children=[n]:(i={id:r.parentId,children:[r]},a[r.parentId]=i,a[n.id]=n):o.push(r)):(_(t.parentId)?(r=a[t.parentId])?r.children?r.children.push(n):r.children=[n]:(t={id:t.parentId,children:[n]},a[t.id]=t):o.push(n),a[n.id]=n)});var i={};(e||[]).forEach(function(t){i[t.id]=t;var e,n=a[t.comboId];n&&(e={id:t.id,comboId:t.comboId},n.children?n.children.push(e):n.children=[e],e.itemType="node",a[t.id]=e)});var r=0;return o.forEach(function(t){t.depth=r+10,ee(t,function(t){var e=a[t.id].itemType,n="node"===e?a[t.comboId]:a[t.parentId];t.depth=n&&"node"===e?r+1:r+10,r<t.depth&&(r=t.depth);e=i[t.id];return e&&(e.depth=t.depth),!0})}),o},Be=function(t,e,n){var i,r=t,o={root:{children:t}},a=!1,s="root";(t||[]).forEach(function(t){if(!a)return t.id===e?("combo"===(i=t).itemType?i.parentId=n:i.comboId=n,void(a=!0)):void De(t,function(t){return o[t.id]={children:t.children},r=o[t.parentId||t.comboId||"root"].children,!t||!t.removed&&e!==t.id||!r||(s=t.parentId||t.comboId||"root","combo"===(i=t).itemType?i.parentId=n:i.comboId=n,!(a=!0))})});var u,c,h,l=(r=o[s].children)?r.indexOf(i):-1;return-1<l&&r.splice(l,1),a||(i={id:e,itemType:"node",comboId:n},o[e]={children:void 0}),e&&(u=!1,n?(c=0,(t||[]).forEach(function(t){u||De(t,function(t){return n!==t.id||(u=!0,t.children?t.children.push(i):t.children=[i],c=t.depth,"node"===i.itemType?i.depth=c+2:i.depth=c+1,!1)})})):n&&u||"node"===i.itemType||t.push(i),h=i.depth,De(i,function(t){return"node"===t.itemType?h+=2:h+=1,t.depth=h,!0})),t},Ge=function(t,e){var n={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,x:void 0,y:void 0,width:void 0,height:void 0,centerX:void 0,centerY:void 0};return t&&0!==t.length&&(t.forEach(function(t){t=e.findById(t.id);t&&t.isVisible()&&(t.set("bboxCanvasCache",void 0),(t=t.getCanvasBBox()).x&&n.minX>t.minX&&(n.minX=t.minX),t.y&&n.minY>t.minY&&(n.minY=t.minY),t.x&&n.maxX<t.maxX&&(n.maxX=t.maxX),t.y&&n.maxY<t.maxY&&(n.maxY=t.maxY))}),n.x=(n.minX+n.maxX)/2,n.y=(n.minY+n.maxY)/2,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2,Object.keys(n).forEach(function(t){n[t]!==1/0&&n[t]!==-1/0||(n[t]=void 0)})),n},Ue=function(t){var e=N(t.x)||N(t.y)||t.type||t.anchorPoints||t.size;return e=t.style?e||N(t.style.r)||N(t.style.width)||N(t.style.height)||N(t.style.rx)||N(t.style.ry):e},Fe=function(e){var r={};return Object.keys(e).forEach(function(t){var n,i=e[t];g(i)?(n={},Object.keys(i).forEach(function(t){var e=i[t];"img"===t&&!_(e)||(n[t]=q(e))}),r[t]=n):r[t]=q(i)}),r};function ze(t){this.graph=t,this.destroyed=!1,this.modes=t.get("modes")||{default:[]},this.formatModes(),this.mode=t.get("defaultMode")||"default",this.currentBehaves=[],this.setMode(this.mode)}var je=(ze.prototype.formatModes=function(){var t=this.modes;S(t,function(n){S(n,function(t,e){_(t)&&(n[e]={type:t})})})},ze.prototype.setBehaviors=function(t){var n,i=this.graph,t=this.modes[t],r=[];S(t||[],function(t){var e=yt.getBehavior(t.type||t);e&&(n=new e(t))&&(n.bind(i),r.push(n))}),this.currentBehaves=r},ze.mergeBehaviors=function(e,t){return S(t,function(t){e.indexOf(t)<0&&(_(t)&&(t={type:t}),e.push(t))}),e},ze.filterBehaviors=function(t,n){var i=[];return t.forEach(function(t){var e="",e=_(t)?t:t.type;n.indexOf(e)<0&&i.push(t)}),i},ze.prototype.setMode=function(t){var e=this.modes,n=this.graph,i=t;e[i]&&(n.emit("beforemodechange",{mode:t}),S(this.currentBehaves,function(t){t.delegate&&t.delegate.remove(),t.unbind(n)}),this.setBehaviors(i),n.emit("aftermodechange",{mode:t}),this.mode=t)},ze.prototype.getMode=function(){return this.mode},ze.prototype.manipulateBehaviors=function(t,e,n){var i=this,r=m(t)?t:[t];if(m(e))return S(e,function(t){i.modes[t]?i.modes[t]=n?ze.mergeBehaviors(i.modes[t]||[],r):ze.filterBehaviors(i.modes[t]||[],r):n&&(i.modes[t]=r)}),this;t=e;return e||(t=this.mode),this.modes[t]||n&&(this.modes[t]=r),this.modes[t]=n?ze.mergeBehaviors(this.modes[t]||[],r):ze.filterBehaviors(this.modes[t]||[],r),this.setMode(this.mode),this},ze.prototype.updateBehavior=function(t,e,n){_(t)&&(t={type:t});var i=[];if(n&&n!==this.mode&&"default"!==n){if(!(i=this.modes[n])||!i.length)return this;for(var r=i.length,o=0;o<r;o++)if((a=i[o]).type===t.type||a===t.type)return a===t.type&&(a={type:a}),Object.assign(a,e),i[o]=a,this}else{if(!(i=this.currentBehaves)||!i.length)return this;for(var a,s=i.length,o=0;o<s;o++)if((a=i[o]).type===t.type)return a.updateCfg(e),this}return this},ze.prototype.destroy=function(){this.graph=null,this.modes=null,this.currentBehaves=null,this.destroyed=!0},ze);function We(t,e){if(t)for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n]);return t}function Xe(t,e,n,i,r){var o,a,s;return null===r&&null===i&&(i=n),t=+t,e=+e,n=+n,i=+i,null!==r?(o=Math.PI/180,a=t+n*Math.cos(-i*o),s=t+n*Math.cos(-r*o),[["M",a,e+n*Math.sin(-i*o)],["A",n,n,0,+(180<r-i),0,s,e+n*Math.sin(-r*o)]]):[["M",t,e],["m",0,-i],["a",n,i,0,1,1,0,2*i],["a",n,i,0,1,1,0,-2*i],["z"]]}function Ze(t,e,n,i){return[t,e,n,i,n,i]}function Ve(t,e,n,i,r,o){return[1/3*t+2/3*n,1/3*e+2/3*i,1/3*r+2/3*n,1/3*o+2/3*i,r,o]}function Ye(t,e,n,i,r){return t*(t*(-3*e+9*n-9*i+3*r)+6*e-12*n+6*i)-3*e+3*n}function He(t,e,n,i,r,o,a,s,u){for(var c=(u=1<(u=null===u?1:u)?1:u<0?0:u)/2,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],l=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,f=0;f<12;f++){var p=c*h[f]+c,g=Ye(p,t,n,r,a),p=Ye(p,e,i,o,s);d+=l[f]*Math.sqrt(g*g+p*p)}return c*d}function qe(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function Ke(t,e,n,i){return null===t&&(t=e=n=i=0),null===e&&(e=t.y,n=t.width,i=t.height,t=t.x),{x:t,y:e,width:n,w:n,height:i,h:i,x2:t+n,y2:e+i,cx:t+n/2,cy:e+i/2,r1:Math.min(n,i)/2,r2:Math.max(n,i)/2,r0:Math.sqrt(n*n+i*i)/2,path:ln(t,e,n,i),vb:[t,e,n,i].join(" ")}}function Je(t,e,n,i,r,o,a,s){return m(t)||(t=[t,e,n,i,r,o,a,s]),t=function(t,e,n,i,r,o,a,s){for(var u,c,h,l=[],d=[[],[]],f=0;f<2;++f){var p,g=0===f?(c=6*t-12*n+6*r,u=-3*t+9*n-9*r+3*a,3*n-3*t):(c=6*e-12*i+6*o,u=-3*e+9*i-9*o+3*s,3*i-3*e);Math.abs(u)<1e-12?Math.abs(c)<1e-12||0<(h=-g/c)&&h<1&&l.push(h):(p=c*c-4*g*u,g=Math.sqrt(p),p<0||(0<(p=(-c+g)/(2*u))&&p<1&&l.push(p),0<(g=(-c-g)/(2*u))&&g<1&&l.push(g)))}for(var v,y=l.length,m=y;y--;)h=l[y],d[0][y]=(v=1-h)*v*v*t+3*v*v*h*n+3*v*h*h*r+h*h*h*a,d[1][y]=v*v*v*e+3*v*v*h*i+3*v*h*h*o+h*h*h*s;return d[0][m]=t,d[1][m]=e,d[0][m+1]=a,d[1][m+1]=s,d[0].length=d[1].length=m+2,{min:{x:Math.min.apply(0,d[0]),y:Math.min.apply(0,d[1])},max:{x:Math.max.apply(0,d[0]),y:Math.max.apply(0,d[1])}}}.apply(null,t),Ke(t.min.x,t.min.y,t.max.x-t.min.x,t.max.y-t.min.y)}function Qe(t,e,n,i,r,o,a,s,u){var c=1-u,h=Math.pow(c,3),l=Math.pow(c,2),d=u*u,f=d*u,p=t+2*u*(n-t)+d*(r-2*n+t),g=e+2*u*(i-e)+d*(o-2*i+e),v=n+2*u*(r-n)+d*(a-2*r+n);return{x:h*t+3*l*u*n+3*c*u*u*r+f*a,y:h*e+3*l*u*i+3*c*u*u*o+f*s,m:{x:p,y:g},n:{x:v,y:d=i+2*u*(o-i)+d*(s-2*o+i)},start:{x:c*t+u*n,y:c*e+u*i},end:{x:c*r+u*a,y:c*o+u*s},alpha:90-180*Math.atan2(p-v,g-d)/Math.PI}}function $e(t,e,n){var i,r=Je(t);if(i=i=Je(e),r=Ke(r=r),i=Ke(i),!(qe(i,r.x,r.y)||qe(i,r.x2,r.y)||qe(i,r.x,r.y2)||qe(i,r.x2,r.y2)||qe(r,i.x,i.y)||qe(r,i.x2,i.y)||qe(r,i.x,i.y2)||qe(r,i.x2,i.y2)||(r.x<i.x2&&r.x>i.x||i.x<r.x2&&i.x>r.x)&&(r.y<i.y2&&r.y>i.y||i.y<r.y2&&i.y>r.y)))return n?0:[];for(var o=~~(He.apply(0,t)/8),a=~~(He.apply(0,e)/8),s=[],u=[],c={},h=n?0:[],l=0;l<1+o;l++){var d=Qe.apply(0,t.concat(l/o));s.push({x:d.x,y:d.y,t:l/o})}for(l=0;l<1+a;l++){d=Qe.apply(0,e.concat(l/a));u.push({x:d.x,y:d.y,t:l/a})}for(l=0;l<o;l++)for(var f=0;f<a;f++){var p=s[l],g=s[l+1],v=u[f],y=u[f+1],m=Math.abs(g.x-p.x)<.001?"y":"x",x=Math.abs(y.x-v.x)<.001?"y":"x",b=function(t,e,n,i,r,o,a,s){if(!(Math.max(t,n)<Math.min(r,a)||Math.min(t,n)>Math.max(r,a)||Math.max(e,i)<Math.min(o,s)||Math.min(e,i)>Math.max(o,s))){var u=(t*i-e*n)*(r-a)-(t-n)*(r*s-o*a),c=(t*i-e*n)*(o-s)-(e-i)*(r*s-o*a),h=(t-n)*(o-s)-(e-i)*(r-a);if(h){var l=u/h,u=c/h,c=+l.toFixed(2),h=+u.toFixed(2);if(!(c<+Math.min(t,n).toFixed(2)||c>+Math.max(t,n).toFixed(2)||c<+Math.min(r,a).toFixed(2)||c>+Math.max(r,a).toFixed(2)||h<+Math.min(e,i).toFixed(2)||h>+Math.max(e,i).toFixed(2)||h<+Math.min(o,s).toFixed(2)||h>+Math.max(o,s).toFixed(2)))return{x:l,y:u}}}}(p.x,p.y,g.x,g.y,v.x,v.y,y.x,y.y);b&&c[b.x.toFixed(4)]!==b.y.toFixed(4)&&(c[b.x.toFixed(4)]=b.y.toFixed(4),p=p.t+Math.abs((b[m]-p[m])/(g[m]-p[m]))*(g.t-p.t),v=v.t+Math.abs((b[x]-v[x])/(y[x]-v[x]))*(y.t-v.t),0<=p&&p<=1&&0<=v&&v<=1&&(n?h+=1:h.push({x:b.x,y:b.y,t1:p,t2:v})))}return h}var tn="\t\n\v\f\r   ᠎             　\u2028\u2029",en=new RegExp("([a-z])["+tn+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+tn+"]*,?["+tn+"]*)+)","ig"),nn=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+tn+"]*,?["+tn+"]*","ig"),rn=function(o){if(!o)return null;if(m(o))return o;var a={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},s=[];return String(o).replace(en,function(t,e,n){var i=[],r=e.toLowerCase();if(n.replace(nn,function(t,e){e&&i.push(+e)}),"m"===r&&2<i.length&&(s.push([e].concat(i.splice(0,2))),r="l",e="m"===e?"l":"L"),"o"===r&&1===i.length&&s.push([e,i[0]]),"r"===r)s.push([e].concat(i));else for(;i.length>=a[r]&&(s.push([e].concat(i.splice(0,a[r]))),a[r]););return o}),s},on=function(t,e){for(var n=[],i=0,r=t.length;i<r-2*!e;i+=2){var o=[{x:+t[i-2],y:+t[i-1]},{x:+t[i],y:+t[i+1]},{x:+t[i+2],y:+t[i+3]},{x:+t[i+4],y:+t[i+5]}];e?i?r-4===i?o[3]={x:+t[0],y:+t[1]}:r-2===i&&(o[2]={x:+t[0],y:+t[1]},o[3]={x:+t[2],y:+t[3]}):o[0]={x:+t[r-2],y:+t[r-1]}:r-4===i?o[3]=o[2]:i||(o[0]={x:+t[i],y:+t[i+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n},an=function(t){if(!(t=rn(t))||!t.length)return[["M",0,0]];var e,n=[],i=0,r=0,o=0,a=0,s=0;"M"===t[0][0]&&(i=+t[0][1],r=+t[0][2],s++,n[0]=["M",o=i,a=r]);for(var u=3===t.length&&"M"===t[0][0]&&"R"===t[1][0].toUpperCase()&&"Z"===t[2][0].toUpperCase(),c=void 0,h=void 0,l=s,d=t.length;l<d;l++){if(n.push(c=[]),(e=(h=t[l])[0])!==e.toUpperCase())switch(c[0]=e.toUpperCase(),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+h[6]+i,c[7]=+h[7]+r;break;case"V":c[1]=+h[1]+r;break;case"H":c[1]=+h[1]+i;break;case"R":for(var f,p=2,g=(f=[i,r].concat(h.slice(1))).length;p<g;p++)f[p]=+f[p]+i,f[++p]=+f[p]+r;n.pop(),n=n.concat(on(f,u));break;case"O":n.pop(),(f=Xe(i,r,h[1],h[2])).push(f[0]),n=n.concat(f);break;case"U":n.pop(),n=n.concat(Xe(i,r,h[1],h[2],h[3])),c=["U"].concat(n[n.length-1].slice(-2));break;case"M":o=+h[1]+i,a=+h[2]+r;break;default:for(p=1,g=h.length;p<g;p++)c[p]=+h[p]+(p%2?i:r)}else if("R"===e)f=[i,r].concat(h.slice(1)),n.pop(),n=n.concat(on(f,u)),c=["R"].concat(h.slice(-2));else if("O"===e)n.pop(),(f=Xe(i,r,h[1],h[2])).push(f[0]),n=n.concat(f);else if("U"===e)n.pop(),n=n.concat(Xe(i,r,h[1],h[2],h[3])),c=["U"].concat(n[n.length-1].slice(-2));else for(var v=0,y=h.length;v<y;v++)c[v]=h[v];if("O"!==(e=e.toUpperCase()))switch(c[0]){case"Z":i=+o,r=+a;break;case"H":i=c[1];break;case"V":r=c[1];break;case"M":o=c[c.length-2],a=c[c.length-1];break;default:i=c[c.length-2],r=c[c.length-1]}}return n},sn=function(t,e,n,i,r,o,a,s,u,c){n===i&&(n+=1);function h(t,e,n){return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}}var l=120*Math.PI/180,d=Math.PI/180*(+r||0),f=[];c?(b=c[0],E=c[1],m=c[2],x=c[3]):(t=(g=h(t,e,-d)).x,e=g.y,s=(g=h(s,u,-d)).x,u=g.y,t===s&&e===u&&(s+=1,u+=1),1<(y=(v=(t-s)/2)*v/(n*n)+(p=(e-u)/2)*p/(i*i))&&(n*=y=Math.sqrt(y),i*=y),g=n*n,y=i*i,m=(g=(o===a?-1:1)*Math.sqrt(Math.abs((g*y-g*p*p-y*v*v)/(g*p*p+y*v*v))))*n*p/i+(t+s)/2,x=g*-i*v/n+(e+u)/2,b=Math.asin(((e-x)/i).toFixed(9)),E=Math.asin(((u-x)/i).toFixed(9)),b=t<m?Math.PI-b:b,E=s<m?Math.PI-E:E,b<0&&(b=2*Math.PI+b),E<0&&(E=2*Math.PI+E),a&&E<b&&(b-=2*Math.PI),!a&&b<E&&(E-=2*Math.PI));var p,g,v,y=E-b;Math.abs(y)>l&&(p=E,g=s,v=u,E=b+l*(a&&b<E?1:-1),s=m+n*Math.cos(E),u=x+i*Math.sin(E),f=sn(s,u,n,i,r,0,a,g,v,[E,p,m,x]));var y=E-b,m=Math.cos(b),x=Math.sin(b),b=Math.cos(E),E=Math.sin(E),y=Math.tan(y/4),n=4/3*n*y,i=4/3*i*y,y=[t,e],m=[t+n*x,e-i*m],b=[s+n*E,u-i*b],u=[s,u];if(m[0]=2*y[0]-m[0],m[1]=2*y[1]-m[1],c)return[m,b,u].concat(f);for(var S=[],w=0,k=(f=[m,b,u].concat(f).join().split(",")).length;w<k;w++)S[w]=w%2?h(f[w-1],f[w],d).y:h(f[w],f[w+1],d).x;return S},un=function(t,e){for(var o=an(t),a=e&&an(e),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r=[],s=[],u="",c="",h=function(t,e,n){var i,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(t[0]in{T:1,Q:1}||(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(sn.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":r="C"===n||"S"===n?(i=2*e.x-e.bx,2*e.y-e.by):(i=e.x,e.y),t=["C",i,r].concat(t.slice(1));break;case"T":"Q"===n||"T"===n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(Ve(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(Ve(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(Ze(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(Ze(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(Ze(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(Ze(e.x,e.y,e.X,e.Y))}return t},l=function(t,e){if(7<t[e].length){t[e].shift();for(var n=t[e];n.length;)r[e]="A",a&&(s[e]="A"),t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),f=Math.max(o.length,a&&a.length||0)}},d=function(t,e,n,i,r){t&&e&&"M"===t[r][0]&&"M"!==e[r][0]&&(e.splice(r,0,["M",i.x,i.y]),n.bx=0,n.by=0,n.x=t[r][1],n.y=t[r][2],f=Math.max(o.length,a&&a.length||0))},f=Math.max(o.length,a&&a.length||0),p=0;p<f;p++){"C"!==(u=o[p]?o[p][0]:u)&&(r[p]=u,p&&(c=r[p-1])),o[p]=h(o[p],n,c),"A"!==r[p]&&"C"===u&&(r[p]="C"),l(o,p),a&&("C"!==(u=a[p]?a[p][0]:u)&&(s[p]=u,p&&(c=s[p-1])),a[p]=h(a[p],i,c),"A"!==s[p]&&"C"===u&&(s[p]="C"),l(a,p)),d(o,a,n,i,p),d(a,o,i,n,p);var g=o[p],v=a&&a[p],y=g.length,m=a&&v.length;n.x=g[y-2],n.y=g[y-1],n.bx=parseFloat(g[y-4])||n.x,n.by=parseFloat(g[y-3])||n.y,i.bx=a&&(parseFloat(v[m-4])||i.x),i.by=a&&(parseFloat(v[m-3])||i.y),i.x=a&&v[m-2],i.y=a&&v[m-1]}return a?[o,a]:o},cn=/,?([a-z]),?/gi,hn=function(t){return t.join(",").replace(cn,"$1")},ln=function(t,e,n,i,r){if(r)return[["M",+t+ +r,e],["l",n-2*r,0],["a",r,r,0,0,1,r,r],["l",0,i-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-n,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-i],["a",r,r,0,0,1,r,-r],["z"]];n=[["M",t,e],["l",n,0],["l",0,i],["l",-n,0],["z"]];return n.parsePathArray=hn,n},dn=function(t,e){return function(t,e,n){var i,r,o,a,s,u,c,h;t=un(t),e=un(e);for(var l=n?0:[],d=0,f=t.length;d<f;d++){var p=t[d];if("M"===p[0])i=o=p[1],g=a=p[2];else for(var g="C"===p[0]?(i=(c=[i,g].concat(p.slice(1)))[6],c[7]):(c=[i,g,i,g,o,a,o,a],i=o,a),v=0,y=e.length;v<y;v++){var m=e[v];if("M"===m[0])r=s=m[1],x=u=m[2];else{var x="C"===m[0]?(r=(h=[r,x].concat(m.slice(1)))[6],h[7]):(h=[r,x,r,x,s,u,s,u],r=s,u),b=$e(c,h,n);if(n)l+=b;else{for(var E=0,S=b.length;E<S;E++)b[E].segment1=d,b[E].segment2=v,b[E].bez1=c,b[E].bez2=h;l=l.concat(b)}}}}return l}(t,e)};function fn(t,e){var o=[],a=[];return t.length&&function t(e,n){if(1===e.length)o.push(e[0]),a.push(e[0]);else{for(var i=[],r=0;r<e.length-1;r++)0===r&&o.push(e[0]),r===e.length-2&&a.push(e[r+1]),i[r]=[(1-n)*e[r][0]+n*e[r+1][0],(1-n)*e[r][1]+n*e[r+1][1]];t(i,n)}}(t,e),{left:o,right:a.reverse()}}function pn(t,e,n){if(1===n)return[[].concat(t)];var i=[];if("L"===e[0]||"C"===e[0]||"Q"===e[0])i=i.concat(function(t,e,n){t=[[t[1],t[2]]],n=n||2;var i=[];"A"===e[0]?(t.push(e[6]),t.push(e[7])):"C"===e[0]?(t.push([e[1],e[2]]),t.push([e[3],e[4]]),t.push([e[5],e[6]])):"S"===e[0]||"Q"===e[0]?(t.push([e[1],e[2]]),t.push([e[3],e[4]])):t.push([e[1],e[2]]);for(var r=t,o=1/n,a=0;a<n-1;a++){var s=fn(r,o/(1-o*a));i.push(s.left),r=s.right}return i.push(r),i.map(function(t){var e=[];return 4===t.length&&(e.push("C"),e=e.concat(t[2])),3<=t.length&&(3===t.length&&e.push("Q"),e=e.concat(t[1])),2===t.length&&e.push("L"),e=e.concat(t[t.length-1])})}(t,e,n));else{var r=[].concat(t);"M"===r[0]&&(r[0]="L");for(var o=0;o<=n-1;o++)i.push(r)}return i}var gn=function(i,t){if(1===i.length)return i;var r=i.length-1,e=t.length-1,n=r/e,o=[];if(1===i.length&&"M"===i[0][0]){for(var a=0;a<e-r;a++)i.push(i[0]);return i}for(a=0;a<e;a++){var s=Math.floor(n*a);o[s]=(o[s]||0)+1}var u=o.reduce(function(t,e,n){return n===r?t.concat(i[r]):t.concat(pn(i[n],i[n+1],e))},[]);return u.unshift(i[0]),"Z"!==t[e]&&"z"!==t[e]||u.push("Z"),u};function vn(t,e){var n=t.length,i=e.length,r=0;if(0===n||0===i)return null;for(var o=[],a=0;a<=n;a++)o[a]=[],o[a][0]={min:a};for(var s=0;s<=i;s++)o[0][s]={min:s};for(var u,a=1;a<=n;a++)for(var c=t[a-1],s=1;s<=i;s++){var r=function(t,n){if(t.length!==n.length)return!1;var i=!0;return S(t,function(t,e){if(t!==n[e])return i=!1}),i}(c,e[s-1])?0:1,h=o[a-1][s].min+1,l=o[a][s-1].min+1,d=o[a-1][s-1].min+r;o[a][s]=(u=void 0,u=null,(l=l)<(d=d=d)&&(d=l,u="add"),(h=h)<d&&(d=h,u="del"),{type:u,min:d})}return o}var yn=function(t,e){var n=vn(t,e),i=t.length,r=e.length,o=[],a=1,s=1;if(n[i][r].min!==i){for(var u=1;u<=i;u++){for(var c=n[u][u].min,s=u,h=a;h<=r;h++)n[u][h].min<c&&(c=n[u][h].min,s=h);n[u][a=s].type&&o.push({index:u-1,type:n[u][a].type})}for(u=o.length-1;0<=u;u--)a=o[u].index,"add"===o[u].type?t.splice(a,0,[].concat(t[a])):t.splice(a,1)}var l=r-(i=t.length);if(i<r)for(u=0;u<l;u++)"z"===t[i-1][0]||"Z"===t[i-1][0]?t.splice(i-2,0,t[i-2]):t.push(t[i-1]),i+=1;return t};function mn(t,e,n){for(var i,r=[].concat(t),o=1/(n+1),a=xn(e)[0],s=1;s<=n;s++)o*=s,0===(i=Math.floor(t.length*o))?r.unshift([a[0]*o+t[i][0]*(1-o),a[1]*o+t[i][1]*(1-o)]):r.splice(i,0,[a[0]*o+t[i][0]*(1-o),a[1]*o+t[i][1]*(1-o)]);return r}function xn(t){var e=[];switch(t[0]){case"M":case"L":e.push([t[1],t[2]]);break;case"A":e.push([t[6],t[7]]);break;case"Q":e.push([t[3],t[4]]),e.push([t[1],t[2]]);break;case"T":e.push([t[1],t[2]]);break;case"C":e.push([t[5],t[6]]),e.push([t[1],t[2]]),e.push([t[3],t[4]]);break;case"S":e.push([t[3],t[4]]),e.push([t[1],t[2]]);break;case"H":case"V":e.push([t[1],t[1]])}return e}var bn=function(t,e){if(t.length<=1)return t;for(var n,i=0;i<e.length;i++)if(t[i][0]!==e[i][0])switch(n=xn(t[i]),e[i][0]){case"M":t[i]=["M"].concat(n[0]);break;case"L":t[i]=["L"].concat(n[0]);break;case"A":t[i]=[].concat(e[i]),t[i][6]=n[0][0],t[i][7]=n[0][1];break;case"Q":if(n.length<2){if(!(0<i)){t[i]=e[i];break}n=mn(n,t[i-1],1)}t[i]=["Q"].concat(n.reduce(function(t,e){return t.concat(e)},[]));break;case"T":t[i]=["T"].concat(n[0]);break;case"C":if(n.length<3){if(!(0<i)){t[i]=e[i];break}n=mn(n,t[i-1],2)}t[i]=["C"].concat(n.reduce(function(t,e){return t.concat(e)},[]));break;case"S":if(n.length<2){if(!(0<i)){t[i]=e[i];break}n=mn(n,t[i-1],1)}t[i]=["S"].concat(n.reduce(function(t,e){return t.concat(e)},[]));break;default:t[i]=e[i]}return t};function En(t,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=e,this.timeStamp=e.timeStamp}var Sn=(En.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},En.prototype.stopPropagation=function(){this.propagationStopped=!0},En.prototype.toString=function(){return"[Event (type="+this.type+")]"},En.prototype.save=function(){},En.prototype.restore=function(){},En),wn=function(t,e){return(wn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function kn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}wn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}Object.create;Object.create;function Cn(t,e){e=t.indexOf(e);-1!==e&&t.splice(e,1)}var _n,Mn="undefined"!=typeof window&&void 0!==window.document;function In(t,e){if(t.isCanvas())return 1;for(var n=e.getParent(),i=!1;n;){if(n===t){i=!0;break}n=n.getParent()}return i}function Tn(t){return t.cfg.visible&&t.cfg.capture}function An(t){var e=_n.call(this)||this;e.destroyed=!1;var n=e.getDefaultCfg();return e.cfg=at(n,t),e}var Pn=(kn(An,_n=Ct),An.prototype.getDefaultCfg=function(){return{}},An.prototype.get=function(t){return this.cfg[t]},An.prototype.set=function(t,e){this.cfg[t]=e},An.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},An),Dn=n(43631);function Nn(t,e){var n=[],i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],h=t[7],l=t[8],d=e[0],f=e[1],p=e[2],g=e[3],v=e[4],y=e[5],m=e[6],t=e[7],e=e[8];return n[0]=d*i+f*a+p*c,n[1]=d*r+f*s+p*h,n[2]=d*o+f*u+p*l,n[3]=g*i+v*a+y*c,n[4]=g*r+v*s+y*h,n[5]=g*o+v*u+y*l,n[6]=m*i+t*a+e*c,n[7]=m*r+t*s+e*h,n[8]=m*o+t*u+e*l,n}function On(t,e){var n=[],i=e[0],e=e[1];return n[0]=t[0]*i+t[3]*e+t[6],n[1]=t[1]*i+t[4]*e+t[7],n}function Ln(t){var e=[],n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],l=h*a-s*c,d=-h*o+s*u,f=c*o-a*u,t=n*l+i*d+r*f;return t?(e[0]=l*(t=1/t),e[1]=(-h*i+r*c)*t,e[2]=(s*i-r*a)*t,e[3]=d*t,e[4]=(h*n-r*u)*t,e[5]=(-s*n+r*o)*t,e[6]=f*t,e[7]=(-c*n+i*u)*t,e[8]=(a*n-i*o)*t,e):null}var Rn,Bn=function(t,e){for(var n,i,r,o,a,s,u,c,h=t?[].concat(t):[1,0,0,0,1,0,0,0,1],l=0,d=e.length;l<d;l++){var f=e[l];switch(f[0]){case"t":s=a=h,u=[f[1],f[2]],c=void 0,c=[0,0,0,0,0,0,0,0,0],_t.fromTranslation(c,u),_t.multiply(a,c,s);break;case"s":o=a=h,c=[f[1],f[2]],s=void 0,s=[0,0,0,0,0,0,0,0,0],_t.fromScaling(s,c),_t.multiply(a,s,o);break;case"r":i=n=h,o=f[1],r=void 0,r=[0,0,0,0,0,0,0,0,0],_t.fromRotation(r,o),_t.multiply(n,r,i);break;case"m":r=n=h,i=f[1],_t.multiply(n,i,r)}}return h},Gn="matrix",Un=["zIndex","capture","visible","type"],Fn=["repeat"];function zn(t){var e=Rn.call(this,t)||this;e.attrs={};var n=e.getDefaultAttrs();return at(n,t.attrs),e.attrs=n,e.initAttrs(n),e.initAnimate(),e}var jn,Wn=(kn(zn,Rn=Pn),zn.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},zn.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},zn.prototype.onCanvasChange=function(t){},zn.prototype.initAttrs=function(t){},zn.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},zn.prototype.isGroup=function(){return!1},zn.prototype.getParent=function(){return this.get("parent")},zn.prototype.getCanvas=function(){return this.get("canvas")},zn.prototype.attr=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=e[0],r=e[1];if(!i)return this.attrs;if(g(i)){for(var o in i)this.setAttr(o,i[o]);return this.afterAttrsChange(i),this}return 2===e.length?(this.setAttr(i,r),this.afterAttrsChange(((t={})[i]=r,t)),this):this.attrs[i]},zn.prototype.isClipped=function(t,e){var n=this.getClip();return n&&!n.isHit(t,e)},zn.prototype.setAttr=function(t,e){var n=this.attrs[t];n!==e&&(this.attrs[t]=e,this.onAttrChange(t,e,n))},zn.prototype.onAttrChange=function(t,e,n){"matrix"===t&&this.set("totalMatrix",null)},zn.prototype.afterAttrsChange=function(t){var e;this.cfg.isClipShape?(e=this.cfg.applyTo)&&e.onCanvasChange("clip"):this.onCanvasChange("attr")},zn.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},zn.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},zn.prototype.setZIndex=function(t){this.set("zIndex",t);t=this.getParent();return t&&t.sort(),this},zn.prototype.toFront=function(){var t,e=this.getParent();e&&(t=e.getChildren(),this.get("el"),e=t.indexOf(this),t.splice(e,1),t.push(this),this.onCanvasChange("zIndex"))},zn.prototype.toBack=function(){var t,e=this.getParent();e&&(t=e.getChildren(),this.get("el"),e=t.indexOf(this),t.splice(e,1),t.unshift(this),this.onCanvasChange("zIndex"))},zn.prototype.remove=function(t){void 0===t&&(t=!0);var e=this.getParent();e?(Cn(e.getChildren(),this),e.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),t&&this.destroy()},zn.prototype.resetMatrix=function(){this.attr(Gn,this.getDefaultMatrix()),this.onCanvasChange("matrix")},zn.prototype.getMatrix=function(){return this.attr(Gn)},zn.prototype.setMatrix=function(t){this.attr(Gn,t),this.onCanvasChange("matrix")},zn.prototype.getTotalMatrix=function(){var t,e,n=this.cfg.totalMatrix;return n||(t=this.attr("matrix"),n=(e=this.cfg.parentMatrix)&&t?Nn(e,t):t||e,this.set("totalMatrix",n)),n},zn.prototype.applyMatrix=function(t){var e=this.attr("matrix"),n=null,n=t&&e?Nn(t,e):e||t;this.set("totalMatrix",n),this.set("parentMatrix",t)},zn.prototype.getDefaultMatrix=function(){return null},zn.prototype.applyToMatrix=function(t){var e=this.attr("matrix");return e?On(e,t):t},zn.prototype.invertFromMatrix=function(t){var e=this.attr("matrix");if(e){e=Ln(e);if(e)return On(e,t)}return t},zn.prototype.setClip=function(t){var e,n=this.getCanvas(),i=null;return!t||(e=this.getShapeBase()[U(t.type)])&&(i=new e({type:t.type,isClipShape:!0,applyTo:this,attrs:t.attrs,canvas:n})),this.set("clipShape",i),this.onCanvasChange("clip"),i},zn.prototype.getClip=function(){var t=this.cfg.clipShape;return t||null},zn.prototype.clone=function(){var e=this,n=this.attrs,i={};S(n,function(t,e){m(n[e])?i[e]=function(t){for(var e=[],n=0;n<t.length;n++)m(t[n])?e.push([].concat(t[n])):e.push(t[n]);return e}(n[e]):i[e]=n[e]});var r=new this.constructor({attrs:i});return S(Un,function(t){r.set(t,e.get(t))}),r},zn.prototype.destroy=function(){this.destroyed||(this.attrs={},Rn.prototype.destroy.call(this))},zn.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},zn.prototype.animate=function(){for(var t,e,n,i,r,o,a,s,u,c,h,l,d,f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];(this.get("timeline")||this.get("canvas"))&&(this.set("animating",!0),(t=this.get("timeline"))||(t=this.get("canvas").get("timeline"),this.set("timeline",t)),e=this.get("animations")||[],t.timer||t.initTimer(),c=f[0],n=f[1],i=void 0===(r=f[2])?"easeLinear":r,r=void 0===(o=f[3])?ht:o,o=void 0===(o=f[4])?0:o,y(c)?(d=c,c={}):g(c)&&c.onFrame&&(d=c.onFrame,a=c.repeat),g(n)?(n=(u=n).duration,i=u.easing||"easeLinear",o=u.delay||0,a=u.repeat||a||!1,r=u.callback||ht,s=u.pauseCallback||ht,u=u.resumeCallback||ht):(N(r)&&(o=r,r=null),i=y(i)?(r=i,"easeLinear"):i||"easeLinear"),c=c,h={},l=this.attr(),S(c,function(t,e){-1!==Fn.indexOf(e)||it(l[e],t)||(h[e]=t)}),d={fromAttrs:function(t,e){var n,i={},r=e.attrs;for(n in t)i[n]=r[n];return i}(c=h,this),toAttrs:c,duration:n,easing:i,repeat:a,callback:r,pauseCallback:s,resumeCallback:u,delay:o,startTime:t.getTime(),id:ct(),onFrame:d,pathFormatted:!1},0<e.length?e=function(t,e){if(e.onFrame)return t;var i=e.startTime,r=e.delay,o=e.duration,a=Object.prototype.hasOwnProperty;return S(t,function(n){i+r<n.startTime+n.delay+n.duration&&o>n.delay&&S(e.toAttrs,function(t,e){a.call(n.toAttrs,e)&&(delete n.toAttrs[e],delete n.fromAttrs[e])})}),t}(e,d):t.addAnimator(this),e.push(d),this.set("animations",e),this.set("_pause",{isPaused:!1}))},zn.prototype.stopAnimate=function(e){var n=this;void 0===e&&(e=!0);var t=this.get("animations");S(t,function(t){e&&(t.onFrame?n.attr(t.onFrame(1)):n.attr(t.toAttrs)),t.callback&&t.callback()}),this.set("animating",!1),this.set("animations",[])},zn.prototype.pauseAnimate=function(){var t=this.get("timeline"),e=this.get("animations"),n=t.getTime();return S(e,function(t){t._paused=!0,t._pauseTime=n,t.pauseCallback&&t.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:n}),this},zn.prototype.resumeAnimate=function(){var e=this.get("timeline").getTime(),t=this.get("animations"),n=this.get("_pause").pauseTime;return S(t,function(t){t.startTime=t.startTime+(e-n),t._paused=!1,t._pauseTime=null,t.resumeCallback&&t.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",t),this},zn.prototype.emitDelegation=function(t,n){var i,r=this,o=n.propagationPath;this.getEvents();"mouseenter"===t?i=n.fromShape:"mouseleave"===t&&(i=n.toShape);for(var a=this,e=0;e<o.length;e++)if("break"===function(t){var e=o[t],t=e.get("name");if(t){if((e.isGroup()||e.isCanvas&&e.isCanvas())&&i&&In(e,i))return"break";m(t)?S(t,function(t){r.emitDelegateEvent(e,t,n)}):a.emitDelegateEvent(e,t,n)}}(e))break},zn.prototype.emitDelegateEvent=function(t,e,n){var i=this.getEvents(),e=e+":"+n.type;(i[e]||i["*"])&&(n.name=e,n.currentTarget=t,n.delegateTarget=this,n.delegateObject=t.get("delegateObject"),this.emit(e,n))},zn.prototype.translate=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.getMatrix(),e=Bn(n,[["t",t,e]]);return this.setMatrix(e),this},zn.prototype.move=function(t,e){var n=this.attr("x")||0,i=this.attr("y")||0;return this.translate(t-n,e-i),this},zn.prototype.moveTo=function(t,e){return this.move(t,e)},zn.prototype.scale=function(t,e){var n=this.getMatrix(),t=Bn(n,[["s",t,e||t]]);return this.setMatrix(t),this},zn.prototype.rotate=function(t){var e=this.getMatrix(),t=Bn(e,[["r",t]]);return this.setMatrix(t),this},zn.prototype.rotateAtStart=function(t){var e=this.attr(),n=e.x,i=e.y,e=this.getMatrix(),i=Bn(e,[["t",-n,-i],["r",t],["t",n,i]]);return this.setMatrix(i),this},zn.prototype.rotateAtPoint=function(t,e,n){var i=this.getMatrix(),e=Bn(i,[["t",-t,-e],["r",n],["t",t,e]]);return this.setMatrix(e),this},zn),Xn={},Zn="_INDEX";function Vn(){return null!==jn&&jn.apply(this,arguments)||this}var Yn=(kn(Vn,jn=Wn),Vn.prototype.isCanvas=function(){return!1},Vn.prototype.getBBox=function(){var t=1/0,e=-1/0,n=1/0,i=-1/0,r=[],o=[],a=this.getChildren().filter(function(t){return t.get("visible")&&(!t.isGroup()||t.isGroup()&&0<t.getChildren().length)}),i=0<a.length?(S(a,function(t){t=t.getBBox();r.push(t.minX,t.maxX),o.push(t.minY,t.maxY)}),t=E(r),e=b(r),n=E(o),b(o)):n=e=t=0;return{x:t,y:n,minX:t,minY:n,maxX:e,maxY:i,width:e-t,height:i-n}},Vn.prototype.getCanvasBBox=function(){var t=1/0,e=-1/0,n=1/0,i=-1/0,r=[],o=[],a=this.getChildren().filter(function(t){return t.get("visible")&&(!t.isGroup()||t.isGroup()&&0<t.getChildren().length)}),i=0<a.length?(S(a,function(t){t=t.getCanvasBBox();r.push(t.minX,t.maxX),o.push(t.minY,t.maxY)}),t=E(r),e=b(r),n=E(o),b(o)):n=e=t=0;return{x:t,y:n,minX:t,minY:n,maxX:e,maxY:i,width:e-t,height:i-n}},Vn.prototype.getDefaultCfg=function(){var t=jn.prototype.getDefaultCfg.call(this);return t.children=[],t},Vn.prototype.onAttrChange=function(t,e,n){jn.prototype.onAttrChange.call(this,t,e,n),"matrix"===t&&(t=this.getTotalMatrix(),this._applyChildrenMarix(t))},Vn.prototype.applyMatrix=function(t){var e=this.getTotalMatrix();jn.prototype.applyMatrix.call(this,t);t=this.getTotalMatrix();t!==e&&this._applyChildrenMarix(t)},Vn.prototype._applyChildrenMarix=function(e){var t=this.getChildren();S(t,function(t){t.applyMatrix(e)})},Vn.prototype.addShape=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],i=t[1];g(n)?i=n:i.type=n;n=Xn[i.type];n||(n=U(i.type),Xn[i.type]=n);i=new(this.getShapeBase()[n])(i);return this.add(i),i},Vn.prototype.addGroup=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,i=t[0],r=t[1];return n=y(i)?new i(r||{parent:this}):(n=i||{},new(this.getGroupBase())(n)),this.add(n),n},Vn.prototype.getCanvas=function(){var t=this.isCanvas()?this:this.get("canvas");return t},Vn.prototype.getShape=function(t,e,n){if(!Tn(this))return null;var i,r=this.getChildren();return this.isCanvas()?i=this._findShape(r,t,e,n):(e=this.invertFromMatrix(e=[t,e,1]),this.isClipped(e[0],e[1])||(i=this._findShape(r,e[0],e[1],n))),i},Vn.prototype._findShape=function(t,e,n,i){for(var r=null,o=t.length-1;0<=o;o--){var a=t[o];if(Tn(a)&&(a.isGroup()?r=a.getShape(e,n,i):a.isHit(e,n)&&(r=a)),r)break}return r},Vn.prototype.add=function(t){var e,n,i=this.getCanvas(),r=this.getChildren(),o=this.get("timeline"),a=t.getParent();a&&(e=a,n=t,(a=void 0===(a=!1)?!0:a)?n.destroy():(n.set("parent",null),n.set("canvas",null)),Cn(e.getChildren(),n)),t.set("parent",this),i&&function e(t,n){t.set("canvas",n),!t.isGroup()||(t=t.get("children")).length&&t.forEach(function(t){e(t,n)})}(t,i),o&&function e(t,n){t.set("timeline",n),!t.isGroup()||(t=t.get("children")).length&&t.forEach(function(t){e(t,n)})}(t,o),r.push(t),t.onCanvasChange("add"),this._applyElementMatrix(t)},Vn.prototype._applyElementMatrix=function(t){var e=this.getTotalMatrix();e&&t.applyMatrix(e)},Vn.prototype.getChildren=function(){return this.get("children")},Vn.prototype.sort=function(){var i,t=this.getChildren();S(t,function(t,e){return t[Zn]=e,t}),t.sort((i=function(t,e){return t.get("zIndex")-e.get("zIndex")},function(t,e){var n=i(t,e);return 0===n?t[Zn]-e[Zn]:n})),this.onCanvasChange("sort")},Vn.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var t=this.getChildren(),e=t.length-1;0<=e;e--)t[e].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},Vn.prototype.destroy=function(){this.get("destroyed")||(this.clear(),jn.prototype.destroy.call(this))},Vn.prototype.getFirst=function(){return this.getChildByIndex(0)},Vn.prototype.getLast=function(){var t=this.getChildren();return this.getChildByIndex(t.length-1)},Vn.prototype.getChildByIndex=function(t){return this.getChildren()[t]},Vn.prototype.getCount=function(){return this.getChildren().length},Vn.prototype.contain=function(t){return-1<this.getChildren().indexOf(t)},Vn.prototype.removeChild=function(t,e){void 0===e&&(e=!0),this.contain(t)&&t.remove(e)},Vn.prototype.findAll=function(e){var n=[],t=this.getChildren();return S(t,function(t){e(t)&&n.push(t),t.isGroup()&&(n=n.concat(t.findAll(e)))}),n},Vn.prototype.find=function(e){var n=null,t=this.getChildren();return S(t,function(t){if(e(t)?n=t:t.isGroup()&&(n=t.find(e)),n)return!1}),n},Vn.prototype.findById=function(e){return this.find(function(t){return t.get("id")===e})},Vn.prototype.findByClassName=function(e){return this.find(function(t){return t.get("className")===e})},Vn.prototype.findAllByName=function(e){return this.findAll(function(t){return t.get("name")===e})},Vn),Hn=n(35374),qn=n(75877),Kn=n(42800),Jn=n(88122),Qn=function(t){return["fill","stroke","fillStyle","strokeStyle"].includes(t)},$n=function(t){return/^[r,R,L,l]{1}[\s]*\(/.test(t)},ti=[1,0,0,0,1,0,0,0,1];function ei(t,e,n){var i,r=e.startTime;if(n<r+e.delay||e._paused)return!1;var o=e.duration,a=e.easing;if(n=n-r-e.delay,e.repeat)i=qn[a](i=n%o/o);else{if(!((i=n/o)<1))return e.onFrame?t.attr(e.onFrame(1)):t.attr(e.toAttrs),!0;i=qn[a](i)}return e.onFrame?(a=e.onFrame(i),t.attr(a)):function(t,e,n){var i,r,o,a={},s=e.fromAttrs,u=e.toAttrs;if(!t.destroyed){for(r in u)if(!it(s[r],u[r]))if("path"===r){var c=u[r],h=s[r];c.length>h.length?(c=rn(u[r]),h=rn(s[r]),h=yn(h,c),h=bn(h,c),e.fromAttrs.path=h,e.toAttrs.path=c):e.pathFormatted||(c=rn(u[r]),h=rn(s[r]),h=bn(h,c),e.fromAttrs.path=h,e.toAttrs.path=c,e.pathFormatted=!0),a[r]=[];for(var l=0;l<c.length;l++){for(var d=c[l],f=h[l],p=[],g=0;g<d.length;g++)N(d[g])&&f&&N(f[g])?(i=(0,Kn.Z)(f[g],d[g]),p.push(i(n))):p.push(d[g]);a[r].push(p)}}else"matrix"===r?(o=(0,Jn.Z)(s[r]||ti,u[r]||ti)(n),a[r]=o):Qn(r)&&$n(u[r])?a[r]=u[r]:y(u[r])||(i=(0,Kn.Z)(s[r],u[r]),a[r]=i(n));t.attr(a)}}(t,e,i),!1}function ni(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}var ii=(ni.prototype.initTimer=function(){var i,r,o,a=this;this.timer=Hn.HT(function(t){if(a.current=t,0<a.animators.length){for(var e=a.animators.length-1;0<=e;e--)if((i=a.animators[e]).destroyed)a.removeAnimator(e);else{if(!i.isAnimatePaused())for(var n=(r=i.get("animations")).length-1;0<=n;n--)o=r[n],ei(i,o,t)&&(r.splice(n,1),o.callback&&o.callback());0===r.length&&a.removeAnimator(e)}a.canvas.get("autoDraw")||a.canvas.draw()}})},ni.prototype.addAnimator=function(t){this.animators.push(t)},ni.prototype.removeAnimator=function(t){this.animators.splice(t,1)},ni.prototype.isAnimating=function(){return!!this.animators.length},ni.prototype.stop=function(){this.timer&&this.timer.stop()},ni.prototype.stopAllAnimations=function(e){void 0===e&&(e=!0),this.animators.forEach(function(t){t.stopAnimate(e)}),this.animators=[],this.canvas.draw()},ni.prototype.getTime=function(){return this.current},ni),ri=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function oi(t,e,n){n.name=e,n.target=t,n.currentTarget=t,(n.delegateTarget=t).emit(e,n)}function ai(t){var n=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(t){var e=t.type;n._triggerEvent(e,t)},this._onDocumentMove=function(t){var e;n.canvas.get("el")!==t.target&&(n.dragging||n.currentShape)&&(e=n._getPointInfo(t),n.dragging&&n._emitEvent("drag",t,e,n.draggingShape))},this._onDocumentMouseUp=function(t){var e;n.canvas.get("el")!==t.target&&n.dragging&&(e=n._getPointInfo(t),n.draggingShape&&n._emitEvent("drop",t,e,null),n._emitEvent("dragend",t,e,n.draggingShape),n._afterDrag(n.draggingShape,e,t))},this.canvas=t.canvas}var si,ui=(ai.prototype.init=function(){this._bindEvents()},ai.prototype._bindEvents=function(){var e=this,n=this.canvas.get("el");S(ri,function(t){n.addEventListener(t,e._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},ai.prototype._clearEvents=function(){var e=this,n=this.canvas.get("el");S(ri,function(t){n.removeEventListener(t,e._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},ai.prototype._getEventObj=function(t,e,n,i,r,o){e=new Sn(t,e);return e.fromShape=r,e.toShape=o,e.x=n.x,e.y=n.y,e.clientX=n.clientX,e.clientY=n.clientY,e.propagationPath.push(i),e},ai.prototype._getShape=function(t,e){return this.canvas.getShape(t.x,t.y,e)},ai.prototype._getPointInfo=function(t){var e=this.canvas,n=e.getClientByEvent(t),t=e.getPointByEvent(t);return{x:t.x,y:t.y,clientX:n.x,clientY:n.y}},ai.prototype._triggerEvent=function(t,e){var n=this._getPointInfo(e),i=this._getShape(n,e),r=this["_on"+t],o=!1;r?r.call(this,n,i,e):(r=this.currentShape,"mouseenter"===t||"dragenter"===t||"mouseover"===t?(this._emitEvent(t,e,n,null,null,i),i&&this._emitEvent(t,e,n,i,null,i),"mouseenter"===t&&this.draggingShape&&this._emitEvent("dragenter",e,n,null)):"mouseleave"===t||"dragleave"===t||"mouseout"===t?(o=!0,r&&this._emitEvent(t,e,n,r,r,null),this._emitEvent(t,e,n,null,r,null),"mouseleave"===t&&this.draggingShape&&this._emitEvent("dragleave",e,n,null)):this._emitEvent(t,e,n,i,null,null)),o||(this.currentShape=i),i&&!i.get("destroyed")&&((o=this.canvas).get("el").style.cursor=i.attr("cursor")||o.get("cursor"))},ai.prototype._onmousedown=function(t,e,n){0===n.button&&(this.mousedownShape=e,this.mousedownPoint=t,this.mousedownTimeStamp=n.timeStamp),this._emitEvent("mousedown",n,t,e,null,null)},ai.prototype._emitMouseoverEvents=function(t,e,n,i){var r=this.canvas.get("el");n!==i&&(n&&(this._emitEvent("mouseout",t,e,n,n,i),this._emitEvent("mouseleave",t,e,n,n,i),i&&!i.get("destroyed")||(r.style.cursor=this.canvas.get("cursor"))),i&&(this._emitEvent("mouseover",t,e,i,n,i),this._emitEvent("mouseenter",t,e,i,n,i)))},ai.prototype._emitDragoverEvents=function(t,e,n,i,r){i?(i!==n&&(n&&this._emitEvent("dragleave",t,e,n,n,i),this._emitEvent("dragenter",t,e,i,n,i)),r||this._emitEvent("dragover",t,e,i)):n&&this._emitEvent("dragleave",t,e,n,n,i),r&&this._emitEvent("dragover",t,e,i)},ai.prototype._afterDrag=function(t,e,n){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var i=this._getShape(e,n);i!==t&&this._emitMouseoverEvents(n,e,t,i),this.currentShape=i},ai.prototype._onmouseup=function(t,e,n){var i;0===n.button&&(i=this.draggingShape,this.dragging?(i&&this._emitEvent("drop",n,t,e),this._emitEvent("dragend",n,t,i),this._afterDrag(i,t,n)):(this._emitEvent("mouseup",n,t,e),e===this.mousedownShape&&this._emitEvent("click",n,t,e),this.mousedownShape=null,this.mousedownPoint=null))},ai.prototype._ondragover=function(t,e,n){n.preventDefault();var i=this.currentShape;this._emitDragoverEvents(n,t,i,e,!0)},ai.prototype._onmousemove=function(t,e,n){var i,r,o,a,s=this.canvas,u=this.currentShape,c=this.draggingShape;this.dragging?(c&&this._emitDragoverEvents(n,t,u,e,!1),this._emitEvent("drag",n,t,c)):(a=this.mousedownPoint)?(i=this.mousedownShape,r=n.timeStamp-this.mousedownTimeStamp,o=a.clientX-t.clientX,a=a.clientY-t.clientY,120<r||40<o*o+a*a?i&&i.get("draggable")?((c=this.mousedownShape).set("capture",!1),this.draggingShape=c,this.dragging=!0,this._emitEvent("dragstart",n,t,c),this.mousedownShape=null,this.mousedownPoint=null):!i&&s.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",n,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(n,t,u,e),this._emitEvent("mousemove",n,t,e)):(this._emitMouseoverEvents(n,t,u,e),this._emitEvent("mousemove",n,t,e))):(this._emitMouseoverEvents(n,t,u,e),this._emitEvent("mousemove",n,t,e))},ai.prototype._emitEvent=function(t,e,n,i,r,o){var a,s,u,c,h,l=this._getEventObj(t,e,n,i,r,o);if(i){oi(l.shape=i,t,l);for(var d=i.getParent();d;)d.emitDelegation(t,l),l.propagationStopped||(a=d,s=t,h=c=void 0,(u=l).bubbles&&(c=void 0,h=!1,"mouseenter"===s?(c=u.fromShape,h=!0):"mouseleave"===s&&(h=!0,c=u.toShape),a.isCanvas()&&h||(c&&In(a,c)?u.bubbles=!1:(u.name=s,u.currentTarget=a,(u.delegateTarget=a).emit(s,u))))),l.propagationPath.push(d),d=d.getParent()}else oi(this.canvas,t,l)},ai.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},ai),ci=(0,Dn.qY)(),hi=ci&&"firefox"===ci.name;function li(t){t=si.call(this,t)||this;return t.initContainer(),t.initDom(),t.initEvents(),t.initTimeline(),t}var di,fi=(kn(li,si=Yn),li.prototype.getDefaultCfg=function(){var t=si.prototype.getDefaultCfg.call(this);return t.cursor="default",t.supportCSSTransform=!1,t},li.prototype.initContainer=function(){var t=this.get("container");_(t)&&(t=document.getElementById(t),this.set("container",t))},li.prototype.initDom=function(){var t=this.createDom();this.set("el",t),this.get("container").appendChild(t),this.setDOMSize(this.get("width"),this.get("height"))},li.prototype.initEvents=function(){var t=new ui({canvas:this});t.init(),this.set("eventController",t)},li.prototype.initTimeline=function(){var t=new ii(this);this.set("timeline",t)},li.prototype.setDOMSize=function(t,e){var n=this.get("el");Mn&&(n.style.width=t+"px",n.style.height=e+"px")},li.prototype.changeSize=function(t,e){this.setDOMSize(t,e),this.set("width",t),this.set("height",e),this.onCanvasChange("changeSize")},li.prototype.getRenderer=function(){return this.get("renderer")},li.prototype.getCursor=function(){return this.get("cursor")},li.prototype.setCursor=function(t){this.set("cursor",t);var e=this.get("el");Mn&&e&&(e.style.cursor=t)},li.prototype.getPointByEvent=function(t){if(this.get("supportCSSTransform")){if(hi&&!G(t.layerX)&&t.layerX!==t.offsetX)return{x:t.layerX,y:t.layerY};if(!G(t.offsetX))return{x:t.offsetX,y:t.offsetY}}var e=this.getClientByEvent(t),t=e.x,e=e.y;return this.getPointByClient(t,e)},li.prototype.getClientByEvent=function(t){var e=t;return{x:(e=t.touches?("touchend"===t.type?t.changedTouches:t.touches)[0]:e).clientX,y:e.clientY}},li.prototype.getPointByClient=function(t,e){var n=this.get("el").getBoundingClientRect();return{x:t-n.left,y:e-n.top}},li.prototype.getClientByPoint=function(t,e){var n=this.get("el").getBoundingClientRect();return{x:t+n.left,y:e+n.top}},li.prototype.draw=function(){},li.prototype.removeDom=function(){var t=this.get("el");t.parentNode.removeChild(t)},li.prototype.clearEvents=function(){this.get("eventController").destroy()},li.prototype.isCanvas=function(){return!0},li.prototype.getParent=function(){return null},li.prototype.destroy=function(){var t=this.get("timeline");this.get("destroyed")||(this.clear(),t&&t.stop(),this.clearEvents(),this.removeDom(),si.prototype.destroy.call(this))},li);function pi(){return null!==di&&di.apply(this,arguments)||this}var gi,vi=(kn(pi,di=Yn),pi.prototype.isGroup=function(){return!0},pi.prototype.isEntityGroup=function(){return!1},pi.prototype.clone=function(){for(var t=di.prototype.clone.call(this),e=this.getChildren(),n=0;n<e.length;n++){var i=e[n];t.add(i.clone())}return t},pi);function yi(t){return gi.call(this,t)||this}var e=(kn(yi,gi=Wn),yi.prototype._isInBBox=function(t,e){var n=this.getBBox();return n.minX<=t&&n.maxX>=t&&n.minY<=e&&n.maxY>=e},yi.prototype.afterAttrsChange=function(t){gi.prototype.afterAttrsChange.call(this,t),this.clearCacheBBox()},yi.prototype.getBBox=function(){var t=this.cfg.bbox;return t||(t=this.calculateBBox(),this.set("bbox",t)),t},yi.prototype.getCanvasBBox=function(){var t=this.cfg.canvasBBox;return t||(t=this.calculateCanvasBBox(),this.set("canvasBBox",t)),t},yi.prototype.applyMatrix=function(t){gi.prototype.applyMatrix.call(this,t),this.set("canvasBBox",null)},yi.prototype.calculateCanvasBBox=function(){var t=this.getBBox(),e=this.getTotalMatrix(),n=t.minX,i=t.minY,r=t.maxX,o=t.maxY;e&&(u=On(e,[t.minX,t.minY]),a=On(e,[t.maxX,t.minY]),c=On(e,[t.minX,t.maxY]),s=On(e,[t.maxX,t.maxY]),n=Math.min(u[0],a[0],c[0],s[0]),r=Math.max(u[0],a[0],c[0],s[0]),i=Math.min(u[1],a[1],c[1],s[1]),o=Math.max(u[1],a[1],c[1],s[1]));var a,s,u,c,t=this.attrs;return t.shadowColor&&(u=r+(a=void 0===(u=t.shadowBlur)?0:u)+(s=void 0===(c=t.shadowOffsetX)?0:c),c=i-a+(t=void 0===(c=t.shadowOffsetY)?0:c),t=o+a+t,n=Math.min(n,n-a+s),r=Math.max(r,u),i=Math.min(i,c),o=Math.max(o,t)),{x:n,y:i,minX:n,minY:i,maxX:r,maxY:o,width:r-n,height:o-i}},yi.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},yi.prototype.isClipShape=function(){return this.get("isClipShape")},yi.prototype.isInShape=function(t,e){return!1},yi.prototype.isOnlyHitBox=function(){return!1},yi.prototype.isHit=function(t,e){var n=this.get("startArrowShape"),i=this.get("endArrowShape"),r=[t,e,1],t=(r=this.invertFromMatrix(r))[0],e=r[1],r=this._isInBBox(t,e);if(this.isOnlyHitBox())return r;if(r&&!this.isClipped(t,e)){if(this.isInShape(t,e))return!0;if(n&&n.isHit(t,e))return!0;if(i&&i.isHit(t,e))return!0}return!1},yi),mi=new Map;function xi(t,e){mi.set(t,e)}function bi(t){return mi.get(t)}function Ei(t){t=t.attr();return{x:t.x,y:t.y,width:t.width,height:t.height}}function Si(t){var e=t.attr(),n=e.x,t=e.y,e=e.r;return{x:n-e,y:t-e,width:2*e,height:2*e}}function wi(t){return Math.min.apply(null,t)}function ki(t){return Math.max.apply(null,t)}function Ci(t,e,n,i){n=t-n,i=e-i;return Math.sqrt(n*n+i*i)}function _i(t,e){return Math.abs(t-e)<.001}function Mi(t,e){var n=wi(t),i=wi(e);return{x:n,y:i,width:ki(t)-n,height:ki(e)-i}}function Ii(t){return(t+2*Math.PI)%(2*Math.PI)}var Ti={box:function(t,e,n,i){return Mi([t,n],[e,i])},length:Ci,pointAt:function(t,e,n,i,r){return{x:(1-r)*t+r*n,y:(1-r)*e+r*i}},pointDistance:function(t,e,n,i,r,o){var a=(n-t)*(r-t)+(i-e)*(o-e);return a<0?Ci(t,e,r,o):(n-t)*(n-t)+(i-e)*(i-e)<a?Ci(n,i,r,o):this.pointToLine(t,e,n,i,r,o)},pointToLine:function(t,e,n,i,r,o){i=[n-t,i-e];if(Pt.I6(i,[0,0]))return Math.sqrt((r-t)*(r-t)+(o-e)*(o-e));i=[-i[1],i[0]];return Pt.Fv(i,i),Math.abs(Pt.AK([r-t,o-e],i))},tangentAngle:function(t,e,n,i){return Math.atan2(i-e,n-t)}};function Ai(t,e,n,i,r,o){for(var a,s=1/0,u=[n,i],c=20,h=1/(c=o&&200<o?o/10:c),l=h/10,d=0;d<=c;d++){var f=d*h,p=[r.apply(null,t.concat([f])),r.apply(null,e.concat([f]))];(y=Ci(u[0],u[1],p[0],p[1]))<s&&(a=f,s=y)}if(0===a)return{x:t[0],y:e[0]};if(1===a){o=t.length;return{x:t[o-1],y:e[o-1]}}for(s=1/0,d=0;d<32&&!(l<1e-4);d++){var g=a-l,v=a+l,p=[r.apply(null,t.concat([g])),r.apply(null,e.concat([g]))],y=Ci(u[0],u[1],p[0],p[1]);0<=g&&y<s?(a=g,s=y):(g=[r.apply(null,t.concat([v])),r.apply(null,e.concat([v]))],g=Ci(u[0],u[1],g[0],g[1]),v<=1&&g<s?(a=v,s=g):l*=.5)}return{x:r.apply(null,t.concat([a])),y:r.apply(null,e.concat([a]))}}function Pi(t,e,n,i){var r=1-i;return r*r*t+2*i*r*e+i*i*n}function Di(t,e,n){n=t+n-2*e;if(_i(n,0))return[.5];n=(t-e)/n;return n<=1&&0<=n?[n]:[]}function Ni(t,e,n,i){return 2*(1-i)*(e-t)+2*i*(n-e)}function Oi(t,e,n,i,r,o,a){var s=Pi(t,n,r,a),u=Pi(e,i,o,a),c=Ti.pointAt(t,e,n,i,a),a=Ti.pointAt(n,i,r,o,a);return[[t,e,c.x,c.y,s,u],[s,u,a.x,a.y,r,o]]}function Li(t,e,n,i,r,o,a){if(0===a)return(Ci(t,e,n,i)+Ci(n,i,r,o)+Ci(t,e,r,o))/2;r=Oi(t,e,n,i,r,o,.5),o=r[0],r=r[1];return o.push(a-1),r.push(a-1),Li.apply(null,o)+Li.apply(null,r)}var Ri={box:function(t,e,n,i,r,o){var a=Di(t,n,r)[0],s=Di(e,i,o)[0],u=[t,r],c=[e,o];return void 0!==a&&u.push(Pi(t,n,r,a)),void 0!==s&&c.push(Pi(e,i,o,s)),Mi(u,c)},length:function(t,e,n,i,r,o){return Li(t,e,n,i,r,o,3)},nearestPoint:function(t,e,n,i,r,o,a,s){return Ai([t,n,r],[e,i,o],a,s,Pi)},pointDistance:function(t,e,n,i,r,o,a,s){o=this.nearestPoint(t,e,n,i,r,o,a,s);return Ci(o.x,o.y,a,s)},interpolationAt:Pi,pointAt:function(t,e,n,i,r,o,a){return{x:Pi(t,n,r,a),y:Pi(e,i,o,a)}},divide:Oi,tangentAngle:function(t,e,n,i,r,o,a){r=Ni(t,n,r,a),a=Ni(e,i,o,a);return Ii(Math.atan2(a,r))}};function Bi(t,e,n,i,r){var o=1-r;return o*o*o*t+3*e*r*o*o+3*n*r*r*o+i*r*r*r}function Gi(t,e,n,i,r){var o=1-r;return 3*(o*o*(e-t)+2*o*r*(n-e)+r*r*(i-n))}function Ui(t,e,n,i){var r,o=-3*t+9*e-9*n+3*i,i=6*t-12*e+6*n,n=3*e-3*t,e=[];return _i(o,0)?_i(i,0)||0<=(r=-n/i)&&r<=1&&e.push(r):_i(t=i*i-4*o*n,0)?e.push(-i/(2*o)):0<t&&(t=(-i-(n=Math.sqrt(t)))/(2*o),0<=(r=(-i+n)/(2*o))&&r<=1&&e.push(r),0<=t&&t<=1&&e.push(t)),e}function Fi(t,e,n,i,r,o,a,s,u){var c=Bi(t,n,r,a,u),h=Bi(e,i,o,s,u),l=Ti.pointAt(t,e,n,i,u),i=Ti.pointAt(n,i,r,o,u),r=Ti.pointAt(r,o,a,s,u),o=Ti.pointAt(l.x,l.y,i.x,i.y,u),u=Ti.pointAt(i.x,i.y,r.x,r.y,u);return[[t,e,l.x,l.y,o.x,o.y,c,h],[c,h,u.x,u.y,r.x,r.y,a,s]]}function zi(t,e,n,i,r,o,a,s,u){if(0===u)return function(t,e){for(var n=0,i=t.length,r=0;r<i;r++)n+=Ci(t[r],e[r],t[(r+1)%i],e[(r+1)%i]);return n/2}([t,n,r,a],[e,i,o,s]);a=Fi(t,e,n,i,r,o,a,s,.5),s=a[0],a=a[1];return s.push(u-1),a.push(u-1),zi.apply(null,s)+zi.apply(null,a)}var ji={extrema:Ui,box:function(t,e,n,i,r,o,a,s){for(var u=[t,a],c=[e,s],h=Ui(t,n,r,a),l=Ui(e,i,o,s),d=0;d<h.length;d++)u.push(Bi(t,n,r,a,h[d]));for(d=0;d<l.length;d++)c.push(Bi(e,i,o,s,l[d]));return Mi(u,c)},length:function(t,e,n,i,r,o,a,s){return zi(t,e,n,i,r,o,a,s,3)},nearestPoint:function(t,e,n,i,r,o,a,s,u,c,h){return Ai([t,n,r,a],[e,i,o,s],u,c,Bi,h)},pointDistance:function(t,e,n,i,r,o,a,s,u,c,h){h=this.nearestPoint(t,e,n,i,r,o,a,s,u,c,h);return Ci(h.x,h.y,u,c)},interpolationAt:Bi,pointAt:function(t,e,n,i,r,o,a,s,u){return{x:Bi(t,n,r,a,u),y:Bi(e,i,o,s,u)}},divide:Fi,tangentAngle:function(t,e,n,i,r,o,a,s,u){a=Gi(t,n,r,a,u),u=Gi(e,i,o,s,u);return Ii(Math.atan2(u,a))}};function Wi(t,e){t=Math.abs(t);return 0<e?t:-1*t}var Xi=function(t,e,n,i,r,o){var a=n,s=i;if(0===a||0===s)return{x:t,y:e};for(var r=r-t,o=o-e,u=Math.abs(r),c=Math.abs(o),h=a*a,l=s*s,d=Math.PI/4,f=0;f<4;f++){var p=a*Math.cos(d),g=s*Math.sin(d),v=(h-l)*Math.pow(Math.cos(d),3)/a,y=(l-h)*Math.pow(Math.sin(d),3)/s,m=p-v,x=g-y,b=u-v,E=c-y,v=Math.hypot(x,m),y=Math.hypot(E,b);d+=v*Math.asin((m*E-x*b)/(v*y))/Math.sqrt(h+l-p*p-g*g),d=Math.min(Math.PI/2,Math.max(0,d))}return{x:t+Wi(p,r),y:e+Wi(g,o)}};function Zi(t,e,n,i,r,o){return n*Math.cos(r)*Math.cos(o)-i*Math.sin(r)*Math.sin(o)+t}function Vi(t,e,n,i,r,o){return n*Math.sin(r)*Math.cos(o)+i*Math.cos(r)*Math.sin(o)+e}function Yi(t,e,n){return{x:t*Math.cos(n),y:e*Math.sin(n)}}function Hi(t,e,n){var i=Math.cos(n),n=Math.sin(n);return[t*i-e*n,t*n+e*i]}var qi={box:function(t,e,n,i,r,o,a){for(var s=(g=n,p=i,v=r,Math.atan(-p/g*Math.tan(v))),u=1/0,c=-1/0,h=[o,a],l=2*-Math.PI;l<=2*Math.PI;l+=Math.PI){var d=s+l;o<a?o<d&&d<a&&h.push(d):a<d&&d<o&&h.push(d)}for(l=0;l<h.length;l++){var f=Zi(t,0,n,i,r,h[l]);f<u&&(u=f),c<f&&(c=f)}for(var p,g,v,y=(p=n,g=i,v=r,Math.atan(g/(p*Math.tan(v)))),m=1/0,x=-1/0,b=[o,a],l=2*-Math.PI;l<=2*Math.PI;l+=Math.PI){var E=y+l;o<a?o<E&&E<a&&b.push(E):a<E&&E<o&&b.push(E)}for(l=0;l<b.length;l++){var S=Vi(0,e,n,i,r,b[l]);S<m&&(m=S),x<S&&(x=S)}return{x:u,y:m,width:c-u,height:x-m}},length:function(t,e,n,i,r,o,a){},nearestPoint:function(t,e,n,i,r,o,a,s,u){var c=Hi(s-t,u-e,-r),h=c[0],l=c[1],s=Xi(0,0,n,i,h,l),c=(u=n,c=i,h=s.x,l=s.y,(Math.atan2(l*u,h*c)+2*Math.PI)%(2*Math.PI));c<o?s=Yi(n,i,o):a<c&&(s=Yi(n,i,a));r=Hi(s.x,s.y,r);return{x:r[0]+t,y:r[1]+e}},pointDistance:function(t,e,n,i,r,o,a,s,u){i=this.nearestPoint(t,e,n,i,s,u);return Ci(i.x,i.y,s,u)},pointAt:function(t,e,n,i,r,o,a,s){o=(a-o)*s+o;return{x:Zi(t,0,n,i,r,o),y:Vi(0,e,n,i,r,o)}},tangentAngle:function(t,e,n,i,r,o,a,s){var u=(a-o)*s+o,o=(a=i,s=r,o=u,-1*n*Math.cos(s)*Math.sin(o)-a*Math.sin(s)*Math.cos(o)),u=(i=i,r=r,u=u,-1*n*Math.sin(r)*Math.sin(u)+i*Math.cos(r)*Math.cos(u));return Ii(Math.atan2(u,o))}};function Ki(t){if(t.length<2)return 0;for(var e=0,n=0;n<t.length-1;n++){var i=t[n],r=t[n+1];e+=Ci(i[0],i[1],r[0],r[1])}return e}var Ji=Ki;function Qi(t,e){return t&&e?{minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}:t||e}function $i(t,e){var n=t.get("startArrowShape"),t=t.get("endArrowShape");return n&&(e=Qi(e,n.getCanvasBBox())),e=t?Qi(e,t.getCanvasBBox()):e}var tr=null;function er(){var t;return tr||((t=document.createElement("canvas")).width=1,t.height=1,tr=t.getContext("2d")),tr}function nr(t,e,n){var i=1;return 1<(i=_(t)?t.split("\n").length:i)?e*i+(t=e,(n=n)?n-t:.14*t)*(i-1):e}function ir(t){var e=t.fontSize,n=t.fontFamily,i=t.fontWeight;return[t.fontStyle,t.fontVariant,i,e+"px",n].join(" ").trim()}var rr=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/gi,or=/[^\s\,]+/gi;var ar=function(t){var i=t||[];return m(i)?i:_(i)?(i=i.match(rr),S(i,function(n,t){var e;1<(n=n.match(or))[0].length&&(e=n[0].charAt(0),n.splice(1,0,n[0].substr(1)),n[0]=e),S(n,function(t,e){isNaN(t)||(n[e]=+t)}),i[t]=n}),i):void 0};function sr(t,e){for(var n=[],i=0,r=t.length;i<r-2*!e;i+=2){var o=[{x:+t[i-2],y:+t[i-1]},{x:+t[i],y:+t[i+1]},{x:+t[i+2],y:+t[i+3]},{x:+t[i+4],y:+t[i+5]}];e?i?r-4===i?o[3]={x:+t[0],y:+t[1]}:r-2===i&&(o[2]={x:+t[0],y:+t[1]},o[3]={x:+t[2],y:+t[3]}):o[0]={x:+t[r-2],y:+t[r-1]}:r-4===i?o[3]=o[2]:i||(o[0]={x:+t[i],y:+t[i+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n}var C="\t\n\v\f\r   ᠎             　\u2028\u2029",ur=new RegExp("([a-z])["+C+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+C+"]*,?["+C+"]*)+)","ig"),cr=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+C+"]*,?["+C+"]*","ig");function hr(t){if(!t)return null;if(m(t))return t;var o={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},a=[];return String(t).replace(ur,function(t,e,n){var i=[],r=e.toLowerCase();if(n.replace(cr,function(t,e){e&&i.push(+e)}),"m"===r&&2<i.length&&(a.push([e].concat(i.splice(0,2))),r="l",e="m"===e?"l":"L"),"o"===r&&1===i.length&&a.push([e,i[0]]),"r"===r)a.push([e].concat(i));else for(;i.length>=o[r]&&(a.push([e].concat(i.splice(0,o[r]))),o[r]););return""}),a}var lr=/[a-z]/;function dr(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}function fr(t){var e=hr(t);if(!e||!e.length)return[["M",0,0]];for(var n=!1,i=0;i<e.length;i++){var r=e[i][0];if(lr.test(r)||0<=["V","H","T","S"].indexOf(r)){n=!0;break}}if(!n)return e;var o=[],a=0,s=0,u=0,c=0,h=0,t=e[0];"M"!==t[0]&&"m"!==t[0]||(a=+t[1],s=+t[2],h++,o[0]=["M",u=a,c=s]);for(var i=h,l=e.length;i<l;i++){var d=e[i],f=o[i-1],p=[],g=(r=d[0]).toUpperCase();if(r!==g)switch(p[0]=g){case"A":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+d[6]+a,p[7]=+d[7]+s;break;case"V":p[1]=+d[1]+s;break;case"H":p[1]=+d[1]+a;break;case"M":u=+d[1]+a,c=+d[2]+s;break;default:for(var v=1,y=d.length;v<y;v++)p[v]=+d[v]+(v%2?a:s)}else p=e[i];switch(g){case"Z":a=+u,s=+c;break;case"H":p=["L",a=p[1],s];break;case"V":p=["L",a,s=p[1]];break;case"T":var a=p[1],s=p[2],m=dr([f[1],f[2]],[f[3],f[4]]),p=["Q",m[0],m[1],a,s];break;case"S":a=p[p.length-2],s=p[p.length-1];m=f.length,m=dr([f[m-4],f[m-3]],[f[m-2],f[m-1]]);p=["C",m[0],m[1],p[1],p[2],a,s];break;case"M":u=p[p.length-2],c=p[p.length-1];break;default:a=p[p.length-2],s=p[p.length-1]}o.push(p)}return o}function pr(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function gr(t,e){return pr(t)*pr(e)?(t[0]*e[0]+t[1]*e[1])/(pr(t)*pr(e)):1}function vr(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(gr(t,e))}function yr(t,e){return t[0]===e[0]&&t[1]===e[1]}function mr(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}function xr(t){for(var e=[],n=null,i=null,r=null,o=0,a=(t=ar(t)).length,s=0;s<a;s++){var u=t[s],i=t[s+1],c=u[0],h={command:c,prePoint:n,params:u,startTangent:null,endTangent:null};switch(c){case"M":r=[u[1],u[2]],o=s;break;case"A":var l=function(t,e){var n=e[1],i=e[2],r=L(B(e[3]),2*Math.PI),o=e[4],a=e[5],s=t[0],u=t[1],c=e[6],h=e[7],l=Math.cos(r)*(s-c)/2+Math.sin(r)*(u-h)/2,d=-1*Math.sin(r)*(s-c)/2+Math.cos(r)*(u-h)/2,f=l*l/(n*n)+d*d/(i*i);1<f&&(n*=Math.sqrt(f),i*=Math.sqrt(f));var p=n*n*(d*d)+i*i*(l*l),e=p?Math.sqrt((n*n*(i*i)-p)/p):1;return o===a&&(e*=-1),isNaN(e)&&(e=0),f=i?e*n*d/i:0,p=n?e*-i*l/n:0,e=(s+c)/2+Math.cos(r)*f-Math.sin(r)*p,s=(u+h)/2+Math.sin(r)*f+Math.cos(r)*p,u=[(l-f)/n,(d-p)/i],f=[(-1*l-f)/n,(-1*d-p)/i],d=vr([1,0],u),p=vr(u,f),gr(u,f)<=-1&&(p=Math.PI),1<=gr(u,f)&&(p=0),0===a&&0<p&&(p-=2*Math.PI),1===a&&p<0&&(p+=2*Math.PI),{cx:e,cy:s,rx:yr(t,[c,h])?0:n,ry:yr(t,[c,h])?0:i,startAngle:d,endAngle:d+p,xRotation:r,arcFlag:o,sweepFlag:a}}(n,u);h.arcParams=l}"Z"===c?(n=r,i=t[o+1]):n=[u[(E=u.length)-2],u[E-1]],i&&"Z"===i[0]&&(i=t[o],e[o]&&(e[o].prePoint=n)),h.currentPoint=n,e[o]&&yr(n,e[o].currentPoint)&&(e[o].prePoint=h.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;h.nextPoint=d;var f,p,g,v,y,m,x,b,E,S,w,k=h.prePoint;["L","H","V"].includes(c)?(h.startTangent=[k[0]-n[0],k[1]-n[1]],h.endTangent=[n[0]-k[0],n[1]-k[1]]):"Q"===c?(f=[u[1],u[2]],h.startTangent=[k[0]-f[0],k[1]-f[1]],h.endTangent=[n[0]-f[0],n[1]-f[1]]):"T"===c?(f=mr((p=e[s-1]).currentPoint,k),"Q"===p.command?(h.command="Q",h.startTangent=[k[0]-f[0],k[1]-f[1]],h.endTangent=[n[0]-f[0],n[1]-f[1]]):(h.command="TL",h.startTangent=[k[0]-n[0],k[1]-n[1]],h.endTangent=[n[0]-k[0],n[1]-k[1]])):"C"===c?(g=[u[1],u[2]],v=[u[3],u[4]],h.startTangent=[k[0]-g[0],k[1]-g[1]],h.endTangent=[n[0]-v[0],n[1]-v[1]]):"S"===c?(g=mr((p=e[s-1]).currentPoint,k),v=[u[1],u[2]],"C"===p.command?(h.command="C",h.startTangent=[k[0]-g[0],k[1]-g[1]]):(h.command="SQ",h.startTangent=[k[0]-v[0],k[1]-v[1]]),h.endTangent=[n[0]-v[0],n[1]-v[1]]):"A"===c&&(y=.001,S=void 0===(b=(x=h.arcParams||{}).cx)?0:b,w=void 0===(m=x.cy)?0:m,E=x.rx,c=void 0===(d=x.ry)?0:d,b=x.sweepFlag,d=void 0===(m=x.startAngle)?0:m,x=void 0===(m=x.endAngle)?0:m,0===(void 0===b?0:b)&&(y*=-1),b=(m=void 0===E?0:E)*Math.cos(d-y)+S,E=c*Math.sin(d-y)+w,h.startTangent=[b-r[0],E-r[1]],S=m*Math.cos(d+x+y)+S,w=c*Math.sin(d+x-y)+w,h.endTangent=[k[0]-S,k[1]-w]),e.push(h)}return e}function br(t,e){var n=t.prePoint,i=t.currentPoint,r=t.nextPoint,o=Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2),t=Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2),n=Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2),n=Math.acos((o+t-n)/(2*Math.sqrt(o)*Math.sqrt(t)));if(!n||0===Math.sin(n)||(o=n,void(t=0)===a&&(a=O),Math.abs(o-t)<a))return{xExtra:0,yExtra:0};var a=Math.abs(Math.atan2(r[1]-i[1],r[0]-i[0])),i=Math.abs(Math.atan2(r[0]-i[0],r[1]-i[1])),a=a>Math.PI/2?Math.PI-a:a,i=i>Math.PI/2?Math.PI-i:i;return{xExtra:Math.cos(n/2-a)*(e/2*(1/Math.sin(n/2)))-e/2||0,yExtra:Math.cos(i-n/2)*(e/2*(1/Math.sin(n/2)))-e/2||0}}xi("rect",Ei),xi("image",Ei),xi("circle",Si),xi("marker",Si),xi("polyline",function(t){for(var e=t.attr().points,n=[],i=[],r=0;r<e.length;r++){var o=e[r];n.push(o[0]),i.push(o[1])}var a=(u=Mi(n,i)).x,s=u.y,u={minX:a,minY:s,maxX:a+u.width,maxY:s+u.height};return{x:(u=$i(t,u)).minX,y:u.minY,width:u.maxX-u.minX,height:u.maxY-u.minY}}),xi("polygon",function(t){for(var e=t.attr().points,n=[],i=[],r=0;r<e.length;r++){var o=e[r];n.push(o[0]),i.push(o[1])}return Mi(n,i)}),xi("text",function(t){var e,n,i=t.attr(),r=i.x,o=i.y,a=i.text,s=i.fontSize,u=i.lineHeight,c=(c=i.font)||ir(i),c=(t=a,c=c,e=er(),n=0,G(t)||""===t||(e.save(),e.font=c,_(t)&&t.includes("\n")?(c=t.split("\n"),S(c,function(t){t=e.measureText(t).width;n<t&&(n=t)})):n=e.measureText(t).width,e.restore()),n);return o=c?(t=i.textAlign,i=i.textBaseline,u={x:r,y:o-(s=nr(a,s,u))},t&&("end"===t||"right"===t?u.x-=c:"center"===t&&(u.x-=c/2)),i&&("top"===i?u.y+=s:"middle"===i&&(u.y+=s/2)),{x:u.x,y:u.y,width:c,height:s}):{x:r,y:o,width:0,height:0}}),xi("path",function(t){var e=(i=t.attr()).path,n=i.stroke?i.lineWidth:0,e=(i=function(t,e){for(var n=[],i=[],r=[],o=0;o<t.length;o++){var a=(l=t[o]).currentPoint,s=l.params,u=l.prePoint,c=void 0;switch(l.command){case"Q":c=Ri.box(u[0],u[1],s[1],s[2],s[3],s[4]);break;case"C":c=ji.box(u[0],u[1],s[1],s[2],s[3],s[4],s[5],s[6]);break;case"A":var h=l.arcParams,c=qi.box(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:n.push(a[0]),i.push(a[1])}c&&(l.box=c,n.push(c.x,c.x+c.width),i.push(c.y,c.y+c.height)),e&&("L"===l.command||"M"===l.command)&&l.prePoint&&l.nextPoint&&r.push(l)}var l,n=n.filter(function(t){return!Number.isNaN(t)}),i=i.filter(function(t){return!Number.isNaN(t)}),d=E(n),f=E(i),p=b(n),g=b(i);if(0===r.length)return{x:d,y:f,width:p-d,height:g-f};for(o=0;o<r.length;o++)(a=(l=r[o]).currentPoint)[0]===d?d-=br(l,e).xExtra:a[0]===p&&(p+=br(l,e).xExtra),a[1]===f?f-=br(l,e).yExtra:a[1]===g&&(g+=br(l,e).yExtra);return{x:d,y:f,width:p-d,height:g-f}}(t.get("segments")||xr(e),n)).x,n=i.y,i={minX:e,minY:n,maxX:e+i.width,maxY:n+i.height};return{x:(i=$i(t,i)).minX,y:i.minY,width:i.maxX-i.minX,height:i.maxY-i.minY}}),xi("line",function(t){var e=(r=t.attr()).x1,n=r.y1,i=r.x2,r=r.y2,r={minX:Math.min(e,i),maxX:Math.max(e,i),minY:Math.min(n,r),maxY:Math.max(n,r)};return{x:(r=$i(t,r)).minX,y:r.minY,width:r.maxX-r.minX,height:r.maxY-r.minY}}),xi("ellipse",function(t){var e=(i=t.attr()).x,n=i.y,t=i.rx,i=i.ry;return{x:e-t,y:n-i,width:2*t,height:2*i}});var Er,Sr=(bt(wr,Er=Sn),wr);function wr(t,e){t=Er.call(this,t,e)||this;return t.item=e.item,t.canvasX=e.canvasX,t.canvasY=e.canvasY,t.wheelDelta=e.wheelDelta,t.detail=e.detail,t}var kr=function(t){return t+"-"+Math.random()+Date.now()},Cr=function(t){var e=0,n=0,i=0,r=0;return N(t)?e=n=i=r=t:_(t)?e=n=i=r=parseInt(t,10):m(t)&&(e=t[0],i=G(t[1])?t[0]:t[1],r=G(t[2])?t[0]:t[2],n=G(t[3])?i:t[3]),[e,i,r,n]},_r=function(t){var e=new Sr(t.type,t);return e.clientX=t.clientX,e.clientY=t.clientY,e.x=t.x,e.y=t.y,e.target=t.target,e.currentTarget=t.currentTarget,e.bubbles=!0,e.item=t.item,e},Mr=function(t){if(!t)return!1;for(var e=[1,0,0,0,1,0,0,0,1],n=0;n<9;n++)if(t[n]!==e[n])return!0;return!1},Ir=function(t){return Number.isNaN(Number(t))},Tr=function(t){for(var e=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<t.length;o++){var a=t[o].getBBox(),s=a.minX,u=a.minY,c=a.maxX,a=a.maxY;s<e&&(e=s),u<i&&(i=u),n<c&&(n=c),r<a&&(r=a)}return{x:Math.floor(e),y:Math.floor(i),width:Math.ceil(n)-Math.floor(e),height:Math.ceil(r)-Math.floor(i),minX:e,minY:i,maxX:n,maxY:r}},Ar=function(t,e,n,i,r){void 0===n&&(n="quadratic"),void 0===i&&(i=void 0),void 0===r&&(r=void 0);for(var o,a=t.length,s=2*(e=void 0===e?15:e),u=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"],c={},h=[],l={},d=0;d<a;d++){var f=t[d],p=f.source,g=f.target,v=p+"-"+g;if(!h[d]){c[v]||(c[v]=[]),h[d]=!0,c[v].push(f);for(var y,m,x,b=0;b<a;b++)d!==b&&(m=(y=t[b]).source,x=y.target,h[b]||(p===x&&g===m?(c[v].push(y),h[b]=!0,l[m+"|"+x+"|"+(c[v].length-1)]=!0):p===m&&g===x&&(c[v].push(y),h[b]=!0)))}}for(o in c)for(var E=c[o],S=E.length,w=0;w<S;w++){var k,C=E[w];C.source!==C.target?1===S&&i&&C.source!==C.target?C.type=i:(C.type=n,k=(w%2==0?1:-1)*(l[C.source+"|"+C.target+"|"+w]?-1:1),C.curveOffset=S%2==1?k*Math.ceil(w/2)*s:k*(Math.floor(w/2)*s+e)):(r&&(C.type=r),C.loopCfg={position:u[w%8],dist:20*Math.floor(w/8)+50})}return t};function Pr(t){this.destroyed=!1,this.graph=t,this.destroyed=!1}var Dr=(Pr.prototype.getViewCenter=function(){var t=this.getFormatPadding(),e=this.graph,n=this.graph.get("width"),e=e.get("height");return{x:(n-t[1]-t[3])/2+t[3],y:(e-t[0]-t[2])/2+t[0]}},Pr.prototype.fitCenter=function(){var t=this.graph,e=t.get("group");e.resetMatrix();var n,i=e.getCanvasBBox();0!==i.width&&0!==i.height&&(n=this.getViewCenter(),e=i.x+i.width/2,i=i.y+i.height/2,t.translate(n.x-e,n.y-i))},Pr.prototype.fitView=function(){var t=this.graph,e=this.getFormatPadding(),n=t.get("width"),i=t.get("height"),r=t.get("group");r.resetMatrix();var o,a,s=r.getCanvasBBox();0!==s.width&&0!==s.height&&(o=this.getViewCenter(),a=s.x+s.width/2,r=s.y+s.height/2,t.translate(o.x-a,o.y-r),n=(n-e[1]-e[3])/s.width,s=(i-e[0]-e[2])/s.height,t.zoom(s<n?s:n,o))},Pr.prototype.getFormatPadding=function(){var t=this.graph.get("fitViewPadding");return Cr(t)},Pr.prototype.focusPoint=function(t,e,n){var i,r,o,a,s,u,c=this,h=this.getViewCenter(),l=this.getPointByCanvas(h.x,h.y),h=(h=this.graph.get("group").getMatrix())||[1,0,0,0,1,0,0,0,1];e?(i=(l.x-t.x)*h[0],r=(l.y-t.y)*h[4],u=s=a=o=0,this.graph.get("canvas").animate(function(t){s=i*t,u=r*t,c.graph.translate(s-o,u-a),o=s,a=u},Et({},n))):this.graph.translate((l.x-t.x)*h[0],(l.y-t.y)*h[4])},Pr.prototype.getPointByCanvas=function(t,e){var n=this.graph.get("group").getMatrix();return Ut({x:t,y:e},n=n||[1,0,0,0,1,0,0,0,1])},Pr.prototype.getPointByClient=function(t,e){e=this.graph.get("canvas").getPointByClient(t,e);return this.getPointByCanvas(e.x,e.y)},Pr.prototype.getClientByPoint=function(t,e){var n=this.graph.get("canvas"),e=this.getCanvasByPoint(t,e),e=n.getClientByPoint(e.x,e.y);return{x:e.x,y:e.y}},Pr.prototype.getCanvasByPoint=function(t,e){var n=this.graph.get("group").getMatrix();return Gt({x:t,y:e},n=n||[1,0,0,0,1,0,0,0,1])},Pr.prototype.focus=function(t,e,n){var i=(i=(t=_(t)?this.graph.findById(t):t).get("group").getMatrix())||[1,0,0,0,1,0,0,0,1];t&&this.focusPoint({x:i[6],y:i[7]},e,n)},Pr.prototype.changeSize=function(n,i){var r=this.graph;if(!N(n)||!N(i))throw Error("invalid canvas width & height, please make sure width & height type is number");r.set({width:n,height:i}),r.get("canvas").changeSize(n,i),r.get("plugins").forEach(function(t){var e;t.get("gridContainer")&&(e=r.get("minZoom"),We(t.get("container"),{width:n+"px",height:i+"px"}),We(t.get("gridContainer"),{width:n/e+"px",height:i/e+"px",left:0,top:0}))})},Pr.prototype.destroy=function(){this.graph=null,this.destroyed=!1},Pr);function Nr(t){return(Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Or(t){if("string"!=typeof t)return t;function e(e){if("string"!=typeof e)return e;try{return JSON.parse(e.trim())}catch(t){return e.trim()}}var n=e(t);if("string"!=typeof n)return n;for(var i=function(t){return t[t.length-1]},r=t.trim(),o=[],a=[],s=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.some(function(t){return i(a)===t})},u=null,c=0,h="";c<r.length;){var l=r[c],d=s('"',"'");if(d||l.trim()){var f="\\"===r[c-1],p=s("}"),g=s("]"),v=s(","),y=i(o);if(d)i(a)!==l||f?h+=l:(a.pop(),f=e(h),y.push(f),u=f,h="");else if(g&&","===l)h&&(y.push(e(h)),h="");else if(p&&":"===l)a.push(","),h&&(y.push(h),h="");else if(v&&","===l)h&&(y.push(e(h)),h=""),a.pop();else if("}"===l&&(p||v)){h&&(y.push(e(h)),h=""),v&&a.pop();for(var m={},x=1;x<y.length;x+=2)m[y[x-1]]=y[x];o.pop(),o.length&&i(o).push(m),a.pop(),u=m}else"]"===l&&g?(h&&(y.push(e(h)),h=""),o.pop(),o.length&&i(o).push(y),a.pop(),u=y):"{"===l?(o.push([]),a.push("}")):"["===l?(o.push([]),a.push("]")):'"'===l?a.push('"'):"'"===l?a.push("'"):h+=l;c+=1}else c+=1}return u||h}var Lr=function(t){return t.split("-").reduce(function(t,e){return t+e.charAt(0).toUpperCase()+e.slice(1)})};function Rr(t,e){var n=Et({x:0,y:0,width:0,height:0},e=void 0===e?{x:0,y:0}:e);if(null!==(i=t.children)&&void 0!==i&&i.length){var i=t.attrs,r=void 0===i?{}:i,i=r.marginTop,o=Et({},e);i&&(o.y+=i);for(var a=0;a<t.children.length;a++){t.children[a].attrs.key=(r.key||"root")+" -"+a+" ";var s,u=Rr(t.children[a],o);u.bbox&&(s=u.bbox,"inline"===u.attrs.next?o.x+=u.bbox.width:o.y+=u.bbox.height,s.width+s.x>n.width&&(n.width=s.width+s.x),s.height+s.y>n.height&&(n.height=s.height+s.y))}}return t.bbox=function(t,e,n){var i,r,o=t.attrs,a=void 0===o?{}:o,s={x:e.x||0,y:e.y||0,width:n.width||0,height:n.height||0};switch(t.type){case"maker":case"circle":a.r&&(r=2*a.r,i=2*a.r);break;case"text":a.text&&(r=Le(a.text,a.fontSize||12)[0],s.y+=i=16,s.height=i,s.width=r,t.attrs=Et({fontSize:12,fill:"#000"},a));break;default:a.width&&(r=a.width),a.height&&(i=a.height)}return 0<=i&&(s.height=i),0<=r&&(s.width=r),a.marginTop&&(s.y+=a.marginTop),a.marginLeft&&(s.x+=a.marginLeft),s}(t,e,n),t.attrs=Et(Et({},t.attrs),t.bbox),t}function Br(i){function r(t){var a,e="function"==typeof i?i(t):i,n=(a=e,function(t){for(var e,n=a.length,i=[],r=0,o="";r<n;)"{"===a[r]&&"{"===a[r+1]?(i.push(o),o="",r+=2):"}"===a[r]&&"}"===a[r+1]?(i.length&&(e=i.pop(),o=st(t,o,e.endsWith("=")?'"{'+o+'}"':o),i.push(e+o)),r+=2,o=""):(o+=a[r],r+=1);return i.push(o),i.map(function(t,e){return i[e-1]&&i[e-1].endsWith("=")?'"{'+t+'}"':t}).join("")}(t));return(e=document.createElement("div")).innerHTML=n,t=Rr(function e(i,n){var r={},t=i.getAttributeNames&&i.getAttributeNames()||[],o=i.children&&Array.from(i.children).map(function(t){return e(t,n)}),a={},s=i.tagName?i.tagName.toLowerCase():"group";return"text"===s&&(r.text=i.innerText),"img"===(a.type=s)&&(a.type="image"),Array.from(t).forEach(function(e){var t,n=Lr(e),e=i.getAttribute(e);try{"style"===n||"attrs"===n?(t=Or(e),r=Et(Et({},r),t)):a[n]=Or(e)}catch(t){if("style"===n)throw t;a[n]=e}}),a.attrs=r,n&&n.style&&a.name&&"object"===Nr(n.style[a.name])&&(a.attrs=Et(Et({},a.attrs),n.style[a.name])),n&&n.style&&a.keyshape&&(a.attrs=Et(Et({},a.attrs),n.style)),o.length&&(a.children=o),a}(e.children[0],t)),e.remove(),t}var c={};return{draw:function(t,s){var e=r(t),u=s;return function t(e){var n=e.attrs,i=void 0===n?{}:n,r=e.bbox,o=e.type,a=e.children,n=St(e,["attrs","bbox","type","children"]);"group"!==e.type&&(n=s.addShape(e.type,Et({attrs:i,origin:{bbox:r,type:o,children:a}},n)),e.keyshape&&(u=n)),e.children&&e.children.forEach(t)}(e),c[t.id]=[e],u},update:function(t,o){c[t.id]||(c[t.id]=[]);function a(t){var e;"group"!==t.type&&n.addShape(t.type,{attrs:t.attrs}),null!==(e=t.children)&&void 0!==e&&e.length&&t.children.map(a)}function s(e){var t=u.find(function(t){return t.attrs.key===e.attrs.key});t&&n.removeChild(t),null!==(t=e.children)&&void 0!==t&&t.length&&e.children.map(s)}var n=o.getContainer(),u=n.get("children"),e=r(t),i=function t(e,n){var i,r=(e||{}).type,o=((null==n?void 0:n.attrs)||{}).key;if(o&&e&&(e.attrs.key=o),!e&&n)return{action:"delete",val:n,type:r,key:o};if(e&&!n)return{action:"add",val:e,type:r};if(!e&&!n)return{action:"same",type:r};var a=[];if(0<(null===(i=e.children)||void 0===i?void 0:i.length)||0<(null===(i=n.children)||void 0===i?void 0:i.length))for(var s=Math.max(null===(l=e.children)||void 0===l?void 0:l.length,null===(l=n.children)||void 0===l?void 0:l.length),u=n.children||[],c=e.children||[],h=0;h<s;h+=1)a.push(t(c[h],u[h]));var l=Object.keys(n.attrs),d=Object.keys(e.attrs);return n.type!==e.type?{action:"restructure",nowTarget:e,formerTarget:n,key:o,children:a}:l.filter(function(t){return"children"!==t}).some(function(t){return e.attrs[t]!==n.attrs[t]||!d.includes(t)})?{action:"change",val:e,children:a,type:r,key:o}:{action:"same",children:a,type:r,key:o}}(e,c[t.id].pop());(function t(e){var n=e.key;if("group"!==e.type){var i,r=u.find(function(t){return t.attrs.key===n});switch(e.action){case"change":r&&(i=e.val.keyshape?o.getOriginStyle():{},r.attr(Et(Et({},i),e.val.attrs)));break;case"add":a(e.val);break;case"delete":s(e.val);break;case"restructure":s(e.formerTarget),a(e.nowTarget)}}e.children&&e.children.forEach(t)})(i),c[t.id].push(e)},getAnchorPoints:function(){return[[0,.5],[1,.5],[.5,1],[.5,0]]}}}var Gr={};function Ur(t){return Gr[t]||(Gr[t]=U(t)),Gr[t]}var Fr={defaultShapeType:"defaultType",className:null,getShape:function(t){return this[t]||this[this.defaultShapeType]||this["simple-circle"]},draw:function(t,e,n){var i=this.getShape(t),t=i.draw(e,n);return i.afterDraw&&i.afterDraw(e,n,t),t},baseUpdate:function(t,e,n){t=this.getShape(t);t.update&&t.update(e,n),t.afterUpdate&&t.afterUpdate(e,n)},setState:function(t,e,n,i){this.getShape(t).setState(e,n,i)},shouldUpdate:function(t){return!!this.getShape(t).update},getControlPoints:function(t,e){return this.getShape(t).getControlPoints(e)},getAnchorPoints:function(t,e){return this.getShape(t).getAnchorPoints(e)}},zr={options:{},draw:function(t,e){return this.drawShape(t,e)},drawShape:function(){},afterDraw:function(){},afterUpdate:function(){},setState:function(){},getControlPoints:function(t){return t.controlPoints},getAnchorPoints:function(t){var e=this.options.anchorPoints;return t.anchorPoints||e}},ve=(jr.registerFactory=function(t,e){t=Ur(t),e=Et(Et({},Fr),e);return(jr[t]=e).className=t,e},jr.getFactory=function(t){return jr[Ur(t)]},jr.registerNode=function(t,e,n){var i,r=jr.Node;return(e="string"==typeof e||"function"==typeof e?(i=Br(e),Et(Et({},r.getShape("single-node")),i)):e.jsx?(i=Br(e.jsx),Et(Et(Et({},r.getShape("single-node")),i),e)):(r.getShape(n),n=n?r.getShape(n):zr,Et(Et({},n),e))).type=t,e.itemType="node",r[t]=e},jr.registerEdge=function(t,e,n){var i=jr.Edge,n=n?i.getShape(n):zr,e=Et(Et({},n),e);return e.type=t,e.itemType="edge",i[t]=e},jr.registerCombo=function(t,e,n){var i=jr.Combo,n=n?i.getShape(n):zr,e=Et(Et({},n),e);return e.type=t,e.itemType="combo",i[t]=e},jr);function jr(){}var Wr=ve;ve.registerFactory("node",{defaultShapeType:"circle"}),ve.registerFactory("edge",{defaultShapeType:"line"}),ve.registerFactory("combo",{defaultShapeType:"circle"});var Xr="bboxCache",Zr="bboxCanvasCache";function Vr(t){this._cfg={},this.destroyed=!1,this._cfg=Object.assign({id:void 0,type:"item",model:{},group:void 0,animate:!1,visible:!0,locked:!1,event:!0,keyShape:void 0,states:[]},this.getDefaultCfg(),t);var e=this.get("model"),n=e.id,i=this.get("type");n||(n=kr(i),this.get("model").id=n),this.set("id",n);t=t.group;t&&(t.set("item",this),t.set("id",n)),this.init(),this.draw();n=e.shape||e.type||("edge"===i?"line":"circle"),i=this.get("shapeFactory");i&&i[n]&&((n=i[n].options)&&n.stateStyles&&(e=this.get("styles")||e.stateStyles,e=Q({},n.stateStyles,e),this.set("styles",e)))}var Yr,pe=(Vr.prototype.calculateBBox=function(){var t=this.get("keyShape"),e=this.get("group"),e=Te(t,e);return e.x=e.minX,e.y=e.minY,e.width=e.maxX-e.minX,e.height=e.maxY-e.minY,e.centerX=(e.minX+e.maxX)/2,e.centerY=(e.minY+e.maxY)/2,e},Vr.prototype.calculateCanvasBBox=function(){var t=this.get("keyShape"),e=this.get("group"),e=Te(t,e);return e.x=e.minX,e.y=e.minY,e.width=e.maxX-e.minX,e.height=e.maxY-e.minY,e.centerX=(e.minX+e.maxX)/2,e.centerY=(e.minY+e.maxY)/2,e},Vr.prototype.drawInner=function(){var t=this.get("shapeFactory"),e=this.get("group"),n=this.get("model");e.clear();var i=n.visible;void 0===i||i||this.changeVisibility(i),t&&(this.updatePosition(n),n=(i=this.getShapeCfg(n)).type,(e=t.draw(n,i,e))&&(this.set("keyShape",e),e.set("isKeyShape",!0),e.set("draggable",!0)),this.setOriginStyle(),this.set("currentShape",n),this.restoreStates(t,n))},Vr.prototype.setOriginStyle=function(){var s,e,o,t=this.get("group").get("children"),n=this.getKeyShape(),u=this,c=n.get("name");this.get("originStyle")?(s=this.getOriginStyle(),c&&!s[c]&&(s[c]={}),e=this.getCurrentStatesStyle(),S(t,function(t){var n,i,r,o=t.get("name"),a=t.attr();o&&o!==c?(n=e[o],s[o]||(s[o]={}),n?Object.keys(a).forEach(function(t){var e=a[t];e!==n[t]&&(s[o][t]=e)}):s[o]="image"!==t.get("type")?q(a):u.getShapeStyleByName(o)):(i=t.attr(),r=Et(Et({},e),e[c]),Object.keys(i).forEach(function(t){var e=i[t];r[t]!==e&&(c?s[c][t]=e:s[t]=e)}))}),s.path&&delete s.path,s.matrix&&delete s.matrix,s.x&&delete s.x,s.y&&delete s.y,s[c]&&s[c].x&&delete s[c].x,s[c]&&s[c].y&&delete s[c].y,u.set("originStyle",s)):(o={},S(t,function(t){var e,n,i=t.get("type"),r=t.get("name");r&&r!==c?o[r]="image"!==i?q(t.attr()):u.getShapeStyleByName(r):((e=u.getShapeStyleByName()).path&&delete e.path,e.matrix&&delete e.matrix,c?r?o[c]=e:(n=kr("shape"),t.set("name",n),o[n]="image"!==i?q(t.attr()):u.getShapeStyleByName(r)):Object.assign(o,e))}),u.set("originStyle",o))},Vr.prototype.restoreStates=function(e,n){var i=this,t=i.get("states");S(t,function(t){e.setState(n,t,!0,i)})},Vr.prototype.init=function(){var t=Wr.getFactory(this.get("type"));this.set("shapeFactory",t)},Vr.prototype.get=function(t){return this._cfg[t]},Vr.prototype.set=function(t,e){w(t)?this._cfg=Et(Et({},this._cfg),t):this._cfg[t]=e},Vr.prototype.getDefaultCfg=function(){return{}},Vr.prototype.clearCache=function(){this.set(Xr,null),this.set(Zr,null)},Vr.prototype.beforeDraw=function(){},Vr.prototype.afterDraw=function(){},Vr.prototype.afterUpdate=function(){},Vr.prototype.draw=function(){this.beforeDraw(),this.drawInner(),this.afterDraw()},Vr.prototype.getShapeStyleByName=function(e){var t=this.get("group"),t=e?t.find(function(t){return t.get("name")===e}):this.getKeyShape();if(t){var n={};return S(t.attr(),function(t,e){"img"!==e&&(n[e]=t)}),n}return{}},Vr.prototype.getShapeCfg=function(t){var e=this.get("styles");if(e){var n=t;return n.style=Et(Et({},e),t.style),n}return t},Vr.prototype.getStateStyle=function(t){var e=this.get("styles");return e&&e[t]},Vr.prototype.getOriginStyle=function(){return this.get("originStyle")},Vr.prototype.getCurrentStatesStyle=function(){var e=this,n={},t=e.getStates();return t&&t.length?(S(e.getStates(),function(t){n=Object.assign(n,e.getStateStyle(t))}),n):this.getOriginStyle()},Vr.prototype.setState=function(t,e){var n=this.get("states"),i=this.get("shapeFactory"),r=t,o=t;_(e)&&(r=t+":"+e,o=t+":");var a=n;if(X(e)){var s=n.indexOf(o);if(e){if(-1<s)return;n.push(r)}else-1<s&&n.splice(s,1)}else _(e)&&(0<(n=n.filter(function(t){return t.includes(o)})).length&&this.clearStates(n),(a=a.filter(function(t){return!t.includes(o)})).push(r),this.set("states",a));i&&(a=this.get("model").type,i.setState(a,t,e,this))},Vr.prototype.clearStates=function(e){var n=this,t=n.getStates(),i=n.get("shapeFactory"),r=n.get("model").type;_(e=e||t)&&(e=[e]);t=t.filter(function(t){return-1===e.indexOf(t)});n.set("states",t),e.forEach(function(t){i.setState(r,t,!1,n)})},Vr.prototype.getContainer=function(){return this.get("group")},Vr.prototype.getKeyShape=function(){return this.get("keyShape")},Vr.prototype.getModel=function(){return this.get("model")},Vr.prototype.getType=function(){return this.get("type")},Vr.prototype.getID=function(){return this.get("id")},Vr.prototype.isItem=function(){return!0},Vr.prototype.getStates=function(){return this.get("states")},Vr.prototype.hasState=function(t){return 0<=this.getStates().indexOf(t)},Vr.prototype.refresh=function(){var t=this.get("model");this.updatePosition(t),this.updateShape(),this.afterUpdate(),this.clearCache()},Vr.prototype.isOnlyMove=function(t){return!1},Vr.prototype.update=function(t,e){void 0===e&&(e=!1);var n=this.get("model"),i=n.visible,r=t.visible;i!==r&&void 0!==r&&this.changeVisibility(r);var o=n.x,i=n.y;t.x=(isNaN(t.x)?n:t).x,t.y=(isNaN(t.y)?n:t).y;r=this.get("styles");t.stateStyles&&(at(r,t.stateStyles),delete t.stateStyles),Object.assign(n,t),e?this.updatePosition(t):(o===t.x&&i===t.y||this.updatePosition(t),this.updateShape()),this.afterUpdate(),this.clearCache()},Vr.prototype.updateShape=function(){var t=this.get("shapeFactory"),e=this.get("model"),n=e.type;t.shouldUpdate(n)&&n===this.get("currentShape")?(e=this.getShapeCfg(e),t.baseUpdate(n,e,this),this.setOriginStyle()):this.draw(),this.restoreStates(t,n)},Vr.prototype.updatePosition=function(t){var e=this.get("model"),n=(G(t.x)?e:t).x,i=(G(t.y)?e:t).y,t=this.get("group");if(G(n)||G(i))return!1;e.x=n,e.y=i;e=t.getMatrix();return(!e||e[6]!==n||e[7]!==i)&&(t.resetMatrix(),Zt(t,{x:n,y:i}),this.clearCache(),!0)},Vr.prototype.getBBox=function(){var t=this.get(Xr);return t||(t=this.calculateBBox(),this.set(Xr,t)),t},Vr.prototype.getCanvasBBox=function(){var t=this.get(Zr);return t||(t=this.calculateCanvasBBox(),this.set(Zr,t)),t},Vr.prototype.toFront=function(){this.get("group").toFront()},Vr.prototype.toBack=function(){this.get("group").toBack()},Vr.prototype.show=function(){this.changeVisibility(!0)},Vr.prototype.hide=function(){this.changeVisibility(!1)},Vr.prototype.changeVisibility=function(t){var e=this.get("group");t?e.show():e.hide(),this.set("visible",t)},Vr.prototype.isVisible=function(){return this.get("visible")},Vr.prototype.enableCapture=function(t){var e=this.get("group");e&&e.set("capture",t)},Vr.prototype.destroy=function(){var t,e;this.destroyed||(t=this.get("animate"),e=this.get("group"),t&&e.stopAnimate(),this.clearCache(),e.remove(),this._cfg=null,this.destroyed=!0)},Vr),Hr={source:"start",target:"end"},qr="Node",Kr="Point";function Jr(){return null!==Yr&&Yr.apply(this,arguments)||this}var Qr,$r=(bt(Jr,Yr=pe),Jr.prototype.getDefaultCfg=function(){return{type:"edge",sourceNode:null,targetNode:null,startPoint:null,endPoint:null,linkCenter:!1}},Jr.prototype.setEnd=function(t,e){var n=Hr[t]+Kr,i=t+qr,t=this.get(i);t&&!t.destroyed&&t.removeEdge(this),w(e)?(this.set(n,e),this.set(i,null)):(e.addEdge(this),this.set(i,e),this.set(n,null))},Jr.prototype.getLinkPoint=function(t,e,n){var i,r=t+qr,o=this.get(Hr[t]+Kr);return o||(i=this.get(r),r=t+"Anchor",n=this.getPrePoint(t,n),r=e[r],o=(o=!G(r)?i.getLinkPointByAnchor(r):o)||i.getLinkPoint(n),G(o.index)||this.set(t+"AnchorIndex",o.index)),o},Jr.prototype.getPrePoint=function(t,e){return e&&e.length?e["source"===t?0:e.length-1]:this.getEndPoint("source"===t?"target":"source")},Jr.prototype.getEndPoint=function(t){var e=Hr[t]+Kr,t=this.get(t+qr);return t?t.get("model"):this.get(e)},Jr.prototype.getControlPointsByCenter=function(t){var e=this.getEndPoint("source"),n=this.getEndPoint("target"),i=this.get("shapeFactory"),t=t.type;return i.getControlPoints(t,{startPoint:e,endPoint:n})},Jr.prototype.getEndCenter=function(t){var e=Hr[t]+Kr,t=this.get(t+qr);if(t){t=t.getBBox();return{x:t.centerX,y:t.centerY}}return this.get(e)},Jr.prototype.init=function(){Yr.prototype.init.call(this),this.setSource(this.get("source")),this.setTarget(this.get("target"))},Jr.prototype.getShapeCfg=function(t){var e=this.get("linkCenter"),n=Yr.prototype.getShapeCfg.call(this,t);return e?(n.startPoint=this.getEndCenter("source"),n.endPoint=this.getEndCenter("target")):(e=n.controlPoints||this.getControlPointsByCenter(n),n.startPoint=this.getLinkPoint("source",t,e),n.endPoint=this.getLinkPoint("target",t,e)),n.sourceNode=this.get("sourceNode"),n.targetNode=this.get("targetNode"),n},Jr.prototype.getModel=function(){var t=this.get("model"),e=this.get("source"+qr),n=this.get("target"+qr);return e?delete t.sourceNode:t.source=this.get("start"+Kr),n?delete t.targetNode:t.target=this.get("end"+Kr),_(t.source)||w(t.source)||(t.source=t.source.getID()),_(t.target)||w(t.target)||(t.target=t.target.getID()),t},Jr.prototype.setSource=function(t){this.setEnd("source",t),this.set("source",t)},Jr.prototype.setTarget=function(t){this.setEnd("target",t),this.set("target",t)},Jr.prototype.getSource=function(){return this.get("source")},Jr.prototype.getTarget=function(){return this.get("target")},Jr.prototype.updatePosition=function(){return!1},Jr.prototype.update=function(t,e){void 0===e&&(e=!1);var n=this.get("model"),i=n.visible,e=t.visible;i!==e&&void 0!==e&&this.changeVisibility(e);e=this.get("styles");t.stateStyles&&(at(e,t.stateStyles),delete t.stateStyles),Object.assign(n,t),this.updateShape(),this.afterUpdate(),this.clearCache()},Jr.prototype.destroy=function(){var t=this.get("source"+qr),e=this.get("target"+qr);t&&!t.destroyed&&t.removeEdge(this),e&&!e.destroyed&&e.removeEdge(this),Yr.prototype.destroy.call(this)},Jr),to="anchorPointsCache";function eo(){return null!==Qr&&Qr.apply(this,arguments)||this}var no,io=(bt(eo,Qr=pe),eo.prototype.getNearestPoint=function(t,e){for(var n=0,i=t[0],r=zt(t[0],e),o=0;o<t.length;o++){var a=t[o],s=zt(a,e);s<r&&(i=a,r=s,n=o)}return i.anchorIndex=n,i},eo.prototype.getDefaultCfg=function(){return{type:"node",edges:[]}},eo.prototype.getEdges=function(){return this.get("edges")},eo.prototype.getInEdges=function(){var e=this;return this.get("edges").filter(function(t){return t.get("target")===e})},eo.prototype.getOutEdges=function(){var e=this;return this.get("edges").filter(function(t){return t.get("source")===e})},eo.prototype.getNeighbors=function(t){var e=this,n=this.get("edges");if("target"===t)return n.filter(function(t){return t.getSource()===e}).map(function(t){return t.getTarget()});if("source"===t)return n.filter(function(t){return t.getTarget()===e}).map(function(t){return t.getSource()});return n.map(function(t){return t.getSource()===e?t.getTarget():t.getSource()})},eo.prototype.getLinkPointByAnchor=function(t){return this.getAnchorPoints()[t]},eo.prototype.getLinkPoint=function(t){var e,n,i=this.get("keyShape").get("type"),r=this.get("type"),o=this.getBBox(),a="combo"===r?(e=o.centerX||(o.maxX+o.minX)/2,o.centerY||(o.maxY+o.minY)/2):(e=o.centerX,o.centerY),r=this.getAnchorPoints();switch(i){case"circle":n=Rt({x:e,y:a,r:o.width/2},t);break;case"ellipse":n=Bt({x:e,y:a,rx:o.width/2,ry:o.height/2},t);break;default:n=Lt(o,t)}i=n;return i=(i=r.length?this.getNearestPoint(r,i=i||t):i)||{x:e,y:a}},eo.prototype.getAnchorPoints=function(){var t,n,e,i,r=this.get(to);return r||(r=[],t=this.get("shapeFactory"),n=this.getBBox(),e=this.get("model"),i=this.getShapeCfg(e),e=e.type,i=t.getAnchorPoints(e,i)||[],S(i,function(t,e){e={x:n.minX+t[0]*n.width,y:n.minY+t[1]*n.height,anchorIndex:e};r.push(e)}),this.set(to,r)),r},eo.prototype.addEdge=function(t){this.get("edges").push(t)},eo.prototype.lock=function(){this.set("locked",!0)},eo.prototype.unlock=function(){this.set("locked",!1)},eo.prototype.hasLocked=function(){return this.get("locked")},eo.prototype.removeEdge=function(t){var e=this.getEdges(),t=e.indexOf(t);-1<t&&e.splice(t,1)},eo.prototype.clearCache=function(){this.set("bboxCache",null),this.set(to,null)},eo.prototype.isOnlyMove=function(t){if(!t)return!1;var e=!G(t.x),n=!G(t.y),t=Object.keys(t);return 1===t.length&&(e||n)||2===t.length&&e&&n},eo),ro="bboxCache",oo="bboxCanvasCache",ao="sizeCache",so="anchorPointsCache";function uo(){return null!==no&&no.apply(this,arguments)||this}var co=(bt(uo,no=io),uo.prototype.getDefaultCfg=function(){return{type:"combo",nodes:[],edges:[],combos:[]}},uo.prototype.getShapeCfg=function(t){var e=this.get("styles"),n=this.get("bbox");if(e&&n){var i=t,n={r:Math.hypot(n.height,n.width)/2||Se.defaultCombo.size[0]/2,width:n.width||Se.defaultCombo.size[0],height:n.height||Se.defaultCombo.size[1]};i.style=Et(Et(Et({},e),t.style),n);e=t.padding||Se.defaultCombo.padding;return N(e)?(n.r+=e,n.width+=2*e,n.height+=2*e):(n.r+=e[0],n.width+=e[1]+e[3]||2*e[1],n.height+=e[0]+e[2]||2*e[0]),this.set(ao,n),i}return t},uo.prototype.calculateCanvasBBox=function(){if(!this.destroyed){var t=this.get("keyShape"),e=this.get("group"),n=Te(t,e);n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2;var i=this.get(ao),r=this.get(ro)||{},e=r.x,r=r.x;return i?(i.width=Math.max(i.width,n.width),i.height=Math.max(i.height,n.height),"circle"===t.get("type")?(n.width=2*i.r,n.height=2*i.r):(n.width=i.width,n.height=i.height),n.minX=n.centerX-n.width/2,n.minY=n.centerY-n.height/2,n.maxX=n.centerX+n.width/2,n.maxY=n.centerY+n.height/2):(n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2),n.x=n.minX,n.y=n.minY,n.x===e&&n.y===r||this.set(so,null),n}},uo.prototype.getChildren=function(){return{nodes:this.getNodes(),combos:this.getCombos()}},uo.prototype.getNodes=function(){return this.get("nodes")},uo.prototype.getCombos=function(){return this.get("combos")},uo.prototype.addChild=function(t){switch(t.getType()){case"node":this.addNode(t);break;case"combo":this.addCombo(t);break;default:return!1}return!0},uo.prototype.addCombo=function(t){return this.get("combos").push(t),!0},uo.prototype.addNode=function(t){return this.get("nodes").push(t),!0},uo.prototype.removeChild=function(t){switch(t.getType()){case"node":this.removeNode(t);break;case"combo":this.removeCombo(t);break;default:return!1}return!0},uo.prototype.removeCombo=function(t){if(t){var e=this.getCombos(),t=e.indexOf(t);return-1<t&&(e.splice(t,1),!0)}},uo.prototype.removeNode=function(t){if(t){var e=this.getNodes(),t=e.indexOf(t);return-1<t&&(e.splice(t,1),!0)}},uo.prototype.isOnlyMove=function(t){return!1},uo.prototype.getBBox=function(){return this.set(oo,null),this.calculateCanvasBBox()},uo.prototype.clearCache=function(){this.set(ro,null),this.set(oo,null),this.set(so,null)},uo.prototype.destroy=function(){var t,e;this.destroyed||(t=this.get("animate"),e=this.get("group"),t&&e.stopAnimate(),this.clearCache(),this.set(ao,null),this.set("bbox",null),e.remove(),this._cfg=null,this.destroyed=!0)},uo),ho="node",lo="edge",fo="combo",po="stateStyles";function go(t){this.graph=t,this.destroyed=!1}var vo=(go.prototype.addItem=function(t,n){var i=this.graph,e="vedge"===t?lo:t,r=i.get(e+"Group")||i.get("group"),o=U(e),a=null,s=i.get(e+U(po))||{},u=i.get("default"+o);n[po]&&(s=n[po]),u&&S(u,function(t,e){g(t)&&!m(t)?n[e]=Q({},t,n[e]):m(t)?n[e]=n[e]||q(u[e]):n[e]=n[e]||u[e]});var c,h,e=i.get(e+"Mapper");if(e&&((c=e(n))[po]&&(s=c[po],delete c[po]),S(c,function(t,e){g(t)&&!m(t)?n[e]=Q({},n[e],t):n[e]=c[e]||n[e]})),i.emit("beforeadditem",{type:t,model:n}),t===lo||"vedge"===t){var l=void 0,d=void 0,l=n.source,d=n.target;if(l&&_(l)&&(l=i.findById(l)),d&&_(d)&&(d=i.findById(d)),!l||!d)return;l.getType&&"combo"===l.getType()&&(n.isComboEdge=!0),d.getType&&"combo"===d.getType()&&(n.isComboEdge=!0),a=new $r({model:n,source:l,target:d,styles:s,linkCenter:i.get("linkCenter"),group:r.addGroup()})}else t===ho?a=new io({model:n,styles:s,group:r.addGroup()}):t===fo&&(l=n.children,d=Ge(l,i),isNaN(d.x)?isNaN(n.x)&&(n.x=100*Math.random()):n.x=d.x,isNaN(d.y)?isNaN(n.y)&&(n.y=100*Math.random()):n.y=d.y,(r=r.addGroup()).setZIndex(n.depth),h=(a=new co({model:n,styles:s,bbox:n.collapsed?Ge([],i):d,group:r})).getModel(),(l||[]).forEach(function(t){var e=i.findById(t.id);a.addChild(e),t.depth=h.depth+2}),n.collapsed&&setTimeout(function(){i.collapseCombo(a)},16));if(a)return i.get(t+"s").push(a),i.get("itemMap")[a.get("id")]=a,i.emit("afteradditem",{item:a,model:n}),a},go.prototype.updateItem=function(e,n){var i,t,r,o,a,s,u,c=this.graph;(e=_(e)?c.findById(e):e)&&!e.destroyed&&(u="",e.getType&&(u=e.getType()),r=c.get(u+"Mapper"),i=e.getModel(),s=e.isOnlyMove(n),r?(t=r(Q({},i,n)),r=Q({},i,t,n),t[po]&&(e.set("styles",r[po]),delete r[po]),S(r,function(t,e){n[e]=t})):S(n,function(t,e){i[e]&&g(t)&&!m(t)&&(n[e]=Et(Et({},i[e]),n[e]))}),c.emit("beforeupdateitem",{item:e,cfg:n}),u===lo&&(n.source&&(o=n.source,_(o)&&(o=c.findById(o)),e.setSource(o)),n.target&&(o=n.target,_(o)&&(o=c.findById(o)),e.setTarget(o)),e.update(n)),u!==ho&&u!==fo||(e.update(n,s),a=e.getEdges(),(s=Ue(n))&&u===ho?S(a,function(t){t.refresh()}):s&&u===fo&&(s=e.get("shapeFactory"),u=i.type||"circle",(void 0===i.animate||void 0===n.animate?null===(u=null===(u=s[u])||void 0===u?void 0:u.options)||void 0===u?void 0:u.animate:i.animate||n.animate)?setTimeout(function(){var t;!e||e.destroyed||(t=e.getKeyShape())&&!t.destroyed&&S(a,function(t){t&&!t.destroyed&&t.refresh()})},201):S(a,function(t){t.refresh()}))),c.emit("afterupdateitem",{item:e,cfg:n}))},go.prototype.updateCombo=function(e,t){var n,i=this,r=this.graph;(e=_(e)?r.findById(e):e)&&!e.destroyed&&(n=e.getModel(),t=Ge(n.collapsed?[]:t,r),e.set("bbox",t),e.update({x:t.x,y:t.y}),r=e.get("shapeFactory"),t=n.type||"circle",(void 0===n.animate?null===(t=null===(t=r[t])||void 0===t?void 0:t.options)||void 0===t?void 0:t.animate:n.animate)?setTimeout(function(){var t;!e||e.destroyed||(t=e.getKeyShape())&&!t.destroyed&&(e.getShapeCfg(n),i.updateComboEdges(e))},201):this.updateComboEdges(e))},go.prototype.updateComboEdges=function(t){for(var e=t.getEdges()||[],n=0;n<e.length;n++){var i,r,o=e[n];o&&!o.destroyed&&(i=o.get("shapeFactory"),r=o.getShapeCfg(o.getModel()),(o=o.getContainer()).clear(),i.draw(r.type,r,o))}},go.prototype.collapseCombo=function(t){var e=this.graph,t=(t=_(t)?e.findById(t):t).getChildren();t.nodes.forEach(function(t){e.hideItem(t)}),t.combos.forEach(function(t){e.hideItem(t)})},go.prototype.expandCombo=function(t){var e=this.graph,t=(t=_(t)?e.findById(t):t).getChildren();t.nodes.forEach(function(t){e.showItem(t)}),t.combos.forEach(function(t){t.getModel().collapsed?t.show():e.showItem(t)})},go.prototype.removeItem=function(t){var e=this,n=this.graph;if((t=_(t)?n.findById(t):t)&&!t.destroyed){var i=q(t.getModel());n.emit("beforeremoveitem",{item:i});var r="";t.getType&&(r=t.getType());var o=n.get(r+"s"),a=o.indexOf(t);-1<a&&o.splice(a,1),r!==lo||-1<(u=(s=n.get("v"+r+"s")).indexOf(t))&&s.splice(u,1);var s=t.get("id");delete n.get("itemMap")[s];var u=n.get("comboTrees"),c=t.get("id");if(r===ho){var h,l,s=t.getModel().comboId;u&&s&&(l=!1,(h=u).forEach(function(t){l||De(t,function(t){if(t.id===c&&h){var e=h.indexOf(t);return h.splice(e,1),!(l=!0)}return h=t.children,!0})}));for(var d=(g=t.getEdges()).length-1;0<=d;d--)n.removeItem(g[d],!1);s&&n.updateCombo(s)}else if(r===fo){var f,r=t.getModel().parentId,p=!1;(u||[]).forEach(function(t){p||De(t,function(t){return t.id!==c||(f=t,!(p=!0))})}),f.removed=!0,f&&f.children&&f.children.forEach(function(t){e.removeItem(t.id)});for(var g,d=(g=t.getEdges()).length;0<=d;d--)n.removeItem(g[d],!1);r&&n.updateCombo(r)}t.destroy(),n.emit("afterremoveitem",{item:i})}},go.prototype.setItemState=function(t,e,n){var i=this.graph,r=e;_(n)&&(r=e+":"+n),t.hasState(r)===n&&n||_(n)&&t.hasState(r)||(i.emit("beforeitemstatechange",{item:t,state:r,enabled:n}),t.setState(e,n),i.autoPaint(),i.emit("afteritemstatechange",{item:t,state:r,enabled:n}))},go.prototype.priorityState=function(t,e){var n=this.graph,i=t;_(t)&&(i=n.findById(t)),this.setItemState(i,e,!1),this.setItemState(i,e,!0)},go.prototype.clearItemStates=function(t,e){var n=this.graph;_(t)&&(t=n.findById(t)),n.emit("beforeitemstatesclear",{item:t,states:e}),t.clearStates(e),n.emit("afteritemstatesclear",{item:t,states:e})},go.prototype.refreshItem=function(t){var e=this.graph;_(t)&&(t=e.findById(t)),e.emit("beforeitemrefresh",{item:t}),t.refresh(),e.emit("afteritemrefresh",{item:t})},go.prototype.addCombos=function(t,i){var r=this,e=this.graph;(t||[]).forEach(function(t){Ne(t,function(e){var n;return i.forEach(function(t){t.id===e.id&&(t.children=e.children,t.depth=e.depth,n=t)}),n&&r.addItem("combo",n),!0})});e=e.get("comboGroup");e&&e.sort()},go.prototype.changeItemVisibility=function(t,e){var n,i,r,o,a,s=this,u=this.graph;if(t=_(t)?u.findById(t):t)return u.emit("beforeitemvisibilitychange",{item:t,visible:e}),t.changeVisibility(e),t.getType&&t.getType()===ho?(a=t.getEdges(),S(a,function(t){(!e||t.get("source").isVisible()&&t.get("target").isVisible())&&s.changeItemVisibility(t,e)})):t.getType&&t.getType()===fo&&(n=u.get("comboTrees"),i=t.get("id"),o=!(r=[]),(n||[]).forEach(function(t){o||t.children&&0!==t.children.length&&De(t,function(t){return t.id!==i||(r=t.children,!(o=!0))})}),r&&(!e||e&&!t.getModel().collapsed)&&r.forEach(function(t){t=u.findById(t.id);s.changeItemVisibility(t,e)}),a=t.getEdges(),S(a,function(t){(!e||t.get("source").isVisible()&&t.get("target").isVisible())&&s.changeItemVisibility(t,e)})),u.emit("afteritemvisibilitychange",{item:t,visible:e}),t},go.prototype.destroy=function(){this.graph=null,this.destroyed=!0},go),yo=null;function mo(t){this.graph=t,this.cachedStates={enabled:{},disabled:{}},this.destroyed=!1}var xo=(mo.checkCache=function(t,e,n){!n[e]||0<=(t=n[e].indexOf(t))&&n[e].splice(t,1)},mo.cacheState=function(t,e,n){n[e]||(n[e]=[]),n[e].push(t)},mo.prototype.updateState=function(t,e,n){var i,r,o=this,a=mo.checkCache,s=mo.cacheState;t.destroyed||(i=(r=this.cachedStates).enabled,r=r.disabled,n?(a(t,e,r),s(t,e,i)):(a(t,e,i),s(t,e,r)),yo&&clearTimeout(yo),yo=setTimeout(function(){yo=null,o.updateGraphStates()},16))},mo.prototype.updateStates=function(e,t,n){var i=this;_(t)?this.updateState(e,t,n):t.forEach(function(t){i.updateState(e,t,n)})},mo.prototype.updateGraphStates=function(){var r=this.graph.get("states"),t=this.cachedStates;S(t.disabled,function(e,t){r[t]&&(r[t]=r[t].filter(function(t){return e.indexOf(t)<0&&!e.destroyed}))}),S(t.enabled,function(t,n){var i;r[n]?(i={},r[n].forEach(function(t){t.destroyed||(i[t.get("id")]=!0)}),t.forEach(function(t){var e;t.destroyed||(e=t.get("id"),i[e]||(i[e]=!0,r[n].push(t)))})):r[n]=t}),this.graph.emit("graphstatechange",{states:r}),this.cachedStates={enabled:{},disabled:{}}},mo.prototype.destroy=function(){this.graph=null,this.cachedStates=null,yo&&clearTimeout(yo),yo=null,this.destroyed=!0},mo),bo=function(t){var e=[];if(t.length<2)throw new Error("point length must largn than 2, now it's "+t.length);for(var n=0,i=t;n<i.length;n++){var r=i[n],o=r.x,r=r.y;e.push(o),e.push(r)}var a=sr(e);return a.unshift(["M",t[0].x,t[0].y]),a},Eo=function(t,e,n,i){void 0===i&&(i=0);var r={x:(1-(n=void 0===n?0:n))*t.x+n*e.x,y:(1-n)*t.y+n*e.y},n=[0,0];Pt.Fv(n,[e.x-t.x,e.y-t.y]);i=[-(n=!n||!n[0]&&!n[1]?[0,0]:n)[1]*i,n[0]*i];return r.x+=i[0],r.y+=i[1],r},So=function(t,e){var n=t.length;if(!n)return"";for(var i="",r=0;r<n;r++)i+=function(t,n){return t&&n?t.replace(/\\?\{([^{}]+)\}/g,function(t,e){if("\\"===t.charAt(0))return t.slice(1);e=n[e];return(e=0===e?"0":e)||""}):t}(0===r?"M{x} {y}":"L{x} {y}",t[r]);return e&&(i+="Z"),i},wo=function(t){var i=[];return t.forEach(function(t){if("A"!==t[0])for(var e=1;e<t.length;e+=2)i.push([t[e],t[e+1]]);else{var n=t.length;i.push([t[n-2],t[n-1]])}}),i},ko=function(t){if(t.length<2)throw new Error("point length must largn than 2, now it's "+t.length);var e=t[0],n=t[1],i=t[t.length-1],r=t[t.length-2];t.unshift(i),t.unshift(r),t.push(e),t.push(n);for(var o=[],a=1;a<t.length-2;a+=1){var s=t[a-1].x,u=t[a-1].y,c=t[a].x,h=t[a].y,l=t[a+1].x,d=t[a+1].y,f=a!==t.length-2?t[a+2].x:l,p=a!==t.length-2?t[a+2].y:d;o.push(["C",c+(l-s)/6,h+(d-u)/6,l-(f-c)/6,d-(p-h)/6,l,d])}return o.unshift(["M",i.x,i.y]),o},Co=function(t,e){return Pt.bA([0,0],Pt.Fv([0,0],t),e)},_o=function(t,e){e=[t[1]-e[1],e[0]-t[0]],t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);if(0===t)throw new Error("p0 should not be equal to p1");return[e[0]/t,e[1]/t]},Mo=function(t,e){return[e[0]-t[0],e[1]-t[1]]};function Io(t,e){var n,i,r,o,a,s,u;if(!t||t.length<1)return"";if(1===t.length)return i=[(n=t)[0][0],n[0][1]-e],n=[n[0][0],n[0][1]+e],"M "+i+" A "+e+","+e+",0,0,0,"+n+" A "+e+","+e+",0,0,0,"+i;if(2===t.length)return r=t,o=Pt.bA([0,0],_o(r[0],r[1]),e),a=Pt.bA([0,0],o,-1),s=Pt.IH([0,0],r[0],o),u=Pt.IH([0,0],r[1],o),o=Pt.IH([0,0],r[1],a),a=Pt.IH([0,0],r[0],a),"M "+s+" L "+u+" A "+[e,e,"0,0,0",o].join(",")+" L "+a+" A "+[e,e,"0,0,0",s].join(",");for(var c=new Array(t.length),h=0;h<c.length;++h){var l=0===h?t[t.length-1]:t[h-1],d=t[h],f=Pt.bA([0,0],_o(l,d),e);c[h]=[Pt.IH([0,0],l,f),Pt.IH([0,0],d,f)]}var p="A "+[e,e,"0,0,0,"].join(",");return(c=c.map(function(t,e){var n="";return 0===e&&(n="M "+c[c.length-1][1]+" "),n+=p+t[0]+" L "+t[1]})).join(" ")}function To(n,t){var e,i,r,o,a,s,u,c=n.length;if(!n||c<1)return"";if(1===c)return i=[(e=n)[0][0],e[0][1]-t],e=[e[0][0],e[0][1]+t],"M "+i+" A "+[t,t,"0,0,0",e].join(",")+" A "+[t,t,"0,0,0",i].join(",");if(2===c)return o=Mo((r=n)[0],r[1]),a=Co(o,t),s=Pt.IH([0,0],r[0],Pt.bA([0,0],a,-1)),u=Pt.IH([0,0],r[1],a),r=1.2*t,a=Co(Pt.Fv([0,0],o),r),o=Pt.bA([0,0],a,-1),r=Pt.IH([0,0],s,o),o=Pt.IH([0,0],u,o),a=Pt.IH([0,0],s,a),"M "+s+" C "+[r,o,u].join(",")+" S "+[a,s].join(",")+" Z";for(var h=n.map(function(t,e){e=n[(e+1)%c];return{p:t,v:Pt.Fv([0,0],Mo(t,e))}}),l=0;l<h.length;++l){var d=Pt.Fv([0,0],Pt.IH([0,0],h[0<l?l-1:c-1].v,Pt.bA([0,0],h[l].v,-1)));h[l].p=Pt.IH([0,0],h[l].p,Pt.bA([0,0],d,t))}return h.map(function(t){t=t.p;return{x:t[0],y:t[1]}})}function Ao(t,e,n){return(t.y-n.y)*(e.x-n.x)-(t.x-n.x)*(e.y-n.y)}function Po(t){var e=t.map(function(t){return{x:t.getModel().x,y:t.getModel().y}});if(e.sort(function(t,e){return t.x===e.x?t.y-e.y:t.x-e.x}),1===e.length)return e;for(var n=[],i=0;i<e.length;i++){for(;2<=n.length&&Ao(n[n.length-2],n[n.length-1],e[i])<=0;)n.pop();n.push(e[i])}for(var r=[],i=e.length-1;0<=i;i--){for(;2<=r.length&&Ao(r[r.length-2],r[r.length-1],e[i])<=0;)r.pop();r.push(e[i])}return r.pop(),n.pop(),n.concat(r)}var Do={maxRoutingIterations:100,maxMarchingIterations:100,pixelGroupSize:2,edgeR0:10,edgeR1:10,nodeR0:5,nodeR1:10,morphBuffer:5,threshold:.001,skip:16,nodeInfluenceFactor:1,edgeInfluenceFactor:1,negativeNodeInfluenceFactor:-.5};function No(u,c,i){function r(t,e){return c.cells[t+e*c.width]}function h(t,e){var n=0;return r(t-1,e-1)>=i&&(n+=1),r(t,e-1)>i&&(n+=2),r(t-1,e)>i&&(n+=4),r(t,e)>i&&(n+=8),n}var n=!1;this.march=function(){for(var t=0;t<c.width&&!n;t+=1)for(var e=0;e<c.height&&!n;e+=1)r(t,e)>i&&15!==h(t,e)&&(n=function(t,e){for(var n,i,r=t,o=e,a=0;a<c.width*c.height;a++){if(n=r,i=o,-1<u.findIndex(function(t){return t.x===r&&t.y===o})){if(u[0].x===r&&u[0].y===o)return!0}else u.push({x:r,y:o});var s=h(r,o);switch(s){case-1:return!0;case 0:case 3:case 2:case 7:r++;break;case 12:case 14:case 4:r--;break;case 6:0===n&&(-1===i?--r:r+=1);break;case 1:case 13:case 5:o--;break;case 9:1===n&&(0===i?--o:o+=1);break;case 10:case 8:case 11:o++;break;default:return!0}}}(t,e));return n}}function Oo(t,n){var i=Number.POSITIVE_INFINITY,r=null;return t.forEach(function(t){var e=ae(t,n);0<=e&&e<i&&(r=t,i=e)}),r}function Lo(t,u,e,c){var h=[],l=[];l.push(t);for(var d=!0,n=0,f=function(e,t){var n=!1;return t.forEach(function(t){n||(he(e,{x:t.x1,y:t.y1})||he(e,{x:t.x2,y:t.y2}))&&(n=!0)}),n},p=function(t,e){for(var n=0,i=e;n<i.length;n++){var r=i[n].getBBox(),r=[[r.x,r.y],[r.x+r.width,r.y],[r.x,r.y+r.height],[r.x+r.width,r.y+r.height]];if(Kt(r,t.x,t.y))return!0}return!1};d&&n<e;)for(d=!1;!d&&l.length;)!function(){var o,t,a=l.pop(),s=Oo(u,a);s&&(t=oe(s,a),o=t[0],2===t[1]&&((t=function(t){for(var e=c,n=Go(s,e,o,t),i=f(n,l)||f(n,h),r=p(n,u);!i&&r&&1<=e;)n=Go(s,e/=1.5,o,t),i=f(n,l)||f(n,h),r=p(n,u);!n||i||t&&r||(l.push(new $t(a.x1,a.y1,n.x,n.y)),l.push(new $t(n.x,n.y,a.x2,a.y2)),d=!0)})(!0),d||t(!1))),d||h.push(a),n+=1}();for(;l.length;)h.push(l.pop());return h}function Ro(t,o,e,n,i){var a,s,u,c,e=(a=t,e=e,s=o,u=null,c=Number.POSITIVE_INFINITY,e.forEach(function(t){var e={x:a.getModel().x,y:a.getModel().y},n={x:t.getModel().x,y:t.getModel().y},i=ue(e,n),r=new $t(e.x,e.y,n.x,n.y),n=s.reduce(function(t,e){return 0<ae(e,r)?t+1:t},0);i*Math.pow(n+1,2)<c&&(u=t,c=i*Math.pow(n+1,2))}),u);if(null===e)return[];e=new $t(t.getModel().x,t.getModel().y,e.getModel().x,e.getModel().y);return function(t){for(var e=[];0<t.length;){var n=t.pop();if(0===t.length){e.push(n);break}var i=t.pop(),r=new $t(n.x1,n.y1,i.x2,i.y2);Oo(o,r)?(e.push(n),t.push(i)):t.push(r)}return e}(Lo(e,o,n,i))}function Bo(r,e,t){var n=Object.assign(Do,t),i=se(r.map(function(t){return{x:t.getModel().x,y:t.getModel().y}}));r=r.sort(function(t,e){return ue({x:t.getModel().x,y:t.getModel().y},i)-ue({x:e.getModel().x,y:e.getModel().y},i)});var o=[],a=[];r.forEach(function(t){Ro(t,e,o,n.maxRoutingIterations,n.morphBuffer).forEach(function(t){a.push(t)}),o.push(t)});for(var s=function(t,e,n){var i={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,width:0,height:0,x:0,y:0},r=[];t.forEach(function(t){r.push(t.getBBox())}),e.forEach(function(t){r.push(t.getBBox())});for(var o=0,a=r;o<a.length;o++){var s=a[o];i.minX=(s.minX<i.minX?s:i).minX-n,i.minY=(s.minY<i.minY?s:i).minY-n,i.maxX=(s.maxX>i.maxX?s:i).maxX+n,i.maxY=(s.maxY>i.maxY?s:i).maxY+n}return i.width=i.maxX-i.minX,i.height=i.maxY-i.minY,i.x=i.minX,i.y=i.minY,i}(r,a,n.nodeR0),u=function(t,e,n){t=Math.ceil(t/n),n=Math.ceil(e/n);return{cells:new Float32Array(Math.max(0,t*n)).fill(0),width:t,height:n}}(s.width,s.height,n.pixelGroupSize),c=[],h=[],l=0;l<n.maxMarchingIterations;l++)if(!function(t,e,n,l,d,f){function i(t,e){e=Math.floor((t-e)/f.pixelGroupSize);return e<0?0:e}function p(t,e){return t*f.pixelGroupSize+e}function g(t,e){return[Math.min(i(t.minX,e+l.minX),d.width),Math.min(i(t.minY,e+l.minY),d.height),Math.min(i(t.maxX,-e+l.minX),d.width),Math.min(i(t.maxY,-e+l.minY),d.height)]}function r(t,e){for(var n=t.getBBox(),i=g(n,f.nodeR1),r=i[0],t=i[1],o=i[2],a=i[3],s=t;s<a;s+=1)for(var u,c,h=r;h<o;h+=1)e<0&&d[h+s*d.width]<=0||(u=p(h,l.minX),c=p(s,l.minY),(c=le({x:u,y:c},{x:n.minX,y:n.minY,width:n.width,height:n.height}))<Math.pow(f.nodeR1,2)&&(c=Math.sqrt(c)-f.nodeR1,d.cells[h+s*d.width]+=e*c*c))}var o=(f.nodeR0-f.nodeR1)*(f.nodeR0-f.nodeR1),a=(f.edgeR0-f.edgeR1)*(f.edgeR0-f.edgeR1);f.nodeInfluenceFactor&&t.forEach(function(t){r(t,f.nodeInfluenceFactor/o)});f.edgeInfluenceFactor&&n.forEach(function(t){!function(t,e){for(var n=t.getBBox(),i=g(n,f.edgeR1),r=i[0],n=i[1],o=i[2],a=i[3],s=n;s<a;s+=1)for(var u,c,h=r;h<o;h+=1)e<0&&d.cells[h+s*d.width]<=0||(u=p(h,l.minX),c=p(s,l.minY),(c=ce({x:u,y:c},t))<Math.pow(f.edgeR1,2)&&(c=Math.sqrt(c)-f.edgeR1,d.cells[h+s*d.width]+=e*c*c))}(t,f.edgeInfluenceFactor/a)});f.negativeNodeInfluenceFactor&&e.forEach(function(t){r(t,f.negativeNodeInfluenceFactor/o)})}(r,e,a,s,u,n),h=[],new No(c=[],u,n.threshold).march()){var d=c.map(function(t){return{x:Math.round(t.x*n.pixelGroupSize+s.minX),y:Math.round(t.y*n.pixelGroupSize+s.minY)}});if(d){var f=d.length;if(1<n.skip)for(f=Math.floor(d.length/n.skip);f<3&&1<n.skip;)--n.skip,f=Math.floor(d.length/n.skip);for(var p=0,g=0;g<f;g+=1,p+=n.skip)h.push({x:d[p].x,y:d[p].y})}if(h&&function(){for(var t=0,e=r;t<e.length;t++){var n=e[t],i=h.map(function(t){return[t.x,t.y]});if(!Kt(i,n.getBBox().centerX,n.getBBox().centerY))return!1}return!0}())return h;if(n.threshold*=.9,l<=.5*n.maxMarchingIterations)n.memberInfluenceFactor*=1.2,n.edgeInfluenceFactor*=1.2;else{if(!(0!==n.nonMemberInfluenceFactor&&0<e.length))break;n.nonMemberInfluenceFactor*=.8}}return h}function Go(t,e,n,i){var r=t.getBBox(),o=n[0],a=n[1],s=n[2],t=n[3],n={topLeft:{x:r.minX-e,y:r.minY-e},topRight:{x:r.maxX+e,y:r.minY-e},bottomLeft:{x:r.minX-e,y:r.maxY+e},bottomRight:{x:r.maxX+e,y:r.maxY+e}},e=r.height*r.width;function u(t,e){return r.width*(.5*(t.y-r.minY+(e.y-r.minY)))}if(a)return o?i?n.topLeft:n.bottomRight:s?i?n.bottomLeft:n.topRight:u(a,t)<.5*e?a.y>t.y?i?n.topLeft:n.bottomRight:i?n.topRight:n.bottomLeft:a.y<t.y?i?n.bottomLeft:n.topRight:i?n.bottomRight:n.topLeft;if(t){if(o)return i?n.topRight:n.bottomLeft;if(s)return i?n.bottomRight:n.topLeft}return u(o,s)<.5*e?o.x>s.x?i?n.topLeft:n.bottomRight:i?n.bottomLeft:n.topRight:o.x<s.x?i?n.topRight:n.bottomLeft:i?n.bottomRight:n.topLeft}function Uo(e,t){this.cfg=Q(this.getDefaultCfg(),t),this.graph=e,this.id=this.cfg.id,this.group=this.cfg.group,this.members=this.cfg.members.map(function(t){return _(t)?e.findById(t):t}),this.nonMembers=this.cfg.nonMembers.map(function(t){return _(t)?e.findById(t):t}),this.setPadding(),this.setType(),this.path=this.calcPath(this.members,this.nonMembers),this.render()}var Fo,zo=(Uo.prototype.getDefaultCfg=function(){return{id:"g6-hull",type:"round-convex",members:[],nonMembers:[],style:{fill:"lightblue",stroke:"blue",opacity:.2},padding:10}},Uo.prototype.setPadding=function(){var t=this.members.length&&this.members[0].getKeyShape().getCanvasBBox().width/2;this.padding=0<this.cfg.padding?this.cfg.padding+t:10+t,this.cfg.bubbleCfg={nodeR0:this.padding-t,nodeR1:this.padding-t,morphBuffer:this.padding-t}},Uo.prototype.setType=function(){this.type=this.cfg.type,this.members.length<3&&(this.type="round-convex"),"round-convex"!==this.type&&"smooth-convex"!==this.type&&"bubble"!==this.type&&(this.type="round-convex")},Uo.prototype.calcPath=function(t,e){var n,i,r;switch(this.type){case"round-convex":i=hr(r=Io((n=Po(t)).map(function(t){return[t.x,t.y]}),this.padding));break;case"smooth-convex":2===(n=Po(t)).length?i=hr(r=Io(n.map(function(t){return[t.x,t.y]}),this.padding)):2<n.length&&(r=To(n.map(function(t){return[t.x,t.y]}),this.padding),i=ko(r));break;case"bubble":i=2<=(n=Bo(t,e,this.cfg.bubbleCfg)).length&&ko(n)}return i},Uo.prototype.render=function(){this.group.addShape("path",{attrs:Et({path:this.path},this.cfg.style),id:this.id,name:this.cfg.id}),this.group.toBack()},Uo.prototype.addMember=function(t){if(t){_(t)&&(t=this.graph.findById(t)),this.members.push(t);t=this.nonMembers.indexOf(t);return-1<t&&this.nonMembers.splice(t,1),this.updateData(this.members,this.nonMembers),!0}},Uo.prototype.addNonMember=function(t){if(t){_(t)&&(t=this.graph.findById(t)),this.nonMembers.push(t);t=this.members.indexOf(t);return-1<t&&this.members.splice(t,1),this.updateData(this.members,this.nonMembers),!0}},Uo.prototype.removeMember=function(t){if(t){_(t)&&(t=this.graph.findById(t));t=this.members.indexOf(t);return-1<t&&(this.members.splice(t,1),this.updateData(this.members,this.nonMembers),!0)}},Uo.prototype.removeNonMember=function(t){if(t){_(t)&&(t=this.graph.findById(t));t=this.nonMembers.indexOf(t);return-1<t&&(this.nonMembers.splice(t,1),this.updateData(this.members,this.nonMembers),!0)}},Uo.prototype.updateData=function(t,e){var n=this;this.group.findById(this.id).remove(),t&&(this.members=t.map(function(t){return _(t)?n.graph.findById(t):t})),e&&(this.nonMembers=e.map(function(t){return _(t)?n.graph.findById(t):t})),this.path=this.calcPath(this.members,this.nonMembers),this.render()},Uo.prototype.updateStyle=function(t){this.group.findById(this.id).attr(Et({},t))},Uo.prototype.updateCfg=function(t){var e=this;this.cfg=Q(this.cfg,t),this.id=this.cfg.id,this.group=this.cfg.group,t.members&&(this.members=this.cfg.members.map(function(t){return _(t)?e.graph.findById(t):t})),t.nonMembers&&(this.nonMembers=this.cfg.nonMembers.map(function(t){return _(t)?e.graph.findById(t):t})),this.setPadding(),this.setType(),this.path=this.calcPath(this.members,this.nonMembers),this.render()},Uo.prototype.contain=function(t){var e,n=this,i=_(t)?this.graph.findById(t):t,t=i.getKeyShape();return e=(e="path"===i.get("type")?wo(t.attr("path")):[[(e=t.getCanvasBBox()).minX,e.minY],[e.maxX,e.minY],[e.maxX,e.maxY],[e.minX,e.maxY]]).map(function(t){t=n.graph.getPointByCanvas(t[0],t[1]);return[t.x,t.y]}),Qt(e,wo(this.path))},Uo.prototype.destroy=function(){this.group.remove(),this.cfg=null},Uo),jo=Mt;function Wo(t){var e=Fo.call(this)||this;return e.cfg=Q(e.getDefaultCfg(),t),e.init(),e.animating=!1,e.destroyed=!1,e.cfg.enabledStack&&(e.undoStack=new Tt.Stack(e.cfg.maxStep),e.redoStack=new Tt.Stack(e.cfg.maxStep)),e}bt(Wo,Fo=Ct),Wo.prototype.init=function(){this.initCanvas();var t=new Dr(this),e=new je(this),n=new vo(this),i=new xo(this);this.set({viewController:t,modeController:e,itemController:n,stateController:i}),this.initLayoutController(),this.initEventController(),this.initGroups(),this.initPlugins()},Wo.prototype.initGroups=function(){var t,e,n=this.get("canvas"),i=this.get("canvas").get("el").id,r=n.addGroup({id:i+"-root",className:Se.rootContainerClassName});this.get("groupByTypes")&&(t=r.addGroup({id:i+"-edge",className:Se.edgeContainerClassName}),e=r.addGroup({id:i+"-node",className:Se.nodeContainerClassName}),(n=r.addGroup({id:i+"-combo",className:Se.comboContainerClassName})).toBack(),this.set({nodeGroup:e,edgeGroup:t,comboGroup:n}));i=r.addGroup({id:i+"-delegate",className:Se.delegateContainerClassName});this.set({delegateGroup:i}),this.set("group",r)},Wo.prototype.getDefaultCfg=function(){return{container:void 0,width:void 0,height:void 0,renderer:"canvas",modes:{},plugins:[],data:{},fitViewPadding:10,minZoom:.2,maxZoom:10,event:!0,groupByTypes:!0,directed:!1,autoPaint:!0,nodes:[],edges:[],combos:[],vedges:[],itemMap:{},linkCenter:!1,defaultNode:{},defaultEdge:{},nodeStateStyles:{},edgeStateStyles:{},states:{},animate:!1,animateCfg:{onFrame:void 0,duration:500,easing:"easeLinear"},callback:void 0,enabledStack:!1,maxStep:10,tooltips:[]}},Wo.prototype.set=function(t,e){return w(t)?this.cfg=Et(Et({},this.cfg),t):this.cfg[t]=e,this},Wo.prototype.get=function(t){return this.cfg[t]},Wo.prototype.getGroup=function(){return this.get("group")},Wo.prototype.getContainer=function(){return this.get("container")},Wo.prototype.getMinZoom=function(){return this.get("minZoom")},Wo.prototype.setMinZoom=function(t){return this.set("minZoom",t)},Wo.prototype.getMaxZoom=function(){return this.get("maxZoom")},Wo.prototype.setMaxZoom=function(t){return this.set("maxZoom",t)},Wo.prototype.getWidth=function(){return this.get("width")},Wo.prototype.getHeight=function(){return this.get("height")},Wo.prototype.clearItemStates=function(t,e){_(t)&&(t=this.findById(t));var n=this.get("itemController");e=e||t.get("states"),n.clearItemStates(t,e),this.get("stateController").updateStates(t,e,!1)},Wo.prototype.node=function(t){"function"==typeof t&&this.set("nodeMapper",t)},Wo.prototype.edge=function(t){"function"==typeof t&&this.set("edgeMapper",t)},Wo.prototype.combo=function(t){"function"==typeof t&&this.set("comboMapper",t)},Wo.prototype.findById=function(t){return this.get("itemMap")[t]},Wo.prototype.find=function(t,n){var i,t=this.get(t+"s");return S(t,function(t,e){if(n(t,e))return i=t}),i},Wo.prototype.findAll=function(t,n){var i=[];return S(this.get(t+"s"),function(t,e){n(t,e)&&i.push(t)}),i},Wo.prototype.findAllByState=function(t,e){return this.findAll(t,function(t){return t.hasState(e)})},Wo.prototype.translate=function(t,e){var n=this.get("group"),i=q(n.getMatrix());i=jo(i=i||[1,0,0,0,1,0,0,0,1],[["t",t,e]]),n.setMatrix(i),this.emit("viewportchange",{action:"translate",matrix:n.getMatrix()}),this.autoPaint()},Wo.prototype.moveTo=function(t,e){var n=this.get("group");Vt(n,{x:t,y:e}),this.emit("viewportchange",{action:"move",matrix:n.getMatrix()})},Wo.prototype.fitView=function(t){t&&this.set("fitViewPadding",t),this.get("viewController").fitView(),this.autoPaint()},Wo.prototype.fitCenter=function(){this.get("viewController").fitCenter(),this.autoPaint()},Wo.prototype.addBehaviors=function(t,e){return this.get("modeController").manipulateBehaviors(t,e,!0),this},Wo.prototype.removeBehaviors=function(t,e){return this.get("modeController").manipulateBehaviors(t,e,!1),this},Wo.prototype.updateBehavior=function(t,e,n){return this.get("modeController").updateBehavior(t,e,n),this},Wo.prototype.zoom=function(t,e){var n=this.get("group"),i=q(n.getMatrix()),r=this.get("minZoom"),o=this.get("maxZoom");i=jo(i=i||[1,0,0,0,1,0,0,0,1],e?[["t",-e.x,-e.y],["s",t,t],["t",e.x,e.y]]:[["s",t,t]]),r&&i[0]<r||o&&i[0]>o||(n.setMatrix(i),this.emit("viewportchange",{action:"zoom",matrix:i}),this.autoPaint())},Wo.prototype.zoomTo=function(t,e){t/=this.getZoom();this.zoom(t,e)},Wo.prototype.focusItem=function(t,e,n){var i=this.get("viewController"),r=!1;e?r=!0:void 0===e&&(r=this.get("animate"));e={};n?e=n:void 0===n&&(e=this.get("animateCfg")),i.focus(t,r,e),this.autoPaint()},Wo.prototype.autoPaint=function(){this.get("autoPaint")&&this.paint()},Wo.prototype.paint=function(){this.emit("beforepaint"),this.get("canvas").draw(),this.emit("afterpaint")},Wo.prototype.getPointByClient=function(t,e){return this.get("viewController").getPointByClient(t,e)},Wo.prototype.getClientByPoint=function(t,e){return this.get("viewController").getClientByPoint(t,e)},Wo.prototype.getPointByCanvas=function(t,e){return this.get("viewController").getPointByCanvas(t,e)},Wo.prototype.getCanvasByPoint=function(t,e){return this.get("viewController").getCanvasByPoint(t,e)},Wo.prototype.getGraphCenterPoint=function(){var t=this.get("group").getCanvasBBox();return{x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2}},Wo.prototype.getViewPortCenterPoint=function(){return this.getPointByCanvas(this.get("width")/2,this.get("height")/2)},Wo.prototype.showItem=function(t,e){void 0===e&&(e=!0);t=this.get("itemController").changeItemVisibility(t,!0);if(e&&this.get("enabledStack")){var n=t.getID(),i={},r={};switch(t.getType()){case"node":i.nodes=[{id:n,visible:!1}],r.nodes=[{id:n,visible:!0}];break;case"edge":i.nodes=[{id:n,visible:!1}],r.edges=[{id:n,visible:!0}];break;case"combo":i.nodes=[{id:n,visible:!1}],r.combos=[{id:n,visible:!0}]}this.pushStack("visible",{before:i,after:r})}},Wo.prototype.hideItem=function(t,e){void 0===e&&(e=!0);t=this.get("itemController").changeItemVisibility(t,!1);if(e&&this.get("enabledStack")){var n=t.getID(),i={},r={};switch(t.getType()){case"node":i.nodes=[{id:n,visible:!0}],r.nodes=[{id:n,visible:!1}];break;case"edge":i.nodes=[{id:n,visible:!0}],r.edges=[{id:n,visible:!1}];break;case"combo":i.nodes=[{id:n,visible:!0}],r.combos=[{id:n,visible:!1}]}this.pushStack("visible",{before:i,after:r})}},Wo.prototype.refreshItem=function(t){this.get("itemController").refreshItem(t)},Wo.prototype.setAutoPaint=function(t){this.set("autoPaint",t),this.get("canvas").set("autoDraw",t)},Wo.prototype.remove=function(t,e){this.removeItem(t,e=void 0===e?!0:e)},Wo.prototype.removeItem=function(t,e){void 0===e&&(e=!0);var n=t;if(((n=_(t)?this.findById(t):n)||!_(t))&&n){t="";if(n.getType&&(t=n.getType()),e&&this.get("enabledStack")){var i=Et(Et({},n.getModel()),{itemType:t}),r={};switch(t){case"node":r.nodes=[i],r.edges=[];for(var o=n.getEdges(),a=o.length-1;0<=a;a--)r.edges.push(Et(Et({},o[a].getModel()),{itemType:"edge"}));break;case"edge":r.edges=[i];break;case"combo":r.combos=[i]}this.pushStack("delete",{before:r,after:{}})}"node"===t&&n.getModel().comboId&&this.updateComboTree(n),this.get("itemController").removeItem(n),"combo"===t&&(t=Be(this.get("comboTrees")),this.set("comboTrees",t))}},Wo.prototype.addItem=function(n,i,t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);var r=this.get("comboSorted");this.set("comboSorted",r&&!e);var o=this.get("itemController");if(!function(t,e){if("node"===t||"combo"===t){if(e.id&&!_(e.id))return!1}else if(!("edge"!==t||e.source&&e.target))return!1;return!0}(n,i))return!1;if(!i.id||!this.findById(i.id)){var a,s,u,c,h,l,r=(r=this.get("comboTrees"))||[];"combo"===n?(a=this.get("itemMap"),s=!1,r.forEach(function(t){s||Ne(t,function(t){i.parentId===t.id&&(s=!0,e=Et({id:i.id,depth:t.depth+2},i),t.children?t.children.push(e):t.children=[e],i.depth=e.depth,u=o.addItem(n,i));var e=a[t.id];return s&&e&&e.getType&&"combo"===e.getType()&&o.updateCombo(e,t.children),!0})}),s||(e=Et({id:i.id,depth:0},i),i.depth=e.depth,r.push(e),u=o.addItem(n,i)),this.set("comboTrees",r)):"node"===n&&_(i.comboId)&&r?((d=this.findById(i.comboId))&&d.getType&&d.getType(),u=o.addItem(n,i),c=this.get("itemMap"),l=h=!1,(r||[]).forEach(function(t){l||h||Ne(t,function(t){return t.id===i.id?!(l=!0):(i.comboId!==t.id||l||(h=!0,(e=q(i)).itemType="node",t.children?t.children.push(e):t.children=[e],i.depth=t.depth+1),h&&c[t.id].getType&&"combo"===c[t.id].getType()&&o.updateCombo(c[t.id],t.children),!0);var e})})):u=o.addItem(n,i),("node"===n&&i.comboId||"combo"===n&&i.parentId)&&(d=this.findById(i.comboId||i.parentId))&&d.getType&&"combo"===d.getType()&&d.addChild(u);var d=this.get("combos");if(d&&0<d.length&&this.sortCombos(),this.autoPaint(),t&&this.get("enabledStack")){var f=Et(Et({},u.getModel()),{itemType:n}),p={};switch(n){case"node":p.nodes=[f];break;case"edge":p.edges=[f];break;case"combo":p.combos=[f]}this.pushStack("add",{before:{},after:p})}return u}},Wo.prototype.add=function(t,e,n,i){return this.addItem(t,e,n=void 0===n?!0:n,i=void 0===i?!0:i)},Wo.prototype.updateItem=function(t,e,n){var i=this;void 0===n&&(n=!0);var r=this.get("itemController"),o=_(t)?this.findById(t):t,a=q(o.getModel()),s="";o.getType&&(s=o.getType());t=wt([],o.getStates());if("combo"===s&&S(t,function(t){return i.setItemState(o,t,!1)}),r.updateItem(o,e),"combo"===s&&S(t,function(t){return i.setItemState(o,t,!0)}),n&&this.get("enabledStack")){var u={nodes:[],edges:[],combos:[]},c={nodes:[],edges:[],combos:[]},h=Et({id:a.id},e);switch(s){case"node":u.nodes.push(a),c.nodes.push(h);break;case"edge":u.edges.push(a),c.edges.push(h);break;case"combo":u.combos.push(a),c.combos.push(h)}"node"===s&&u.nodes.push(a),this.pushStack("update",{before:u,after:c})}},Wo.prototype.update=function(t,e,n){this.updateItem(t,e,n=void 0===n?!0:n)},Wo.prototype.setItemState=function(t,e,n){_(t)&&(t=this.findById(t)),this.get("itemController").setItemState(t,e,n);var i=this.get("stateController");_(n)?i.updateState(t,e+":"+n,!0):i.updateState(t,e,n)},Wo.prototype.priorityState=function(t,e){this.get("itemController").priorityState(t,e)},Wo.prototype.data=function(t){ie(t),this.set("data",t)},Wo.prototype.render=function(){var e=this;this.set("comboSorted",!1);var t=this.get("data");if(this.get("enabledStack")&&this.clearStack(),!t)throw new Error("data must be defined first");var n=t.nodes,i=void 0===n?[]:n,r=t.edges,n=void 0===r?[]:r,r=t.combos,r=void 0===r?[]:r;this.clear(!0),this.emit("beforerender"),S(i,function(t){e.add("node",t,!1,!1)}),r&&0!==r.length&&(i=Re(r,i),this.set("comboTrees",i),e.addCombos(r)),S(n,function(t){e.add("edge",t,!1,!1)});var o=e.get("animate");(e.get("fitView")||e.get("fitCenter"))&&e.set("animate",!1);n=e.get("layoutController");if(n){if(n.layout(function(){e.get("fitView")?e.fitView():e.get("fitCenter")&&e.fitCenter();e.autoPaint(),e.emit("afterrender"),(e.get("fitView")||e.get("fitCenter"))&&e.set("animate",o)}),this.destroyed)return}else e.get("fitView")&&e.fitView(),e.get("fitCenter")&&e.fitCenter(),e.emit("afterrender"),e.set("animate",o);this.get("groupByTypes")||(r&&0!==r.length?this.sortCombos():t.nodes&&t.edges&&t.nodes.length<t.edges.length?this.getNodes().forEach(function(t){t.toFront()}):this.getEdges().forEach(function(t){t.toBack()})),this.get("enabledStack")&&this.pushStack("render")},Wo.prototype.read=function(t){this.data(t),this.render()},Wo.prototype.diffItems=function(n,i,t){var r,o=this,a=this.get("itemMap");S(t,function(t){var e;(r=a[t.id])?(o.get("animate")&&"node"===n&&(e=r.getContainer().getMatrix(),r.set("originAttrs",{x:(e=e||[1,0,0,0,1,0,0,0,1])[6],y:e[7]})),o.updateItem(r,t,!1)):r=o.addItem(n,t,!1),r&&i[n+"s"].push(r)})},Wo.prototype.changeData=function(t,e){void 0===e&&(e=!0);var n=this;if(!ie(t))return this;e&&this.get("enabledStack")&&this.pushStack("changedata",{before:n.save(),after:t}),this.set("comboSorted",!1),this.removeHulls(),this.getNodes().map(function(t){return n.clearItemStates(t)}),this.getEdges().map(function(t){return n.clearItemStates(t)});var i=this.get("canvas"),r=i.get("localRefresh");i.set("localRefresh",!1),n.get("data")||(n.data(t),n.render());var o=this.get("itemMap"),a={nodes:[],edges:[]},s=t.combos;s&&(e=Re(s,t.nodes),this.set("comboTrees",e)),this.diffItems("node",a,t.nodes),S(o,function(t,e){o[e].getModel().depth=0,t.getType&&"edge"===t.getType()||(t.getType&&"combo"===t.getType()?(delete o[e],t.destroy()):a.nodes.indexOf(t)<0&&(delete o[e],n.remove(t,!1)))});for(var u=this.getCombos(),c=u.length-1;0<=c;c--)u[c].destroyed&&u.splice(c,1);s&&(n.addCombos(s),this.get("groupByTypes")||this.sortCombos()),this.diffItems("edge",a,t.edges),S(o,function(t,e){(!t.getType||"node"!==t.getType()&&"combo"!==t.getType())&&a.edges.indexOf(t)<0&&(delete o[e],n.remove(t,!1))}),this.set({nodes:a.nodes,edges:a.edges});t=this.get("layoutController");return t&&(t.changeData(),n.get("animate")&&!t.getLayoutType()?n.positionsAnimate():n.autoPaint()),setTimeout(function(){i.set("localRefresh",r)},16),this},Wo.prototype.addCombos=function(t){var e=this.get("comboTrees");this.get("itemController").addCombos(e,t)},Wo.prototype.createCombo=function(t,e){var i=this;this.set("comboSorted",!1);var r="";if(t){if(_(t))o={id:r=t};else{if(!(r=t.id))return;o=t}var n=e.map(function(t){var e=i.findById(t),n=e.getModel(),t="";e.getType&&(t=e.getType());e={id:e.getID(),itemType:t};return"combo"===t?(e.parentId=r,n.parentId=r):"node"===t&&(e.comboId=r,n.comboId=r),e});o.children=n,this.addItem("combo",o,!1),this.set("comboSorted",!1);var o=this.get("comboTrees");(o||[]).forEach(function(t){Ne(t,function(t){return t.id!==r||(t.itemType="combo",t.children=n,!1)})}),o&&this.sortCombos()}},Wo.prototype.uncombo=function(n){var i,r,o,a,s,u,c,h,t,l=this,d=n;!(d=_(n)?this.findById(n):d)||d.getType&&"combo"!==d.getType()||(i=d.getModel().parentId,r=(r=this.get("comboTrees"))||[],o=this.get("itemMap"),a=d.get("id"),u=[],c=this.get("combos"),h=this.findById(i),r.forEach(function(t){s||Ne(t,function(t){var e;return t.id===a&&(s=t,d.getEdges().forEach(function(t){l.removeItem(t,!1)}),e=c.indexOf(n),c.splice(e,1),delete o[a],d.destroy()),!i||!s||t.id!==i||(h.removeCombo(d),-1!==(e=(u=t.children).indexOf(s))&&u.splice(e,1),s.children.forEach(function(t){var e=l.findById(t.id),n=e.getModel();e.getType&&"combo"===e.getType()?(t.parentId=i,delete t.comboId,n.parentId=i,delete n.comboId):e.getType&&"node"===e.getType()&&(t.comboId=i,n.comboId=i),h.addChild(e),u.push(t)}),!1)})}),!i&&s&&(t=r.indexOf(s),r.splice(t,1),s.children.forEach(function(t){t.parentId=void 0;var e=l.findById(t.id).getModel();delete e.parentId,delete e.comboId,"node"!==t.itemType&&r.push(t)})))},Wo.prototype.updateCombos=function(){var i=this,t=this.get("comboTrees"),r=this.get("itemController"),o=this.get("itemMap");(t||[]).forEach(function(t){Ne(t,function(t){if(!t)return!0;var e,n=o[t.id];return n&&n.getType&&"combo"===n.getType()&&(e=wt([],n.getStates()),S(e,function(t){return i.setItemState(n,t,!1)}),r.updateCombo(n,t.children),S(e,function(t){return i.setItemState(n,t,!0)})),!0})}),this.sortCombos()},Wo.prototype.updateCombo=function(t){var i,r,o,a=this,e=t;!(e=_(t)?this.findById(t):e)||e.getType&&"combo"!==e.getType()||(i=e.get("id"),e=this.get("comboTrees"),r=this.get("itemController"),o=this.get("itemMap"),(e||[]).forEach(function(t){Ne(t,function(t){if(!t)return!0;var e,n=o[t.id];return i===t.id&&n&&n.getType&&"combo"===n.getType()&&(e=wt([],n.getStates()),S(e,function(t){n.getStateStyle(t)&&a.setItemState(n,t,!1)}),r.updateCombo(n,t.children),S(e,function(t){n.getStateStyle(t)&&a.setItemState(n,t,!0)}),i=i&&t.parentId),!0})}))},Wo.prototype.updateComboTree=function(t,e,n){void 0===n&&(n=!0);this.set("comboSorted",!1);var i,r,o,a=(i=_(t)?this.findById(t):t).getModel(),s=a.comboId||a.parentId,u="";if(i.getType&&(u=i.getType()),e&&"combo"===u){var c,t=this.get("comboTrees"),h=!0;if((t||[]).forEach(function(t){c||De(t,function(t){if(!c)return t.id===i.getID()&&(c=t),!0})}),De(c,function(t){return t.id!==e||(h=!1)}),!h)return}n&&this.get("enabledStack")&&(n={},r={},"combo"===u?(n.combos=[{id:a.id,parentId:a.parentId}],r.combos=[{id:a.id,parentId:e}]):"node"===u&&(n.nodes=[{id:a.id,parentId:a.comboId}],r.nodes=[{id:a.id,parentId:e}]),this.pushStack("updateComboTree",{before:n,after:r})),!a.parentId&&!a.comboId||(r=this.findById(a.parentId||a.comboId))&&r.removeChild(i),"combo"===u?a.parentId=e:"node"===u&&(a.comboId=e),e&&(o=this.findById(e))&&o.addChild(i),s&&(o=this.findById(s))&&o.removeChild(i);a=Be(this.get("comboTrees"),a.id,e);this.set("comboTrees",a),this.updateCombos()},Wo.prototype.save=function(){var e=[],n=[],i=[];return S(this.get("nodes"),function(t){e.push(t.getModel())}),S(this.get("edges"),function(t){n.push(t.getModel())}),S(this.get("combos"),function(t){i.push(t.getModel())}),{nodes:e,edges:n,combos:i}},Wo.prototype.changeSize=function(t,e){return this.get("viewController").changeSize(t,e),this},Wo.prototype.refresh=function(){var t,e,n;this.emit("beforegraphrefresh"),this.get("animate")?this.positionsAnimate():(t=this.get("nodes"),e=this.get("edges"),n=this.get("edges"),S(t,function(t){t.refresh()}),S(e,function(t){t.refresh()}),S(n,function(t){t.refresh()})),this.emit("aftergraphrefresh"),this.autoPaint()},Wo.prototype.getNodes=function(){return this.get("nodes")},Wo.prototype.getEdges=function(){return this.get("edges")},Wo.prototype.getCombos=function(){return this.get("combos")},Wo.prototype.getComboChildren=function(t){if((t=_(t)?this.findById(t):t)&&(!t.getType||"combo"===t.getType()))return t.getChildren()},Wo.prototype.positionsAnimate=function(){var a=this;a.emit("beforeanimate");var t=a.get("animateCfg"),s=t.onFrame,e=a.getNodes(),n=e.map(function(t){t=t.getModel();return{id:t.id,x:t.x,y:t.y}});a.isAnimating()&&a.stopAnimate(),a.get("canvas").animate(function(o){S(n,function(t){var e,n,i,r=a.findById(t.id);r&&!r.destroyed&&(n=r.get("originAttrs"),e=r.get("model"),n||(n={x:(i=(i=r.getContainer().getMatrix())||[1,0,0,0,1,0,0,0,1])[6],y:i[7]},r.set("originAttrs",n)),s?(i=s(r,o,t,n),r.set("model",Object.assign(e,i))):(e.x=n.x+(t.x-n.x)*o,e.y=n.y+(t.y-n.y)*o))}),a.refreshPositions()},{duration:t.duration,easing:t.easing,callback:function(){S(e,function(t){t.set("originAttrs",null)}),t.callback&&t.callback(),a.emit("afteranimate"),a.animating=!1}})},Wo.prototype.refreshPositions=function(){this.emit("beforegraphrefreshposition");var n,t=this.get("nodes"),e=this.get("edges"),i=this.get("vedges"),r=this.get("combos"),o={};S(t,function(t){n=t.getModel();var e=t.get("originAttrs");e&&n.x===e.x&&n.y===e.y||(t=t.updatePosition({x:n.x,y:n.y}),o[n.id]=t,n.comboId&&(o[n.comboId]=o[n.comboId]||t))}),r&&0!==r.length&&this.updateCombos(),S(e,function(t){var e=t.getSource().getModel(),n=t.getTarget();w(n)||(n=n.getModel(),(o[e.id]||o[n.id]||t.getModel().isComboEdge)&&t.refresh())}),S(i,function(t){t.refresh()}),this.emit("aftergraphrefreshposition"),this.autoPaint()},Wo.prototype.stopAnimate=function(){this.get("canvas").stopAnimate()},Wo.prototype.isAnimating=function(){return this.animating},Wo.prototype.getZoom=function(){var t=this.get("group").getMatrix();return t?t[0]:1},Wo.prototype.getCurrentMode=function(){return this.get("modeController").getMode()},Wo.prototype.setMode=function(t){return this.get("modeController").setMode(t),this},Wo.prototype.clear=function(t){return void 0===t&&(t=!1),this.get("canvas").clear(),this.initGroups(),this.set({itemMap:{},nodes:[],edges:[],groups:[],combos:[],comboTrees:[]}),t||this.emit("afterrender"),this},Wo.prototype.updateLayout=function(t){var e=this.get("layoutController");_(t)&&(t={type:t});var n=this.get("layout"),i={};Object.assign(i,n,t),this.set("layout",i),e.isLayoutTypeSame(i)&&i.gpuEnabled===n.gpuEnabled?e.updateLayoutCfg(i):e.changeLayout(i)},Wo.prototype.destroyLayout=function(){this.get("layoutController").destroyLayout()},Wo.prototype.layout=function(){var t=this.get("layoutController"),e=this.get("layout");e&&t&&(!e.workerEnabled&&t.layoutMethod?t.relayout(!0):t.layout())},Wo.prototype.collapseCombo=function(t){var u,e,c,h,n,i,l,d,f=this;(t=_(t)?this.findById(t):t)&&(this.emit("beforecollapseexpandcombo",{action:"expand",item:t}),u=t.getModel(),this.get("itemController").collapseCombo(t),u.collapsed=!0,e=this.getEdges().concat(this.get("vedges")),c=[],h=[],n=this.get("comboTrees"),i=!1,(n||[]).forEach(function(t){i||De(t,function(t){return!(i&&t.depth<=u.depth)&&(!(i=u.id===t.id?!0:i)||(t=f.findById(t.id))&&t.getType&&"combo"===t.getType()&&(c=c.concat(t.getNodes()),h=h.concat(t.getCombos())),!0)})}),l={},d=[],e.forEach(function(t){if(!t.isVisible()||t.getModel().isVEdge){var e,n=t.getSource(),i=t.getTarget();if((c.includes(n)||h.includes(n))&&!c.includes(i)&&!h.includes(i)||n.getModel().id===u.id)if((e=t.getModel()).isVEdge)f.removeItem(t,!1);else{for(var r=i.getModel();!i.isVisible();){if(!(i=f.findById(r.parentId||r.comboId))||!r.parentId&&!r.comboId)return;r=i.getModel()}var o=r.id;l[u.id+"-"+o]?l[u.id+"-"+o]+=e.size||1:(s=f.addItem("vedge",{source:u.id,target:o,isVEdge:!0},!1),l[u.id+"-"+o]=e.size||1,d.push(s))}else if(!c.includes(n)&&!h.includes(n)&&(c.includes(i)||h.includes(i))||i.getModel().id===u.id)if((e=t.getModel()).isVEdge)f.removeItem(t,!1);else{for(var a=n.getModel();!n.isVisible();){if(!(n=f.findById(a.parentId||a.comboId))||!a.parentId&&!a.comboId)return;a=n.getModel()}var s,t=a.id;l[t+"-"+u.id]?l[t+"-"+u.id]+=e.size||1:(s=f.addItem("vedge",{target:u.id,source:t,isVEdge:!0},!1),l[t+"-"+u.id]=e.size||1,d.push(s))}}}),d.forEach(function(t){var e=t.getModel();f.updateItem(t,{size:l[e.source+"-"+e.target]},!1)}),this.emit("aftercollapseexpandcombo",{action:"collapse",item:t}))},Wo.prototype.expandCombo=function(t){var c,e,h,l,n,i,d,f,p=this;!(t=_(t)?this.findById(t):t)||t.getType&&"combo"!==t.getType()||(this.emit("beforecollapseexpandcombo",{action:"expand",item:t}),c=t.getModel(),this.get("itemController").expandCombo(t),c.collapsed=!1,e=this.getEdges().concat(this.get("vedges")),h=[],l=[],n=this.get("comboTrees"),i=!1,(n||[]).forEach(function(t){i||De(t,function(t){return!(i&&t.depth<=c.depth)&&(!(i=c.id===t.id?!0:i)||(t=p.findById(t.id))&&t.getType&&"combo"===t.getType()&&(h=h.concat(t.getNodes()),l=l.concat(t.getCombos())),!0)})}),d={},f={},e.forEach(function(t){if(!t.isVisible()||t.getModel().isVEdge){var e=t.getSource(),n=t.getTarget(),i=e.get("id"),r=n.get("id");if((h.includes(e)||l.includes(e))&&!h.includes(n)&&!l.includes(n)||i===c.id)if(t.getModel().isVEdge)p.removeItem(t,!1);else{for(var o=n.getModel();!n.isVisible();){if(!(n=p.findById(o.comboId||o.parentId))||!o.parentId&&!o.comboId)return;o=n.getModel()}for(var r=o.id,a=e.getModel();!e.isVisible();){if(!(e=p.findById(a.comboId||a.parentId))||!a.parentId&&!a.comboId)return;if(a.comboId===c.id||a.parentId===c.id)break;a=e.getModel()}if(i=a.id,r){if(d[u=i+"-"+r])return d[u]+=t.getModel().size||1,void p.updateItem(f[u],{size:d[u]},!1);var s=p.addItem("vedge",{source:i,target:r,isVEdge:!0},!1);d[u]=t.getModel().size||1,f[u]=s}}else if(!h.includes(e)&&!l.includes(e)&&(h.includes(n)||l.includes(n))||r===c.id)if(t.getModel().isVEdge)p.removeItem(t,!1);else{for(a=e.getModel();!e.isVisible();){if(!(e=p.findById(a.comboId||a.parentId))||!a.parentId&&!a.comboId)return;a=e.getModel()}for(var u,i=a.id,o=n.getModel();!n.isVisible();){if(!(n=p.findById(o.comboId||o.parentId))||!o.parentId&&!o.comboId)return;if(o.comboId===c.id||o.parentId===c.id)break;o=n.getModel()}if(r=o.id,i){if(d[u=i+"-"+r])return d[u]+=t.getModel().size||1,void p.updateItem(f[u],{size:d[u]},!1);s=p.addItem("vedge",{target:r,source:i,isVEdge:!0},!1);d[u]=t.getModel().size||1,f[u]=s}}else(h.includes(e)||l.includes(e))&&(h.includes(n)||l.includes(n))&&e.isVisible()&&n.isVisible()&&t.show()}}),this.emit("aftercollapseexpandcombo",{action:"expand",item:t}))},Wo.prototype.collapseExpandCombo=function(t){if((t=_(t)?this.findById(t):t)&&(!t.getType||"combo"===t.getType())){for(var e=t.getModel(),n=this.findById(e.parentId);n;){var i=n.getModel();if(i.collapsed)return void(n=void 0);n=this.findById(i.parentId)}e.collapsed?this.expandCombo(t):this.collapseCombo(t),this.updateCombo(t)}},Wo.prototype.sortCombos=function(){var i,r,o=this;this.get("comboSorted")||(this.set("comboSorted",!0),i=[],r={},(this.get("comboTrees")||[]).forEach(function(t){De(t,function(t){return i[t.depth]?i[t.depth].push(t.id):i[t.depth]=[t.id],r[t.id]=t.depth,!0})}),(this.getEdges().concat(this.get("vedges"))||[]).forEach(function(t){var e=t.getModel(),n=r[e.source]||0,t=r[e.target]||0,t=Math.max(n,t);i[t]?i[t].push(e.id):i[t]=[e.id]}),i.forEach(function(t){if(t&&t.length)for(var e=t.length-1;0<=e;e--){var n=o.findById(t[e]);n&&n.toFront()}}))},Wo.prototype.getNeighbors=function(t,e){var n=t;return(n=_(t)?this.findById(t):n).getNeighbors(e)},Wo.prototype.getNodeDegree=function(t,e,n){void 0===e&&(e=void 0),void 0===n&&(n=!1);var i=t;_(t)&&(i=this.findById(t));t=this.get("degrees");t&&!n||(t=(0,Tt.getDegree)(this.save()),this.set("degrees",t));var r=t[i.getID()],o=0;if(!r)return 0;switch(e){case"in":o=r.inDegree;break;case"out":o=r.outDegree;break;case"all":o=r;break;default:o=r.degree}return o},Wo.prototype.getUndoStack=function(){return this.undoStack},Wo.prototype.getRedoStack=function(){return this.redoStack},Wo.prototype.getStackData=function(){return this.get("enabledStack")?{undoStack:this.undoStack.toArray(),redoStack:this.redoStack.toArray()}:null},Wo.prototype.clearStack=function(){this.get("enabledStack")&&(this.undoStack.clear(),this.redoStack.clear())},Wo.prototype.pushStack=function(t,e,n){void 0===t&&(t="update"),void 0===n&&(n="undo"),this.get("enabledStack")&&(e=e?q(e):{before:{},after:q(this.save())},("redo"===n?this.redoStack:this.undoStack).push({action:t,data:e}),this.emit("stackchange",{undoStack:this.undoStack,redoStack:this.redoStack}))},Wo.prototype.getAdjMatrix=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=this.get("directed"));var n=this.get("adjMatrix");return n&&t||(n=(0,Tt.getAdjMatrix)(this.save(),e),this.set("adjMatrix",n)),n},Wo.prototype.getShortestPathMatrix=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=this.get("directed"));var n=this.get("adjMatrix"),i=this.get("shortestPathMatrix");return n&&t||(n=(0,Tt.getAdjMatrix)(this.save(),e),this.set("adjMatrix",n)),i&&t||(i=(0,Tt.floydWarshall)(this.save(),e),this.set("shortestPathMatrix",i)),i},Wo.prototype.on=function(t,e,n){return Fo.prototype.on.call(this,t,e,n)},Wo.prototype.destroy=function(){this.clear(),this.clearStack(),this.get("itemController").destroy(),this.get("modeController").destroy(),this.get("viewController").destroy(),this.get("stateController").destroy(),this.get("canvas").destroy(),this.cfg=null,this.destroyed=!0,this.redoStack=null,this.undoStack=null},Wo.prototype.createHull=function(t){if(t.members&&!(t.members.length<1)){var e=this.get("hullGroup"),n=this.get("hullMap");if(n||this.set("hullMap",n={}),e&&!e.get("destroyed")||((e=this.get("group").addGroup({id:"hullGroup"})).toBack(),this.set("hullGroup",e)),n[t.id])return n[t.id];e=e.addGroup({id:t.id+"-container"}),e=new zo(this,Et(Et({},t),{group:e}));return n[e.id]=e}},Wo.prototype.getHulls=function(){return this.get("hullMap")},Wo.prototype.getHullById=function(t){return this.get("hullMap")[t]},Wo.prototype.removeHull=function(t){t=_(t)?this.getHullById(t):t;delete this.get("hullMap")[t.id],t.destroy()},Wo.prototype.removeHulls=function(){var e=this.getHulls();e&&Object.keys(e).length&&(Object.keys(e).forEach(function(t){e[t].destroy()}),this.set("hullMap",{}))},ge=Wo;function Xo(t){return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Zo=Mt,Vo=["startArrow","endArrow"],fe={lineWidth:1,stroke:void 0,fill:void 0,lineAppendWidth:1,opacity:void 0,strokeOpacity:void 0,fillOpacity:void 0,x:0,y:0,r:10,width:20,height:20,shadowColor:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},Yo={edge:{lineWidth:1,stroke:"#000",lineDash:void 0,startArrow:!1,endArrow:!1,opacity:void 0,strokeOpacity:void 0,fillOpacity:void 0,shadowColor:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},node:fe,combo:fe},Ho="-label-bg",Ee={options:{},itemType:"",type:"",getCustomConfig:function(t){return{}},getOptions:function(t){return Q({labelCfg:{style:{fontFamily:"undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif"}},descriptionCfg:{style:{fontFamily:"undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif"}}},this.options,this.getCustomConfig(t)||{},t)},draw:function(t,e){var n=this.drawShape(t,e);return n.set("className",this.itemType+"-shape"),t.label&&this.drawLabel(t,e).set("className",this.itemType+"-label"),n},afterDraw:function(t,e,n){},drawShape:function(t,e){return null},drawLabel:function(t,e){var n=this.getOptions(t).labelCfg,i=this.getLabelStyle(t,n||{},e),r=i.rotate;delete i.rotate;n=e.addShape("text",{attrs:i,draggable:!0,className:"text-shape",name:"text-shape"});if(r){var o=n.getBBox(),a=(a=n.getMatrix())||[1,0,0,0,1,0,0,0,1];if(i.rotateCenter)switch(i.rotateCenter){case"center":a=Zo(a,[["t",-o.width/2,-o.height/2],["r",r],["t",o.width/2,o.height/2]]);break;case"lefttop":a=Zo(a,[["t",-i.x,-i.y],["r",r],["t",i.x,i.y]]);break;case"leftcenter":a=Zo(a,[["t",-i.x,-i.y-o.height/2],["r",r],["t",i.x,i.y+o.height/2]]);break;default:a=Zo(a,[["t",-o.width/2,-o.height/2],["r",r],["t",o.width/2,o.height/2]])}else a=Zo(a,[["t",-i.x,-i.y-o.height/2],["r",r],["t",i.x,i.y+o.height/2]]);n.setMatrix(a)}return i.background&&(t=this.drawLabelBg(t,e,n),e=this.itemType+Ho,t.set("classname",e),n.toFront()),n},drawLabelBg:function(t,e,n){var i=at({},this.options.labelCfg,t.labelCfg),i=this.getLabelBgStyleByPosition(n,t,i,e);return e.addShape("rect",{name:"text-bg-shape",attrs:i})},getLabelStyleByPosition:function(t,e,n){return{text:t.label}},getLabelBgStyleByPosition:function(t,e,n,i){return{}},getLabelStyle:function(t,e,n){t=this.getLabelStyleByPosition(t,e,n),n=this.itemType+"Label",n=Se[n]?Se[n].style:null;return Et(Et(Et({},n),t),e.style)},getShapeStyle:function(t){return t.style},update:function(t,e){this.updateShapeStyle(t,e),this.updateLabel(t,e)},updateShapeStyle:function(t,e){var n,i=e.getContainer(),r=e.getKeyShape(),o=at({},r.attr(),t.style);for(n in o)!function(e){var t,n=o[e];w(n)?(t=i.find(function(t){return t.get("name")===e}))&&t.attr(n):r.attr(((t={})[e]=n,t))}(n)},updateLabel:function(t,e){var n,i,r,o=e.getContainer(),a=this.getOptions({}).labelCfg,s=this.itemType+"-label",u=o.find(function(t){return t.get("className")===s}),c=this.itemType+Ho,h=o.find(function(t){return t.get("classname")===c});!t.label&&""!==t.label||(u?(n={},e.getModel&&(n=e.getModel().labelCfg),r=Q({},a,n,t.labelCfg),i=this.getLabelStyleByPosition(t,r,o),e=t.labelCfg?t.labelCfg.style:void 0,a=r.style&&r.style.background,i=(n=Et(Et(Et({},u.attr()),i),e)).rotate,delete n.rotate,i?(e=Zo(e=[1,0,0,0,1,0,0,0,1],[["t",-n.x,-n.y],["r",i],["t",n.x,n.y]]),u.resetMatrix(),u.attr(Et(Et({},n),{matrix:e}))):(u.resetMatrix(),u.attr(n)),h?n.background?(r=this.getLabelBgStyleByPosition(u,t,r,o),r=Et(Et({},r),a),h.resetMatrix(),i&&(a=Zo(a=[1,0,0,0,1,0,0,0,1],[["t",-r.x,-r.y],["r",i],["t",r.x,r.y]]),r.matrix=a),h.attr(r)):o.removeChild(h):n.background&&((h=this.drawLabelBg(t,o,u)).set("classname",c),u.toFront())):this.drawLabel(t,o).set("className",s))},afterUpdate:function(t,e){},setState:function(t,e,n){var i,a=n.get("keyShape");if(a){var s=n.getType(),r=X(e)?t:t+":"+e,t=this.getStateStyle(r,n),r=n.getStateStyle(r);if(r||t){var u=at({},r||t),c=n.getContainer(),h={x:1,y:1,cx:1,cy:1};if("combo"===s&&(h.r=1,h.width=1,h.height=1),e)for(v in u)!function(e){var t,n=u[e];w(n)&&!Vo.includes(e)?(t=c.find(function(t){return t.get("name")===e}))&&t.attr(n):a.attr(((t={})[e]=n,t))}(v);else{var o=Fe(n.getCurrentStatesStyle()),l=at({},n.getModel().style,Fe(n.getOriginStyle())),d=a.get("name"),f=a.attr(),p={};Object.keys(f).forEach(function(t){var e;"img"!==t&&((e=f[t])&&"object"===Xo(e)?p[t]=q(e):p[t]=e)});var g,v,y,m={};for(g in u)!function(i){var r,o,t=u[i];w(t)&&!Vo.includes(i)?(r=c.find(function(t){return t.get("name")===i}))&&(o=q(r.attr()),S(t,function(t,e){var n;i===d&&p[e]&&!h[e]?(delete p[e],n=l[i][e]||Yo[s][e],a.attr(e,n)):!o[e]&&0!==o[e]||(delete o[e],n=l[i][e]||Yo[s][e],r.attr(e,n))}),m[i]=o):p[i]&&!h[i]&&(delete p[i],t=l[i]||(l[d]?l[d][i]:void 0)||Yo[s][i],a.attr(i,t))}(g);for(v in d?m[d]=p:at(m,p),o)h[v]||(y=o[v],w(y)&&!Vo.includes(v)||(d?(at(l[d],((i={})[v]=y,i)),delete l[v]):at(l,((i={})[v]=y,i)),delete o[v]));var x={};Q(x,l,m,o);var b,E=!1;for(b in x)!function(e){var t,n,i=x[e];w(i)&&!Vo.includes(e)?(n=c.find(function(t){return t.get("name")===e}))&&(e===d&&("combo"===s&&(delete i.r,delete i.width,delete i.height),E=!0),n.attr(i)):E||(i=i||Yo[s][e],"combo"===s?d||a.attr(((t={})[e]=i,t)):a.attr(((t={})[e]=i,t)))}(b)}}}},getStateStyle:function(t,e){var n=e.getModel(),i=e.getType(),r=this.getOptions(n),e=r.stateStyles,r=r.style,r=void 0===r?{}:r,t=n.stateStyles?n.stateStyles[t]:e&&e[t];return"combo"===i?q(t):at({},r,t)},getControlPoints:function(t){return t.controlPoints},getAnchorPoints:function(t){return this.getOptions(t).anchorPoints}},xe={itemType:"node",shapeType:"single-node",labelPosition:"center",offset:Se.nodeLabel.offset,getSize:function(t){t=t.size||this.getOptions({}).size||Se.defaultNode.size;return m(t)&&1===t.length&&(t=[t[0],t[0]]),t=!m(t)?[t,t]:t},getLabelStyleByPosition:function(t,e){var n=e.position||this.labelPosition;if("center"===n)return{x:0,y:0,text:t.label};var i=e.offset;G(i)&&(i=this.offset);var r,e=this.getSize(t),o=e[0],a=e[1];switch(n){case"top":r={x:0,y:0-a/2-i,textBaseline:"bottom"};break;case"bottom":r={x:0,y:a/2+i,textBaseline:"top"};break;case"left":r={x:0-o/2-i,y:0,textAlign:"right"};break;default:r={x:o/2+i,y:0,textAlign:"left"}}return r.text=t.label,r},getLabelBgStyleByPosition:function(t,e,n,i){if(!t)return{};var r=t.getBBox(),o=n.style&&n.style.background;if(!o)return{};var a=Cr(o.padding),s=r.width+a[1]+a[3],t=r.height+a[0]+a[2],n=n.offset;return G(n)&&(n=this.offset),a={x:r.minX-a[3],y:r.minY-a[0]},Et(Et(Et({},a),o),{width:s,height:t})},drawShape:function(t,e){var n=this.shapeType,t=this.getShapeStyle(t);return e.addShape(n,{attrs:t,draggable:!0,name:"node-shape"})},updateLinkPoints:function(t,e){var n=this.getOptions(t).linkPoints,i=e.find(function(t){return"link-point-left"===t.get("className")}),r=e.find(function(t){return"link-point-right"===t.get("className")}),o=e.find(function(t){return"link-point-top"===t.get("className")}),a=e.find(function(t){return"link-point-bottom"===t.get("className")});i&&(p=i.attr()),r&&!p&&(p=r.attr()),o&&!p&&(p=o.attr());var s=at({},p=(p=a&&!p?a.attr():p)||n,t.linkPoints),u=s.fill,c=s.stroke,h=s.lineWidth,l=(l=s.size/2)||s.r,d=t.linkPoints||{left:void 0,right:void 0,top:void 0,bottom:void 0},f=d.left,n=d.right,p=d.top,s=d.bottom,d=this.getSize(t),t=d[0],d=d[1],h={r:l,fill:u,stroke:c,lineWidth:h};i?f||void 0===f?i.attr(Et(Et({},h),{x:-t/2,y:0})):i.remove():f&&e.addShape("circle",{attrs:Et(Et({},h),{x:-t/2,y:0}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),r?(n||void 0===n||r.remove(),r.attr(Et(Et({},h),{x:t/2,y:0}))):n&&e.addShape("circle",{attrs:Et(Et({},h),{x:t/2,y:0}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),o?(p||void 0===p||o.remove(),o.attr(Et(Et({},h),{x:0,y:-d/2}))):p&&e.addShape("circle",{attrs:Et(Et({},h),{x:0,y:-d/2}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),a?s||void 0===s?a.attr(Et(Et({},h),{x:0,y:d/2})):a.remove():s&&e.addShape("circle",{attrs:Et(Et({},h),{x:0,y:d/2}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})},updateShape:function(t,e,n,i){e.get("keyShape").attr(Et({},n)),this.updateLabel(t,e),i&&this.updateIcon(t,e)},updateIcon:function(t,e){var n,i,r=this,o=e.getContainer(),a=this.getOptions(t).icon,s=(t.icon||{show:void 0}).show,e=o.find(function(t){return t.get("className")===r.type+"-icon"});e?s||void 0===s?(n=(t=at({},e.attr(),a)).width,i=t.height,e.attr(Et(Et({},t),{x:-n/2,y:-i/2}))):e.remove():s&&(n=a.width,i=a.height,o.addShape("image",{attrs:Et(Et({},a),{x:-n/2,y:-i/2}),className:this.type+"-icon",name:this.type+"-icon"}),(o=o.find(function(t){return"node-label"===t.get("className")}))&&o.toFront())}},ye=Et(Et({},Ee),xe);Wr.registerNode("single-node",ye);var qo="edge-shape";be={itemType:"edge",labelPosition:"center",refX:0,refY:0,labelAutoRotate:!1,options:{size:Se.defaultEdge.size,style:{x:0,y:0,stroke:Se.defaultEdge.style.stroke,lineAppendWidth:Se.defaultEdge.style.lineAppendWidth},labelCfg:{style:{fill:Se.edgeLabel.style.fill,fontSize:Se.edgeLabel.style.fontSize}},stateStyles:Et({},Se.edgeStateStyles)},getPath:function(t){var n=[];return S(t,function(t,e){0===e?n.push(["M",t.x,t.y]):n.push(["L",t.x,t.y])}),n},getShapeStyle:function(t){var e=at({},this.options.style,{stroke:t.color},t.style),n=t.size||Se.defaultEdge.size,i=(t=this.getPathPoints(t)).startPoint,r=t.endPoint,t=this.getControlPoints(t),i=[i];(i=t?i.concat(t):i).push(r);i=this.getPath(i);return at({},Se.defaultEdge.style,{stroke:Se.defaultEdge.color,lineWidth:n,path:i},e)},updateShapeStyle:function(t,e){var n=e.getContainer(),i={stroke:t.color},r=n.find(function(t){return"edge-shape"===t.get("className")})||e.getKeyShape(),o=t.size,a=(t=this.getPathPoints(t)).startPoint,s=t.endPoint,u=this.getControlPoints(t),c=[a];(c=u?c.concat(u):c).push(s);var h=r.attr(),n=at({},i,h,t.style),e=t.sourceNode,a=t.targetNode,s={radius:n.radius};u||(s={source:e,target:a,offset:n.offset,radius:n.radius}),h.endArrow&&!1===n.endArrow&&(t.style.endArrow={path:""}),h.startArrow&&!1===n.startArrow&&(t.style.startArrow={path:""});s=this.getPath(c,s),t=at(i,r.attr(),{lineWidth:o,path:s},t.style);r&&r.attr(t)},getLabelStyleByPosition:function(t,e,n){var i=e.position||this.labelPosition,r={},o=n&&n.find(function(t){return t.get("className")===qo}),a="start"===i?0:"end"===i?1:.5,s=e.refX||this.refX,n=e.refY||this.refY;if(t.startPoint.x===t.endPoint.x&&t.startPoint.y===t.endPoint.y)return r.x=t.startPoint.x+s,r.y=t.startPoint.y+n,r.text=t.label,r;e=G(e.autoRotate)?this.labelAutoRotate:e.autoRotate,e=Pe(o,a,s,n,e);return r.x=e.x,r.y=e.y,r.rotate=e.rotate,r.textAlign=this._getTextAlign(i,e.angle),r.text=t.label,r},getLabelBgStyleByPosition:function(t,e,n,i){if(!t)return{};var r=t.getBBox(),o=n.style&&n.style.background;if(!o)return{};var a=o.padding,s=r.width+a[1]+a[3],u=r.height+a[0]+a[2],c=n.position||this.labelPosition,t=Et(Et({},o),{width:s,height:u,x:r.minX-a[2],y:r.minY-a[0],rotate:0}),o=G(n.autoRotate)?this.labelAutoRotate:n.autoRotate,r=i&&i.find(function(t){return t.get("className")===qo}),a="start"===c?0:"end"===c?1:.5,i=n.refX||this.refX,c=n.refY||this.refY;if(e.startPoint.x===e.endPoint.x&&e.startPoint.y===e.endPoint.y)return t.x=e.startPoint.x+i-s/2,t.y=e.startPoint.y+c-u/2,t;n=Pe(r,a,i-s/2,c+u/2,o),e=n.angle;return e>.5*Math.PI&&e<1.5*Math.PI&&(n=Pe(r,a,i+s/2,c+u/2,o)),o&&(t.x=n.x,t.y=n.y),t.rotate=n.rotate,t},_getTextAlign:function(t,e){var n,i="center";return e?(e%=2*Math.PI,"center"!==t?0<=e&&e<=Math.PI/2||e>=1.5*Math.PI&&e<2*Math.PI?t:("start"===(e=n=t)?e="end":"end"===n&&(e="start"),e):i):t},getControlPoints:function(t){return t.controlPoints},getPathPoints:function(t){return t},drawShape:function(t,e){t=this.getShapeStyle(t);return e.addShape("path",{className:qo,name:qo,attrs:t})},drawLabel:function(t,e){var n=this.options.labelCfg,i="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif",r=Q({fontFamily:i},n,t.labelCfg),i=this.getLabelStyle(t,r,e),n=i.rotate;delete i.rotate;r=e.addShape("text",{attrs:i,name:"text-shape"});return n&&r.rotateAtStart(n),i.background&&(t=this.drawLabelBg(t,e,r),e=this.itemType+Ho,t.set("classname",e),r.toFront()),r},drawLabelBg:function(t,e,n){var i=this.options.labelCfg,r=Q({},i,t.labelCfg),i=this.getLabelStyle(t,r,e).rotate,r=this.getLabelBgStyleByPosition(n,t,r,e);delete r.rotate;r=e.addShape("rect",{name:"text-bg-shape",attrs:r});return i&&r.rotateAtStart(i),r}},me=Et(Et({},Ee),be);Wr.registerEdge("single-edge",me),Wr.registerEdge("line",{getControlPoints:function(){}},"single-edge"),Wr.registerEdge("spline",{getPath:function(t){return bo(t)}},"single-edge"),Wr.registerEdge("arc",{curveOffset:20,clockwise:1,getControlPoints:function(t){var e=t.startPoint,n=t.endPoint,i=(e.x+n.x)/2,r=(e.y+n.y)/2;if(void 0!==t.controlPoints){if(a=t.controlPoints[0],s=Ft(e,a,n),e.x<=n.x&&e.y>n.y?this.clockwise=s.x>a.x?0:1:e.x<=n.x&&e.y<n.y?this.clockwise=s.x>a.x?1:0:e.x>n.x&&e.y<=n.y?this.clockwise=s.y<a.y?0:1:this.clockwise=s.y<a.y?1:0,(a.x-e.x)/(a.y-e.y)==(n.x-e.x)/(n.y-e.y))return[]}else{void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),m(t.curveOffset)&&(t.curveOffset=t.curveOffset[0]),t.curveOffset<0?this.clockwise=0:this.clockwise=1;var o={x:n.x-e.x,y:n.y-e.y},o=Math.atan2(o.y,o.x),a={x:t.curveOffset*Math.cos(-Math.PI/2+o)+i,y:t.curveOffset*Math.sin(-Math.PI/2+o)+r},s=Ft(e,a,n)}s=zt(e,s);return[{x:s,y:s}]},getPath:function(t){var e=[];return e.push(["M",t[0].x,t[0].y]),2===t.length?e.push(["L",t[1].x,t[1].y]):e.push(["A",t[1].x,t[1].y,0,0,this.clockwise,t[2].x,t[2].y]),e}},"single-edge"),Wr.registerEdge("quadratic",{curvePosition:.5,curveOffset:-20,getControlPoints:function(t){var e,n,i=t.controlPoints;return i&&i.length||(e=t.startPoint,n=t.endPoint,void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),m(this.curveOffset)&&(t.curveOffset=t.curveOffset[0]),m(this.curvePosition)&&(t.curvePosition=t.curveOffset[0]),i=[Eo(e,n,t.curvePosition,t.curveOffset)]),i},getPath:function(t){var e=[];return e.push(["M",t[0].x,t[0].y]),e.push(["Q",t[1].x,t[1].y,t[2].x,t[2].y]),e}},"single-edge"),Wr.registerEdge("cubic",{curvePosition:[.5,.5],curveOffset:[-20,20],getControlPoints:function(t){var e,n,i=t.controlPoints;return void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),N(t.curveOffset)&&(t.curveOffset=[t.curveOffset,-t.curveOffset]),N(t.curvePosition)&&(t.curvePosition=[t.curvePosition,1-t.curvePosition]),i&&i.length&&!(i.length<2)||(e=t.startPoint,n=t.endPoint,i=[Eo(e,n,t.curvePosition[0],t.curveOffset[0]),Eo(e,n,t.curvePosition[1],t.curveOffset[1])]),i},getPath:function(t){var e=[];return e.push(["M",t[0].x,t[0].y]),e.push(["C",t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y]),e}},"single-edge"),Wr.registerEdge("cubic-vertical",{curvePosition:[.5,.5],minCurveOffset:[0,0],curveOffset:void 0,getControlPoints:function(t){var e=t.startPoint,n=t.endPoint;void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.minCurveOffset&&(t.minCurveOffset=this.minCurveOffset),N(t.curveOffset)&&(t.curveOffset=[t.curveOffset,-t.curveOffset]),N(t.minCurveOffset)&&(t.minCurveOffset=[t.minCurveOffset,-t.minCurveOffset]),N(t.curvePosition)&&(t.curvePosition=[t.curvePosition,1-t.curvePosition]);var i=n.y-e.y,r=[0,0];return t.curveOffset?r=t.curveOffset:Math.abs(i)<Math.abs(t.minCurveOffset[0])&&(r=t.minCurveOffset),[{x:e.x,y:e.y+i*this.curvePosition[0]+r[0]},{x:n.x,y:n.y-i*this.curvePosition[1]+r[1]}]}},"cubic"),Wr.registerEdge("cubic-horizontal",{curvePosition:[.5,.5],minCurveOffset:[0,0],curveOffset:void 0,getControlPoints:function(t){var e=t.startPoint,n=t.endPoint;void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.minCurveOffset&&(t.minCurveOffset=this.minCurveOffset),N(t.curveOffset)&&(t.curveOffset=[t.curveOffset,-t.curveOffset]),N(t.minCurveOffset)&&(t.minCurveOffset=[t.minCurveOffset,-t.minCurveOffset]),N(t.curvePosition)&&(t.curvePosition=[t.curvePosition,1-t.curvePosition]);var i=n.x-e.x,r=[0,0];return t.curveOffset?r=t.curveOffset:Math.abs(i)<Math.abs(t.minCurveOffset[0])&&(r=t.minCurveOffset),[{x:e.x+i*this.curvePosition[0]+r[0],y:e.y},{x:n.x-i*this.curvePosition[1]+r[1],y:n.y}]}},"cubic"),Wr.registerEdge("loop",{getPathPoints:function(t){return Ae(t)},getControlPoints:function(t){return t.controlPoints},afterDraw:function(t){t.controlPoints=void 0},afterUpdate:function(t){t.controlPoints=void 0}},"cubic");tn={itemType:"combo",shapeType:"single-combo",labelPosition:"top",refX:Se.comboLabel.refX,refY:Se.comboLabel.refY,options:{style:{stroke:Se.defaultCombo.style.stroke,fill:Se.defaultCombo.style.fill,lineWidth:Se.defaultCombo.style.lineWidth},labelCfg:{style:{fill:Se.comboLabel.style.fill,fontSize:Se.comboLabel.style.fontSize}},stateStyles:Et({},Se.comboStateStyles)},getSize:function(t){t=q(t.size||this.options.size||Se.defaultCombo.size);return m(t)&&1===t.length&&(t=[t[0],t[0]]),t=!m(t)?[t,t]:t},getLabelStyleByPosition:function(t,e){var n=e.position||this.labelPosition,i=t.style,r=t.padding||this.options.padding;m(r)&&(r=r[0]);var o=e.refX,a=e.refY;G(o)&&(o=this.refX),G(a)&&(a=this.refY);var s,e=this.getSize(t),u=(Math.max(i.r,e[0]/2)||e[0]/2)+r;switch(n){case"top":s={x:0,y:-u-a,textBaseline:"bottom",textAlign:"center"};break;case"bottom":s={x:0,y:u+a,textBaseline:"bottom",textAlign:"center"};break;case"left":s={x:-u+o,y:0,textAlign:"left"};break;case"center":s={x:0,y:0,text:t.label,textAlign:"center"};break;default:s={x:u+o,y:0,textAlign:"right"}}return s.text=t.label,s},drawShape:function(t,e){var n=this.shapeType,t=this.getShapeStyle(t);return e.addShape(n,{attrs:t,draggable:!0,name:"combo-shape"})},updateShape:function(t,e,n){var i=e.get("keyShape");(void 0===t.animate?this.options:t).animate&&i.animate?i.animate(n,{duration:200,easing:"easeLinear"}):i.attr(Et({},n)),this.updateLabel(t,e)}},Pn=Et(Et({},Ee),tn);Wr.registerCombo("single-combo",Pn),Wr.registerCombo("circle",{options:{size:[Se.defaultCombo.size[0],Se.defaultCombo.size[0]],padding:Se.defaultCombo.padding[0],animate:!0,style:{stroke:Se.defaultCombo.style.stroke,fill:Se.defaultCombo.style.fill,lineWidth:Se.defaultCombo.style.lineWidth},labelCfg:{style:{fill:Se.comboLabel.style.fill,fontSize:Se.comboLabel.style.fontSize},refX:0,refY:0},stateStyles:Et({},Se.comboStateStyles)},shapeType:"circle",labelPosition:"top",drawShape:function(t,e){t=this.getShapeStyle(t);return delete t.height,delete t.width,e.addShape("circle",{attrs:t,className:"circle-combo",name:"circle-combo",draggable:!0})},getShapeStyle:function(t){var e=this.options.style,n=t.padding||this.options.padding;m(n)&&(n=n[0]);var i,e=at({},e,{stroke:t.color},t.style);i=t.fixSize?N(t.fixSize)?t.fixSize:t.fixSize[0]:(i=this.getSize(t),!N(e.r)||isNaN(e.r)?i[0]/2||Se.defaultCombo.style.r:Math.max(e.r,i[0]/2)||i[0]/2),e.r=i+n;e=Et({x:0,y:0},e);return t.style?t.style.r=i:t.style={r:i},e},update:function(t,e){var n=this.getSize(t),i=t.padding||this.options.padding;m(i)&&(i=i[0]);var r=q(t.style),n=t.fixSize?N(t.fixSize)?t.fixSize:t.fixSize[0]:Math.max(r.r,n[0]/2)||n[0]/2;r.r=n+i;i=e.get("sizeCache");i&&(i.r=r.r);i={stroke:t.color},r=at({},e.get("keyShape").attr(),i,r);t.style?t.style.r=n:t.style={r:n},this.updateShape(t,e,r,!0)}},"single-combo"),Wr.registerCombo("rect",{options:{size:[40,5],padding:[25,20,15,20],animate:!0,style:{radius:0,stroke:Se.defaultCombo.style.stroke,fill:Se.defaultCombo.style.fill,lineWidth:Se.defaultCombo.style.lineWidth},labelCfg:{style:{fill:Se.comboLabel.style.fill,fontSize:Se.comboLabel.style.fontSize}},anchorPoints:[[0,.5],[1,.5]],stateStyles:Et({},Se.comboStateStyles)},shapeType:"rect",labelPosition:"top",drawShape:function(t,e){t=this.getShapeStyle(t);return e.addShape("rect",{attrs:t,className:"rect-combo",name:"rect-combo",draggable:!0})},getLabelStyleByPosition:function(t,e){var n=e.position||this.labelPosition,i=t.style,r=t.padding||this.options.padding;N(r)&&(r=[r,r,r,r]);var o=e.refX,a=e.refY;G(o)&&(o=this.refX),G(a)&&(a=this.refY);var s,u=i.width/2+r[3],c=i.height/2+r[0];switch(n){case"top":s={x:0-u+o,y:0-c+a,textBaseline:"top",textAlign:"left"};break;case"bottom":s={x:0,y:c+a,textBaseline:"bottom",textAlign:"center"};break;case"left":s={x:0-u+a,y:0,textAlign:"left"};break;case"center":s={x:0,y:0,text:t.label,textAlign:"center"};break;default:s={x:u+o,y:0,textAlign:"right"}}return s.text=t.label,s},getShapeStyle:function(t){var e=this.options.style,n=t.padding||this.options.padding;N(n)&&(n=[n,n,n,n]);var i,r=at({},e,{stroke:t.color},t.style),o=this.getSize(t),a=t.collapsed&&t.fixCollapseSize?t.fixCollapseSize:t.fixSize,e=a?N(a)?i=a:(i=a[0],a[1]):(i=!N(r.width)||isNaN(r.width)?o[0]||Se.defaultCombo.style.width:Math.max(r.width,o[0])||o[0],!N(r.height)||isNaN(r.height)?o[1]||Se.defaultCombo.style.height:Math.max(r.height,o[1])||o[1]),a=-i/2-n[3],o=-e/2-n[0];r.width=i+n[1]+n[3],r.height=e+n[0]+n[2];r=Et({x:a,y:o},r);return t.style?(t.style.width=i,t.style.height=e):t.style={width:i,height:e},r},update:function(t,e){var n=this.getSize(t),i=t.padding||this.options.padding;N(i)&&(i=[i,i,i,i]);var r,o=q(t.style),a=t.collapsed&&t.fixCollapseSize?t.fixCollapseSize:t.fixSize,a=a?N(a)?r=a:(r=a[0],a[1]):(r=Math.max(o.width,n[0])||n[0],Math.max(o.height,n[1])||n[1]);o.width=r+i[1]+i[3],o.height=a+i[0]+i[2];n=e.get("sizeCache");n&&(n.width=o.width,n.height=o.height),o.x=-r/2-i[3],o.y=-a/2-i[0];i={stroke:t.color},o=at({},e.get("keyShape").attr(),i,o);t.style?(t.style.width=r,t.style.height=a):t.style={width:r,height:a},this.updateShape(t,e,o,!1)},updateShape:function(t,e,n){var i=e.get("keyShape");(void 0===t.animate?this.options:t).animate&&i.animate?i.animate(n,{duration:200,easing:"easeLinear"}):i.attr(Et({},n)),this.updateLabel(t,e)}},"single-combo"),Wr.registerNode("simple-circle",{options:{size:Se.defaultNode.size,style:{x:0,y:0,stroke:Se.defaultNode.style.stroke,fill:Se.defaultNode.style.fill,lineWidth:Se.defaultNode.style.lineWidth},labelCfg:{style:{fill:Se.nodeLabel.style.fill,fontSize:Se.nodeLabel.style.fontSize}},stateStyles:Et({},Se.nodeStateStyles)},shapeType:"simple-circle",labelPosition:"center",drawShape:function(t,e){t=this.getShapeStyle(t);return e.addShape("circle",{attrs:t,className:this.type+"-keyShape",draggable:!0})},getShapeStyle:function(t){var e=this.getOptions(t).style,n={stroke:t.color},n=Q({},e,n),t=this.getSize(t)[0]/2;return Et({x:0,y:0,r:t},n)},update:function(t,e){var n=this.getSize(t),i={stroke:t.color,r:n[0]/2},n=e.get("keyShape"),i=Q({},n.attr(),i,t.style);this.updateShape(t,e,i,!0)}},"single-node"),Wr.registerNode("simple-rect",{options:{size:[100,30],style:{radius:0,stroke:Se.defaultNode.style.stroke,fill:Se.defaultNode.style.fill,lineWidth:Se.defaultNode.style.lineWidth},labelCfg:{style:{fill:Se.nodeLabel.style.fill,fontSize:Se.nodeLabel.style.fontSize}},anchorPoints:[[0,.5],[1,.5]],stateStyles:Et({},Se.nodeStateStyles)},shapeType:"simple-rect",labelPosition:"center",drawShape:function(t,e){t=this.getShapeStyle(t);return e.addShape("rect",{attrs:t,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0})},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),n=this.getSize(t),t=e.width||n[0],n=e.height||n[1];return Et({x:-t/2,y:-n/2,width:t,height:n},e)},update:function(t,e){e.getContainer();var n=this.getOptions({}).style,i=this.getSize(t),r=e.get("keyShape");t.size||(i[0]=r.attr("width")||n.width,i[1]=r.attr("height")||n.height);i={stroke:t.color,x:-i[0]/2,y:-i[1]/2,width:i[0],height:i[1]},i=at({},n,r.attr(),i),i=at(i,t.style);this.updateShape(t,e,i,!1)}},"single-node"),Wr.registerNode("image",{options:{img:"https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*eD7nT6tmYgAAAAAAAAAAAABkARQnAQ",size:200,clipCfg:{show:!1,type:"circle",r:50,rx:50,ry:35,width:50,height:35,points:[[30,12],[12,30],[30,48],[48,30]],path:[["M",25,25],["L",50,25],["A",12.5,12.5,0,1,1,50,50],["A",12.5,12.5,0,1,0,50,50],["L",25,75],["Z"]],x:0,y:0}},shapeType:"image",labelPosition:"bottom",drawShape:function(t,e){var n=this.shapeType,i=this.getShapeStyle(t);delete i.fill;i=e.addShape(n,{attrs:i,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0});return this.drawClip(t,i),i},drawClip:function(t,e){var n,i,r,o,a,s,u=this.getOptions(t).clipCfg;u.show&&(n=u.type,i=u.x,r=u.y,t=u.style,"circle"===n?(o=u.r,e.setClip({type:"circle",attrs:Et({r:o,x:i,y:r},t)})):"rect"===n?(o=u.width,a=u.height,e.setClip({type:"rect",attrs:Et({x:i-o/2,y:r-a/2,width:o,height:a},t)})):"ellipse"===n?(a=u.rx,s=u.ry,e.setClip({type:"ellipse",attrs:Et({x:i,y:r,rx:a,ry:s},t)})):"polygon"===n?(s=u.points,e.setClip({type:"polygon",attrs:Et({points:s},t)})):"path"===n&&(u=u.path,e.setClip({type:"path",attrs:Et({path:u},t)})))},getShapeStyle:function(t){var e=this.getOptions(t).style,n=this.getSize(t),i=this.getOptions(t).img,r=n[0],t=n[1];return e&&(r=e.width||n[0],t=e.height||n[1]),Et({x:-r/2,y:-t/2,width:r,height:t,img:i},e)},updateShapeStyle:function(t,e){var n=e.getContainer(),i=this.itemType+"-shape",e=n.find(function(t){return t.get("className")===i})||e.getKeyShape(),t=this.getShapeStyle(t);e&&e.attr(t)}},"single-node");var ci={triangle:function(t,e,n){n=2*(n=void 0===n?0:n);return"M "+n+",0 L "+(n+(e=void 0===e?15:e))+",-"+(t=void 0===t?10:t)/2+" L "+(n+e)+","+t/2+" Z"},vee:function(t,e,n){n=2*(n=void 0===n?0:n);return"M "+n+",0 L "+(n+(e=void 0===e?20:e))+",-"+(t=void 0===t?15:t)/2+"\n        L "+(n+2*e/3)+",0 L "+(n+e)+","+t/2+" Z"},circle:function(t,e){return"M "+2*(e=void 0===e?0:e)+", 0\n            a "+(t=void 0===t?5:t)+","+t+" 0 1,0 "+2*t+",0\n            a "+t+","+t+" 0 1,0 "+2*-t+",0"},rect:function(t,e,n){n=2*(n=void 0===n?0:n);return"M "+n+","+-(t=void 0===t?10:t)/2+" \n        L "+(n+(e=void 0===e?10:e))+","+-t/2+" \n        L "+(n+e)+","+t/2+" \n        L "+n+","+t/2+" Z"},diamond:function(t,e,n){n=2*(n=void 0===n?0:n);return"M "+n+",0 \n        L "+(n+(e=void 0===e?15:e)/2)+","+-(t=void 0===t?15:t)/2+" \n        L "+(n+e)+",0 \n        L "+(n+e/2)+","+t/2+" Z"},triangleRect:function(t,e,n,i,r,o){o=2*(o=void 0===o?0:o),r=o+(e=void 0===e?15:e)+(r=void 0===r?5:r);return"M "+o+",0 L "+(o+e)+",-"+(t=void 0===t?15:t)/2+" L "+(o+e)+","+t/2+" Z\n            M "+r+", -"+(n=void 0===n?15:n)/2+"\n            L "+(r+(i=void 0===i?3:i))+" -"+n/2+"\n            L "+(r+i)+" "+n/2+"\n            L "+r+" "+n/2+"\n            Z"}},Yn={collapse:function(t,e,n){return[["M",t-n,e],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0],["M",t-n+4,e],["L",t+n-4,e]]},expand:function(t,e,n){return[["M",t-n,e],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0],["M",t-n+4,e],["L",t-n+2*n-4,e],["M",t-n+n,e-n+4],["L",t,e+n-4]]},upTriangle:function(t,e,n){var i=n*Math.cos(Math.PI/6),r=n*Math.sin(Math.PI/6);return[["M",t-i,e+r],["L",t+i,e+r],["L",t,e-n],["Z"]]},downTriangle:function(t,e,n){var i=n*Math.cos(Math.PI/6),r=n*Math.sin(Math.PI/6);return[["M",t-i,e-r],["L",t+i,e-r],["L",t,e+n],["Z"]]}},Wn=Wr,Ko=["#5F95FF","#61DDAA","#65789B","#F6BD16","#7262FD","#78D3F8","#9661BC","#F6903D","#008685","#F08BB4"],C=Mt,Jo=Et(Et(Et(Et(Et(Et({},a),r),s),i),u),{transform:C,mat3:_t});function Qo(t){this.graph=t,this.layoutCfg=t.get("layout")||{},this.layoutType=this.getLayoutType(),this.layoutMethods=[],this.initLayout()}var $o,ve=(Qo.prototype.initLayout=function(){},Qo.prototype.getLayoutType=function(){return this.getLayoutCfgType(this.layoutCfg)},Qo.prototype.getLayoutCfgType=function(t){var e=t.type;if(e)return e;t=t.pipes;return Array.isArray(t)?t.map(function(t){return(null==t?void 0:t.type)||""}):null},Qo.prototype.isLayoutTypeSame=function(t){var n=this.getLayoutCfgType(t);return Array.isArray(this.layoutType)?this.layoutType.every(function(t,e){return t===n[e]}):(null==t?void 0:t.type)===this.layoutType},Qo.prototype.refreshLayout=function(){var t=this.graph;t&&(t.get("animate")?t.positionsAnimate():t.refreshPositions())},Qo.prototype.changeLayout=function(t){this.layoutCfg=t,this.destoryLayoutMethods(),this.layout()},Qo.prototype.changeData=function(){this.destoryLayoutMethods(),this.layout()},Qo.prototype.destoryLayoutMethods=function(){var t=this.layoutMethods;null!=t&&t.forEach(function(t){t.destroy()}),this.layoutMethods=[]},Qo.prototype.destroyLayout=function(){var t=this.graph;this.destoryLayoutMethods(),t.set("layout",void 0),this.layoutCfg=void 0,this.layoutType=void 0,this.layoutMethods=void 0},Qo.prototype.setDataFromGraph=function(){for(var t=[],e=[],n=[],i=[],r=[],o=[],a=this.graph.getNodes(),s=this.graph.getEdges(),u=this.graph.getCombos(),c=a.length,h=0;h<c;h++){var l=a[h];l&&!l.destroyed&&(g=l.getModel(),(l.isVisible()?t:e).push(g))}for(var d=s.length,h=0;h<d;h++){var f=s[h];f&&!f.destroyed&&(g=f.getModel(),(f.isVisible()?g.isComboEdge?r:n:i).push(g))}for(var p=u.length,h=0;h<p;h++){var g,v=u[h];v.destroyed||(g=v.getModel(),(v.isVisible()?o:i).push(g))}return{nodes:t,hiddenNodes:e,edges:n,hiddenEdges:i,combos:o,hiddenCombos:[],comboEdges:r}},Qo.prototype.reLayoutMethod=function(r,o){var a=this;return new Promise(function(t,e){var n=a.graph,i=null==o?void 0:o.type;o.onLayoutEnd=function(){n.emit("aftersublayout",{type:i}),t()},r.init(a.data),"force"===i&&(r.ticking=!1,r.forceSimulation.stop()),n.emit("beforesublayout",{type:i}),r.execute(),r.isCustomLayout&&o.onLayoutEnd&&o.onLayoutEnd()})},Qo.prototype.relayout=function(t){var i=this,e=this.graph,n=this.layoutMethods,r=this.layoutCfg;if(t){this.data=this.setDataFromGraph();t=this.data.nodes;if(!t)return!1;this.initPositions(r.center,t)}e.emit("beforelayout");var o=Promise.resolve();null!=n&&n.forEach(function(t,e){var n=r[e];o=o.then(function(){return i.reLayoutMethod(t,n)})}),o.then(function(){r.onAllLayoutEnd&&r.onAllLayoutEnd()}).catch(function(t){})},Qo.prototype.filterLayoutData=function(t,e){var n,i,r=t.nodes,o=t.edges,a=St(t,["nodes","edges"]);return r?(n=y(null==e?void 0:e.nodesFilter)?e.nodesFilter:function(){return!0},e=y(null==e?void 0:e.edgesFilter)?e.edgesFilter:(i=r.reduce(function(t,e){return t[e.id]=!0,t},{}),function(t){return i[t.source]&&i[t.target]}),Et({nodes:r.filter(n),edges:o.filter(e)},a)):t},Qo.prototype.getLayoutBBox=function(t){var e=this.graph,e=A(e.getNodes(),function(t){return t.getModel().layoutOrder}),e=Object.values(e).map(function(t){t=Tr(t);return t.size=[t.width,t.height],t});return{groupNodes:Object.values(A(t,"layoutOrder")),layoutNodes:e}},Qo.prototype.layoutAnimate=function(){},Qo.prototype.moveToZero=function(){var t=this.graph.get("data").nodes;if(void 0!==t[0].x&&null!==t[0].x&&!Ir(t[0].x)){for(var e=[0,0],n=t.length,i=0;i<n;i++){var r=t[i];e[0]+=r.x,e[1]+=r.y}e[0]/=t.length,e[1]/=t.length;for(i=0;i<n;i++)(r=t[i]).x-=e[0],r.y-=e[1]}},Qo.prototype.initPositions=function(t,e){var n=this.graph;if(!e)return!1;var i=e?e.length:0;if(i){var r=.85*n.get("width"),n=.85*n.get("height"),o=Math.ceil(Math.sqrt(i)*(r/n)),a=r/(o-1),s=n/(Math.ceil(i/o)-1);isFinite(a)&&a||(a=0),isFinite(s)&&a||(s=0);for(var u=t[0]-r/2,c=t[1]-n/2,h=!0,l=0;l<i;l++){var d=e[l];Ir(d.x)&&(h=!1,d.x=l%o*a+u),Ir(d.y)&&(h=!1,d.y=Math.floor(l/o)*s+c)}return h}},Qo.prototype.destroy=function(){this.graph=null,this.destoryLayoutMethods(),this.destroyed=!0},Qo),pe=function(t){this.graph=t,this.destroyed=!1,this.initEvents()};(Ct=$o=$o||{}).CLICK="click",Ct.DBLCLICK="dblclick",Ct.MOUSEDOWN="mousedown",Ct.MOUDEUP="mouseup",Ct.CONTEXTMENU="contextmenu",Ct.MOUSEENTER="mouseenter",Ct.MOUSEOUT="mouseout",Ct.MOUSEOVER="mouseover",Ct.MOUSEMOVE="mousemove",Ct.MOUSELEAVE="mouseleave",Ct.DRAGSTART="dragstart",Ct.DRAGEND="dragend",Ct.DRAG="drag",Ct.DRAGENTER="dragenter",Ct.DRAGLEAVE="dragleave",Ct.DRAGOVER="dragover",Ct.DRAGOUT="dragout",Ct.DDROP="drop",Ct.KEYUP="keyup",Ct.KEYDOWN="keydown",Ct.WHEEL="wheel",Ct.FOCUS="focus",Ct.BLUR="blur",Ct.TOUCHSTART="touchstart",Ct.TOUCHMOVE="touchmove",Ct.TOUCHEND="touchend",Ct.NODE_CONTEXTMENU="node:contextmenu",Ct.NODE_CLICK="node:click",Ct.NODE_DBLCLICK="node:dblclick",Ct.NODE_MOUSEDOWN="node:mousedown",Ct.NODE_MOUSEUP="node:mouseup",Ct.NODE_MOUSEENTER="node:mouseenter",Ct.NODE_MOUSELEAVE="node:mouseleave",Ct.NODE_MOUSEMOVE="node:mousemove",Ct.NODE_MOUSEOUT="node:mouseout",Ct.NODE_MOUSEOVER="node:mouseover",Ct.NODE_DROP="node:drop",Ct.NODE_DRAGOVER="node:dragover",Ct.NODE_DRAGENTER="node:dragenter",Ct.NODE_DRAGLEAVE="node:dragleave",Ct.NODE_DRAGSTART="node:dragstart",Ct.NODE_DRAG="node:drag",Ct.NODE_DRAGEND="node:dragend",Ct.COMBO_CONTEXTMENU="combo:contextmenu",Ct.COMBO_CLICK="combo:click",Ct.COMBO_DBLCLICK="combo:dblclick",Ct.COMBO_MOUSEDOWN="combo:mousedown",Ct.COMBO_MOUSEUP="combo:mouseup",Ct.COMBO_MOUSEENTER="combo:mouseenter",Ct.COMBO_MOUSELEAVE="combo:mouseleave",Ct.COMBO_MOUSEMOVE="combo:mousemove",Ct.COMBO_MOUSEOUT="combo:mouseout",Ct.COMBO_MOUSEOVER="combo:mouseover",Ct.COMBO_DROP="combo:drop",Ct.COMBO_DRAGOVER="combo:dragover",Ct.COMBO_DRAGENTER="combo:dragenter",Ct.COMBO_DRAGLEAVE="combo:dragleave",Ct.COMBO_DRAGSTART="combo:dragstart",Ct.COMBO_DRAG="combo:drag",Ct.COMBO_DRAGEND="combo:dragend",Ct.EDGE_CONTEXTMENU="edge:contextmenu",Ct.EDGE_CLICK="edge:click",Ct.EDGE_DBLCLICK="edge:dblclick",Ct.EDGE_MOUSEDOWN="edge:mousedown",Ct.EDGE_MOUSEUP="edge:mouseup",Ct.EDGE_MOUSEENTER="edge:mouseenter",Ct.EDGE_MOUSELEAVE="edge:mouseleave",Ct.EDGE_MOUSEMOVE="edge:mousemove",Ct.EDGE_MOUSEOUT="edge:mouseout",Ct.EDGE_MOUSEOVER="edge:mouseover",Ct.EDGE_DROP="edge:drop",Ct.EDGE_DRAGOVER="edge:dragover",Ct.EDGE_DRAGENTER="edge:dragenter",Ct.EDGE_DRAGLEAVE="edge:dragleave",Ct.CANVAS_CONTEXTMENU="canvas:contextmenu",Ct.CANVAS_CLICK="canvas:click",Ct.CANVAS_DBLCLICK="canvas:dblclick",Ct.CANVAS_MOUSEDOWN="canvas:mousedown",Ct.CANVAS_MOUSEUP="canvas:mouseup",Ct.CANVAS_MOUSEENTER="canvas:mouseenter",Ct.CANVAS_MOUSELEAVE="canvas:mouseleave",Ct.CANVAS_MOUSEMOVE="canvas:mousemove",Ct.CANVAS_MOUSEOUT="canvas:mouseout",Ct.CANVAS_MOUSEOVER="canvas:mouseover",Ct.CANVAS_DROP="canvas:drop",Ct.CANVAS_DRAGENTER="canvas:dragenter",Ct.CANVAS_DRAGLEAVE="canvas:dragleave",Ct.CANVAS_DRAGSTART="canvas:dragstart",Ct.CANVAS_DRAG="canvas:drag",Ct.CANVAS_DRAGEND="canvas:dragend",Ct.BEFORERENDER="beforerender",Ct.AFTERRENDER="afterrender",Ct.BEFOREADDITEM="beforeadditem",Ct.AFTERADDITEM="afteradditem",Ct.BEFOREREMOVEITEM="beforeremoveitem",Ct.AFTERREMOVEITEM="afterremoveitem",Ct.BEFOREUPDATEITEM="beforeupdateitem",Ct.AFTERUPDATEITEM="afterupdateitem",Ct.BEFOREITEMVISIBILITYCHANGE="beforeitemvisibilitychange",Ct.AFTERITEMVISIBILITYCHANGE="afteritemvisibilitychange",Ct.BEFOREITEMSTATECHANGE="beforeitemstatechange",Ct.AFTERITEMSTATECHANGE="afteritemstatechange",Ct.BEFOREITEMREFRESH="beforeitemrefresh",Ct.AFTERITEMREFRESH="afteritemrefresh",Ct.BEFOREITEMSTATESCLEAR="beforeitemstatesclear",Ct.AFTERITEMSTATESCLEAR="afteritemstatesclear",Ct.BEFOREMODECHANGE="beforemodechange",Ct.AFTERMODECHANGE="aftermodechange",Ct.BEFORELAYOUT="beforelayout",Ct.AFTERLAYOUT="afterlayout",Ct.BEFORECREATEEDGE="beforecreateedge",Ct.AFTERCREATEEDGE="aftercreateedge",Ct.BEFOREGRAPHREFRESHPOSITION="beforegraphrefreshposition",Ct.AFTERGRAPHREFRESHPOSITION="aftergraphrefreshposition",Ct.BEFOREGRAPHREFRESH="beforegraphrefresh",Ct.AFTERGRAPHREFRESH="aftergraphrefresh",Ct.BEFOREANIMATE="beforeanimate",Ct.AFTERANIMATE="afteranimate",Ct.BEFOREPAINT="beforepaint",Ct.AFTERPAINT="afterpaint",Ct.BEFORECOLLAPSEEXPANDCOMBO="beforecollapseexpandcombo",Ct.AFTERCOLLAPSEEXPANDCOMBO="aftercollapseexpandcombo",Ct.GRAPHSTATECHANGE="graphstatechange",Ct.AFTERACTIVATERELATIONS="afteractivaterelations",Ct.NODESELECTCHANGE="nodeselectchange",Ct.TOOLTIPCHANGE="tooltipchange",Ct.WHEELZOOM="wheelzoom",Ct.VIEWPORTCHANGE="viewportchange",Ct.DRAGNODEEND="dragnodeend",Ct.STACKCHANGE="stackchange";var fe=Wn.registerNode,xe=Wn.registerEdge,ye=Wn.registerCombo,ta=mt.registerBehavior,ea=Se,na=(Wn.registerNode,Wn.registerEdge,Wn.registerCombo,mt.registerBehavior,n(70655)),ia=function(t,e){return(ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function ra(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}ia(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var oa=function(){return(oa=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.create;Object.create;function aa(t,e,n,i){n=t-n,i=e-i;return Math.sqrt(n*n+i*i)}function sa(t,e,n,i,r,o){return t<=r&&r<=t+n&&e<=o&&o<=e+i}function ua(t,e){return!(e.minX>t.maxX||e.maxX<t.minX||e.minY>t.maxY||e.maxY<t.minY)}function ca(t,e){return t[0]===e[0]&&t[1]===e[1]}var ha=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,la=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,da=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,fa=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function pa(t,e){t=t.match(fa);S(t,function(t){t=t.split(":");e.addColorStop(t[0],t[1])})}function ga(t,e,n){if(_(n)){if("("===n[1]||"("===n[2]){if("l"===n[0])return i=t,r=e,o=n,s=ha.exec(o),u=parseFloat(s[1])%360*(Math.PI/180),c=s[2],o=r.getBBox(),s=0<=u&&u<.5*Math.PI?(a={x:o.minX,y:o.minY},{x:o.maxX,y:o.maxY}):.5*Math.PI<=u&&u<Math.PI?(a={x:o.maxX,y:o.minY},{x:o.minX,y:o.maxY}):Math.PI<=u&&u<1.5*Math.PI?(a={x:o.maxX,y:o.maxY},{x:o.minX,y:o.minY}):(a={x:o.minX,y:o.maxY},{x:o.maxX,y:o.minY}),o=(r=Math.tan(u))*r,u=(s.x-a.x+r*(s.y-a.y))/(1+o)+a.x,o=r*(s.x-a.x+r*(s.y-a.y))/(1+o)+a.y,o=i.createLinearGradient(a.x,a.y,u,o),pa(c,o),o;if("r"===n[0])return function(t,e,n){var i=la.exec(n),r=parseFloat(i[1]),o=parseFloat(i[2]),a=parseFloat(i[3]),s=i[4];if(0!==a)return n=e.getBBox(),i=n.maxX-n.minX,u=n.maxY-n.minY,e=Math.sqrt(i*i+u*u)/2,e=t.createRadialGradient(n.minX+i*r,n.minY+u*o,0,n.minX+i/2,n.minY+u/2,a*e),pa(s,e),e;var u=s.match(fa);return u[u.length-1].split(":")[1]}(t,e,n);if("p"===n[0])return function(t,e,n){if(e.get("patternSource")&&e.get("patternSource")===n)return e.get("pattern");var i,r,o=(a=da.exec(n))[1],a=a[2];function s(){i=t.createPattern(r,o),e.set("pattern",i),e.set("patternSource",n)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return r=new Image,a.match(/^data:/i)||(r.crossOrigin="Anonymous"),r.src=a,r.complete?s():(r.onload=s,r.src=r.src),i}(t,e,n)}return n}var i,r,o,a,s,u,c}function va(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ya(t,e){return va(t)*va(e)?(t[0]*e[0]+t[1]*e[1])/(va(t)*va(e)):1}function ma(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(ya(t,e))}function xa(t,e){var n=e[1],i=e[2],r=L(B(e[3]),2*Math.PI),o=e[4],a=e[5],s=t[0],u=t[1],c=e[6],h=e[7],l=Math.cos(r)*(s-c)/2+Math.sin(r)*(u-h)/2,d=-1*Math.sin(r)*(s-c)/2+Math.cos(r)*(u-h)/2,f=l*l/(n*n)+d*d/(i*i);1<f&&(n*=Math.sqrt(f),i*=Math.sqrt(f));var p=n*n*(d*d)+i*i*(l*l),e=p?Math.sqrt((n*n*(i*i)-p)/p):1;o===a&&(e*=-1),isNaN(e)&&(e=0);f=i?e*n*d/i:0,p=n?e*-i*l/n:0,e=(s+c)/2+Math.cos(r)*f-Math.sin(r)*p,s=(u+h)/2+Math.sin(r)*f+Math.cos(r)*p,u=[(l-f)/n,(d-p)/i],f=[(-1*l-f)/n,(-1*d-p)/i],d=ma([1,0],u),p=ma(u,f);return ya(u,f)<=-1&&(p=Math.PI),1<=ya(u,f)&&(p=0),0===a&&0<p&&(p-=2*Math.PI),1===a&&p<0&&(p+=2*Math.PI),{cx:e,cy:s,rx:ca(t,[c,h])?0:n,ry:ca(t,[c,h])?0:i,startAngle:d,endAngle:d+p,xRotation:r,arcFlag:o,sweepFlag:a}}var ba=Math.sin,Ea=Math.cos,Sa=Math.atan2,wa=Math.PI;function ka(t,e,n,i,r,o,a){var s=e.stroke,e=e.lineWidth,n=Sa(i-o,n-r),e=new xs({type:"path",canvas:t.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*Ea(wa/6)+","+10*ba(wa/6)+" L0,0 L"+10*Ea(wa/6)+",-"+10*ba(wa/6),stroke:s,lineWidth:e}});e.translate(r,o),e.rotateAtPoint(r,o,n),t.set(a?"startArrowShape":"endArrowShape",e)}function Ca(t,e,n,i,r,o,a){var s=e.startArrow,u=e.endArrow,c=e.stroke,h=e.lineWidth,l=a?s:u,d=l.d,e=l.fill,s=l.stroke,u=l.lineWidth,l=function(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}(l,["d","fill","stroke","lineWidth"]),n=Sa(i-o,n-r);d&&(r-=Ea(n)*d,o-=ba(n)*d);e=new xs({type:"path",canvas:t.get("canvas"),isArrowShape:!0,attrs:oa(oa({},l),{stroke:s||c,lineWidth:u||h,fill:e})});e.translate(r,o),e.rotateAtPoint(r,o,n),t.set(a?"startArrowShape":"endArrowShape",e)}function _a(t,e,n,i,r){t=Sa(i-e,n-t);return{dx:Ea(t)*r,dy:ba(t)*r}}function Ma(t,e,n,i,r,o){"object"==typeof e.startArrow?Ca(t,e,n,i,r,o,!0):e.startArrow?ka(t,e,n,i,r,o,!0):t.set("startArrowShape",null)}function Ia(t,e,n,i,r,o){"object"==typeof e.endArrow?Ca(t,e,n,i,r,o,!1):e.endArrow?ka(t,e,n,i,r,o,!1):t.set("startArrowShape",null)}var Ta,Aa={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function Pa(t,e){var n,i=e.attr();for(n in i){var r=i[n],o=Aa[n]||n;"matrix"===o&&r?t.transform(r[0],r[1],r[3],r[4],r[6],r[7]):"lineDash"===o&&t.setLineDash?m(r)&&t.setLineDash(r):("strokeStyle"===o||"fillStyle"===o?r=ga(t,e,r):"globalAlpha"===o&&(r*=t.globalAlpha),t[o]=r)}}function Da(t,e,n){for(var i=0;i<e.length;i++){var r=e[i];r.cfg.visible?r.draw(t,n):r.skipDraw()}}function Na(n,t,e){var i=n.get("refreshElements");S(i,function(t){if(t!==n)for(var e=t.cfg.parent;e&&e!==n&&!e.cfg.refresh;)e.cfg.refresh=!0,e=e.cfg.parent}),(i[0]===n?Oa:function t(e,n){for(var i=0;i<e.length;i++){var r,o=e[i];o.cfg.visible&&(o.cfg.hasChanged?(o.cfg.refresh=!0,o.isGroup()&&Oa(o.cfg.children,n)):o.cfg.refresh?o.isGroup()&&t(o.cfg.children,n):(r=La(o,n),(o.cfg.refresh=r)&&o.isGroup()&&t(o.cfg.children,n)))}})(t,e)}function Oa(t,e){for(var n=0;n<t.length;n++){var i=t[n];i.cfg.refresh=!0,i.isGroup()&&Oa(i.get("children"),e)}}function La(t,e){var n=t.cfg.cacheCanvasBBox;return t.cfg.isInView&&n&&ua(n,e)}function Ra(t,e,n,i){var r=n.path,o=n.startArrow,a=n.endArrow;if(r){var s=[0,0],u=[0,0],c={dx:0,dy:0};e.beginPath();for(var h=0;h<r.length;h++){var l,d=r[h],f=d[0];0===h&&o&&o.d?c=_a((l=t.getStartTangent())[0][0],l[0][1],l[1][0],l[1][1],o.d):h===r.length-2&&"Z"===r[h+1][0]&&a&&a.d?"Z"===r[h+1][0]&&(c=_a((l=t.getEndTangent())[0][0],l[0][1],l[1][0],l[1][1],a.d)):h===r.length-1&&a&&a.d&&"Z"!==r[0]&&(c=_a((l=t.getEndTangent())[0][0],l[0][1],l[1][0],l[1][1],a.d));var p=c.dx,g=c.dy;switch(f){case"M":e.moveTo(d[1]-p,d[2]-g),u=[d[1],d[2]];break;case"L":e.lineTo(d[1]-p,d[2]-g);break;case"Q":e.quadraticCurveTo(d[1],d[2],d[3]-p,d[4]-g);break;case"C":e.bezierCurveTo(d[1],d[2],d[3],d[4],d[5]-p,d[6]-g);break;case"A":var v=void 0;i?(v=i[h])||(v=xa(s,d),i[h]=v):v=xa(s,d);var y,m=v.cx,x=v.cy,b=v.rx,E=v.ry,S=v.startAngle,w=v.endAngle,k=v.xRotation,C=v.sweepFlag;e.ellipse?e.ellipse(m,x,b,E,k,S,w,1-C):(y=E<b?b:E,v=E<b?1:b/E,b=E<b?E/b:1,e.translate(m,x),e.rotate(k),e.scale(v,b),e.arc(0,0,y,S,w,1-C),e.scale(1/v,1/b),e.rotate(-k),e.translate(-m,-x));break;case"Z":e.closePath()}s="Z"===f?u:[d[(f=d.length)-2],d[f-1]]}}}function Ba(t,e){var n=t.get("canvas");n&&("remove"===e&&(t._cacheCanvasBBox=t.get("cacheCanvasBBox")),t.get("hasChanged")||(t.set("hasChanged",!0),t.cfg.parent&&t.cfg.parent.get("hasChanged")||(n.refreshElement(t,e,n),n.get("autoDraw")&&n.draw())))}function Ga(t){var e,n,i,r,o,a;return t.destroyed?e=t._cacheCanvasBBox:(i=(n=t.get("cacheCanvasBBox"))&&!(!n.width||!n.height),o=(r=t.getCanvasBBox())&&!(!r.width||!r.height),i&&o?(a=r,e=(t=n)&&a?{minX:Math.min(t.minX,a.minX),minY:Math.min(t.minY,a.minY),maxX:Math.max(t.maxX,a.maxX),maxY:Math.max(t.maxY,a.maxY)}:t||a):i?e=n:o&&(e=r)),e}function Ua(){return null!==Ta&&Ta.apply(this,arguments)||this}var Fa,za=(ra(Ua,Ta=vi),Ua.prototype.onCanvasChange=function(t){Ba(this,t)},Ua.prototype.getShapeBase=function(){return c},Ua.prototype.getGroupBase=function(){return Ua},Ua.prototype._applyClip=function(t,e){e&&(t.save(),Pa(t,e),e.createPath(t),t.restore(),t.clip(),e._afterDraw())},Ua.prototype.cacheCanvasBBox=function(){var t=this.cfg.children,n=[],i=[];S(t,function(t){var e=t.cfg.cacheCanvasBBox;e&&t.cfg.isInView&&(n.push(e.minX,e.maxX),i.push(e.minY,e.maxY))});var e,r,o,a=null;n.length?(e=E(n),r=b(n),a={minX:e,minY:o=E(i),x:e,y:o,maxX:r,maxY:t=b(i),width:r-e,height:t-o},(o=this.cfg.canvas)&&(o=o.getViewRange(),this.set("isInView",ua(a,o)))):this.set("isInView",!1),this.set("cacheCanvasBBox",a)},Ua.prototype.draw=function(t,e){var n=this.cfg.children,i=!e||this.cfg.refresh;n.length&&i&&(t.save(),Pa(t,this),this._applyClip(t,this.getClip()),Da(t,n,e),t.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},Ua.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},Ua);function ja(){return null!==Fa&&Fa.apply(this,arguments)||this}var Wa,Xa=(ra(ja,Fa=e),ja.prototype.getDefaultAttrs=function(){var t=Fa.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},ja.prototype.getShapeBase=function(){return c},ja.prototype.getGroupBase=function(){return za},ja.prototype.onCanvasChange=function(t){Ba(this,t)},ja.prototype.calculateBBox=function(){var t=this.get("type"),e=this.getHitLineWidth(),n=bi(t)(this),i=e/2,r=n.x-i,o=n.y-i,t=n.x+n.width+i,i=n.y+n.height+i;return{x:r,minX:r,y:o,minY:o,width:n.width+e,height:n.height+e,maxX:t,maxY:i}},ja.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},ja.prototype.isStroke=function(){return!!this.attrs.stroke},ja.prototype._applyClip=function(t,e){e&&(t.save(),Pa(t,e),e.createPath(t),t.restore(),t.clip(),e._afterDraw())},ja.prototype.draw=function(t,e){var n=this.cfg.clipShape;if(e){if(!1===this.cfg.refresh)return void this.set("hasChanged",!1);if(!ua(e,this.getCanvasBBox()))return this.set("hasChanged",!1),void(this.cfg.isInView&&this._afterDraw())}t.save(),Pa(t,this),this._applyClip(t,n),this.drawPath(t),t.restore(),this._afterDraw()},ja.prototype.getCanvasViewBox=function(){var t=this.cfg.canvas;return t?t.getViewRange():null},ja.prototype.cacheCanvasBBox=function(){var t,e=this.getCanvasViewBox();e&&(e=ua(t=this.getCanvasBBox(),e),this.set("isInView",e),e?this.set("cacheCanvasBBox",t):this.set("cacheCanvasBBox",null))},ja.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},ja.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},ja.prototype.drawPath=function(t){this.createPath(t),this.strokeAndFill(t),this.afterDrawPath(t)},ja.prototype.fill=function(t){t.fill()},ja.prototype.stroke=function(t){t.stroke()},ja.prototype.strokeAndFill=function(t){var e=this.attrs,n=e.lineWidth,i=e.opacity,r=e.strokeOpacity,e=e.fillOpacity;this.isFill()&&(G(e)||1===e?this.fill(t):(t.globalAlpha=e,this.fill(t),t.globalAlpha=i)),this.isStroke()&&0<n&&(G(r)||1===r||(t.globalAlpha=r),this.stroke(t)),this.afterDrawPath(t)},ja.prototype.createPath=function(t){},ja.prototype.afterDrawPath=function(t){},ja.prototype.isInShape=function(t,e){var n=this.isStroke(),i=this.isFill(),r=this.getHitLineWidth();return this.isInStrokeOrPath(t,e,n,i,r)},ja.prototype.isInStrokeOrPath=function(t,e,n,i,r){return!1},ja.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var t=this.attrs;return t.lineWidth+t.lineAppendWidth},ja);function Za(){return null!==Wa&&Wa.apply(this,arguments)||this}var Va,Ya=(ra(Za,Wa=Xa),Za.prototype.getDefaultAttrs=function(){var t=Wa.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{x:0,y:0,r:0})},Za.prototype.isInStrokeOrPath=function(t,e,n,i,r){var o=this.attr(),a=o.x,s=o.y,o=o.r,r=r/2,e=aa(a,s,t,e);return i&&n?e<=o+r:i?e<=o:!!n&&(o-r<=e&&e<=o+r)},Za.prototype.createPath=function(t){var e=this.attr(),n=e.x,i=e.y,e=e.r;t.beginPath(),t.arc(n,i,e,0,2*Math.PI,!1),t.closePath()},Za);function Ha(t,e,n,i){return t/(n*n)+e/(i*i)}function qa(){return null!==Va&&Va.apply(this,arguments)||this}var Ka,Ja=(ra(qa,Va=Xa),qa.prototype.getDefaultAttrs=function(){var t=Va.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{x:0,y:0,rx:0,ry:0})},qa.prototype.isInStrokeOrPath=function(t,e,n,i,r){var o=this.attr(),a=r/2,s=o.x,u=o.y,r=o.rx,o=o.ry,s=(t-s)*(t-s),u=(e-u)*(e-u);return i&&n?Ha(s,u,r+a,o+a)<=1:i?Ha(s,u,r,o)<=1:!!n&&(1<=Ha(s,u,r-a,o-a)&&Ha(s,u,r+a,o+a)<=1)},qa.prototype.createPath=function(t){var e,n=this.attr(),i=n.x,r=n.y,o=n.rx,a=n.ry;t.beginPath(),t.ellipse?t.ellipse(i,r,o,a,0,0,2*Math.PI,!1):(e=a<o?o:a,n=a<o?1:o/a,o=a<o?a/o:1,t.save(),t.translate(i,r),t.scale(n,o),t.arc(0,0,e,0,2*Math.PI),t.restore(),t.closePath())},qa);function Qa(t){return t instanceof HTMLElement&&_(t.nodeName)&&"CANVAS"===t.nodeName.toUpperCase()}function $a(){return null!==Ka&&Ka.apply(this,arguments)||this}var ts,es=(ra($a,Ka=Xa),$a.prototype.getDefaultAttrs=function(){var t=Ka.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{x:0,y:0,width:0,height:0})},$a.prototype.initAttrs=function(t){this._setImage(t.img)},$a.prototype.isStroke=function(){return!1},$a.prototype.isOnlyHitBox=function(){return!0},$a.prototype._afterLoading=function(){var t;!0===this.get("toDraw")&&((t=this.get("canvas"))?t.draw():this.createPath(this.get("context")))},$a.prototype._setImage=function(t){var e,n=this,i=this.attrs;_(t)?((e=new Image).onload=function(){if(n.destroyed)return!1;n.attr("img",e),n.set("loading",!1),n._afterLoading();var t=n.get("callback");t&&t.call(n)},e.crossOrigin="Anonymous",e.src=t,this.set("loading",!0)):t instanceof Image?(i.width||(i.width=t.width),i.height||(i.height=t.height)):Qa(t)&&(i.width||(i.width=Number(t.getAttribute("width"))),i.height||(i.height,Number(t.getAttribute("height"))))},$a.prototype.onAttrChange=function(t,e,n){Ka.prototype.onAttrChange.call(this,t,e,n),"img"===t&&this._setImage(e)},$a.prototype.createPath=function(t){if(this.get("loading"))return this.set("toDraw",!0),void this.set("context",t);var e=this.attr(),n=e.x,i=e.y,r=e.width,o=e.height,a=e.sx,s=e.sy,u=e.swidth,c=e.sheight,e=e.img;(e instanceof Image||Qa(e))&&(G(a)||G(s)||G(u)||G(c)?t.drawImage(e,n,i,r,o):t.drawImage(e,a,s,u,c,n,i,r,o))},$a);function ns(t,e,n,i,r,o,a){var s=Math.min(t,n),u=Math.max(t,n),c=Math.min(e,i),h=Math.max(e,i),l=r/2;return s-l<=o&&o<=u+l&&c-l<=a&&a<=h+l&&Ti.pointToLine(t,e,n,i,o,a)<=r/2}function is(){return null!==ts&&ts.apply(this,arguments)||this}var rs,os=(ra(is,ts=Xa),is.prototype.getDefaultAttrs=function(){var t=ts.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},is.prototype.initAttrs=function(t){this.setArrow()},is.prototype.onAttrChange=function(t,e,n){ts.prototype.onAttrChange.call(this,t,e,n),this.setArrow()},is.prototype.setArrow=function(){var t=this.attr(),e=t.x1,n=t.y1,i=t.x2,r=t.y2,o=t.startArrow,a=t.endArrow;o&&Ma(this,t,i,r,e,n),a&&Ia(this,t,e,n,i,r)},is.prototype.isInStrokeOrPath=function(t,e,n,i,r){if(!n||!r)return!1;n=this.attr();return ns(n.x1,n.y1,n.x2,n.y2,r,t,e)},is.prototype.createPath=function(t){var e=this.attr(),n=e.x1,i=e.y1,r=e.x2,o=e.y2,a=e.startArrow,s=e.endArrow,u={dx:0,dy:0},c={dx:0,dy:0};a&&a.d&&(u=_a(n,i,r,o,e.startArrow.d)),s&&s.d&&(c=_a(n,i,r,o,e.endArrow.d)),t.beginPath(),t.moveTo(n+u.dx,i+u.dy),t.lineTo(r-c.dx,o-c.dy)},is.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),n=this.get("endArrowShape");e&&e.draw(t),n&&n.draw(t)},is.prototype.getTotalLength=function(){var t=this.attr(),e=t.x1,n=t.y1,i=t.x2,t=t.y2;return Ti.length(e,n,i,t)},is.prototype.getPoint=function(t){var e=this.attr(),n=e.x1,i=e.y1,r=e.x2,e=e.y2;return Ti.pointAt(n,i,r,e,t)},is),be={circle:function(t,e,n){return[["M",t-n,e],["A",n,n,0,1,0,t+n,e],["A",n,n,0,1,0,t-n,e]]},square:function(t,e,n){return[["M",t-n,e-n],["L",t+n,e-n],["L",t+n,e+n],["L",t-n,e+n],["Z"]]},diamond:function(t,e,n){return[["M",t-n,e],["L",t,e-n],["L",t+n,e],["L",t,e+n],["Z"]]},triangle:function(t,e,n){var i=n*Math.sin(1/3*Math.PI);return[["M",t-n,e+i],["L",t,e-i],["L",t+n,e+i],["Z"]]},"triangle-down":function(t,e,n){var i=n*Math.sin(1/3*Math.PI);return[["M",t-n,e-i],["L",t+n,e-i],["L",t,e+i],["Z"]]}};function as(){return null!==rs&&rs.apply(this,arguments)||this}var ss=(ra(as,rs=Xa),as.prototype.initAttrs=function(t){this._resetParamsCache()},as.prototype._resetParamsCache=function(){this.set("paramsCache",{})},as.prototype.onAttrChange=function(t,e,n){rs.prototype.onAttrChange.call(this,t,e,n),-1!==["symbol","x","y","r","radius"].indexOf(t)&&this._resetParamsCache()},as.prototype.isOnlyHitBox=function(){return!0},as.prototype._getR=function(t){return G(t.r)?t.radius:t.r},as.prototype._getPath=function(){var t,e,n=this.attr(),i=n.x,r=n.y,o=n.symbol||"circle",n=this._getR(n);if(y(o))e=fr(e=(t=o)(i,r,n));else{if(!(t=as.Symbols[o]))return null;e=t(i,r,n)}return e},as.prototype.createPath=function(t){var e=this._getPath(),n=this.get("paramsCache");Ra(this,t,{path:e},n)},as.Symbols=be,as);function us(t,e,n){var i=er();return t.createPath(i),i.isPointInPath(e,n)}var cs=1e-6;function hs(t){return Math.abs(t)<cs?0:t<0?-1:1}function ls(t,e,n){var i=!1,r=t.length;if(r<=2)return!1;for(var o,a,s,u=0;u<r;u++){var c=t[u],h=t[(u+1)%r];if(a=h,((s=[e,n])[0]-(o=c)[0])*(a[1]-o[1])==(a[0]-o[0])*(s[1]-o[1])&&Math.min(o[0],a[0])<=s[0]&&s[0]<=Math.max(o[0],a[0])&&Math.min(o[1],a[1])<=s[1]&&s[1]<=Math.max(o[1],a[1]))return!0;0<hs(c[1]-n)!=0<hs(h[1]-n)&&hs(e-(n-c[1])*(c[0]-h[0])/(c[1]-h[1])-c[0])<0&&(i=!i)}return i}function ds(t,e,n,i,r,o,a,s){var u=(Math.atan2(s-e,a-t)+2*Math.PI)%(2*Math.PI);if(u<i||r<u)return!1;u={x:t+n*Math.cos(u),y:e+n*Math.sin(u)};return aa(u.x,u.y,a,s)<=o/2}var fs=function(t,e){for(var n,i,r,o,a,s,u,c,h=t?[].concat(t):[1,0,0,0,1,0,0,0,1],l=0,d=e.length;l<d;l++){var f=e[l];switch(f[0]){case"t":s=a=h,u=[f[1],f[2]],c=void 0,c=[0,0,0,0,0,0,0,0,0],_t.fromTranslation(c,u),_t.multiply(a,c,s);break;case"s":o=a=h,c=[f[1],f[2]],s=void 0,s=[0,0,0,0,0,0,0,0,0],_t.fromScaling(s,c),_t.multiply(a,s,o);break;case"r":i=n=h,o=f[1],r=void 0,r=[0,0,0,0,0,0,0,0,0],_t.fromRotation(r,o),_t.multiply(n,r,i);break;case"m":r=n=h,i=f[1],_t.multiply(n,i,r)}}return h};var ps,gs=oa({hasArc:function(t){for(var e=!1,n=t.length,i=0;i<n;i++){var r=t[i][0];if("C"===r||"A"===r||"Q"===r){e=!0;break}}return e},extractPolygons:function(t){for(var e=t.length,n=[],i=[],r=[],o=0;o<e;o++){var a=t[o],s=a[0];"M"===s?(r.length&&(i.push(r),r=[]),r.push([a[1],a[2]])):"Z"===s?r.length&&(n.push(r),r=[]):r.push([a[1],a[2]])}return 0<r.length&&i.push(r),{polygons:n,polylines:i}},isPointInStroke:function(t,e,n,i,r){for(var o=!1,a=e/2,s=0;s<t.length;s++){var u=t[s],c=u.currentPoint,h=u.params,l=u.prePoint,d=u.box;if(!d||sa(d.x-a,d.y-a,d.width+e,d.height+e,n,i)){switch(u.command){case"L":case"Z":o=ns(l[0],l[1],c[0],c[1],e,n,i);break;case"Q":o=Ri.pointDistance(l[0],l[1],h[1],h[2],h[3],h[4],n,i)<=e/2;break;case"C":o=ji.pointDistance(l[0],l[1],h[1],h[2],h[3],h[4],h[5],h[6],n,i,r)<=e/2;break;case"A":var f=u.arcParams,p=f.cx,g=f.cy,v=f.rx,y=f.ry,m=f.startAngle,x=f.endAngle,b=f.xRotation,E=[n,i,1],f=y<v?v:y,v=fs(null,[["t",-p,-g],["r",-b],["s",1/(y<v?1:v/y),1/(y<v?y/v:1)]]);At.kK(E,E,v),o=ds(0,0,f,m,x,e,E[0],E[1])}if(o)break}}return o}},o);function vs(t,e,n){for(var i=!1,r=0;r<t.length;r++)if(i=ls(t[r],e,n))break;return i}function ys(){return null!==ps&&ps.apply(this,arguments)||this}var ms,xs=(ra(ys,ps=Xa),ys.prototype.getDefaultAttrs=function(){var t=ps.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{startArrow:!1,endArrow:!1})},ys.prototype.initAttrs=function(t){this._setPathArr(t.path),this.setArrow()},ys.prototype.onAttrChange=function(t,e,n){ps.prototype.onAttrChange.call(this,t,e,n),"path"===t&&this._setPathArr(e),this.setArrow()},ys.prototype._setPathArr=function(t){this.attrs.path=fr(t);t=gs.hasArc(t);this.set("hasArc",t),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},ys.prototype.getSegments=function(){var t=this.get("segements");return t||(t=xr(this.attr("path")),this.set("segments",t)),t},ys.prototype.setArrow=function(){var t,e=this.attr(),n=e.startArrow,i=e.endArrow;n&&(t=this.getStartTangent(),Ma(this,e,t[0][0],t[0][1],t[1][0],t[1][1])),i&&(t=this.getEndTangent(),Ia(this,e,t[0][0],t[0][1],t[1][0],t[1][1]))},ys.prototype.isInStrokeOrPath=function(t,e,n,i,r){var o=this.getSegments(),a=this.get("hasArc"),s=!1;return n&&(n=this.getTotalLength(),s=gs.isPointInStroke(o,r,t,e,n)),s=!s&&i?a?us(this,t,e):(a=this.attr("path"),vs((a=gs.extractPolygons(a)).polygons,t,e)||vs(a.polylines,t,e)):s},ys.prototype.createPath=function(t){var e=this.attr(),n=this.get("paramsCache");Ra(this,t,e,n)},ys.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),n=this.get("endArrowShape");e&&e.draw(t),n&&n.draw(t)},ys.prototype.getTotalLength=function(){var t=this.get("totalLength");return G(t)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):t},ys.prototype.getPoint=function(n){var i,r,t=this.get("tCache");t||(this._calculateCurve(),this._setTcache(),t=this.get("tCache"));var e=this.get("curve");if(!t||0===t.length)return e?{x:e[0][1],y:e[0][2]}:null;S(t,function(t,e){n>=t[0]&&n<=t[1]&&(i=(n-t[0])/(t[1]-t[0]),r=e)});var o=e[r];if(G(o)||G(r))return null;t=o.length,e=e[r+1];return ji.pointAt(o[t-2],o[t-1],e[1],e[2],e[3],e[4],e[5],e[6],i)},ys.prototype._calculateCurve=function(){var t=this.attr().path;this.set("curve",gs.pathToCurve(t))},ys.prototype._setTcache=function(){var n,i,r,o,a=0,s=0,u=[],c=this.get("curve");c&&(S(c,function(t,e){r=c[e+1],o=t.length,r&&(a+=ji.length(t[o-2],t[o-1],r[1],r[2],r[3],r[4],r[5],r[6])||0)}),this.set("totalLength",a),0!==a?(S(c,function(t,e){r=c[e+1],o=t.length,r&&((n=[])[0]=s/a,i=ji.length(t[o-2],t[o-1],r[1],r[2],r[3],r[4],r[5],r[6]),s+=i||0,n[1]=s/a,u.push(n))}),this.set("tCache",u)):this.set("tCache",[]))},ys.prototype.getStartTangent=function(){var t,e,n,i=this.getSegments();return 1<i.length&&(t=i[0].currentPoint,e=i[1].currentPoint,n=[],(i=i[1].startTangent)?n.push([t[0]-i[0],t[1]-i[1]]):n.push([e[0],e[1]]),n.push([t[0],t[1]])),n},ys.prototype.getEndTangent=function(){var t,e,n,i=this.getSegments(),r=i.length;return 1<r&&(t=i[r-2].currentPoint,e=i[r-1].currentPoint,n=[],(r=i[r-1].endTangent)?n.push([e[0]-r[0],e[1]-r[1]]):n.push([t[0],t[1]]),n.push([e[0],e[1]])),n},ys);function bs(t,e,n,i,r){var o=t.length;if(o<2)return!1;for(var a=0;a<o-1;a++)if(ns(t[a][0],t[a][1],t[a+1][0],t[a+1][1],e,n,i))return!0;if(r){var s=t[0],r=t[o-1];if(ns(s[0],s[1],r[0],r[1],e,n,i))return!0}return!1}function Es(){return null!==ms&&ms.apply(this,arguments)||this}var Ss,ws=(ra(Es,ms=Xa),Es.prototype.isInStrokeOrPath=function(t,e,n,i,r){var o=this.attr().points,a=!1;return a=!(a=n?bs(o,r,t,e,!0):a)&&i?ls(o,t,e):a},Es.prototype.createPath=function(t){var e=this.attr().points;if(!(e.length<2)){t.beginPath();for(var n=0;n<e.length;n++){var i=e[n];0===n?t.moveTo(i[0],i[1]):t.lineTo(i[0],i[1])}t.closePath()}},Es);function ks(){return null!==Ss&&Ss.apply(this,arguments)||this}var Cs,_s=(ra(ks,Ss=Xa),ks.prototype.getDefaultAttrs=function(){var t=Ss.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{startArrow:!1,endArrow:!1})},ks.prototype.initAttrs=function(t){this.setArrow()},ks.prototype.onAttrChange=function(t,e,n){Ss.prototype.onAttrChange.call(this,t,e,n),this.setArrow(),-1!==["points"].indexOf(t)&&this._resetCache()},ks.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},ks.prototype.setArrow=function(){var t=this.attr(),e=this.attrs,n=e.points,i=e.startArrow,r=e.endArrow,o=n.length,a=n[0][0],s=n[0][1],u=n[o-1][0],e=n[o-1][1];i&&Ma(this,t,n[1][0],n[1][1],a,s),r&&Ia(this,t,n[o-2][0],n[o-2][1],u,e)},ks.prototype.isFill=function(){return!1},ks.prototype.isInStrokeOrPath=function(t,e,n,i,r){return!(!n||!r)&&bs(this.attr().points,r,t,e,!1)},ks.prototype.isStroke=function(){return!0},ks.prototype.createPath=function(t){var e=this.attr(),n=e.points,i=e.startArrow,r=e.endArrow,o=n.length;if(!(n.length<2)){var a,s=n[0][0],u=n[0][1],c=n[o-1][0],e=n[o-1][1];i&&i.d&&(s+=(a=_a(s,u,n[1][0],n[1][1],i.d)).dx,u+=a.dy),r&&r.d&&(c-=(a=_a(n[o-2][0],n[o-2][1],c,e,r.d)).dx,e-=a.dy),t.beginPath(),t.moveTo(s,u);for(var h=0;h<o-1;h++){var l=n[h];t.lineTo(l[0],l[1])}t.lineTo(c,e)}},ks.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),n=this.get("endArrowShape");e&&e.draw(t),n&&n.draw(t)},ks.prototype.getTotalLength=function(){var t=this.attr().points,e=this.get("totalLength");return G(e)?(this.set("totalLength",Ji(t)),this.get("totalLength")):e},ks.prototype.getPoint=function(n){var i,r,t=this.attr().points,e=this.get("tCache");return e||(this._setTcache(),e=this.get("tCache")),S(e,function(t,e){n>=t[0]&&n<=t[1]&&(i=(n-t[0])/(t[1]-t[0]),r=e)}),Ti.pointAt(t[r][0],t[r][1],t[r+1][0],t[r+1][1],i)},ks.prototype._setTcache=function(){var n,i,r,o,a,s=this.attr().points;s&&0!==s.length&&((n=this.getTotalLength())<=0||(i=0,r=[],S(s,function(t,e){s[e+1]&&((o=[])[0]=i/n,a=Ti.length(t[0],t[1],s[e+1][0],s[e+1][1]),i+=a,o[1]=i/n,r.push(o))}),this.set("tCache",r)))},ks.prototype.getStartTangent=function(){var t=this.attr().points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},ks.prototype.getEndTangent=function(){var t=this.attr().points,e=t.length-1,n=[];return n.push([t[e-1][0],t[e-1][1]]),n.push([t[e][0],t[e][1]]),n},ks);function Ms(){return null!==Cs&&Cs.apply(this,arguments)||this}var Is,Ts=(ra(Ms,Cs=Xa),Ms.prototype.getDefaultAttrs=function(){var t=Cs.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{x:0,y:0,width:0,height:0,radius:0})},Ms.prototype.isInStrokeOrPath=function(t,e,n,i,r){var o=this.attr(),a=o.x,s=o.y,u=o.width,c=o.height,h=o.radius;if(h){var l=!1;return n&&(g=c,l=ns((d=a)+(v=h),f=s,d+(p=u)-v,f,y=r,o=t,h=e)||ns(d+p,f+v,d+p,f+g-v,y,o,h)||ns(d+p-v,f+g,d+v,f+g,y,o,h)||ns(d,f+g-v,d,f+v,y,o,h)||ds(d+p-v,f+v,v,1.5*Math.PI,2*Math.PI,y,o,h)||ds(d+p-v,f+g-v,v,0,.5*Math.PI,y,o,h)||ds(d+v,f+g-v,v,.5*Math.PI,Math.PI,y,o,h)||ds(d+v,f+v,v,Math.PI,1.5*Math.PI,y,o,h)),l=!l&&i?us(this,t,e):l}var d,f,p,g,v,y,l=r/2;return i&&n?sa(a-l,s-l,u+l,c+l,t,e):i?sa(a,s,u,c,t,e):n?(n=c,sa((c=a)-(r=(a=r)/2),(s=s)-r,u=u,a,t=t,e=e)||sa(c+u-r,s-r,a,n,t,e)||sa(c+r,s+n-r,u,a,t,e)||sa(c-r,s+r,a,n,t,e)):void 0},Ms.prototype.createPath=function(t){var e,n,i,r=this.attr(),o=r.x,a=r.y,s=r.width,u=r.height,c=r.radius;t.beginPath(),0===c?t.rect(o,a,s,u):(n=(e=(r=i=n=e=0,m(c=c)?1===c.length?e=n=i=r=c[0]:2===c.length?(e=i=c[0],n=r=c[1]):3===c.length?(e=c[0],n=r=c[1],i=c[2]):(e=c[0],n=c[1],i=c[2],r=c[3]):e=n=i=r=c,[e,n,i,r]))[1],i=e[2],r=e[3],t.moveTo(o+(e=e[0]),a),t.lineTo(o+s-n,a),0!==n&&t.arc(o+s-n,a+n,n,-Math.PI/2,0),t.lineTo(o+s,a+u-i),0!==i&&t.arc(o+s-i,a+u-i,i,0,Math.PI/2),t.lineTo(o+r,a+u),0!==r&&t.arc(o+r,a+u-r,r,Math.PI/2,Math.PI),t.lineTo(o,a+e),0!==e&&t.arc(o+e,a+e,e,Math.PI,1.5*Math.PI),t.closePath())},Ms);function As(){return null!==Is&&Is.apply(this,arguments)||this}var Ps,Ds=(ra(As,Is=Xa),As.prototype.getDefaultAttrs=function(){var t=Is.prototype.getDefaultAttrs.call(this);return oa(oa({},t),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},As.prototype.isOnlyHitBox=function(){return!0},As.prototype.initAttrs=function(t){this._assembleFont(),t.text&&this._setText(t.text)},As.prototype._assembleFont=function(){var t=this.attrs;t.font=ir(t)},As.prototype._setText=function(t){var e=null;_(t)&&-1!==t.indexOf("\n")&&(e=t.split("\n")),this.set("textArr",e)},As.prototype.onAttrChange=function(t,e,n){Is.prototype.onAttrChange.call(this,t,e,n),t.startsWith("font")&&this._assembleFont(),"text"===t&&this._setText(e)},As.prototype._getSpaceingY=function(){var t=this.attrs,e=t.lineHeight,t=+t.fontSize;return e?e-t:.14*t},As.prototype._drawTextArr=function(n,t,i){var r,e=this.attrs,o=e.textBaseline,a=e.x,s=e.y,u=+e.fontSize,c=this._getSpaceingY(),h=nr(e.text,e.fontSize,e.lineHeight);S(t,function(t,e){r=s+e*(c+u)-h+u,"middle"===o&&(r+=h-u-(h-u)/2),"top"===o&&(r+=h-u),t&&(i?n.fillText(t,a,r):n.strokeText(t,a,r))})},As.prototype._drawText=function(t,e){var n=this.attr(),i=n.x,r=n.y,o=this.get("textArr");o?this._drawTextArr(t,o,e):(n=n.text)&&(e?t.fillText(n,i,r):t.strokeText(n,i,r))},As.prototype.strokeAndFill=function(t){var e=this.attrs,n=e.lineWidth,i=e.opacity,r=e.strokeOpacity,e=e.fillOpacity;this.isStroke()&&0<n&&(G(r)||1===r||(t.globalAlpha=i),this.stroke(t)),this.isFill()&&(G(e)||1===e?this.fill(t):(t.globalAlpha=e,this.fill(t),t.globalAlpha=i)),this.afterDrawPath(t)},As.prototype.fill=function(t){this._drawText(t,!0)},As.prototype.stroke=function(t){this._drawText(t,!1)},As);function Ns(t,e,n){var i=t.getTotalMatrix();if(i){t=(t=[e,n,1],(i=i)?On(Ln(i),t):t);return[t[0],t[1]]}return[e,n]}function Os(t,e,n){if(t.isCanvas&&t.isCanvas())return 1;if(Tn(t)&&!1!==t.cfg.isInView){if(t.cfg.clipShape){var i=Ns(t,e,n),r=i[0],i=i[1];if(t.isClipped(r,i))return}t=t.cfg.cacheCanvasBBox||t.getCanvasBBox();return e>=t.minX&&e<=t.maxX&&n>=t.minY&&n<=t.maxY?1:void 0}}function Ls(){return null!==Ps&&Ps.apply(this,arguments)||this}var Rs=(ra(Ls,Ps=fi),Ls.prototype.getDefaultCfg=function(){var t=Ps.prototype.getDefaultCfg.call(this);return t.renderer="canvas",t.autoDraw=!0,t.localRefresh=!0,t.refreshElements=[],t.clipView=!0,t.quickHit=!1,t},Ls.prototype.onCanvasChange=function(t){"attr"!==t&&"sort"!==t&&"changeSize"!==t||(this.set("refreshElements",[this]),this.draw())},Ls.prototype.getShapeBase=function(){return c},Ls.prototype.getGroupBase=function(){return za},Ls.prototype.getPixelRatio=function(){var t=this.get("pixelRatio")||(window?window.devicePixelRatio:1);return 1<=t?Math.ceil(t):1},Ls.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},Ls.prototype.createDom=function(){var t=document.createElement("canvas"),e=t.getContext("2d");return this.set("context",e),t},Ls.prototype.setDOMSize=function(t,e){Ps.prototype.setDOMSize.call(this,t,e);var n=this.get("context"),i=this.get("el"),r=this.getPixelRatio();i.width=r*t,i.height=r*e,1<r&&n.scale(r,r)},Ls.prototype.clear=function(){Ps.prototype.clear.call(this),this._clearFrame();var t=this.get("context"),e=this.get("el");t.clearRect(0,0,e.width,e.height)},Ls.prototype.getShape=function(t,e){e=this.get("quickHit")?function t(e,n,i){if(!Os(e,n,i))return null;for(var r=null,o=e.getChildren(),a=o.length-1;0<=a;a--){var s,u,c,h=o[a];if(h.isGroup()?r=t(h,n,i):Os(h,n,i)&&(u=(c=Ns(s=h,n,i))[0],c=c[1],s.isInShape(u,c)&&(r=h)),r)break}return r}(this,t,e):Ps.prototype.getShape.call(this,t,e,null);return e},Ls.prototype._getRefreshRegion=function(){var t,e=this.get("refreshElements"),n=this.getViewRange();return e.length&&e[0]===this?t=n:(t=function(t){if(!t.length)return null;var e=[],n=[],i=[],r=[];return S(t,function(t){t=Ga(t);t&&(e.push(t.minX),n.push(t.minY),i.push(t.maxX),r.push(t.maxY))}),{minX:E(e),minY:E(n),maxX:b(i),maxY:b(r)}}(e))&&(t.minX=Math.floor(t.minX),t.minY=Math.floor(t.minY),t.maxX=Math.ceil(t.maxX),t.maxY=Math.ceil(t.maxY),t.maxY+=1,this.get("clipView")&&(e=n,t=(n=t)&&e&&ua(n,e)?{minX:Math.max(n.minX,e.minX),minY:Math.max(n.minY,e.minY),maxX:Math.min(n.maxX,e.maxX),maxY:Math.min(n.maxY,e.maxY)}:null)),t},Ls.prototype.refreshElement=function(t){this.get("refreshElements").push(t)},Ls.prototype._clearFrame=function(){var t=this.get("drawFrame");t&&(t=t,(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(t),this.set("drawFrame",null),this.set("refreshElements",[]))},Ls.prototype.draw=function(){var t=this.get("drawFrame");this.get("autoDraw")&&t||this._startDraw()},Ls.prototype._drawAll=function(){var t=this.get("context"),e=this.get("el"),n=this.getChildren();t.clearRect(0,0,e.width,e.height),Pa(t,this),Da(t,n),this.set("refreshElements",[])},Ls.prototype._drawRegion=function(){var t=this.get("context"),e=this.get("refreshElements"),n=this.getChildren(),i=this._getRefreshRegion();i?(t.clearRect(i.minX,i.minY,i.maxX-i.minX,i.maxY-i.minY),t.save(),t.beginPath(),t.rect(i.minX,i.minY,i.maxX-i.minX,i.maxY-i.minY),t.clip(),Pa(t,this),Na(this,n,i),Da(t,n,i),t.restore()):e.length&&function t(e){for(var n=0;n<e.length;n++){var i=e[n];i.cfg.hasChanged=!1,i.isGroup()&&!i.destroyed&&t(i.cfg.children)}}(e),S(e,function(t){t.get("hasChanged")&&t.set("hasChanged",!1)}),this.set("refreshElements",[])},Ls.prototype._startDraw=function(){var t,e=this,n=this.get("drawFrame");n||(t=function(){e.get("localRefresh")?e._drawRegion():e._drawAll(),e.set("drawFrame",null)},n=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)})(t),this.set("drawFrame",n))},Ls.prototype.skipDraw=function(){},Ls.prototype.removeDom=function(){var t=this.get("el");t.width=0,t.height=0,t.parentNode.removeChild(t)},Ls),Bs=function(t,e){return(Bs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Gs(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Bs(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Us=function(){return(Us=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.create;Object.create;var Fs,zs={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},js={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function Ws(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Xs(t){var e=zs[t.type],n=t.getParent();if(!e)throw new Error("the type "+t.type+" is not supported by svg");e=Ws(e);return t.get("id")&&(e.id=t.get("id")),t.set("el",e),t.set("attrs",{}),n&&((t=n.get("el"))||(t=n.createDom(),n.set("el",t)),t.appendChild(e)),e}function Zs(t,e){var t=t.get("el"),e=lt(t.children).sort(e),n=document.createDocumentFragment();e.forEach(function(t){n.appendChild(t)}),t.appendChild(n)}function Vs(t){var e=t.attr().matrix;if(e){for(var t=t.cfg.el,n=[],i=0;i<9;i+=3)n.push(e[i]+","+e[i+1]);-1===(n=n.join(",")).indexOf("NaN")&&t.setAttribute("transform","matrix("+n+")")}}function Ys(t,e){var n=t.getClip(),t=t.get("el");n?n&&!t.hasAttribute("clip-path")&&(Xs(n),n.createPath(e),n=e.addClip(n),t.setAttribute("clip-path","url(#"+n+")")):t.removeAttribute("clip-path")}function Hs(e,t){t.forEach(function(t){t.draw(e)})}function qs(t,e){var n,i,r,o,a,s,u,c,h=t.get("canvas");h&&h.get("autoDraw")&&(n=h.get("context"),c=(a=t.getParent())?a.getChildren():[h],i=t.get("el"),"remove"===e?t.get("isClipShape")?(s=(u=i&&i.parentNode)&&u.parentNode,u&&s&&s.removeChild(u)):i&&i.parentNode&&i.parentNode.removeChild(i):"show"===e?i.setAttribute("visibility","visible"):"hide"===e?i.setAttribute("visibility","hidden"):"zIndex"===e?(o=i,a=c.indexOf(t),h=o.parentNode,s=Array.from(h.childNodes).filter(function(t){return 1===t.nodeType&&"defs"!==t.nodeName.toLowerCase()}),u=s[a],c=s.indexOf(o),u?a<c?h.insertBefore(o,u):c<a&&((a=s[a+1])?h.insertBefore(o,a):h.appendChild(o)):h.appendChild(o)):"sort"===e?(r=t.get("children"))&&r.length&&Zs(t,function(t,e){return r.indexOf(t)-r.indexOf(e)?1:0}):"clear"===e?i&&(i.innerHTML=""):"matrix"===e?Vs(t):"clip"===e?Ys(t,n):"attr"===e||"add"===e&&t.draw(n))}function Ks(){return null!==Fs&&Fs.apply(this,arguments)||this}var Js,Qs=(Gs(Ks,Fs=vi),Ks.prototype.isEntityGroup=function(){return!0},Ks.prototype.createDom=function(){var t=Ws("g");this.set("el",t);var e,n=this.getParent();return n&&((e=n.get("el"))||(e=n.createDom(),n.set("el",e)),e.appendChild(t)),t},Ks.prototype.afterAttrsChange=function(t){Fs.prototype.afterAttrsChange.call(this,t);var e=this.get("canvas");e&&e.get("autoDraw")&&(e=e.get("context"),this.createPath(e,t))},Ks.prototype.onCanvasChange=function(t){qs(this,t)},Ks.prototype.getShapeBase=function(){return h},Ks.prototype.getGroupBase=function(){return Ks},Ks.prototype.draw=function(t){var e=this.getChildren(),n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||this.createDom(),Ys(this,t),this.createPath(t),e.length&&Hs(t,e))},Ks.prototype.createPath=function(t,e){var n=this.attr(),i=this.get("el");S(e||n,function(t,e){js[e]&&i.setAttribute(js[e],t)}),Vs(this)},Ks);function $s(){var t=null!==Js&&Js.apply(this,arguments)||this;return t.type="svg",t.canFill=!1,t.canStroke=!1,t}var tu,eu=(Gs($s,Js=e),$s.prototype.getDefaultAttrs=function(){var t=Js.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},$s.prototype.afterAttrsChange=function(t){Js.prototype.afterAttrsChange.call(this,t);var e=this.get("canvas");e&&e.get("autoDraw")&&(e=e.get("context"),this.draw(e,t))},$s.prototype.getShapeBase=function(){return h},$s.prototype.getGroupBase=function(){return Qs},$s.prototype.onCanvasChange=function(t){qs(this,t)},$s.prototype.calculateBBox=function(){var t=this.get("el"),e=null;if(t?e=t.getBBox():(s=bi(this.get("type")))&&(e=s(this)),e){var n=e.x,i=e.y,r=e.width,o=e.height,a=this.getHitLineWidth(),t=a/2,s=n-t,e=i-t;return{x:s,y:e,minX:s,minY:e,maxX:n+r+t,maxY:i+o+t,width:r+a,height:o+a}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},$s.prototype.isFill=function(){var t=this.attr(),e=t.fill,t=t.fillStyle;return(e||t||this.isClipShape())&&this.canFill},$s.prototype.isStroke=function(){var t=this.attr(),e=t.stroke,t=t.strokeStyle;return(e||t)&&this.canStroke},$s.prototype.draw=function(t,e){var n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||Xs(this),Ys(this,t),this.createPath(t,e),this.shadow(t,e),this.strokeAndFill(t,e),this.transform(e))},$s.prototype.createPath=function(t,e){},$s.prototype.strokeAndFill=function(t,e){var n=e||this.attr(),i=n.fill,r=n.fillStyle,o=n.stroke,a=n.strokeStyle,s=n.fillOpacity,u=n.strokeOpacity,c=n.lineWidth,h=this.get("el");this.canFill&&(e?"fill"in n?this._setColor(t,"fill",i):"fillStyle"in n&&this._setColor(t,"fill",r):this._setColor(t,"fill",i||r),s&&h.setAttribute(js.fillOpacity,s)),this.canStroke&&0<c&&(e?"stroke"in n?this._setColor(t,"stroke",o):"strokeStyle"in n&&this._setColor(t,"stroke",a):this._setColor(t,"stroke",o||a),u&&h.setAttribute(js.strokeOpacity,u),c&&h.setAttribute(js.lineWidth,c))},$s.prototype._setColor=function(t,e,n){var i,r=this.get("el");n?(n=n.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(n)?(i=(i=t.find("gradient",n))||t.addGradient(n),r.setAttribute(js[e],"url(#"+i+")")):/^[p,P]{1}[\s]*\(/.test(n)?(i=(i=t.find("pattern",n))||t.addPattern(n),r.setAttribute(js[e],"url(#"+i+")")):r.setAttribute(js[e],n)):r.setAttribute(js[e],"none")},$s.prototype.shadow=function(t,e){var n=this.attr(),i=e||n,r=i.shadowOffsetX,e=i.shadowOffsetY,n=i.shadowBlur,i=i.shadowColor;(r||e||n||i)&&(e=t,i=(n=this).cfg.el,(n={dx:(t=n.attr()).shadowOffsetX,dy:t.shadowOffsetY,blur:t.shadowBlur,color:t.shadowColor}).dx||n.dy||n.blur||n.color?(t=(t=e.find("filter",n))||e.addShadow(n),i.setAttribute("filter","url(#"+t+")")):i.removeAttribute("filter"))},$s.prototype.transform=function(t){var e=this.attr();(t||e).matrix&&Vs(this)},$s.prototype.isInShape=function(t,e){return this.isPointInPath(t,e)},$s.prototype.isPointInPath=function(t,e){var n=this.get("el"),i=this.get("canvas").get("el").getBoundingClientRect(),t=t+i.left,i=e+i.top,i=document.elementFromPoint(t,i);return!(!i||!i.isEqualNode(n))},$s.prototype.getHitLineWidth=function(){var t=this.attrs,e=t.lineWidth,t=t.lineAppendWidth;return this.isStroke()?e+t:0},$s);function nu(){var t=null!==tu&&tu.apply(this,arguments)||this;return t.type="circle",t.canFill=!0,t.canStroke=!0,t}var iu,ru=(Gs(nu,tu=eu),nu.prototype.getDefaultAttrs=function(){var t=tu.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{x:0,y:0,r:0})},nu.prototype.createPath=function(t,e){var n=this.attr(),i=this.get("el");S(e||n,function(t,e){"x"===e||"y"===e?i.setAttribute("c"+e,t):js[e]&&i.setAttribute(js[e],t)})},nu);function ou(){var t=null!==iu&&iu.apply(this,arguments)||this;return t.type="dom",t.canFill=!1,t.canStroke=!1,t}var au,su=(Gs(ou,iu=eu),ou.prototype.createPath=function(t,e){var n=this.attr(),i=this.get("el");if(S(e||n,function(t,e){js[e]&&i.setAttribute(js[e],t)}),"function"==typeof n.html){e=n.html.call(this,n);if(e instanceof Element||e instanceof HTMLDocument){for(var r=i.childNodes,o=r.length-1;0<=o;o--)i.removeChild(r[o]);i.appendChild(e)}else i.innerHTML=e}else i.innerHTML=n.html},ou);function uu(){var t=null!==au&&au.apply(this,arguments)||this;return t.type="ellipse",t.canFill=!0,t.canStroke=!0,t}var cu,hu=(Gs(uu,au=eu),uu.prototype.getDefaultAttrs=function(){var t=au.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{x:0,y:0,rx:0,ry:0})},uu.prototype.createPath=function(t,e){var n=this.attr(),i=this.get("el");S(e||n,function(t,e){"x"===e||"y"===e?i.setAttribute("c"+e,t):js[e]&&i.setAttribute(js[e],t)})},uu);function lu(){var t=null!==cu&&cu.apply(this,arguments)||this;return t.type="image",t.canFill=!1,t.canStroke=!1,t}var du,fu=(Gs(lu,cu=eu),lu.prototype.getDefaultAttrs=function(){var t=cu.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{x:0,y:0,width:0,height:0})},lu.prototype.createPath=function(t,e){var n=this,i=this.attr(),r=this.get("el");S(e||i,function(t,e){"img"===e?n._setImage(i.img):js[e]&&r.setAttribute(js[e],t)})},lu.prototype.setAttr=function(t,e){this.attrs[t]=e,"img"===t&&this._setImage(e)},lu.prototype._setImage=function(t){var e,n=this.attr(),i=this.get("el");_(t)?i.setAttribute("href",t):t instanceof window.Image?(n.width||(i.setAttribute("width",t.width),this.attr("width",t.width)),n.height||(i.setAttribute("height",t.height),this.attr("height",t.height)),i.setAttribute("href",t.src)):t instanceof HTMLElement&&_(t.nodeName)&&"CANVAS"===t.nodeName.toUpperCase()?i.setAttribute("href",t.toDataURL()):t instanceof ImageData&&((e=document.createElement("canvas")).setAttribute("width",""+t.width),e.setAttribute("height",""+t.height),e.getContext("2d").putImageData(t,0,0),n.width||(i.setAttribute("width",""+t.width),this.attr("width",t.width)),n.height||(i.setAttribute("height",""+t.height),this.attr("height",t.height)),i.setAttribute("href",e.toDataURL()))},lu);function pu(){var t=null!==du&&du.apply(this,arguments)||this;return t.type="line",t.canFill=!1,t.canStroke=!0,t}var gu,vu=(Gs(pu,du=eu),pu.prototype.getDefaultAttrs=function(){var t=du.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},pu.prototype.createPath=function(i,t){var r=this.attr(),o=this.get("el");S(t||r,function(t,e){var n;"startArrow"===e||"endArrow"===e?t?(n=g(t)?i.addArrow(r,js[e]):i.getDefaultArrow(r,js[e]),o.setAttribute(js[e],"url(#"+n+")")):o.removeAttribute(js[e]):js[e]&&o.setAttribute(js[e],t)})},pu.prototype.getTotalLength=function(){var t=this.attr(),e=t.x1,n=t.y1,i=t.x2,t=t.y2;return Ti.length(e,n,i,t)},pu.prototype.getPoint=function(t){var e=this.attr(),n=e.x1,i=e.y1,r=e.x2,e=e.y2;return Ti.pointAt(n,i,r,e,t)},pu),yu={circle:function(t,e,n){return[["M",t,e],["m",-n,0],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0]]},square:function(t,e,n){return[["M",t-n,e-n],["L",t+n,e-n],["L",t+n,e+n],["L",t-n,e+n],["Z"]]},diamond:function(t,e,n){return[["M",t-n,e],["L",t,e-n],["L",t+n,e],["L",t,e+n],["Z"]]},triangle:function(t,e,n){var i=n*Math.sin(1/3*Math.PI);return[["M",t-n,e+i],["L",t,e-i],["L",t+n,e+i],["z"]]},triangleDown:function(t,e,n){var i=n*Math.sin(1/3*Math.PI);return[["M",t-n,e-i],["L",t+n,e-i],["L",t,e+i],["Z"]]}},mu={get:function(t){return yu[t]},register:function(t,e){yu[t]=e},remove:function(t){delete yu[t]},getAll:function(){return yu}};function xu(){var t=null!==gu&&gu.apply(this,arguments)||this;return t.type="marker",t.canFill=!0,t.canStroke=!0,t}var bu,Eu=(Gs(xu,gu=eu),xu.prototype.createPath=function(t){this.get("el").setAttribute("d",this._assembleMarker())},xu.prototype._assembleMarker=function(){var t=this._getPath();return m(t)?t.map(function(t){return t.join(" ")}).join(""):t},xu.prototype._getPath=function(){var t=this.attr(),e=t.x,n=t.y,i=t.r||t.radius,t=t.symbol||"circle",t=y(t)?t:mu.get(t);return t?t(e,n,i):null},xu.symbolsFactory=mu,xu);function Su(){var t=null!==bu&&bu.apply(this,arguments)||this;return t.type="path",t.canFill=!0,t.canStroke=!0,t}var wu,ku=(Gs(Su,bu=eu),Su.prototype.getDefaultAttrs=function(){var t=bu.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{startArrow:!1,endArrow:!1})},Su.prototype.createPath=function(i,t){var r=this,o=this.attr(),a=this.get("el");S(t||o,function(t,e){var n;"path"===e&&m(t)?a.setAttribute("d",r._formatPath(t)):"startArrow"===e||"endArrow"===e?t?(n=g(t)?i.addArrow(o,js[e]):i.getDefaultArrow(o,js[e]),a.setAttribute(js[e],"url(#"+n+")")):a.removeAttribute(js[e]):js[e]&&a.setAttribute(js[e],t)})},Su.prototype._formatPath=function(t){t=t.map(function(t){return t.join(" ")}).join("");return~t.indexOf("NaN")?"":t},Su.prototype.getTotalLength=function(){var t=this.get("el");return t?t.getTotalLength():null},Su.prototype.getPoint=function(t){var e=this.get("el"),n=this.getTotalLength();if(0===n)return null;n=e?e.getPointAtLength(t*n):null;return n?{x:n.x,y:n.y}:null},Su);function Cu(){var t=null!==wu&&wu.apply(this,arguments)||this;return t.type="polygon",t.canFill=!0,t.canStroke=!0,t}var _u,Mu=(Gs(Cu,wu=eu),Cu.prototype.createPath=function(t,e){var n=this.attr(),i=this.get("el");S(e||n,function(t,e){"points"===e&&m(t)&&2<=t.length?i.setAttribute("points",t.map(function(t){return t[0]+","+t[1]}).join(" ")):js[e]&&i.setAttribute(js[e],t)})},Cu);function Iu(){var t=null!==_u&&_u.apply(this,arguments)||this;return t.type="polyline",t.canFill=!0,t.canStroke=!0,t}var Tu,Au=(Gs(Iu,_u=eu),Iu.prototype.getDefaultAttrs=function(){var t=_u.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{startArrow:!1,endArrow:!1})},Iu.prototype.onAttrChange=function(t,e,n){_u.prototype.onAttrChange.call(this,t,e,n),-1!==["points"].indexOf(t)&&this._resetCache()},Iu.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},Iu.prototype.createPath=function(t,e){var n=this.attr(),i=this.get("el");S(e||n,function(t,e){"points"===e&&m(t)&&2<=t.length?i.setAttribute("points",t.map(function(t){return t[0]+","+t[1]}).join(" ")):js[e]&&i.setAttribute(js[e],t)})},Iu.prototype.getTotalLength=function(){var t=this.attr().points,e=this.get("totalLength");return G(e)?(this.set("totalLength",Ji(t)),this.get("totalLength")):e},Iu.prototype.getPoint=function(n){var i,r,t=this.attr().points,e=this.get("tCache");return e||(this._setTcache(),e=this.get("tCache")),S(e,function(t,e){n>=t[0]&&n<=t[1]&&(i=(n-t[0])/(t[1]-t[0]),r=e)}),Ti.pointAt(t[r][0],t[r][1],t[r+1][0],t[r+1][1],i)},Iu.prototype._setTcache=function(){var n,i,r,o,a,s=this.attr().points;s&&0!==s.length&&((n=this.getTotalLength())<=0||(i=0,r=[],S(s,function(t,e){s[e+1]&&((o=[])[0]=i/n,a=Ti.length(t[0],t[1],s[e+1][0],s[e+1][1]),i+=a,o[1]=i/n,r.push(o))}),this.set("tCache",r)))},Iu.prototype.getStartTangent=function(){var t=this.attr().points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},Iu.prototype.getEndTangent=function(){var t=this.attr().points,e=t.length-1,n=[];return n.push([t[e-1][0],t[e-1][1]]),n.push([t[e][0],t[e][1]]),n},Iu);function Pu(){var t=null!==Tu&&Tu.apply(this,arguments)||this;return t.type="rect",t.canFill=!0,t.canStroke=!0,t}var Du,Nu=(Gs(Pu,Tu=eu),Pu.prototype.getDefaultAttrs=function(){var t=Tu.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{x:0,y:0,width:0,height:0,radius:0})},Pu.prototype.createPath=function(t,e){var n=this,i=this.attr(),r=this.get("el"),o=!1,a=["x","y","width","height","radius"];S(e||i,function(t,e){-1===a.indexOf(e)||o?-1===a.indexOf(e)&&js[e]&&r.setAttribute(js[e],t):(r.setAttribute("d",n._assembleRect(i)),o=!0)})},Pu.prototype._assembleRect=function(t){var e=t.x,n=t.y,i=t.width,r=t.height,o=t.radius;if(!o)return"M "+e+","+n+" l "+i+",0 l 0,"+r+" l"+-i+" 0 z";var a,s,u,c,c=(c=u=s=a=0,m(t=o)?1===t.length?a=s=u=c=t[0]:2===t.length?(a=u=t[0],s=c=t[1]):3===t.length?(a=t[0],s=c=t[1],u=t[2]):(a=t[0],s=t[1],u=t[2],c=t[3]):a=s=u=c=t,{r1:a,r2:s,r3:u,r4:c});return m(o)?1===o.length?c.r1=c.r2=c.r3=c.r4=o[0]:2===o.length?(c.r1=c.r3=o[0],c.r2=c.r4=o[1]):3===o.length?(c.r1=o[0],c.r2=c.r4=o[1],c.r3=o[2]):(c.r1=o[0],c.r2=o[1],c.r3=o[2],c.r4=o[3]):c.r1=c.r2=c.r3=c.r4=o,[["M "+(e+c.r1)+","+n],["l "+(i-c.r1-c.r2)+",0"],["a "+c.r2+","+c.r2+",0,0,1,"+c.r2+","+c.r2],["l 0,"+(r-c.r2-c.r3)],["a "+c.r3+","+c.r3+",0,0,1,"+-c.r3+","+c.r3],["l "+(c.r3+c.r4-i)+",0"],["a "+c.r4+","+c.r4+",0,0,1,"+-c.r4+","+-c.r4],["l 0,"+(c.r4+c.r1-r)],["a "+c.r1+","+c.r1+",0,0,1,"+c.r1+","+-c.r1],["z"]].join(" ")},Pu),Ou={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},Lu={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},Ru={left:"left",start:"left",center:"middle",right:"end",end:"end"};function Bu(){var t=null!==Du&&Du.apply(this,arguments)||this;return t.type="text",t.canFill=!0,t.canStroke=!0,t}var Gu=(Gs(Bu,Du=eu),Bu.prototype.getDefaultAttrs=function(){var t=Du.prototype.getDefaultAttrs.call(this);return Us(Us({},t),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},Bu.prototype.createPath=function(t,e){var n=this,i=this.attr(),r=this.get("el");this._setFont(),S(e||i,function(t,e){"text"===e?n._setText(""+t):"matrix"===e&&t?Vs(n):js[e]&&r.setAttribute(js[e],t)}),r.setAttribute("paint-order","stroke"),r.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},Bu.prototype._setFont=function(){var t=this.get("el"),e=this.attr(),n=e.textBaseline,i=e.textAlign,e=(0,Dn.qY)();e&&"firefox"===e.name?t.setAttribute("dominant-baseline",Lu[n]||"alphabetic"):t.setAttribute("alignment-baseline",Ou[n]||"baseline"),t.setAttribute("text-anchor",Ru[i]||"left")},Bu.prototype._setText=function(t){var n,i,e=this.get("el"),r=this.attr(),o=r.x,r=r.textBaseline,a=void 0===r?"bottom":r;t?~t.indexOf("\n")?(r=t.split("\n"),n=r.length-1,i="",S(r,function(t,e){0===e?"alphabetic"===a?i+='<tspan x="'+o+'" dy="'+-n+'em">'+t+"</tspan>":"top"===a?i+='<tspan x="'+o+'" dy="0.9em">'+t+"</tspan>":"middle"===a?i+='<tspan x="'+o+'" dy="'+-(n-1)/2+'em">'+t+"</tspan>":"bottom"===a?i+='<tspan x="'+o+'" dy="-'+(.3+n)+'em">'+t+"</tspan>":"hanging"===a&&(i+='<tspan x="'+o+'" dy="'+(-(n-1)-.3)+'em">'+t+"</tspan>"):i+='<tspan x="'+o+'" dy="1em">'+t+"</tspan>"}),e.innerHTML=i):e.innerHTML=t:e.innerHTML=""},Bu),Uu=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Fu=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,zu=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function ju(t){t=t.match(zu);if(!t)return"";var e="";return t.sort(function(t,e){return t=t.split(":"),e=e.split(":"),Number(t[0])-Number(e[0])}),S(t,function(t){t=t.split(":"),e+='<stop offset="'+t[0]+'" stop-color="'+t[1]+'"></stop>'}),e}function Wu(t){this.cfg={};var e,n,i,r,o,a,s,u=null,c=ct("gradient_");return"l"===t.toLowerCase()[0]?(u=Ws("linearGradient"),e=t,n=u,r=Uu.exec(e),o=L(B(parseFloat(r[1])),2*Math.PI),a=r[2],s=0<=o&&o<.5*Math.PI?(i={x:0,y:0},{x:1,y:1}):.5*Math.PI<=o&&o<Math.PI?(i={x:1,y:0},{x:0,y:1}):Math.PI<=o&&o<1.5*Math.PI?(i={x:1,y:1},{x:0,y:0}):(i={x:0,y:1},{x:1,y:0}),r=(e=Math.tan(o))*e,o=(s.x-i.x+e*(s.y-i.y))/(1+r)+i.x,r=e*(s.x-i.x+e*(s.y-i.y))/(1+r)+i.y,n.setAttribute("x1",i.x),n.setAttribute("y1",i.y),n.setAttribute("x2",o),n.setAttribute("y2",r),n.innerHTML=ju(a)):(u=Ws("radialGradient"),i=t,o=u,r=Fu.exec(i),n=parseFloat(r[1]),a=parseFloat(r[2]),i=parseFloat(r[3]),r=r[4],o.setAttribute("cx",n),o.setAttribute("cy",a),o.setAttribute("r",i),o.innerHTML=ju(r)),u.setAttribute("id",c),this.el=u,this.id=c,this.cfg=t,this}var Xu=(Wu.prototype.match=function(t,e){return this.cfg===e},Wu),Zu={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},Vu={x:"-40%",y:"-40%",width:"200%",height:"200%"};function Yu(t){this.type="filter",this.cfg={};var n=Ws(this.type="filter");return S(Vu,function(t,e){n.setAttribute(e,t)}),this.el=n,this.id=ct("filter_"),this.el.id=this.id,this.cfg=t,this._parseShadow(t,n),this}var Hu=(Yu.prototype.match=function(t,e){if(this.type!==t)return!1;var n=!0,i=this.cfg;return S(Object.keys(i),function(t){if(i[t]!==e[t])return n=!1}),n},Yu.prototype.update=function(t,e){var n=this.cfg;return n[Zu[t]]=e,this._parseShadow(n,this.el),this},Yu.prototype._parseShadow=function(t,e){t='<feDropShadow\n      dx="'+(t.dx||0)+'"\n      dy="'+(t.dy||0)+'"\n      stdDeviation="'+(t.blur?t.blur/10:0)+'"\n      flood-color="'+(t.color||"#000")+'"\n      flood-opacity="'+(t.opacity||1)+'"\n      />';e.innerHTML=t},Yu);function qu(t,e){this.cfg={};var n=Ws("marker"),i=ct("marker_");n.setAttribute("id",i);var r=Ws("path");r.setAttribute("stroke",t.stroke||"none"),r.setAttribute("fill",t.fill||"none"),n.appendChild(r),n.setAttribute("overflow","visible"),n.setAttribute("orient","auto-start-reverse"),this.el=n,this.child=r,this.id=i;i=t["marker-start"===e?"startArrow":"endArrow"];return this.stroke=t.stroke||"#000",!0===i?this._setDefaultPath(e,r):(this.cfg=i,this._setMarker(t.lineWidth,r)),this}var Ku=(qu.prototype.match=function(){return!1},qu.prototype._setDefaultPath=function(t,e){var n=this.el;e.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),n.setAttribute("refX",""+10*Math.cos(Math.PI/6)),n.setAttribute("refY","5")},qu.prototype._setMarker=function(t,e){var n=this.el,i=this.cfg.path,r=this.cfg.d;m(i)&&(i=i.map(function(t){return t.join(" ")}).join("")),e.setAttribute("d",i),n.appendChild(e),r&&n.setAttribute("refX",""+r/t)},qu.prototype.update=function(t){var e=this.child;e.attr?e.attr("fill",t):e.setAttribute("fill",t)},qu);function Ju(t){this.type="clip",this.cfg={};var e=Ws("clipPath");this.el=e,this.id=ct("clip_"),e.id=this.id;var n=t.cfg.el;return e.appendChild(n),this.cfg=t,this}var Qu=(Ju.prototype.match=function(){return!1},Ju.prototype.remove=function(){var t=this.el;t.parentNode.removeChild(t)},Ju),$u=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i;function tc(t){this.cfg={};var e=Ws("pattern");e.setAttribute("patternUnits","userSpaceOnUse");var n=Ws("image");e.appendChild(n);var i=ct("pattern_");e.id=i,this.el=e,this.id=i,this.cfg=t;t=$u.exec(t)[2];n.setAttribute("href",t);var r=new Image;function o(){e.setAttribute("width",""+r.width),e.setAttribute("height",""+r.height)}return t.match(/^data:/i)||(r.crossOrigin="Anonymous"),r.src=t,r.complete?o():(r.onload=o,r.src=r.src),this}var ec=(tc.prototype.match=function(t,e){return this.cfg===e},tc);function nc(t){var e=Ws("defs"),n=ct("defs_");e.id=n,t.appendChild(e),this.children=[],this.defaultArrow={},this.el=e,this.canvas=t}var ic,rc=(nc.prototype.find=function(t,e){for(var n=this.children,i=null,r=0;r<n.length;r++)if(n[r].match(t,e)){i=n[r].id;break}return i},nc.prototype.findById=function(t){for(var e=this.children,n=null,i=0;i<e.length;i++)if(e[i].id===t){n=e[i];break}return n},nc.prototype.add=function(t){this.children.push(t),t.canvas=this.canvas,t.parent=this},nc.prototype.getDefaultArrow=function(t,e){var n=t.stroke||t.strokeStyle;if(this.defaultArrow[n])return this.defaultArrow[n].id;e=new Ku(t,e);return this.defaultArrow[n]=e,this.el.appendChild(e.el),this.add(e),e.id},nc.prototype.addGradient=function(t){t=new Xu(t);return this.el.appendChild(t.el),this.add(t),t.id},nc.prototype.addArrow=function(t,e){e=new Ku(t,e);return this.el.appendChild(e.el),this.add(e),e.id},nc.prototype.addShadow=function(t){t=new Hu(t);return this.el.appendChild(t.el),this.add(t),t.id},nc.prototype.addPattern=function(t){t=new ec(t);return this.el.appendChild(t.el),this.add(t),t.id},nc.prototype.addClip=function(t){t=new Qu(t);return this.el.appendChild(t.el),this.add(t),t.id},nc);function oc(t){return ic.call(this,Us(Us({},t),{autoDraw:!0,renderer:"svg"}))||this}var ac=(Gs(oc,ic=fi),oc.prototype.getShapeBase=function(){return h},oc.prototype.getGroupBase=function(){return Qs},oc.prototype.getShape=function(t,e,n){var i=n.target||n.srcElement;if(!zs[i.tagName]){for(var r=i.parentNode;r&&!zs[r.tagName];)r=r.parentNode;i=r}return this.find(function(t){return t.get("el")===i})},oc.prototype.createDom=function(){var t=Ws("svg"),e=new rc(t);return t.setAttribute("width",""+this.get("width")),t.setAttribute("height",""+this.get("height")),this.set("context",e),t},oc.prototype.onCanvasChange=function(t){var n,e,i=this.get("context"),r=this.get("el");"sort"===t?(n=this.get("children"))&&n.length&&Zs(this,function(t,e){return n.indexOf(t)-n.indexOf(e)?1:0}):"clear"===t?r&&(r.innerHTML="",(e=i.el).innerHTML="",r.appendChild(e)):"matrix"===t?Vs(this):"clip"===t?Ys(this,i):"changeSize"===t&&(r.setAttribute("width",""+this.get("width")),r.setAttribute("height",""+this.get("height")))},oc.prototype.draw=function(){var t=this.get("context"),e=this.getChildren();Ys(this,t),e.length&&Hs(t,e)},oc);function sc(t,e){for(var n,i,r,o,a,s,u,c,h=t?[].concat(t):[1,0,0,0,1,0,0,0,1],l=0,d=e.length;l<d;l++){var f=e[l];switch(f[0]){case"t":s=a=h,u=[f[1],f[2]],c=void 0,c=[0,0,0,0,0,0,0,0,0],_t.fromTranslation(c,u),_t.multiply(a,c,s);break;case"s":o=a=h,c=[f[1],f[2]],s=void 0,s=[0,0,0,0,0,0,0,0,0],_t.fromScaling(s,c),_t.multiply(a,s,o);break;case"r":i=n=h,o=f[1],r=void 0,r=[0,0,0,0,0,0,0,0,0],_t.fromRotation(r,o),_t.multiply(n,r,i);break;case"m":r=n=h,i=f[1],_t.multiply(n,i,r)}}return h}var me=n(6767),uc=n.n(me),Ee=n(17621),cc=n.n(Ee),hc=2,lc=.16,dc=.05,fc=.05,pc=.15,gc=5,vc=4,yc=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function mc(t,e,n){e=60<=Math.round(t.h)&&Math.round(t.h)<=240?n?Math.round(t.h)-hc*e:Math.round(t.h)+hc*e:n?Math.round(t.h)+hc*e:Math.round(t.h)-hc*e;return e<0?e+=360:360<=e&&(e-=360),e}function xc(t,e,n){if(0===t.h&&0===t.s)return t.s;t=n?t.s-lc*e:e===vc?t.s+lc:t.s+dc*e;return 1<t&&(t=1),(t=n&&e===gc&&.1<t?.1:t)<.06&&(t=.06),Number(t.toFixed(2))}function bc(t,e,n){e=n?t.v+fc*e:t.v-pc*e;return 1<e&&(e=1),Number(e.toFixed(2))}function Ec(t,e){for(var n=1<arguments.length&&void 0!==e?e:{},i=[],r=cc()(t),o=gc;0<o;--o){var a=r.toHsv(),a=cc()({h:mc(a,o,!0),s:xc(a,o,!0),v:bc(a,o,!0)}).toHexString();i.push(a)}i.push(r.toHexString());for(var s=1;s<=vc;s+=1){var u=r.toHsv(),u=cc()({h:mc(u,s),s:xc(u,s),v:bc(u,s)}).toHexString();i.push(u)}return"dark"===n.theme?yc.map(function(t){var e=t.index,t=t.opacity;return cc().mix(n.backgroundColor||"#141414",i[e],100*t).toHexString()}):i}var Sc={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},wc={},kc={};Object.keys(Sc).forEach(function(t){wc[t]=Ec(Sc[t]),wc[t].primary=wc[t][5],kc[t]=Ec(Sc[t],{theme:"dark",backgroundColor:"#141414"}),kc[t].primary=kc[t][5]});wc.red,wc.volcano,wc.gold,wc.orange,wc.yellow,wc.lime,wc.green,wc.cyan,wc.blue,wc.geekblue,wc.purple,wc.magenta,wc.grey;var Cc=function(t,e,n){t=uc()(t),e=uc()(e);return uc()([(1-n)*t.red()+n*e.red(),(1-n)*t.green()+n*e.green(),(1-n)*t.blue()+n*e.blue()]).rgb()},_c=function(t,e,n,i){return void 0===e&&(e="#fff"),void 0===i&&(i="rgb(150, 150, 150)"),"default"===(n=void 0===n?"default":n)?function(t,e,n){void 0===n&&(n="rgb(150, 150, 150)");var i=Cc(e=void 0===e?"#fff":e,t,.05).rgb().toString(),r=Cc(e,t,.1).rgb().toString(),o=Cc(e,t,.2).rgb().toString(),a=Cc(e,t,.4).rgb().toString(),s=Cc(e,n,.02).rgb().toString(),u=Cc(e,n,.05).rgb().toString(),c=Cc(e,n,.1).rgb().toString(),h=Cc(e,n,.2).rgb().toString(),l=Cc(e,n,.3).rgb().toString(),d=Ec(t,{theme:"default",backgroundColor:e}),f=uc()(t).hex().toLowerCase(),n=d.indexOf(f),f=t;return{mainStroke:t,mainFill:r,activeStroke:t,activeFill:i,inactiveStroke:a,inactiveFill:i,selectedStroke:t,selectedFill:e,highlightStroke:f=-1!==n?d[n+1]:f,highlightFill:o,disableStroke:l,disableFill:u,edgeMainStroke:l,edgeActiveStroke:t,edgeInactiveStroke:h,edgeSelectedStroke:t,edgeHighlightStroke:t,edgeDisableStroke:c,comboMainStroke:l,comboMainFill:s,comboActiveStroke:t,comboActiveFill:i,comboInactiveStroke:l,comboInactiveFill:s,comboSelectedStroke:t,comboSelectedFill:s,comboHighlightStroke:f,comboHighlightFill:s,comboDisableStroke:h,comboDisableFill:u}}(t,e,"rgb(150, 150, 150)"):function(t,e,n){void 0===n&&(n="#777");var i=Cc(e=void 0===e?"#fff":e,t,.2).rgb().toString(),r=Cc(e,t,.3).rgb().toString(),o=Cc(e,t,.6).rgb().toString(),a=Cc(e,t,.8).rgb().toString(),s=Cc(e,n,.2).rgb().toString(),u=Cc(e,n,.25).rgb().toString(),c=Cc(e,n,.3).rgb().toString(),h=Cc(e,n,.4).rgb().toString(),l=Cc(e,n,.5).rgb().toString(),d=Ec(t,{theme:"dark",backgroundColor:e}),e=uc()(t).hex().toLowerCase(),e=d.indexOf(e);return{mainStroke:a,mainFill:i,activeStroke:t,activeFill:r,inactiveStroke:a,inactiveFill:i,selectedStroke:t,selectedFill:i,highlightStroke:t,highlightFill:o,disableStroke:l,disableFill:u,edgeMainStroke:n,edgeActiveStroke:t,edgeInactiveStroke:n,edgeSelectedStroke:t,edgeHighlightStroke:t,edgeDisableStroke:c,comboMainStroke:h,comboMainFill:u,comboActiveStroke:t,comboActiveFill:s,comboInactiveStroke:h,comboInactiveFill:u,comboSelectedStroke:t,comboSelectedFill:s,comboHighlightStroke:-1!==e?d[e+1]:t,comboHighlightFill:u,comboDisableStroke:h,comboDisableFill:s}}(t,e,"#777")},Mc=function(t,e,n,i){void 0===e&&(e="#fff"),void 0===n&&(n="default"),void 0===i&&(i="rgb(150, 150, 150)");var r=[];return t.forEach(function(t){r.push(_c(t,e,n,i))}),r},tn="rgb(0, 0, 0)",Pn=_c("rgb(95, 149, 255)","rgb(255, 255, 255)"),Ic={version:"0.2.7",rootContainerClassName:"root-container",nodeContainerClassName:"node-container",edgeContainerClassName:"edge-container",comboContainerClassName:"combo-container",delegateContainerClassName:"delegate-container",defaultLoopPosition:"top",nodeLabel:{style:{fill:"#000",fontSize:12,textAlign:"center",textBaseline:"middle"},offset:4},defaultNode:{type:"circle",style:{lineWidth:1,stroke:Pn.mainStroke,fill:Pn.mainFill},size:20,color:Pn.mainStroke,linkPoints:{size:8,lineWidth:1,fill:Pn.activeFill,stroke:Pn.activeStroke}},nodeStateStyles:{active:{fill:Pn.activeFill,stroke:Pn.activeStroke,lineWidth:2,shadowColor:Pn.mainStroke,shadowBlur:10},selected:{fill:Pn.selectedFill,stroke:Pn.selectedStroke,lineWidth:4,shadowColor:Pn.selectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{fill:Pn.highlightFill,stroke:Pn.highlightStroke,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{fill:Pn.inactiveFill,stroke:Pn.inactiveStroke,lineWidth:1},disable:{fill:Pn.disableFill,stroke:Pn.disableStroke,lineWidth:1}},edgeLabel:{style:{fill:tn,textAlign:"center",textBaseline:"middle",fontSize:12}},defaultEdge:{type:"line",size:1,style:{stroke:Pn.edgeMainStroke,lineAppendWidth:2},color:Pn.edgeMainStroke},edgeStateStyles:{active:{stroke:Pn.edgeActiveStroke,lineWidth:1},selected:{stroke:Pn.edgeSelectedStroke,lineWidth:2,shadowColor:Pn.edgeSelectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:Pn.edgeHighlightStroke,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{stroke:Pn.edgeInactiveStroke,lineWidth:1},disable:{stroke:Pn.edgeDisableStroke,lineWidth:1}},comboLabel:{style:{fill:tn,textBaseline:"middle",fontSize:12},refY:10,refX:10},defaultCombo:{type:"circle",style:{fill:Pn.comboMainFill,lineWidth:1,stroke:Pn.comboMainStroke,r:5,width:20,height:10},size:[20,5],color:Pn.comboMainStroke,padding:[25,20,15,20]},comboStateStyles:{active:{stroke:Pn.comboActiveStroke,lineWidth:1,fill:Pn.comboActiveFill},selected:{stroke:Pn.comboSelectedStroke,lineWidth:2,fill:Pn.comboSelectedFill,shadowColor:Pn.comboSelectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:Pn.comboHighlightStroke,lineWidth:2,fill:Pn.comboHighlightFill,"text-shape":{fontWeight:500}},inactive:{stroke:Pn.comboInactiveStroke,fill:Pn.comboInactiveFill,lineWidth:1},disable:{stroke:Pn.comboDisableStroke,fill:Pn.comboDisableFill,lineWidth:1}},delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},textWaterMarkerConfig:{width:150,height:100,compatible:!1,text:{x:0,y:60,lineHeight:20,rotate:20,fontSize:14,fontFamily:"Microsoft YaHei",fill:"rgba(0, 0, 0, 0.1)",baseline:"Middle"}},imageWaterMarkerConfig:{width:150,height:130,compatible:!1,image:{x:0,y:0,width:30,height:20,rotate:0}},waterMarkerImage:"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/logo-with-text-73b8a.svg"};function Tc(t,e,n){if(t)return"function"==typeof t.addEventListener?(t.addEventListener(e,n,!1),{remove:function(){t.removeEventListener(e,n,!1)}}):"function"==typeof t.attachEvent?(t.attachEvent("on"+e,n),{remove:function(){t.detachEvent("on"+e,n)}}):void 0}var Ac,Pc=Jo.cloneEvent,Dc=Jo.isViewportChanged;function Nc(t){var e=Ac.call(this,t)||this;return e.extendEvents=[],e.dragging=!1,e.preItem=null,e.graph=t,e.destroyed=!1,e.initEvents(),e}var Oc=(Ac=pe,(0,na.ZT)(Nc,Ac),Nc.prototype.initEvents=function(){var t=this.graph,e=this.extendEvents,n=void 0===e?[]:e,i=t.get("canvas"),r=i.get("el"),o=P(this,"onCanvasEvents"),e=P(this,"onExtendEvents"),t=P(this,"onWheelEvent");i.off("*").on("*",o),this.canvasHandler=o,n.push(Tc(r,"DOMMouseScroll",t)),n.push(Tc(r,"mousewheel",t)),"undefined"!=typeof window&&(n.push(Tc(window,"keydown",e)),n.push(Tc(window,"keyup",e)),n.push(Tc(window,"focus",e)))},Nc.getItemRoot=function(t){for(;t&&!t.get("item");)t=t.get("parent");return t},Nc.prototype.onCanvasEvents=function(t){var e=this.graph,n=e.get("canvas"),i=t.target,r=t.type;t.canvasX=t.x,t.canvasY=t.y;var o={x:t.canvasX,y:t.canvasY},a=e.get("group").getMatrix();if(Dc(a=a||[1,0,0,0,1,0,0,0,1])&&(o=e.getPointByClient(t.clientX,t.clientY)),t.x=o.x,t.y=o.y,t.currentTarget=e,i===n)return"mousemove"!==r&&"mouseleave"!==r||this.handleMouseMove(t,"canvas"),t.target=n,t.item=null,e.emit(r,t),void e.emit("canvas:"+r,t);o=Nc.getItemRoot(i);o?(n=o.get("item")).destroyed||(o=n.getType(),t.target=i,t.item=n,t.canvasX===t.x&&t.canvasY===t.y&&(n=e.getCanvasByPoint(t.x,t.y),t.canvasX=n.x,t.canvasY=n.y),e.emit(r,t),t.name&&!t.name.includes(":")?e.emit(o+":"+r,t):e.emit(t.name,t),"dragstart"===r&&(this.dragging=!0),"dragend"===r&&(this.dragging=!1),"mousemove"===r&&this.handleMouseMove(t,o)):e.emit(r,t)},Nc.prototype.onExtendEvents=function(t){this.graph.emit(t.type,t)},Nc.prototype.onWheelEvent=function(t){G(t.wheelDelta)&&(t.wheelDelta=-t.detail),this.graph.emit("wheel",t)},Nc.prototype.handleMouseMove=function(t,e){var n=this.graph,i=this.preItem,n=n.get("canvas"),n=t.target===n?null:t.item;t=Pc(t),i&&i!==n&&!i.destroyed&&(t.item=i,this.emitCustomEvent(i.getType(),"mouseleave",t),this.dragging&&this.emitCustomEvent(i.getType(),"dragleave",t)),n&&i!==n&&(t.item=n,this.emitCustomEvent(e,"mouseenter",t),this.dragging&&this.emitCustomEvent(e,"dragenter",t)),this.preItem=n},Nc.prototype.emitCustomEvent=function(t,e,n){n.type=e,this.graph.emit(t+":"+e,n)},Nc.prototype.destroy=function(){var t=this.graph,e=this.canvasHandler,n=this.extendEvents;t.get("canvas").off("*",e),S(n,function(t){t.remove()}),this.dragging=!1,this.preItem=null,this.extendEvents.length=0,this.canvasHandler=null,this.destroyed=!0},Nc);class Lc{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(t){return this.init(t),this.execute(!0)}init(t){this.nodes=t.nodes||[],this.edges=t.edges||[],this.combos=t.combos||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){t&&Object.assign(this,t)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const Rc=t=>"string"==typeof t;const Bc=/-(\w)/g;(t=>{const e=Object.create(null)})(t=>t.replace(Bc,(t,e)=>e?e.toUpperCase():""));const Gc=Array.isArray,Uc=t=>"number"==typeof t,Fc=t=>Number.isNaN(Number(t));const zc=(e,n,t)=>{const i=[];for(let t=0;t<e;t++)i[t]=0;return t&&t.forEach(t=>{t.source&&(i[n[t.source]]+=1),t.target&&(i[n[t.target]]+=1)}),i},jc=n=>{const i=[];var r=n.length;for(let e=0;e<r;e+=1){i[e]=[];for(let t=0;t<r;t+=1)e===t?i[e][t]=0:0!==n[e][t]&&n[e][t]?i[e][t]=n[e][t]:i[e][t]=1/0}for(let n=0;n<r;n+=1)for(let e=0;e<r;e+=1)for(let t=0;t<r;t+=1)i[e][t]>i[e][n]+i[n][t]&&(i[e][t]=i[e][n]+i[n][t]);return i},Wc=(t,n)=>{const{nodes:e,edges:i}=t,r=[],o={};if(!e)throw new Error("invalid nodes data!");return e&&e.forEach((t,e)=>{o[t.id]=e;r.push([])}),i&&i.forEach(t=>{var{source:e,target:t}=t,e=o[e],t=o[t];r[e][t]=1,n||(r[t][e]=1)}),r},Xc=(e,n)=>{if(e&&e.children)for(let t=e.children.length-1;0<=t;t--)if(!Xc(e.children[t],n))return;return!!n(e)},Zc=(t,e)=>{"function"==typeof e&&Xc(t,e)},Vc=t=>{if(null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array){const e=[];return t.forEach(t=>{e.push(t)}),e.map(t=>Vc(t))}if("object"!=typeof t||t==={})return t;{const n=Object.assign({},t);return Object.keys(n).forEach(t=>{n[t]=Vc(n[t])}),n}},Yc=t=>"function"==typeof t,Hc=new Map,qc=(e,r)=>{if(Hc.get(e),null!==(t=r)&&"object"==typeof t){class t extends Lc{constructor(t){super();const n=this,i={};var e=n.getDefaultCfg();Object.assign(i,e,r,t),Object.keys(i).forEach(t=>{var e=i[t];n[t]=e})}}Hc.set(e,t)}else Hc.set(e,r);var t};Lc;Lc;const Kc=(e,n)=>{let t;return t=e?Uc(e)?t=>e:e:t=>n||1,t};Lc;var Jc=n(43231),Qc=n(47469),$c=n(77715),th=n(58571),eh=n(1112),nh=n(26464),ih=n(32878);function rh(){function e(t){return()=>t}let s=t=>t.cluster,u=e(1),n=e(-1),i=e(100),r=e(.1),o=[0,0],c=[],h={},l=[],a=100,d=100,f={none:{x:0,y:0}},p=[],g,v="force",y=!0,m=.1;function x(r){if(!y)return x;g.tick(),E();for(let t=0,e=c.length,n,i=r*m;t<e;++t)n=c[t],n.vx+=(f[s(n)].x-n.x)*i,n.vy+=(f[s(n)].y-n.y)*i}function b(){c&&function(){if(c&&c.length){if(void 0===s(c[0]))throw Error("Couldnt find the grouping attribute for the nodes. Make sure to set it up with forceInABox.groupBy('clusterAttr') before calling .links()");var t=function(){const i=[],r=[],o={};let t=[],a={},e=[];return a=function(t){const i={};return t.forEach(t=>{t=s(t);i[t]||(i[t]={count:0,sumforceNodeSize:0})}),t.forEach(t=>{var e=s(t),t=u(t);const n=i[e];n.count=n.count+1,n.sumforceNodeSize=n.sumforceNodeSize+Math.PI*(t*t)*1.3,i[e]=n}),i}(c),e=function(t){const i={},r=[];t.forEach(t=>{var e,t=(e=t,t=s(h[e.source]),e=s(h[e.target]),t<=e?`${t}~${e}`:`${e}~${t}`);let n=0;void 0!==i[t]&&(n=i[t]),n+=1,i[t]=n});const e=Object.entries(i);return e.forEach(([t,e])=>{var n=t.split("~")[0],t=t.split("~")[1];void 0!==n&&void 0!==t&&r.push({source:n,target:t,count:e})}),r}(l),t=Object.keys(a),t.forEach((t,e)=>{var n=a[t];i.push({id:t,size:n.count,r:Math.sqrt(n.sumforceNodeSize/Math.PI)}),o[t]=e}),e.forEach(t=>{var e=o[t.source],n=o[t.target];void 0!==e&&void 0!==n&&r.push({source:e,target:n,count:t.count})}),{nodes:i,links:r}}();g=Qc.Z(t.nodes).force("x",nh.Z(a).strength(.1)).force("y",ih.Z(d).strength(.1)).force("collide",eh.Z(t=>t.r).iterations(4)).force("charge",Jc.Z().strength(n)).force("links",th.Z(t.nodes.length?t.links:[]).distance(i).strength(r)),p=g.nodes(),E()}}()}function E(){return f={none:{x:0,y:0}},p.forEach(t=>{f[t.id]={x:t.x-o[0],y:t.y-o[1]}}),f}return x.initialize=t=>{c=t,b()},x.template=function(t){return arguments.length?(v=t,b(),x):v},x.groupBy=function(e){return arguments.length?(s="string"==typeof e?t=>t[e]:e,x):s},x.enableGrouping=function(t){return arguments.length?(y=t,x):y},x.strength=function(t){return arguments.length?(m=t,x):m},x.centerX=function(t){return arguments.length?(a=t,x):a},x.centerY=function(t){return arguments.length?(d=t,x):d},x.nodes=function(t){return arguments.length?(e=t||[],h={},e.forEach(t=>{h[t.id]=t}),c=t||[],x):c;var e},x.links=function(t){return arguments.length?(l=t||[],b(),x):l},x.nodeSize=x.forceNodeSize=function(t){return arguments.length?(u="function"==typeof t?t:e(+t),b(),x):u},x.forceCharge=function(t){return arguments.length?(n="function"==typeof t?t:e(+t),b(),x):n},x.forceLinkDistance=function(t){return arguments.length?(i="function"==typeof t?t:e(+t),b(),x):i},x.forceLinkStrength=function(t){return arguments.length?(r="function"==typeof t?t:e(+t),b(),x):r},x.offset=function(t){return arguments.length?(o=t,x):o},x.getFocis=E,x}const oh={RUN:"LAYOUT_RUN",END:"LAYOUT_END",ERROR:"LAYOUT_ERROR",TICK:"LAYOUT_TICK",GPURUN:"GPU_LAYOUT_RUN",GPUEND:"GPU_LAYOUT_END"};Lc;function ah(t,e){t=t.degree,e=e.degree;return t<e?-1:e<t?1:0}Lc;var a=n(70681),sh=n.n(a);Lc;function uh(t,e,n){let i;return i=t||(Uc(e)?()=>e:()=>n),i}var ch=n(47859),hh=n(93816);class lh{constructor(t){this.distances=t.distances,this.dimension=t.dimension||2,this.linkDistance=t.linkDistance}layout(){const{dimension:e,distances:n,linkDistance:i}=this;try{const u=ch.Z.mul(ch.Z.pow(n,2),-.5);var t=u.mean("row"),r=u.mean("column"),o=u.mean();u.add(o).subRowVector(t).subColumnVector(r);const c=new hh.Z(u),h=ch.Z.sqrt(c.diagonalMatrix).diagonal();return c.leftSingularVectors.toJSON().map(t=>ch.Z.mul([t],[h]).toJSON()[0].splice(0,e))}catch(t){const l=[];for(let t=0;t<n.length;t++){var a=Math.random()*i,s=Math.random()*i;l.push([a,s])}return l}}}class dh{constructor(t){this.disp=[],this.positions=t.positions,this.adjMatrix=t.adjMatrix,this.focusID=t.focusID,this.radii=t.radii,this.iterations=t.iterations||10,this.height=t.height||10,this.width=t.width||10,this.speed=t.speed||100,this.gravity=t.gravity||10,this.nodeSizeFunc=t.nodeSizeFunc,this.k=t.k||5,this.strictRadial=t.strictRadial,this.nodes=t.nodes}layout(){const e=this.positions,n=[];var i=this.iterations,t=this.width/10;this.maxDisplace=t,this.disp=n;for(let t=0;t<i;t++)e.forEach((t,e)=>{n[e]={x:0,y:0}}),this.getRepulsion(),this.updatePositions();return e}getRepulsion(){const s=this,t=s.positions,u=s.nodes,c=s.disp,h=s.k,e=s.radii||[];t.forEach((o,a)=>{c[a]={x:0,y:0},t.forEach((i,r)=>{if(a!==r&&e[a]===e[r]){let t=o[0]-i[0],e=o[1]-i[1],n=Math.sqrt(t*t+e*e);0===n&&(n=1,i=r<a?1:-1,t=.01*i,e=.01*i),n<s.nodeSizeFunc(u[a])/2+s.nodeSizeFunc(u[r])/2&&(r=h*h/n,c[a].x+=t/n*r,c[a].y+=e/n*r)}})})}updatePositions(){const s=this.positions,o=this.disp,a=this.speed,u=this.strictRadial,c=this.focusID,h=this.maxDisplace||this.width/10;u&&o.forEach((t,e)=>{var n=s[e][0]-s[c][0],i=s[e][1]-s[c][1],e=Math.sqrt(n*n+i*i);let r=i/e,o=-n/e;e=Math.sqrt(t.x*t.x+t.y*t.y);let a=Math.acos((r*t.x+o*t.y)/e);a>Math.PI/2&&(a-=Math.PI/2,r*=-1,o*=-1);e=Math.cos(a)*e;t.x=r*e,t.y=o*e});const l=this.radii;s.forEach((t,e)=>{var n,i,r;e===c||0<(r=Math.sqrt(o[e].x*o[e].x+o[e].y*o[e].y))&&e!==c&&(n=Math.min(h*(a/800),r),t[0]+=o[e].x/r*n,t[1]+=o[e].y/r*n,u&&(i=t[0]-s[c][0],r=t[1]-s[c][1],i=i/(n=Math.sqrt(i*i+r*r))*l[e],r=r/n*l[e],t[0]=s[c][0]+i,t[1]=s[c][1]+r))})}}function fh(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}Lc;Lc;Lc;Lc;var ph=n(95376),gh=n(81278),vh=n(2610),r=n(31255),s=(n(28660),n(20523)),yh=n.n(s),mh=n(37171),xh=1;function bh(t){(0,gh.Z)(this,bh)}function Eh(){(0,gh.Z)(this,Eh),this.index=void 0}function Sh(){(0,gh.Z)(this,Sh),this.name=void 0,this.data=void 0,this.execute=void 0,this.tearDown=void 0}function wh(){(0,gh.Z)(this,wh),this.first=void 0,this.last=void 0}var i=function(){function e(t){(0,gh.Z)(this,e),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=t}var n;return(0,vh.Z)(e,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(t){return-1<this.lookup[t]}},{key:"create",value:function(t,e){this.lookup[t]=this.components.length;e=new this.clazz(e||{});return this.components.push(e),this.entities.push(t),e}},{key:"remove",value:function(t){var e=this.lookup[t];-1<e&&e<this.components.length-1&&(this.components[e]=this.components[this.components.length-1],this.entities[e]=this.entities[this.entities.length-1],this.lookup[this.entities[e]]=e),this.components.pop(),this.entities.pop(),delete this.lookup[t]}},{key:"removeKeepSorted",value:function(t){var e=this.lookup[t];if(-1<e){t=this.entities[e];if(e<this.components.length-1){for(var n=e+1;n<this.components.length;++n)this.components[n-1]=this.components[n];for(var i=e+1;i<this.entities.length;++i)this.entities[i-1]=this.entities[i],this.lookup[this.entities[i-1]]=i-1}this.components.pop(),this.entities.pop(),delete this.lookup[t]}}},{key:"moveItem",value:function(t,e){if(t!==e){for(var n=this.components[t],i=this.entities[t],r=t<e?1:-1,o=t;o!==e;o+=r){var a=o+r;this.components[o]=this.components[a],this.entities[o]=this.entities[a],this.lookup[this.entities[o]]=o}this.components[e]=n,this.entities[e]=i,this.lookup[i]=e}}},{key:"getEntity",value:function(t){return this.entities[t]}},{key:"getComponent",value:function(t){return this.components[t]}},{key:"getComponentByEntity",value:function(t){t=this.lookup[t];return-1<t?this.components[t]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(t){for(var e=0,n=Object.keys(this.lookup);e<n.length;e++){var i=n[e],i=Number(i);if(this.lookup[i]===t)return i}return-1}},{key:"find",value:function(t){for(var e=0;e<this.getCount();e++){var n=this.getComponent(e);if(t(n,e))return n}return null}},{key:"findIndex",value:function(t){for(var e=0;e<this.getCount();e++)if(t(this.getComponent(e),e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,n=Object.keys(this.lookup);e<n.length;e++){var i=n[e],r=Number(i),i=this.lookup[r];t(r,this.getComponent(i))}}},{key:"forEachAsync",value:(n=(0,mh.Z)(yh().mark(function t(e){var n,i,r,o;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=0,i=Object.keys(this.lookup);case 1:if(n<i.length)return o=i[n],r=Number(o),o=this.lookup[r],t.next=7,e(r,this.getComponent(o));t.next=10;break;case 7:n++,t.next=1;break;case 10:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"map",value:function(t){for(var e=[],n=0,i=Object.keys(this.lookup);n<i.length;n++){var r=i[n],o=Number(r),r=this.lookup[o];e.push(t(o,this.getComponent(r)))}return e}}]),e}(),kh=n(36571),Ch=n(86700),_h={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourcePool:Symbol("ResourcePool"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),RendererSystem:Symbol("RendererSystem"),RenderPass:Symbol("RenderPass"),RenderPassFactory:Symbol("Factory<IRenderPass>"),Renderable:Symbol("Factory<IRenderPass>"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),Geometry:Symbol("Geometry"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),Material:Symbol("Material"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine"),ShaderModuleService:Symbol("ShaderModuleService"),ConfigService:Symbol("ConfigService"),InteractorService:Symbol("InteractorService"),IEventEmitter:Symbol("IEventEmitter"),Light:Symbol("Light")},Mh=function(){function t(){(0,gh.Z)(this,t),this.name=void 0,this.refCount=0,this.hasSideEffect=!1,this.devirtualize=[],this.destroy=[],this.reads=[],this.writes=[]}return(0,vh.Z)(t,[{key:"read",value:function(e){return this.reads.find(function(t){return t.index===e.index})||this.reads.push(e),e}},{key:"sample",value:function(t){return this.read(t),t}},{key:"write",value:function(t,e){if(this.writes.find(function(t){return t.index===e.index}))return e;var n=t.getResourceNode(e);n.resource.version++,n.resource.imported&&(this.hasSideEffect=!0);n=t.createResourceNode(n.resource);return(t.getResourceNode(n).writer=this).writes.push(n),n}}]),t}(),Ih=n(40485),Th=n(52024),Ah=n(79507);function Ph(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}function Dh(){(0,gh.Z)(this,Dh),this.resource=void 0,this.writer=void 0,this.readerCount=0,this.version=void 0}var Nh,Oh=function(){(0,Ih.Z)(o,wh);var r=Ph(o);function o(){var t;(0,gh.Z)(this,o);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(t=r.call.apply(r,[this].concat(n))).version=0,t.refs=0,t.name=void 0,t.imported=void 0,t.priority=void 0,t.discardStart=!0,t.discardEnd=!1,t.descriptor=void 0,t.resource=void 0,t}return(0,vh.Z)(o,[{key:"preExecuteDestroy",value:function(){this.discardEnd=!0}},{key:"postExecuteDestroy",value:function(){this.imported}},{key:"postExecuteDevirtualize",value:function(){this.discardStart=!1}},{key:"preExecuteDevirtualize",value:function(){this.imported}}]),o}();function Lh(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Rh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rh(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,e=function(){};return{s:e,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}function Rh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Bh=(u=(0,Ch.b2)(),C=(0,Ch.f3)(_h.RenderEngine),u((Nh=(0,r.Z)((Ct=function(){function t(){(0,gh.Z)(this,t),this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[],(0,ph.Z)(this,"engine",Nh,this)}var e,n;return(0,vh.Z)(t,[{key:"execute",value:(n=(0,mh.Z)(yh().mark(function t(e){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.compile(),t.next=3,this.executePassNodes(e);case 3:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"tearDown",value:function(){this.frameGraphPasses.forEach(function(t){t.tearDown&&t.tearDown()}),this.reset()}},{key:"addPass",value:function(t,e,n,i){var r=new Sh;r.execute=n,i&&(r.tearDown=i),r.name=t;i=new Mh;return i.name=t,this.passNodes.push(i),this.frameGraphPasses.push(r),e(this,i,r),r}},{key:"getPass",value:function(e){return this.frameGraphPasses.find(function(t){return t.name===e})}},{key:"compile",value:function(){var t,e=this,n=Lh(this.passNodes);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.refCount=i.writes.length+(i.hasSideEffect?1:0),i.reads.forEach(function(t){e.resourceNodes[t.index].readerCount++})}}catch(t){n.e(t)}finally{n.f()}var r,o=[],a=Lh(this.resourceNodes);try{for(a.s();!(r=a.n()).done;){var s=r.value;0===s.readerCount&&o.push(s)}}catch(t){a.e(t)}finally{a.f()}for(;o.length;){var u=o.pop(),u=u&&u.writer;if(u&&0==--u.refCount){var c,h=Lh(u.reads);try{for(h.s();!(c=h.n()).done;){var l=c.value,d=this.resourceNodes[l.index];0==--d.readerCount&&o.push(d)}}catch(t){h.e(t)}finally{h.f()}}}this.resourceNodes.forEach(function(t){t.resource.refs+=t.readerCount});var f,p=Lh(this.passNodes);try{for(p.s();!(f=p.n()).done;){var g=f.value;if(g.refCount){var v,y=Lh(g.reads);try{for(y.s();!(v=y.n()).done;){var m=v.value,x=this.resourceNodes[m.index].resource;x.first=x.first||g,x.last=g}}catch(t){y.e(t)}finally{y.f()}var b,E=Lh(g.writes);try{for(E.s();!(b=E.n()).done;){var S=b.value,w=this.resourceNodes[S.index].resource;w.first=w.first||g,w.last=g}}catch(t){E.e(t)}finally{E.f()}}}}catch(t){p.e(t)}finally{p.f()}for(var k=0;k<2;k++){var C,_=Lh(this.resourceNodes);try{for(_.s();!(C=_.n()).done;){var M,I,T=C.value.resource;T.priority===k&&T.refs&&(M=T.first,I=T.last,M&&I&&(M.devirtualize.push(T),I.destroy.push(T)))}}catch(t){_.e(t)}finally{_.f()}}}},{key:"executePassNodes",value:(e=(0,mh.Z)(yh().mark(function t(e){var n,i,r,o,a,s,u,c,h,l,d,f;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=Lh(this.passNodes.entries()),t.prev=1,n.s();case 3:if((i=n.n()).done){t.next=18;break}if(o=(0,kh.Z)(i.value,2),r=o[0],!(o=o[1]).refCount){t.next=16;break}a=Lh(o.devirtualize);try{for(a.s();!(s=a.n()).done;)s.value.preExecuteDevirtualize(this.engine)}catch(t){a.e(t)}finally{a.f()}u=Lh(o.destroy);try{for(u.s();!(c=u.n()).done;)c.value.preExecuteDestroy(this.engine)}catch(t){u.e(t)}finally{u.f()}return t.next=12,this.frameGraphPasses[r].execute(this,this.frameGraphPasses[r],e);case 12:h=Lh(o.devirtualize);try{for(h.s();!(l=h.n()).done;)l.value.postExecuteDevirtualize(this.engine)}catch(t){h.e(t)}finally{h.f()}d=Lh(o.destroy);try{for(d.s();!(f=d.n()).done;)f.value.postExecuteDestroy(this.engine)}catch(t){d.e(t)}finally{d.f()}case 16:t.next=3;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(1),n.e(t.t0);case 23:return t.prev=23,n.f(),t.finish(23);case 26:this.reset();case 27:case"end":return t.stop()}},t,this,[[1,20,23,26]])})),function(t){return e.apply(this,arguments)})},{key:"reset",value:function(){this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[]}},{key:"getResourceNode",value:function(t){return this.resourceNodes[t.index]}},{key:"createResourceNode",value:function(t){var e=new Dh;e.resource=t,e.version=t.version,this.resourceNodes.push(e);e=new Eh;return e.index=this.resourceNodes.length-1,e}},{key:"createTexture",value:function(t,e,n){var i=new Oh;return i.name=e,i.descriptor=n,this.createResourceNode(i)}},{key:"createRenderTarget",value:function(t,e,n){var i=new Oh;return i.name=e,i.descriptor=n,this.createResourceNode(i)}},{key:"present",value:function(n){this.addPass("Present",function(t,e){e.read(n),e.hasSideEffect=!0},(0,mh.Z)(yh().mark(function t(){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)})))}}]),t}()).prototype,"engine",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Ct))||mt),Gh=n(47224),Uh=n(5461),Fh=n(98333),zh=n(71641),jh=9007199254740991,Wh={};Wh["[object Float32Array]"]=Wh["[object Float64Array]"]=Wh["[object Int8Array]"]=Wh["[object Int16Array]"]=Wh["[object Int32Array]"]=Wh["[object Uint8Array]"]=Wh["[object Uint8ClampedArray]"]=Wh["[object Uint16Array]"]=Wh["[object Uint32Array]"]=!0,Wh["[object Arguments]"]=Wh["[object Array]"]=Wh["[object ArrayBuffer]"]=Wh["[object Boolean]"]=Wh["[object DataView]"]=Wh["[object Date]"]=Wh["[object Error]"]=Wh["[object Function]"]=Wh["[object Map]"]=Wh["[object Number]"]=Wh["[object Object]"]=Wh["[object RegExp]"]=Wh["[object Set]"]=Wh["[object String]"]=Wh["[object WeakMap]"]=!1;var Xh=Object.prototype.toString;var Zh=function(t){return!!(e=t)&&"object"===(0,zh.Z)(e)&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=jh)&&!!Wh[Xh.call(t)];var e};function Vh(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Yh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vh(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vh(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Hh(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var qh,Kh,Jh,be=function(){(0,Ih.Z)(i,bh);var n=Hh(i);function i(t){var e;return(0,gh.Z)(this,i),(e=n.call(this,t)).dirty=!0,e.attributes=[],e.indices=void 0,e.indicesBuffer=void 0,e.vertexCount=0,e.maxInstancedCount=void 0,e.aabb=void 0,e.entity=void 0,Object.assign((0,Uh.Z)(e),t),e}return(0,vh.Z)(i,[{key:"setAttribute",value:function(e,t,n,i){var r=this.attributes.find(function(t){return t.name===e});return r?(r.data=t,r.dirty=!0):this.attributes.push(Yh(Yh({dirty:!0,name:e,data:t},n),{},{bufferGetter:i})),this.dirty=!0,this}},{key:"setIndex",value:function(t){return this.indices=new Uint32Array(t.buffer||t),this.dirty=!0,this}},{key:"applyMatrix",value:function(t){var e=this.attributes.find(function(t){return"position"===t.name}),n=this.attributes.find(function(t){return"normal"===t.name});if(e&&(e.dirty=!0,e.data&&e.data.length))for(var i=0;i<e.data.length;i+=3){var r=Fh.al(e.data[i],e.data[i+1],e.data[i+2],1);Fh.fF(r,r,t),Zh(e.data)?e.data.set([r[0],r[1],r[2]],i):(e.data[i]=r[0],e.data[i+1]=r[1],e.data[i+2]=r[2])}if(n){var o=_t.normalFromMat4(_t.create(),t);if(n.data&&n.data.length)for(var a=0;a<n.data.length;a+=3){var s=At.al(n.data[a],n.data[a+1],n.data[a+2]);At.kK(s,s,o),At.Fv(s,s),Zh(n.data)?n.data.set([s[0],s[1],s[2]],a):(n.data[a]=s[0],n.data[a+1]=s[1],n.data[a+2]=s[2])}}}}]),i}();(o=qh=qh||{})[o.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",o[o.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",o[o.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",o[o.POINTS=0]="POINTS",o[o.LINES=1]="LINES",o[o.LINE_LOOP=2]="LINE_LOOP",o[o.LINE_STRIP=3]="LINE_STRIP",o[o.TRIANGLES=4]="TRIANGLES",o[o.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",o[o.TRIANGLE_FAN=6]="TRIANGLE_FAN",o[o.ZERO=0]="ZERO",o[o.ONE=1]="ONE",o[o.SRC_COLOR=768]="SRC_COLOR",o[o.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",o[o.SRC_ALPHA=770]="SRC_ALPHA",o[o.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",o[o.DST_ALPHA=772]="DST_ALPHA",o[o.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",o[o.DST_COLOR=774]="DST_COLOR",o[o.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",o[o.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",o[o.FUNC_ADD=32774]="FUNC_ADD",o[o.BLEND_EQUATION=32777]="BLEND_EQUATION",o[o.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",o[o.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",o[o.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",o[o.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",o[o.MAX_EXT=32776]="MAX_EXT",o[o.MIN_EXT=32775]="MIN_EXT",o[o.BLEND_DST_RGB=32968]="BLEND_DST_RGB",o[o.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",o[o.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",o[o.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",o[o.CONSTANT_COLOR=32769]="CONSTANT_COLOR",o[o.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",o[o.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",o[o.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",o[o.BLEND_COLOR=32773]="BLEND_COLOR",o[o.ARRAY_BUFFER=34962]="ARRAY_BUFFER",o[o.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",o[o.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",o[o.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",o[o.STREAM_DRAW=35040]="STREAM_DRAW",o[o.STATIC_DRAW=35044]="STATIC_DRAW",o[o.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",o[o.BUFFER_SIZE=34660]="BUFFER_SIZE",o[o.BUFFER_USAGE=34661]="BUFFER_USAGE",o[o.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",o[o.FRONT=1028]="FRONT",o[o.BACK=1029]="BACK",o[o.FRONT_AND_BACK=1032]="FRONT_AND_BACK",o[o.CULL_FACE=2884]="CULL_FACE",o[o.BLEND=3042]="BLEND",o[o.DITHER=3024]="DITHER",o[o.STENCIL_TEST=2960]="STENCIL_TEST",o[o.DEPTH_TEST=2929]="DEPTH_TEST",o[o.SCISSOR_TEST=3089]="SCISSOR_TEST",o[o.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",o[o.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",o[o.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",o[o.NO_ERROR=0]="NO_ERROR",o[o.INVALID_ENUM=1280]="INVALID_ENUM",o[o.INVALID_VALUE=1281]="INVALID_VALUE",o[o.INVALID_OPERATION=1282]="INVALID_OPERATION",o[o.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",o[o.CW=2304]="CW",o[o.CCW=2305]="CCW",o[o.LINE_WIDTH=2849]="LINE_WIDTH",o[o.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",o[o.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",o[o.CULL_FACE_MODE=2885]="CULL_FACE_MODE",o[o.FRONT_FACE=2886]="FRONT_FACE",o[o.DEPTH_RANGE=2928]="DEPTH_RANGE",o[o.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",o[o.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",o[o.DEPTH_FUNC=2932]="DEPTH_FUNC",o[o.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",o[o.STENCIL_FUNC=2962]="STENCIL_FUNC",o[o.STENCIL_FAIL=2964]="STENCIL_FAIL",o[o.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",o[o.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",o[o.STENCIL_REF=2967]="STENCIL_REF",o[o.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",o[o.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",o[o.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",o[o.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",o[o.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",o[o.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",o[o.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",o[o.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",o[o.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",o[o.VIEWPORT=2978]="VIEWPORT",o[o.SCISSOR_BOX=3088]="SCISSOR_BOX",o[o.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",o[o.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",o[o.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",o[o.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",o[o.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",o[o.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",o[o.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",o[o.RED_BITS=3410]="RED_BITS",o[o.GREEN_BITS=3411]="GREEN_BITS",o[o.BLUE_BITS=3412]="BLUE_BITS",o[o.ALPHA_BITS=3413]="ALPHA_BITS",o[o.DEPTH_BITS=3414]="DEPTH_BITS",o[o.STENCIL_BITS=3415]="STENCIL_BITS",o[o.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",o[o.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",o[o.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",o[o.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",o[o.SAMPLES=32937]="SAMPLES",o[o.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",o[o.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",o[o.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",o[o.DONT_CARE=4352]="DONT_CARE",o[o.FASTEST=4353]="FASTEST",o[o.NICEST=4354]="NICEST",o[o.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",o[o.BYTE=5120]="BYTE",o[o.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",o[o.SHORT=5122]="SHORT",o[o.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",o[o.INT=5124]="INT",o[o.UNSIGNED_INT=5125]="UNSIGNED_INT",o[o.FLOAT=5126]="FLOAT",o[o.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",o[o.ALPHA=6406]="ALPHA",o[o.RGB=6407]="RGB",o[o.RGBA=6408]="RGBA",o[o.LUMINANCE=6409]="LUMINANCE",o[o.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",o[o.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",o[o.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",o[o.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",o[o.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",o[o.VERTEX_SHADER=35633]="VERTEX_SHADER",o[o.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",o[o.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",o[o.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",o[o.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",o[o.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",o[o.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",o[o.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",o[o.SHADER_TYPE=35663]="SHADER_TYPE",o[o.DELETE_STATUS=35712]="DELETE_STATUS",o[o.LINK_STATUS=35714]="LINK_STATUS",o[o.VALIDATE_STATUS=35715]="VALIDATE_STATUS",o[o.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",o[o.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",o[o.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",o[o.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",o[o.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",o[o.NEVER=512]="NEVER",o[o.LESS=513]="LESS",o[o.EQUAL=514]="EQUAL",o[o.LEQUAL=515]="LEQUAL",o[o.GREATER=516]="GREATER",o[o.NOTEQUAL=517]="NOTEQUAL",o[o.GEQUAL=518]="GEQUAL",o[o.ALWAYS=519]="ALWAYS",o[o.KEEP=7680]="KEEP",o[o.REPLACE=7681]="REPLACE",o[o.INCR=7682]="INCR",o[o.DECR=7683]="DECR",o[o.INVERT=5386]="INVERT",o[o.INCR_WRAP=34055]="INCR_WRAP",o[o.DECR_WRAP=34056]="DECR_WRAP",o[o.VENDOR=7936]="VENDOR",o[o.RENDERER=7937]="RENDERER",o[o.VERSION=7938]="VERSION",o[o.NEAREST=9728]="NEAREST",o[o.LINEAR=9729]="LINEAR",o[o.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",o[o.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",o[o.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",o[o.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",o[o.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",o[o.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",o[o.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",o[o.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",o[o.TEXTURE_2D=3553]="TEXTURE_2D",o[o.TEXTURE=5890]="TEXTURE",o[o.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",o[o.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",o[o.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",o[o.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",o[o.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",o[o.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",o[o.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",o[o.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",o[o.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",o[o.TEXTURE0=33984]="TEXTURE0",o[o.TEXTURE1=33985]="TEXTURE1",o[o.TEXTURE2=33986]="TEXTURE2",o[o.TEXTURE3=33987]="TEXTURE3",o[o.TEXTURE4=33988]="TEXTURE4",o[o.TEXTURE5=33989]="TEXTURE5",o[o.TEXTURE6=33990]="TEXTURE6",o[o.TEXTURE7=33991]="TEXTURE7",o[o.TEXTURE8=33992]="TEXTURE8",o[o.TEXTURE9=33993]="TEXTURE9",o[o.TEXTURE10=33994]="TEXTURE10",o[o.TEXTURE11=33995]="TEXTURE11",o[o.TEXTURE12=33996]="TEXTURE12",o[o.TEXTURE13=33997]="TEXTURE13",o[o.TEXTURE14=33998]="TEXTURE14",o[o.TEXTURE15=33999]="TEXTURE15",o[o.TEXTURE16=34e3]="TEXTURE16",o[o.TEXTURE17=34001]="TEXTURE17",o[o.TEXTURE18=34002]="TEXTURE18",o[o.TEXTURE19=34003]="TEXTURE19",o[o.TEXTURE20=34004]="TEXTURE20",o[o.TEXTURE21=34005]="TEXTURE21",o[o.TEXTURE22=34006]="TEXTURE22",o[o.TEXTURE23=34007]="TEXTURE23",o[o.TEXTURE24=34008]="TEXTURE24",o[o.TEXTURE25=34009]="TEXTURE25",o[o.TEXTURE26=34010]="TEXTURE26",o[o.TEXTURE27=34011]="TEXTURE27",o[o.TEXTURE28=34012]="TEXTURE28",o[o.TEXTURE29=34013]="TEXTURE29",o[o.TEXTURE30=34014]="TEXTURE30",o[o.TEXTURE31=34015]="TEXTURE31",o[o.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",o[o.REPEAT=10497]="REPEAT",o[o.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",o[o.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",o[o.FLOAT_VEC2=35664]="FLOAT_VEC2",o[o.FLOAT_VEC3=35665]="FLOAT_VEC3",o[o.FLOAT_VEC4=35666]="FLOAT_VEC4",o[o.INT_VEC2=35667]="INT_VEC2",o[o.INT_VEC3=35668]="INT_VEC3",o[o.INT_VEC4=35669]="INT_VEC4",o[o.BOOL=35670]="BOOL",o[o.BOOL_VEC2=35671]="BOOL_VEC2",o[o.BOOL_VEC3=35672]="BOOL_VEC3",o[o.BOOL_VEC4=35673]="BOOL_VEC4",o[o.FLOAT_MAT2=35674]="FLOAT_MAT2",o[o.FLOAT_MAT3=35675]="FLOAT_MAT3",o[o.FLOAT_MAT4=35676]="FLOAT_MAT4",o[o.SAMPLER_2D=35678]="SAMPLER_2D",o[o.SAMPLER_CUBE=35680]="SAMPLER_CUBE",o[o.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",o[o.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",o[o.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",o[o.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",o[o.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",o[o.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",o[o.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",o[o.COMPILE_STATUS=35713]="COMPILE_STATUS",o[o.LOW_FLOAT=36336]="LOW_FLOAT",o[o.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",o[o.HIGH_FLOAT=36338]="HIGH_FLOAT",o[o.LOW_INT=36339]="LOW_INT",o[o.MEDIUM_INT=36340]="MEDIUM_INT",o[o.HIGH_INT=36341]="HIGH_INT",o[o.FRAMEBUFFER=36160]="FRAMEBUFFER",o[o.RENDERBUFFER=36161]="RENDERBUFFER",o[o.RGBA4=32854]="RGBA4",o[o.RGB5_A1=32855]="RGB5_A1",o[o.RGB565=36194]="RGB565",o[o.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",o[o.STENCIL_INDEX=6401]="STENCIL_INDEX",o[o.STENCIL_INDEX8=36168]="STENCIL_INDEX8",o[o.DEPTH_STENCIL=34041]="DEPTH_STENCIL",o[o.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",o[o.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",o[o.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",o[o.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",o[o.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",o[o.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",o[o.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",o[o.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",o[o.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",o[o.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",o[o.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",o[o.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",o[o.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",o[o.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",o[o.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",o[o.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",o[o.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",o[o.NONE=0]="NONE",o[o.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",o[o.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",o[o.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",o[o.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",o[o.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",o[o.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",o[o.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",o[o.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",o[o.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",o[o.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",o[o.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",o[o.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",o[o.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",o[o.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",o[o.COPY_SRC=1]="COPY_SRC",o[o.COPY_DST=2]="COPY_DST",o[o.SAMPLED=4]="SAMPLED",o[o.STORAGE=8]="STORAGE",o[o.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT";var Qh=(vi=(0,Ch.b2)(),e=(0,Ch.f3)(_h.GeometryComponentManager),fi=(0,Ch.f3)(_h.RenderEngine),vi((Kh=(0,r.Z)((me=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"geometry",Kh,this),(0,ph.Z)(this,"engine",Jh,this)}var e;return(0,vh.Z)(t,[{key:"execute",value:(e=(0,mh.Z)(yh().mark(function t(){var n=this;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.geometry.forEach(function(t,e){e.dirty&&(e.attributes.forEach(function(t){var e;t.dirty&&t.data&&(t.buffer?null!==(e=t.buffer)&&void 0!==e&&e.subData({data:t.data,offset:0}):t.buffer=n.engine.createBuffer({data:t.data,type:qh.FLOAT}),t.dirty=!1)}),e.indices&&(e.indicesBuffer?e.indicesBuffer.subData({data:e.indices,offset:0}):e.indicesBuffer=n.engine.createElements({data:e.indices,count:e.indices.length,type:qh.UNSIGNED_INT,usage:qh.STATIC_DRAW})),e.dirty=!1)});case 1:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.geometry.forEach(function(t,e){e.indicesBuffer&&e.indicesBuffer.destroy(),e.attributes.forEach(function(t){t.buffer&&t.buffer.destroy()})}),this.geometry.clear()}},{key:"createBufferGeometry",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{vertexCount:3}).vertexCount,e=xh++;return this.geometry.create(e,{vertexCount:t})}},{key:"createInstancedBufferGeometry",value:function(t){var e=t.maxInstancedCount,n=t.vertexCount,t=xh++;return this.geometry.create(t,{maxInstancedCount:e,vertexCount:n})}}]),t}()).prototype,"geometry",[e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jh=(0,r.Z)(me.prototype,"engine",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ee=me))||Ee);function $h(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function tl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$h(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function el(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var nl,il,rl,tn=function(){(0,Ih.Z)(i,bh);var n=el(i);function i(t){var e;return(0,gh.Z)(this,i),(e=n.call(this,t)).vertexShaderGLSL=void 0,e.fragmentShaderGLSL=void 0,e.defines={},e.dirty=!0,e.uniforms=[],e.cull={enable:!0,face:qh.BACK},e.depth={enable:!0},e.blend=void 0,e.entity=void 0,e.type=void 0,Object.assign((0,Uh.Z)(e),t),e}return(0,vh.Z)(i,[{key:"setDefines",value:function(t){return this.defines=tl(tl({},this.defines),t),this}},{key:"setCull",value:function(t){return this.cull=t,this}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"setBlend",value:function(t){return this.blend=t,this}},{key:"setUniform",value:function(e,t){var n=this;if("string"!=typeof e)return Object.keys(e).forEach(function(t){return n.setUniform(t,e[t])}),this;var i=this.uniforms.find(function(t){return t.name===e});return i?(i.dirty=!0,i.data=t):this.uniforms.push({name:e,dirty:!0,data:t}),this.dirty=!0,this}}]),i}();function ol(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function al(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ol(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ol(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var sl,ul=(Pn=(0,Ch.b2)(),pe=(0,Ch.f3)(_h.MaterialComponentManager),a=(0,Ch.f3)(_h.RenderEngine),s=(0,Ch.f3)(_h.ShaderModuleService),Pn((nl=(0,r.Z)((u=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"material",nl,this),(0,ph.Z)(this,"engine",il,this),(0,ph.Z)(this,"shaderModule",rl,this)}var e;return(0,vh.Z)(t,[{key:"execute",value:(e=(0,mh.Z)(yh().mark(function t(){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)})),function(){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.material.clear()}},{key:"createShaderMaterial",value:function(t){var e,n,i=xh++,r=t.vertexShader,o=t.fragmentShader,a=[];return this.engine.supportWebGPU||(e="material-".concat(i),this.shaderModule.registerModule(e,{vs:t.vertexShader,fs:t.fragmentShader}),r=(n=this.shaderModule.getModule(e)).vs,o=n.fs,n.uniforms&&(a=Object.keys(n.uniforms).map(function(t){return{dirty:!0,name:t,data:n.uniforms[t]}}))),this.material.create(i,al(al({vertexShaderGLSL:r,fragmentShaderGLSL:o},t),{},{uniforms:a}))}}]),t}()).prototype,"material",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il=(0,r.Z)(u.prototype,"engine",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rl=(0,r.Z)(u.prototype,"shaderModule",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=u))||C);function cl(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}(Ct=sl=sl||{})[Ct.Standard=0]="Standard";var mt=function(){(0,Ih.Z)(i,bh);var n=cl(i);function i(t){var e;return(0,gh.Z)(this,i),(e=n.call(this,t)).strategy=sl.Standard,e.visibilityPlaneMask=0,e.visible=!1,Object.assign((0,Uh.Z)(e),t),e}return i}(),hl=function(){function n(t,e){(0,gh.Z)(this,n),this.center=void 0,this.halfExtents=void 0,this.min=At.Ue(),this.max=At.Ue(),this.update(t,e)}return(0,vh.Z)(n,[{key:"update",value:function(t,e){this.center=t||At.Ue(),this.halfExtents=e||At.al(.5,.5,.5),this.min=At.lu(this.min,this.center,this.halfExtents),this.max=At.IH(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(t,e){At.IH(this.center,e,t),At.bA(this.center,this.center,.5),At.lu(this.halfExtents,e,t),At.bA(this.halfExtents,this.halfExtents,.5),At.JG(this.min,t),At.JG(this.max,e)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){var e=this.center,n=e[0],i=e[1],r=e[2],o=this.halfExtents,a=o[0],s=o[1],u=o[2],c=n-a,h=n+a,l=i-s,d=i+s,f=r-u,p=r+u,n=t.center,a=n[0],i=n[1],s=n[2],r=t.halfExtents,u=r[0],n=r[1],t=r[2],r=a-u,a=a+u,u=i-n,i=i+n,n=s-t,t=s+t;u<l&&(l=u),d<i&&(d=i),n<f&&(f=n),p<t&&(p=t),e[0]=.5*((c=r<c?r:c)+(h=h<a?a:h)),e[1]=.5*(l+d),e[2]=.5*(f+p),o[0]=.5*(h-c),o[1]=.5*(d-l),o[2]=.5*(p-f),this.min[0]=c,this.min[1]=l,this.min[2]=f,this.max[0]=h,this.max[1]=d,this.max[2]=p}},{key:"intersects",value:function(t){var e=this.getMax(),n=this.getMin(),i=t.getMax(),t=t.getMin();return n[0]<=i[0]&&e[0]>=t[0]&&n[1]<=i[1]&&e[1]>=t[1]&&n[2]<=i[2]&&e[2]>=t[2]}},{key:"containsPoint",value:function(t){var e=this.getMin(),n=this.getMax();return!(t[0]<e[0]||t[0]>n[0]||t[1]<e[1]||t[1]>n[1]||t[2]<e[2]||t[2]>n[2])}},{key:"getNegativeFarPoint",value:function(t){return 273===t.pnVertexFlag?At.JG(At.Ue(),this.min):272===t.pnVertexFlag?At.al(this.min[0],this.min[1],this.max[2]):257===t.pnVertexFlag?At.al(this.min[0],this.max[1],this.min[2]):256===t.pnVertexFlag?At.al(this.min[0],this.max[1],this.max[2]):17===t.pnVertexFlag?At.al(this.max[0],this.min[1],this.min[2]):16===t.pnVertexFlag?At.al(this.max[0],this.min[1],this.max[2]):1===t.pnVertexFlag?At.al(this.max[0],this.max[1],this.min[2]):At.al(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(t){return 273===t.pnVertexFlag?At.JG(At.Ue(),this.max):272===t.pnVertexFlag?At.al(this.max[0],this.max[1],this.min[2]):257===t.pnVertexFlag?At.al(this.max[0],this.min[1],this.max[2]):256===t.pnVertexFlag?At.al(this.max[0],this.min[1],this.min[2]):17===t.pnVertexFlag?At.al(this.min[0],this.max[1],this.max[2]):16===t.pnVertexFlag?At.al(this.min[0],this.max[1],this.min[2]):1===t.pnVertexFlag?At.al(this.min[0],this.min[1],this.max[2]):At.al(this.min[0],this.min[1],this.min[2])}}]),n}();function ll(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var dl,o=function(){(0,Ih.Z)(i,bh);var n=ll(i);function i(t){var e;return(0,gh.Z)(this,i),(e=n.call(this,t)).material=void 0,e.geometry=void 0,e.aabb=new hl,e.aabbDirty=!0,e.model=void 0,e.visible=!0,e.children=[],Object.assign((0,Uh.Z)(e),t),e}return i}(),fl=function(){function n(t,e){(0,gh.Z)(this,n),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=t||0,this.normal=e||At.al(0,1,0),this.updatePNVertexFlag()}return(0,vh.Z)(n,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(0<=this.normal[0])<<8)+(Number(0<=this.normal[1])<<4)+Number(0<=this.normal[2])}},{key:"distanceToPoint",value:function(t){return At.AK(t,this.normal)-this.distance}},{key:"normalize",value:function(){var t=1/At.Zh(this.normal);At.bA(this.normal,this.normal,t),this.distance*=t}},{key:"intersectsLine",value:function(t,e,n){var i=this.distanceToPoint(t),r=i/(i-this.distanceToPoint(e)),i=0<=r&&r<=1;return i&&n&&At.t7(n,t,e,r),i}}]),n}();(vi=dl=dl||{})[vi.OUTSIDE=4294967295]="OUTSIDE",vi[vi.INSIDE=0]="INSIDE",vi[vi.INDETERMINATE=2147483647]="INDETERMINATE";var pl,gl,vl,yl,ml,xl=function(){function n(t){if((0,gh.Z)(this,n),this.planes=[],t)this.planes=t;else for(var e=0;e<6;e++)this.planes.push(new fl)}return(0,vh.Z)(n,[{key:"extractFromVPMatrix",value:function(t){var e=(0,kh.Z)(t,16),n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],d=e[10],f=e[11],p=e[12],g=e[13],t=e[14],e=e[15];At.t8(this.planes[0].normal,o-n,c-a,f-h),this.planes[0].distance=-(e-p),At.t8(this.planes[1].normal,o+n,c+a,f+h),this.planes[1].distance=-(e+p),At.t8(this.planes[2].normal,o+i,c+s,f+l),this.planes[2].distance=-(e+g),At.t8(this.planes[3].normal,o-i,c-s,f-l),this.planes[3].distance=-(e-g),At.t8(this.planes[4].normal,o-r,c-u,f-d),this.planes[4].distance=-(e-t),At.t8(this.planes[5].normal,o+r,c+u,f+d),this.planes[5].distance=-(e+t),this.planes.forEach(function(t){t.normalize(),t.updatePNVertexFlag()})}}]),n}();function bl(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return El(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?El(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,e=function(){};return{s:e,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}function El(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Sl,wl,kl,Cl,_l,Ml,Il,Tl,Al,Pl=(e=(0,Ch.b2)(),fi=(0,Ch.f3)(_h.MeshComponentManager),me=(0,Ch.f3)(_h.CullableComponentManager),Ee=(0,Ch.f3)(_h.GeometryComponentManager),Pn=(0,Ch.f3)(_h.HierarchyComponentManager),pe=(0,Ch.f3)(_h.TransformComponentManager),e((pl=(0,r.Z)((a=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"mesh",pl,this),(0,ph.Z)(this,"cullable",gl,this),(0,ph.Z)(this,"geometry",vl,this),(0,ph.Z)(this,"hierarchy",yl,this),(0,ph.Z)(this,"transform",ml,this),this.planes=void 0}var e;return(0,vh.Z)(t,[{key:"setFrustumPlanes",value:function(t){this.planes=t}},{key:"execute",value:(e=(0,mh.Z)(yh().mark(function t(i){var r,o,a,s,u,c,h,l,d,f,p,g,v,y,m,x,b,E,S,w,k;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=bl(i);try{for(r.s();!(o=r.n()).done;){a=o.value,s=a.getScene(),u=a.getCamera(),c=bl(s.getEntities());try{for(c.s();!(h=c.n()).done;)l=h.value,(d=this.mesh.getComponentByEntity(l))&&(f=this.hierarchy.getComponentByEntity(l),p=this.cullable.getComponentByEntity(l),g=d.geometry,v=this.transform.getComponentByEntity(l),g&&g.aabb&&v&&d.aabbDirty&&(y=v.worldTransform,m=g.aabb,x=m.center,b=m.halfExtents,E=At.fF(At.Ue(),x,y),e=y,(n=_t.create())[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],S=n,w=At.kK(At.Ue(),b,S),d.aabb.update(E,w),d.aabbDirty=!1),p&&g&&(k=this.cullable.getComponentByEntity((null==f?void 0:f.parentID)||-1),p.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(d.aabb,(null==k?void 0:k.visibilityPlaneMask)||dl.INDETERMINATE,this.planes||u.getFrustum().planes),p.visible=p.visibilityPlaneMask!==dl.OUTSIDE))}catch(t){c.e(t)}finally{c.f()}}}catch(t){r.e(t)}finally{r.f()}case 2:case"end":return t.stop()}var e,n},t,this)})),function(t){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"computeVisibilityWithPlaneMask",value:function(t,e,n){if(e===dl.OUTSIDE||e===dl.INSIDE)return e;for(var i=dl.INSIDE,r=0,o=n.length;r<o;++r){var a=r<31?1<<r:0;if(!(r<31&&0==(e&a))){var s=n[r],u=s.normal,s=s.distance;if(0<At.AK(u,t.getNegativeFarPoint(n[r]))+s)return dl.OUTSIDE;0<At.AK(u,t.getPositiveFarPoint(n[r]))+s&&(i|=a)}}return i}}]),t}()).prototype,"mesh",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gl=(0,r.Z)(a.prototype,"cullable",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vl=(0,r.Z)(a.prototype,"geometry",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yl=(0,r.Z)(a.prototype,"hierarchy",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ml=(0,r.Z)(a.prototype,"transform",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s=a))||s),Dl=n(85975);function Nl(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ol(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ol(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,e=function(){};return{s:e,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}function Ol(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Ll,Rl,Bl,Gl,Ul=(u=(0,Ch.b2)(),C=(0,Ch.f3)(_h.MeshComponentManager),Ct=(0,Ch.f3)(_h.GeometryComponentManager),vi=(0,Ch.f3)(_h.MaterialComponentManager),e=(0,Ch.f3)(_h.CullableComponentManager),fi=(0,Ch.f3)(_h.TransformComponentManager),me=(0,Ch.f3)(_h.HierarchyComponentManager),Ee=(0,Ch.f3)(_h.Systems),Pn=(0,Ch.t6)(_h.FrameGraphSystem),pe=(0,Ch.f3)(_h.RenderEngine),a=(0,Ch.f3)(_h.ResourcePool),u((u=s=function(){function t(){var u=this;(0,gh.Z)(this,t),(0,ph.Z)(this,"mesh",Sl,this),(0,ph.Z)(this,"geometry",wl,this),(0,ph.Z)(this,"material",kl,this),(0,ph.Z)(this,"cullable",Cl,this),(0,ph.Z)(this,"transform",_l,this),(0,ph.Z)(this,"hierarchy",Ml,this),(0,ph.Z)(this,"frameGraphSystem",Il,this),(0,ph.Z)(this,"engine",Tl,this),(0,ph.Z)(this,"resourcePool",Al,this),this.modelCache={},this.setup=function(t,e,n){var i=t.createRenderTarget(e,"color buffer",{width:1,height:1,usage:qh.RENDER_ATTACHMENT|qh.SAMPLED|qh.COPY_SRC});n.data={output:e.write(t,i)}},this.execute=function(){var i=(0,mh.Z)(yh().mark(function t(e,n,i){var r,o,a,s;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=e.getResourceNode(n.data.output),r=u.resourcePool.getOrCreateResource(a.resource),o=Nl(i),t.prev=3,o.s();case 5:if((a=o.n()).done){t.next=11;break}return s=a.value,t.next=9,u.initView(s);case 9:t.next=5;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),o.e(t.t0);case 16:return t.prev=16,o.f(),t.finish(16);case 19:s=u.engine.getCanvas(),r.resize({width:s.width,height:s.height}),u.engine.setScissor({enable:!1}),u.engine.clear({framebuffer:r,color:i[0].getClearColor(),depth:1}),u.engine.useFramebuffer(r,function(){var t,e=Nl(i);try{for(e.s();!(t=e.n()).done;){var n=t.value;u.renderView(n)}}catch(t){e.e(t)}finally{e.f()}});case 24:case"end":return t.stop()}},t,null,[[3,13,16,19]])}));return function(t,e,n){return i.apply(this,arguments)}}()}var e,n;return(0,vh.Z)(t,[{key:"renderView",value:function(t){var e=t.getScene(),n=t.getCamera(),i=n.getViewTransform(),r=Dl.Jp(Dl.Ue(),n.getPerspective(),i);n.getFrustum().extractFromVPMatrix(r);var o=t.getViewport(),a=o.x,s=o.y,r=o.width,o=o.height;this.engine.viewport({x:a,y:s,width:r,height:o});var u,c=Nl(e.getEntities());try{for(c.s();!(u=c.n()).done;){var h=u.value;this.renderMesh(h,{camera:n,view:t,viewMatrix:i})}}catch(t){c.e(t)}finally{c.f()}}},{key:"renderMesh",value:function(t,e){var n,i,r=e.camera,o=e.view,a=e.viewMatrix,s=this.mesh.getComponentByEntity(t);s&&s.visible&&(n=s.material,(i=s.geometry)&&!i.dirty&&n&&(e=this.transform.getComponentByEntity(t),i=Dl.Jp(Dl.Ue(),a,e.worldTransform),o=(t=o.getViewport()).width,t=t.height,n.setUniform({projectionMatrix:r.getPerspective(),modelViewMatrix:i,modelMatrix:e.worldTransform,viewMatrix:a,cameraPosition:r.getPosition(),u_viewport:[o,t]}),s.model&&(s.model.draw({uniforms:n.uniforms.reduce(function(t,e){return t[e.name]=e.data,t},{})}),n.uniforms.forEach(function(t){t.dirty=!1}),n.dirty=!1)))}},{key:"initMesh",value:(n=(0,mh.Z)(yh().mark(function t(e,n){var i,r,o,a,s,u,c;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.mesh.getComponentByEntity(e)){t.next=3;break}return t.abrupt("return");case 3:if(r=i.material,(o=i.geometry)&&!o.dirty&&r){t.next=7;break}return t.abrupt("return");case 7:if(i.model){t.next=24;break}if(a="m-".concat(r.entity,"-g-").concat(o.entity),this.modelCache[a])return i.model=this.modelCache[a],t.abrupt("return");t.next=12;break;case 12:return r.setUniform({projectionMatrix:1,modelViewMatrix:1,modelMatrix:1,viewMatrix:1,cameraPosition:1,u_viewport:1}),c=this.engine,s=c.createModel,u=c.createAttribute,c={vs:r.vertexShaderGLSL,fs:r.fragmentShaderGLSL,defines:r.defines,attributes:o.attributes.reduce(function(t,e){return e.data&&e.buffer&&(t[e.name]=u({buffer:e.buffer,attributes:e.attributes,arrayStride:e.arrayStride,stepMode:e.stepMode,divisor:"vertex"===e.stepMode?0:1})),t},{}),uniforms:r.uniforms.reduce(function(t,e){return t[e.name]=e.data,t},{}),scissor:{enable:!0,box:function(){return n.getViewport()}}},r.cull&&(c.cull=r.cull),r.depth&&(c.depth=r.depth),r.blend&&(c.blend=r.blend),o.indicesBuffer&&(c.elements=o.indicesBuffer),o.maxInstancedCount&&(c.instances=o.maxInstancedCount,c.count=o.vertexCount||3),t.next=22,s(c);case 22:i.model=t.sent,this.modelCache[a]=i.model;case 24:case"end":return t.stop()}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"initView",value:(e=(0,mh.Z)(yh().mark(function t(e){var n,i;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=e.getScene(),n=Nl(i.getEntities()),t.prev=2,n.s();case 4:if((i=n.n()).done){t.next=10;break}return i=i.value,t.next=8,this.initMesh(i,e);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),n.e(t.t0);case 15:return t.prev=15,n.f(),t.finish(15);case 18:case"end":return t.stop()}},t,this,[[2,12,15,18]])})),function(t){return e.apply(this,arguments)})}]),t}(),s.IDENTIFIER="Render Pass",Sl=(0,r.Z)((u=u).prototype,"mesh",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=(0,r.Z)(u.prototype,"geometry",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kl=(0,r.Z)(u.prototype,"material",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cl=(0,r.Z)(u.prototype,"cullable",[e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=(0,r.Z)(u.prototype,"transform",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml=(0,r.Z)(u.prototype,"hierarchy",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Il=(0,r.Z)(u.prototype,"frameGraphSystem",[Ee,Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tl=(0,r.Z)(u.prototype,"engine",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Al=(0,r.Z)(u.prototype,"resourcePool",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=u))||me);function Fl(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return zl(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zl(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,e=function(){};return{s:e,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}function zl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var jl,Wl,Xl,Zl,Vl,Yl,Hl={NONE:0,ENCODE:1,HIGHLIGHT:2},ql=(Ee=(0,Ch.b2)(),Pn=(0,Ch.f3)(_h.RenderEngine),pe=(0,Ch.f3)(_h.ResourcePool),a=(0,Ch.f3)(_h.RenderPassFactory),u=(0,Ch.f3)(_h.MeshComponentManager),Ee((Ee=me=function(){function t(){var l=this;(0,gh.Z)(this,t),(0,ph.Z)(this,"engine",Ll,this),(0,ph.Z)(this,"resourcePool",Rl,this),(0,ph.Z)(this,"renderPassFactory",Bl,this),(0,ph.Z)(this,"mesh",Gl,this),this.pickingFBO=void 0,this.views=void 0,this.highlightEnabled=!0,this.highlightColor=[255,0,0,255],this.alreadyInRendering=!1,this.setup=function(t,e,n){var i=t.createRenderTarget(e,"picking fbo",{width:1,height:1});n.data={output:e.write(t,i)},e.hasSideEffect=!0},this.execute=function(){var i=(0,mh.Z)(yh().mark(function t(i,r,e){var n,o,a;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(l.views=e,l.alreadyInRendering)return t.abrupt("return");t.next=3;break;case 3:n=Fl(e);try{for(a=function(){var a=o.value,t=a.getViewport(),e=t.width,n=t.height;l.alreadyInRendering=!0;t=i.getResourceNode(r.data.output);l.pickingFBO=l.resourcePool.getOrCreateResource(t.resource),l.pickingFBO.resize({width:e,height:n}),l.engine.useFramebuffer(l.pickingFBO,function(){l.engine.clear({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var t,e=l.renderPassFactory(Ul.IDENTIFIER),n=[],i=Fl(a.getScene().getEntities());try{for(i.s();!(t=i.n()).done;){var r=t.value,o=l.mesh.getComponentByEntity(r);o.material.setUniform("u_PickingStage",Hl.ENCODE),n.push(o)}}catch(t){i.e(t)}finally{i.f()}e.renderView(a),n.forEach(function(t){t.material.setUniform("u_PickingStage",Hl.HIGHLIGHT)}),l.alreadyInRendering=!1})},n.s();!(o=n.n()).done;)a()}catch(t){n.e(t)}finally{n.f()}case 5:case"end":return t.stop()}},t)}));return function(t,e,n){return i.apply(this,arguments)}}(),this.pick=function(t,e){var n,i,r=t.x,o=t.y,a=l.engine,s=a.readPixels,u=a.useFramebuffer,t=e.getViewport(),a=t.width,c=t.height,h=r*window.devicePixelRatio,r=o*window.devicePixelRatio;if(!(a<h||h<0||c<r||r<0))return u(l.pickingFBO,function(){var t;0===(n=s({x:Math.round(h),y:Math.round(c-(o+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(4),framebuffer:l.pickingFBO}))[0]&&0===n[1]&&0===n[2]||(t=n,i=(t=(0,kh.Z)(t,3))[0]+256*t[1]+65536*t[2]-1,l.highlightEnabled&&l.highlightPickedFeature(n,e))}),i}}return(0,vh.Z)(t,[{key:"enableHighlight",value:function(t){this.highlightEnabled=t}},{key:"setHighlightColor",value:function(t){this.highlightColor=t}},{key:"highlightPickedFeature",value:function(t,e){if(t){var n,i=Fl(e.getScene().getEntities());try{for(i.s();!(n=i.n()).done;){var r=n.value,o=this.mesh.getComponentByEntity(r).material;o.setUniform("u_PickingStage",Hl.HIGHLIGHT),o.setUniform("u_PickingColor",[t[0],t[1],t[2]]),o.setUniform("u_HighlightColor",this.highlightColor)}}catch(t){i.e(t)}finally{i.f()}}}}]),t}(),me.IDENTIFIER="PixelPicking Pass",Ll=(0,r.Z)((me=Ee).prototype,"engine",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rl=(0,r.Z)(me.prototype,"resourcePool",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bl=(0,r.Z)(me.prototype,"renderPassFactory",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gl=(0,r.Z)(me.prototype,"mesh",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ee=me))||Ee),Kl=(Pn=(0,Ch.b2)(),pe=(0,Ch.f3)(_h.RenderEngine),a=(0,Ch.f3)(_h.ResourcePool),Pn((me=u=function t(){var u=this;(0,gh.Z)(this,t),(0,ph.Z)(this,"engine",jl,this),(0,ph.Z)(this,"resourcePool",Wl,this),this.model=void 0,this.setup=function(t,e,n){var i,r=t.getPass(Ul.IDENTIFIER);r&&(i=t.createRenderTarget(e,"render to screen",{width:1,height:1}),n.data={input:e.read(r.data.output),output:e.write(t,i)})},this.execute=function(){var n=(0,mh.Z)(yh().mark(function t(e,n){var i,r,o,a,s;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=u.engine,i=o.createModel,r=o.createAttribute,o=o.createBuffer,u.model){t.next=6;break}return t.next=4,i({vs:u.engine.supportWebGPU?"layout(location = 0) in vec2 a_Position;\nlayout(location = 0) out vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}":"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:u.engine.supportWebGPU?"layout(set = 0, binding = 0) uniform sampler u_TextureSampler;\nlayout(set = 0, binding = 1) uniform texture2D u_Texture;\n\nlayout(location = 0) in vec2 v_UV;\nlayout(location = 0) out vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler2D(u_Texture, u_TextureSampler), v_UV);\n}":"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",attributes:{a_Position:r({buffer:o({data:[-4,-4,4,-4,0,4],type:qh.FLOAT}),size:2,arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})},uniforms:{u_Texture:null},depth:{enable:!1},count:3,blend:{enable:!0}});case 4:a=t.sent,u.model=a;case 6:a=e.getResourceNode(n.data.input),s=u.resourcePool.getOrCreateResource(a.resource),u.engine.useFramebuffer(null,function(){u.engine.clear({framebuffer:null,color:[0,0,0,0],depth:1,stencil:0}),u.model.draw({uniforms:{u_Texture:s}})});case 9:case"end":return t.stop()}},t)}));return function(t,e){return n.apply(this,arguments)}}(),this.tearDown=function(){u.model=void 0}},u.IDENTIFIER="Copy Pass",jl=(0,r.Z)((Ee=me).prototype,"engine",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=(0,r.Z)(Ee.prototype,"resourcePool",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn=Ee))||Pn),Jl=(u=(0,Ch.b2)(),me=(0,Ch.f3)(_h.Systems),pe=(0,Ch.t6)(_h.FrameGraphSystem),a=(0,Ch.f3)(_h.RenderPassFactory),Ee=(0,Ch.f3)(_h.ConfigService),Pn=(0,Ch.f3)(_h.ResourcePool),u((Xl=(0,r.Z)((u=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"frameGraphSystem",Xl,this),(0,ph.Z)(this,"renderPassFactory",Zl,this),(0,ph.Z)(this,"configService",Vl,this),(0,ph.Z)(this,"resourcePool",Yl,this)}var e;return(0,vh.Z)(t,[{key:"execute",value:(e=(0,mh.Z)(yh().mark(function t(e){var n,i,r;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=this.renderPassFactory(Ul.IDENTIFIER),n=r.setup,i=r.execute,this.frameGraphSystem.addPass(Ul.IDENTIFIER,n,i),r=this.renderPassFactory(Kl.IDENTIFIER),n=r.setup,i=r.execute,r=r.tearDown,r=this.frameGraphSystem.addPass(Kl.IDENTIFIER,n,i,r),this.frameGraphSystem.present(r.data.output);case 5:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.resourcePool.clean()}},{key:"pick",value:function(t,e){return this.renderPassFactory(ql.IDENTIFIER).pick(t,e)}}]),t}()).prototype,"frameGraphSystem",[me,pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl=(0,r.Z)(u.prototype,"renderPassFactory",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=(0,r.Z)(u.prototype,"configService",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yl=(0,r.Z)(u.prototype,"resourcePool",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=u))||me);function Ql(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var $l,td,ed,pe=function(){(0,Ih.Z)(i,bh);var n=Ql(i);function i(t){var e;return(0,gh.Z)(this,i),(e=n.call(this,t)).parentID=void 0,Object.assign((0,Uh.Z)(e),t),e}return i}(),nd=(a=(0,Ch.b2)(),Ee=(0,Ch.f3)(_h.HierarchyComponentManager),Pn=(0,Ch.f3)(_h.TransformComponentManager),u=(0,Ch.f3)(_h.MeshComponentManager),a(($l=(0,r.Z)((me=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"hierarchy",$l,this),(0,ph.Z)(this,"transform",td,this),(0,ph.Z)(this,"mesh",ed,this)}var e;return(0,vh.Z)(t,[{key:"execute",value:(e=(0,mh.Z)(yh().mark(function t(){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var n=this;this.transform.forEach(function(t,e){(e.isDirty()||e.isLocalDirty())&&(n.setMeshAABBDirty(n.mesh.getComponentByEntity(t)),e.updateTransform())})}},{key:"runHierarchyUpdateSystem",value:function(){var n=this;this.hierarchy.forEach(function(t,e){t=n.transform.getComponentByEntity(t),e=n.transform.getComponentByEntity(e.parentID);null!==t&&null!==e&&t.updateTransformWithParent(e)})}},{key:"attach",value:function(t,e,n){this.hierarchy.contains(t)&&this.detach(t),this.hierarchy.create(t,{parentID:e});var i=this.mesh.getComponentByEntity(e);if(this.setMeshAABBDirty(i),i&&-1===i.children.indexOf(t)&&i.children.push(t),1<this.hierarchy.getCount())for(var r=this.hierarchy.getCount()-1;0<r;--r)for(var o=this.hierarchy.getEntity(r),a=0;a<r;++a)if(this.hierarchy.getComponent(a).parentID===o){this.hierarchy.moveItem(r,a),++r;break}this.hierarchy.getComponentByEntity(t);var s=this.transform.getComponentByEntity(e);null===s&&(s=this.transform.create(e));i=this.transform.getComponentByEntity(t);null===i&&(i=this.transform.create(t),s=this.transform.getComponentByEntity(e)),i.parent=s,!n&&s&&(i.matrixTransform(Dl.U_(Dl.Ue(),s.worldTransform)),i.updateTransform()),s&&i.updateTransformWithParent(s)}},{key:"detach",value:function(t){var e,n=this.hierarchy.getComponentByEntity(t);null!==n&&(null!==(e=this.transform.getComponentByEntity(t))&&(e.parent=null,e.applyTransform()),this.hierarchy.removeKeepSorted(t),(n=this.mesh.getComponentByEntity(n.parentID))&&(t=n.children.indexOf(t),n.children.splice(t,1)),this.setMeshAABBDirty(n))}},{key:"detachChildren",value:function(t){var e=this.mesh.getComponentByEntity(t);e&&(e.children=[]);for(var n,i=0;i<this.hierarchy.getCount();)(null===(n=this.hierarchy.getComponent(i))||void 0===n?void 0:n.parentID)===t?(n=this.hierarchy.getEntity(i),this.detach(n)):++i}},{key:"setMeshAABBDirty",value:function(t){t&&(t.aabbDirty=!0)}}]),t}()).prototype,"hierarchy",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),td=(0,r.Z)(me.prototype,"transform",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed=(0,r.Z)(me.prototype,"mesh",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=me))||a),id=n(32945);function rd(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}Ee=function(){(0,Ih.Z)(y,bh);var v=rd(y);function y(t){var i,e,r,o,a,s,u,c,h,l,d,n,f,p,g;return(0,gh.Z)(this,y),(i=v.call(this,t)).dirtyFlag=void 0,i.localDirtyFlag=void 0,i.parent=null,i.localPosition=At.al(0,0,0),i.localRotation=id.al(0,0,0,1),i.localScale=At.al(1,1,1),i.localTransform=Dl.Ue(),i.position=At.al(0,0,0),i.rotation=id.al(0,0,0,1),i.scaling=At.al(1,1,1),i.worldTransform=Dl.Ue(),i.matrixTransform=(e=Dl.Ue(),function(t){Dl.Jp(e,i.getLocalTransform(),t),Dl.Q$(i.localScale,e),Dl.i0(i.localPosition,e),Dl.j6(i.localRotation,e)}),i.rotateRollPitchYaw=(r=id.Ue(),o=id.Ue(),a=id.Ue(),function(t,e,n){i.setDirty(),id.Su(r,t,0,0),id.Su(o,0,e,0),id.Su(a,0,0,n),id.Jp(i.localRotation,r,i.localRotation),id.Jp(i.localRotation,i.localRotation,o),id.Jp(i.localRotation,a,i.localRotation),id.Fv(i.localRotation,i.localRotation)}),i.lerp=(s=At.Ue(),u=id.Ue(),c=At.Ue(),h=At.Ue(),l=id.Ue(),d=At.Ue(),function(t,e,n){i.setDirty(),Dl.Q$(s,t.worldTransform),Dl.i0(c,t.worldTransform),Dl.j6(u,t.worldTransform),Dl.Q$(h,e.worldTransform),Dl.i0(d,e.worldTransform),Dl.j6(l,e.worldTransform),At.t7(i.localScale,s,h,n),id.ZA(i.localRotation,u,l,n),At.t7(i.localPosition,c,d,n)}),i.translate=(n=At.Ue(),function(t){return At.IH(n,i.getPosition(),t),i.setPosition(n),i.setDirty(!0),(0,Uh.Z)(i)}),i.translateLocal=function(t){return At.VC(t,t,i.localRotation),At.IH(i.localPosition,i.localPosition,t),i.setLocalDirty(!0),(0,Uh.Z)(i)},i.setPosition=(f=Dl.Ue(),function(t){return i.position=t,i.setLocalDirty(!0),null===i.parent?At.JG(i.localPosition,t):(Dl.JG(f,i.parent.worldTransform),Dl.U_(f,f),At.fF(i.localPosition,t,f)),(0,Uh.Z)(i)}),i.rotate=(p=id.Ue(),function(t){var e,n;return null===i.parent?id.Jp(i.localRotation,i.localRotation,t):(e=i.getRotation(),n=i.parent.getRotation(),id.JG(p,n),id.U_(p,p),id.Jp(p,p,t),id.Jp(i.localRotation,t,e)),id.Fv(i.localRotation,i.localRotation),i.setLocalDirty(),(0,Uh.Z)(i)}),i.rotateLocal=function(t){return id.Jp(i.localRotation,i.localRotation,t),id.Fv(i.localRotation,i.localRotation),i.setLocalDirty(!0),(0,Uh.Z)(i)},i.setRotation=(g=id.Ue(),function(t){return null===i.parent?id.JG(i.localRotation,t):(id.JG(g,i.parent.getRotation()),id.U_(g,g),id.JG(i.localRotation,g),id.dC(i.localRotation,i.localRotation,t)),i.setLocalDirty(!0),(0,Uh.Z)(i)}),i}return(0,vh.Z)(y,[{key:"setLocalPosition",value:function(t){At.JG(this.localPosition,t),this.setLocalDirty(!0)}},{key:"setLocalScale",value:function(t){At.JG(this.localScale,t),this.setLocalDirty(!0)}},{key:"setLocalRotation",value:function(t){return id.JG(this.localRotation,t),this.setLocalDirty(!0),this}},{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?this.dirtyFlag|=y.DIRTY:this.dirtyFlag&=~y.DIRTY}},{key:"isLocalDirty",value:function(){return this.localDirtyFlag}},{key:"setLocalDirty",value:function(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?(this.localDirtyFlag|=y.DIRTY,this.setDirty(!0)):this.localDirtyFlag&=~y.DIRTY}},{key:"updateTransform",value:function(){this.isLocalDirty()&&this.getLocalTransform(),this.isDirty()&&null===this.parent&&(Dl.JG(this.worldTransform,this.getLocalTransform()),this.setDirty(!1))}},{key:"updateTransformWithParent",value:function(t){Dl.Jp(this.worldTransform,t.worldTransform,this.getLocalTransform())}},{key:"applyTransform",value:function(){this.setDirty(),Dl.Q$(this.localScale,this.worldTransform),Dl.i0(this.localPosition,this.worldTransform),Dl.j6(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localPosition=At.al(0,0,0),this.localRotation=id.al(0,0,0,1),this.localScale=At.al(1,1,1)}},{key:"scaleLocal",value:function(t){return this.setLocalDirty(),At.Jp(this.localScale,this.localScale,t),this}},{key:"getLocalPosition",value:function(){return this.localPosition}},{key:"getLocalRotation",value:function(){return this.localRotation}},{key:"getLocalScale",value:function(){return this.localScale}},{key:"getLocalTransform",value:function(){return this.localDirtyFlag&&(Dl.Iw(this.localTransform,this.localRotation,this.localPosition,this.localScale),this.setLocalDirty(!1)),this.localTransform}},{key:"getWorldTransform",value:function(){return(this.isLocalDirty()||this.isDirty())&&(this.parent&&this.parent.getWorldTransform(),this.updateTransform()),this.worldTransform}},{key:"getPosition",value:function(){return Dl.i0(this.position,this.worldTransform),this.position}},{key:"getRotation",value:function(){return Dl.j6(this.rotation,this.worldTransform),this.rotation}},{key:"getScale",value:function(){return Dl.Q$(this.scaling,this.worldTransform),this.scaling}}]),y}();Ee.DIRTY=1;var od,Pn=n(84879),ad=(u=(0,Ch.b2)(),me=(0,Ch.f3)(_h.RenderEngine),u((od=(0,r.Z)((a=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"engine",od,this),this.resourcePool={}}return(0,vh.Z)(t,[{key:"getOrCreateResource",value:function(t){var e,n,i;return this.resourcePool[t.name]||(e=(i=t.descriptor).width,n=i.height,i=i.usage,this.resourcePool[t.name]=this.engine.createFramebuffer({color:this.engine.createTexture2D({width:e,height:n,wrapS:qh.CLAMP_TO_EDGE,wrapT:qh.CLAMP_TO_EDGE,usage:i})})),this.resourcePool[t.name]}},{key:"clean",value:function(){this.resourcePool={}}}]),t}()).prototype,"engine",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=a))||u);function sd(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var me=function(){(0,Ih.Z)(i,bh);var n=sd(i);function i(t){var e;return(0,gh.Z)(this,i),(e=n.call(this,t)).name=void 0,e.name=t.name||"",e}return i}(),ud=(0,Ch.b2)()(a=function(){function t(){(0,gh.Z)(this,t),this.config=void 0}return(0,vh.Z)(t,[{key:"get",value:function(){return this.config}},{key:"set",value:function(t){this.config=t}}]),t}())||a;(u={}).PANSTART="PANSTART",u.PANEND="PANEND",u.PANMOVE="PANMOVE",u.PINCH="PINCH",u.KEYDOWN="KEYDOWN",u.KEYUP="KEYUP",u.HOVER="HOVER";var cd=(0,Ch.b2)()(a=function(){function t(){(0,gh.Z)(this,t)}return(0,vh.Z)(t,[{key:"listen",value:function(t){}},{key:"on",value:function(t,e){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"destroy",value:function(){}}]),t}())||a;var hd=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ld(t){var o={};return{content:t=t.replace(hd,function(t,e,n){var i=n.split(":"),n=i[0].trim(),r="";switch(1<i.length&&(r=i[1].trim()),e){case"bool":r="true"===r;break;case"float":case"int":r=Number(r);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":r=r?r.replace("[","").replace("]","").split(",").reduce(function(t,e){return t.push(Number(e.trim())),t},[]):new Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(e)).fill(0)}return o[n]=r,"uniform ".concat(e," ").concat(n,";\n")}),uniforms:o}}function dd(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dd(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dd(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var pd=/precision\s+(high|low|medium)p\s+float/,gd=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,a=(0,Ch.b2)()(u=function(){function t(){(0,gh.Z)(this,t),this.moduleCache={},this.rawContentCache={}}return(0,vh.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\n\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  // compares only in highlight stage\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\n\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color) {\n  bool selected = bool(v_PickingResult.a);\n\n  if (selected) {\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(resultRGB, color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  return filterPickingColor(filterHighlightColor(color));\n}\n"}),this.registerModule("sdf2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}"})}},{key:"registerModule",value:function(t,e){var n,i,r,o;this.rawContentCache[t]||(i=e.vs,r=void 0===(o=e.fs)?"":o,n=e.uniforms,e=(o=ld(void 0===i?"":i)).content,i=o.uniforms,r=(o=ld(r)).content,o=o.uniforms,this.rawContentCache[t]={fs:r,uniforms:fd(fd(fd({},i),o),n),vs:e})}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var e=this.rawContentCache[t].vs||"",i=this.rawContentCache[t].fs||"",r=this.processModule(e,[],"vs"),o=r.content,a=r.includeList,e=this.processModule(i,[],"fs"),r=e.content,i=e.includeList,e=r,i=a.concat(i).concat(t).filter(function(t,e,n){return n.indexOf(t)===e}).reduce(function(t,e){return fd(fd({},t),n.rawContentCache[e].uniforms)},{});return pd.test(r)||(e="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+r),this.moduleCache[t]={fs:e.trim(),uniforms:i,vs:o.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,i,r){var o=this;return{content:t.replace(gd,function(t,e){var n=e.split(" ")[0].replace(/"/g,"");if(-1<i.indexOf(n))return"";e=o.rawContentCache[n][r];return i.push(n),o.processModule(e||"",i,r).content}),includeList:i}}}]),t}())||u,vd=new Ch.W2;(0,Pn.Z)(vd,!1);function yd(t){for(var e=new hl,n=At.al(t[0],t[1],t[2]),i=At.al(t[0],t[1],t[2]),r=3;r<t.length;){var o=t[r++],a=t[r++],s=t[r++];o<n[0]&&(n[0]=o),a<n[1]&&(n[1]=a),s<n[2]&&(n[2]=s),o>i[0]&&(i[0]=o),a>i[1]&&(i[1]=a),s>i[2]&&(i[2]=s)}return e.setMinMax(n,i),e}vd.bind(_h.ShaderModuleService).to(a).inSingletonScope(),vd.bind(_h.NameComponentManager).toConstantValue(new i(me)),vd.bind(_h.HierarchyComponentManager).toConstantValue(new i(pe)),vd.bind(_h.TransformComponentManager).toConstantValue(new i(Ee)),vd.bind(_h.MeshComponentManager).toConstantValue(new i(o)),vd.bind(_h.CullableComponentManager).toConstantValue(new i(mt)),vd.bind(_h.GeometryComponentManager).toConstantValue(new i(be)),vd.bind(_h.MaterialComponentManager).toConstantValue(new i(tn));var md="undefined"!=typeof navigator&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);At.Ue();At.Ue(),At.Ue(),At.Ue(),At.Ue(),At.Ue();n(59518),n(26199),n(14156),n(71468),n(48871),n(9871);(u={}).Normal="normal",u.PostProcessing="post-processing";var xd,bd,Ed;n(25612),n(92777),n(20159),n(61622),n(20499),n(64851);(Pn=xd=xd||{}).Void="Void",Pn.Boolean="Boolean",Pn.Float="Float",Pn.Uint32="Uint32",Pn.Int32="Int32",Pn.Vector="Vector",Pn.Vector2Float="vec2<f32>",Pn.Vector3Float="vec3<f32>",Pn.Vector4Float="vec4<f32>",Pn.Vector2Boolean="vec2<bool>",Pn.Vector3Boolean="vec3<bool>",Pn.Vector4Boolean="vec4<bool>",Pn.Vector2Uint="vec2<u32>",Pn.Vector3Uint="vec3<u32>",Pn.Vector4Uint="vec4<u32>",Pn.Vector2Int="vec2<i32>",Pn.Vector3Int="vec3<i32>",Pn.Vector4Int="vec4<i32>",Pn.Matrix="Matrix",Pn.Matrix3x3Float="mat3x3<f32>",Pn.Matrix4x4Float="mat4x4<i32>",Pn.Struct="Struct",Pn.FloatArray="Float[]",Pn.Vector4FloatArray="vec4<f32>[]",(a={}).Program="Program",a.Identifier="Identifier",a.VariableDeclaration="VariableDeclaration",a.BlockStatement="BlockStatement",a.ReturnStatement="ReturnStatement",a.FunctionDeclaration="FunctionDeclaration",a.VariableDeclarator="VariableDeclarator",a.AssignmentExpression="AssignmentExpression",a.LogicalExpression="LogicalExpression",a.BinaryExpression="BinaryExpression",a.ArrayExpression="ArrayExpression",a.UnaryExpression="UnaryExpression",a.UpdateExpression="UpdateExpression",a.FunctionExpression="FunctionExpression",a.MemberExpression="MemberExpression",a.ConditionalExpression="ConditionalExpression",a.ExpressionStatement="ExpressionStatement",a.CallExpression="CallExpression",a.NumThreadStatement="NumThreadStatement",a.StorageStatement="StorageStatement",a.DoWhileStatement="DoWhileStatement",a.WhileStatement="WhileStatement",a.ForStatement="ForStatement",a.BreakStatement="BreakStatement",a.ContinueStatement="ContinueStatement",a.IfStatement="IfStatement",a.ImportedFunctionStatement="ImportedFunctionStatement",(me=bd=bd||{}).Input="Input",me.Output="Output",me.Uniform="Uniform",me.Workgroup="Workgroup",me.UniformConstant="UniformConstant",me.Image="Image",me.StorageBuffer="StorageBuffer",me.Private="Private",me.Function="Function",(pe=Ed=Ed||{}).GLSL100="GLSL100",pe.GLSL450="GLSL450",pe.WGSL="WGSL";function Sd(t){return"number"==typeof t}function wd(t){return void 0===t?0:360<t||t<-360?t%360:t}function kd(t,e,n){return Sd(t)?At.al(t,e,n):3===t.length?At.d9(t):At.al(t[0],t[1],t[2])}var Cd,_d,Md,Id,Td=function(){function n(t,e){(0,gh.Z)(this,n),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=t,this.matrix=Dl.d9(e.matrix),this.right=At.d9(e.right),this.up=At.d9(e.up),this.forward=At.d9(e.forward),this.position=At.d9(e.position),this.focalPoint=At.d9(e.focalPoint),this.distanceVector=At.d9(e.distanceVector),this.azimuth=e.azimuth,this.elevation=e.elevation,this.roll=e.roll,this.relAzimuth=e.relAzimuth,this.relElevation=e.relElevation,this.relRoll=e.relRoll,this.dollyingStep=e.dollyingStep,this.distance=e.distance}return(0,vh.Z)(n,[{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getRoll",value:function(){return this.roll}},{key:"retrieve",value:function(t){t.matrix=Dl.JG(t.matrix,this.matrix),t.right=At.JG(t.right,this.right),t.up=At.JG(t.up,this.up),t.forward=At.JG(t.forward,this.forward),t.position=At.JG(t.position,this.position),t.focalPoint=At.JG(t.focalPoint,this.focalPoint),t.distanceVector=At.JG(t.distanceVector,this.distanceVector),t.azimuth=this.azimuth,t.elevation=this.elevation,t.roll=this.roll,t.relAzimuth=this.relAzimuth,t.relElevation=this.relElevation,t.relRoll=this.relRoll,t.dollyingStep=this.dollyingStep,t.distance=this.distance}}]),n}();(Ee=_d=_d||{}).ORBITING="ORBITING",Ee.EXPLORING="EXPLORING",Ee.TRACKING="TRACKING",(o=Md=Md||{}).DEFAULT="DEFAULT",o.ROTATIONAL="ROTATIONAL",o.TRANSLATIONAL="TRANSLATIONAL",o.CINEMATIC="CINEMATIC",(mt=Id=Id||{}).ORTHOGRAPHIC="ORTHOGRAPHIC",mt.PERSPECTIVE="PERSPECTIVE";var Ad,Pd=Math.PI/180,Dd=180/Math.PI,Nd=(be=(0,Ch.b2)(),i=(0,Ch.f3)(_h.InteractorService),be((u=tn=function(){function e(){(0,gh.Z)(this,e),this.matrix=Dl.Ue(),this.right=At.al(1,0,0),this.up=At.al(0,1,0),this.forward=At.al(0,0,1),this.position=At.al(0,0,1),this.focalPoint=At.al(0,0,0),this.distanceVector=At.al(0,0,0),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,(this.rotateWorld=!1,ph.Z)(this,"interactor",Cd,this),this.fov=30,this.near=.1,this.far=1e4,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.zoom=1,this.perspective=Dl.Ue(),this.view=void 0,this.following=void 0,this.type=_d.EXPLORING,this.trackingMode=Md.DEFAULT,this.projectionMode=Id.PERSPECTIVE,this.frustum=new xl,this.landmarks=[],this.landmarkAnimationID=void 0}return(0,vh.Z)(e,[{key:"clone",value:function(){var t=new e;return t.setType(this.type,void 0),t.interactor=this.interactor,t}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"setType",value:function(t,e){return this.type=t,this.type===_d.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===_d.TRACKING&&void 0!==e&&this.setTrackingMode(e),this}},{key:"setProjectionMode",value:function(t){return this.projectionMode=t,this}},{key:"setTrackingMode",value:function(t){if(this.type!==_d.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=t,this}},{key:"setWorldRotation",value:function(t){this.rotateWorld=t,this._getAngles()}},{key:"getViewTransform",value:function(){return Dl.U_(Dl.Ue(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"setMatrix",value:function(t){return this.matrix=t,this._update(),this}},{key:"setAspect",value:function(t){return this.setPerspective(this.near,this.far,this.fov,t),this}},{key:"setViewOffset",value:function(t,e,n,i,r,o){return this.aspect=t/e,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.projectionMode===Id.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===Id.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setPerspective",value:function(t,e,n,i){return this.projectionMode=Id.PERSPECTIVE,this.fov=n,this.near=t,this.far=e,this.aspect=i,Dl.G3(this.perspective,this.fov*Pd,this.aspect,this.near,this.far),this}},{key:"setOrthographic",value:function(t,e,n,i,r,o){this.projectionMode=Id.ORTHOGRAPHIC,this.rright=e,this.left=t,this.top=n,this.bottom=i,this.near=r,this.far=o;var a=(this.rright-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),e=(this.rright+this.left)/2,t=(this.top+this.bottom)/2,n=e-a,i=e+a,e=t+s,a=t-s;return void 0!==this.view&&this.view.enabled&&(t=(this.rright-this.left)/this.view.fullWidth/this.zoom,s=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i=(n+=t*this.view.offsetX)+t*this.view.width,a=(e-=s*this.view.offsetY)-s*this.view.height),Dl.M5(this.perspective,n,i,e,a,r,o),this}},{key:"setPosition",value:function(t,e,n){return this._setPosition(t,e,n),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(t,e,n){var i,r=At.al(0,1,0);return this.focalPoint=kd(t,e,n),this.trackingMode===Md.CINEMATIC&&(t=(i=At.$X(At.Ue(),this.focalPoint,this.position))[0],e=i[1],n=i[2],i=At.kE(i),i=Math.asin(e/i)*Dd,n=90+Math.atan2(n,t)*Dd,t=Dl.Ue(),Dl.uD(t,t,n*Pd),Dl.lM(t,t,i*Pd),r=At.fF(At.Ue(),[0,1,0],t)),Dl.U_(this.matrix,Dl.zB(Dl.Ue(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(t){if(!(this.distance===t||t<0)){this.distance=t,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var e=At.Ue();t=this.distance;var n=this.forward,i=this.focalPoint;return e[0]=t*n[0]+i[0],e[1]=t*n[1]+i[1],e[2]=t*n[2]+i[2],this._setPosition(e),this}}},{key:"setMaxDistance",value:function(t){return this.maxDistance=t,this}},{key:"setMinDistance",value:function(t){return this.minDistance=t,this}},{key:"changeAzimuth",value:function(t){return this.setAzimuth(this.azimuth+t),this}},{key:"changeElevation",value:function(t){return this.setElevation(this.elevation+t),this}},{key:"changeRoll",value:function(t){return this.setRoll(this.roll+t),this}},{key:"setAzimuth",value:function(t){return this.azimuth=wd(t),this.computeMatrix(),this._getAxes(),this.type===_d.ORBITING||this.type===_d.EXPLORING?this._getPosition():this.type===_d.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(t){return this.elevation=wd(t),this.computeMatrix(),this._getAxes(),this.type===_d.ORBITING||this.type===_d.EXPLORING?this._getPosition():this.type===_d.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(t){return this.roll=wd(t),this.computeMatrix(),this._getAxes(),this.type===_d.ORBITING||this.type===_d.EXPLORING?this._getPosition():this.type===_d.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(t,e,n){if(this.type===_d.EXPLORING){t=wd(t),e=wd(e),n=wd(n);var i=id.yY(id.Ue(),[1,0,0],(this.rotateWorld?1:-1)*e*Pd),r=id.yY(id.Ue(),[0,1,0],(this.rotateWorld?1:-1)*t*Pd),o=id.yY(id.Ue(),[0,0,1],n*Pd),i=id.Jp(id.Ue(),r,i),i=id.Jp(id.Ue(),i,o),i=Dl.en(Dl.Ue(),i);Dl.Iu(this.matrix,this.matrix,[0,0,-this.distance]),Dl.Jp(this.matrix,this.matrix,i),Dl.Iu(this.matrix,this.matrix,[0,0,this.distance])}else{if(90<Math.abs(this.elevation+e))return;this.relElevation=wd(e),this.relAzimuth=wd(t),this.relRoll=wd(n),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===_d.ORBITING||this.type===_d.EXPLORING?this._getPosition():this.type===_d.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(t,e){t=kd(t,e,0),e=At.d9(this.position);return At.IH(e,e,At.bA(At.Ue(),this.right,t[0])),At.IH(e,e,At.bA(At.Ue(),this.up,t[1])),this._setPosition(e),this}},{key:"dolly",value:function(t){var e=this.forward,n=At.d9(this.position),t=(this.dollyingStep,this.distance+t*this.dollyingStep),i=Math.max(Math.min(t,this.maxDistance),this.minDistance)-this.distance;return n[0]+=i*e[0],n[1]+=i*e[1],n[2]+=i*e[2],this._setPosition(n),this.type===_d.ORBITING||this.type===_d.EXPLORING?this._getDistance():this.type===_d.TRACKING&&At.IH(this.focalPoint,n,this.distanceVector),this}},{key:"createLandmark",value:function(t,e){var n=this.clone();n.setPosition(e.position),n.setFocalPoint(e.focalPoint),void 0!==e.roll&&n.setRoll(e.roll);n=new Td(t,n);return this.landmarks.push(n),n}},{key:"setLandmark",value:function(t){t=new Td(t,this);return this.landmarks.push(t),this}},{key:"gotoLandmark",value:function(e){var a,s,u,c,t,h=this,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3,n=this.landmarks.find(function(t){return t.name===e});n&&(0!==l?(void 0!==this.landmarkAnimationID&&window.cancelAnimationFrame(this.landmarkAnimationID),this.interactor.disconnect(),a=n.getPosition(),s=n.getFocalPoint(),u=n.getRoll(),t=function t(e){var n=e-(c=void 0===c?e:c),i=(1-Math.cos(n/l*Math.PI))/2,r=At.Ue(),o=At.Ue(),e=0;At.t7(r,h.focalPoint,s,i),At.t7(o,h.position,a,i),e=h.roll*(1-i)+u*i,h.setFocalPoint(r),h.setPosition(o),h.setRoll(e),h.computeMatrix();i=At.TK(r,s)+At.TK(o,a);if(!(.01<i))return h.setFocalPoint(r),h.setPosition(o),h.setRoll(e),h.computeMatrix(),void h.interactor.connect();n<l&&(h.landmarkAnimationID=window.requestAnimationFrame(t))},window.requestAnimationFrame(t)):n.retrieve(this))}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var t=id.yY(id.Ue(),[0,0,1],this.roll*Pd);Dl.yR(this.matrix);var e=id.yY(id.Ue(),[1,0,0],(this.rotateWorld&&this.type!==_d.TRACKING||this.type===_d.TRACKING?1:-1)*this.elevation*Pd),n=id.yY(id.Ue(),[0,1,0],(this.rotateWorld&&this.type!==_d.TRACKING||this.type===_d.TRACKING?1:-1)*this.azimuth*Pd),e=id.Jp(id.Ue(),n,e),e=id.Jp(id.Ue(),e,t),e=Dl.en(Dl.Ue(),e);this.type===_d.ORBITING||this.type===_d.EXPLORING?(Dl.Iu(this.matrix,this.matrix,this.focalPoint),Dl.Jp(this.matrix,this.matrix,e),Dl.Iu(this.matrix,this.matrix,[0,0,this.distance])):this.type===_d.TRACKING&&(Dl.Iu(this.matrix,this.matrix,this.position),Dl.Jp(this.matrix,this.matrix,e))}},{key:"_setPosition",value:function(t,e,n){this.position=kd(t,e,n);n=this.matrix;n[12]=this.position[0],n[13]=this.position[1],n[14]=this.position[2],n[15]=1}},{key:"_getAxes",value:function(){At.JG(this.right,kd(Fh.fF(Fh.Ue(),[1,0,0,0],this.matrix))),At.JG(this.up,kd(Fh.fF(Fh.Ue(),[0,1,0,0],this.matrix))),At.JG(this.forward,kd(Fh.fF(Fh.Ue(),[0,0,1,0],this.matrix))),At.Fv(this.right,this.right),At.Fv(this.up,this.up),At.Fv(this.forward,this.forward)}},{key:"_getAngles",value:function(){var t=this.distanceVector[0],e=this.distanceVector[1],n=this.distanceVector[2],i=At.kE(this.distanceVector);if(0===i)return this.elevation=0,void(this.azimuth=0);this.type===_d.TRACKING||this.rotateWorld?(this.elevation=Math.asin(e/i)*Dd,this.azimuth=Math.atan2(-t,-n)*Dd):(this.elevation=-Math.asin(e/i)*Dd,this.azimuth=-Math.atan2(-t,-n)*Dd)}},{key:"_getPosition",value:function(){At.JG(this.position,kd(Fh.fF(Fh.Ue(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){At.kK(this.distanceVector,[0,0,-this.distance],_t.fromMat4(_t.create(),this.matrix)),At.IH(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=At.$X(At.Ue(),this.focalPoint,this.position),this.distance=At.kE(this.distanceVector),this.dollyingStep=this.distance/100}}]),e}(),tn.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},Cd=(0,r.Z)((Pn=u).prototype,"interactor",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=Pn))||a),Od=(me=(0,Ch.b2)(),pe=(0,Ch.f3)(_h.GeometryComponentManager),me((o=Ee=function(){function t(){(0,gh.Z)(this,t),(this.config=void 0,ph.Z)(this,"geometry",Ad,this),this.entity=void 0,this.component=void 0}return(0,vh.Z)(t,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(t){this.config=t}},{key:"setEntity",value:function(t){this.entity=t,this.component=this.geometry.create(t),this.component.entity=t,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),t}(),Ee.BOX="box",Ee.SPHERE="sphere",Ee.PLANE="plane",Ee.MERGED="merged",Ad=(0,r.Z)((mt=o).prototype,"geometry",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=mt))||be),Ld=n(49469);function Rd(){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}var Bd={}.toString,Gd=function(t,e){return Bd.call(t)==="[object "+e+"]"},Ud=9007199254740991,Fd={};Fd["[object Float32Array]"]=Fd["[object Float64Array]"]=Fd["[object Int8Array]"]=Fd["[object Int16Array]"]=Fd["[object Int32Array]"]=Fd["[object Uint8Array]"]=Fd["[object Uint8ClampedArray]"]=Fd["[object Uint16Array]"]=Fd["[object Uint32Array]"]=!0,Fd["[object Arguments]"]=Fd["[object Array]"]=Fd["[object ArrayBuffer]"]=Fd["[object Boolean]"]=Fd["[object DataView]"]=Fd["[object Date]"]=Fd["[object Error]"]=Fd["[object Function]"]=Fd["[object Map]"]=Fd["[object Number]"]=Fd["[object Object]"]=Fd["[object RegExp]"]=Fd["[object Set]"]=Fd["[object String]"]=Fd["[object WeakMap]"]=!1;var zd=Object.prototype.toString;var jd,Wd,Xd=function(t){return!!(e=t)&&"object"===(0,zh.Z)(e)&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=Ud)&&!!Fd[zd.call(t)];var e};function Zd(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Vd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zd(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zd(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Yd,Hd,qd,Kd,Jd,Qd=(tn=(0,Ch.b2)(),u=(0,Ch.f3)(_h.RenderEngine),i=(0,Ch.f3)(_h.ConfigService),tn((jd=(0,r.Z)((Pn=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"engine",jd,this),(0,ph.Z)(this,"configService",Wd,this),this.entity=xh++,this.model=void 0,this.dirty=!0,this.compiledBundle=void 0,this.initPromise=void 0}var e,n,i;return(0,vh.Z)(t,[{key:"init",value:function(){var t=this.configService.get(),e=t.canvas,t=t.engineOptions;this.initPromise=this.engine.init(Vd({canvas:e||Rd(),swapChainFormat:Ld.EV.BGRA8Unorm,antialiasing:!1},t))}},{key:"setBundle",value:function(t){this.compiledBundle=JSON.parse(JSON.stringify(t))}},{key:"setDispatch",value:function(t){return this.compiledBundle.context&&(this.compiledBundle.context.dispatch=t),this}},{key:"setMaxIteration",value:function(t){return this.compiledBundle.context&&(this.compiledBundle.context.maxIteration=t),this}},{key:"setBinding",value:function(e,t){var n=this;if("string"==typeof e){var i=Sd(t)||Xd(t)||(r=t,Array.isArray?Array.isArray(r):Gd(r,"Array"));if(this.compiledBundle&&this.compiledBundle.context){var r=this.compiledBundle.context.defines.find(function(t){return t.name===e});if(r)return r.value=t,this;r=this.compiledBundle.context.uniforms.find(function(t){return t.name===e});r&&(i?(r.data=t,r.isReferer=!1,r.storageClass===bd.Uniform?this.model&&this.model.updateUniform(e,t):this.model&&this.model.updateBuffer(e,t)):(r.isReferer=!0,r.data=t))}}else Object.keys(e).forEach(function(t){n.setBinding(t,e[t])});return this}},{key:"execute",value:(i=(0,mh.Z)(yh().mark(function t(){var e,n,i=this,r=arguments;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=0<r.length&&void 0!==r[0]?r[0]:1,this.dirty)return this.compiledBundle.context&&(1<e?this.compiledBundle.context.maxIteration=e:this.compiledBundle.context.maxIteration++),t.next=5,this.compile();t.next=6;break;case 5:this.dirty=!1;case 6:for(this.engine.beginFrame(),this.engine.clear({}),this.compiledBundle.context&&this.compiledBundle.context.uniforms.filter(function(t){return t.isReferer}).forEach(function(t){var e=t.data,t=t.name;i.model.confirmInput(e.model,t)}),n=0;n<e;n++)this.model.run();return this.engine.endFrame(),t.abrupt("return",this);case 12:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"getOutput",value:(n=(0,mh.Z)(yh().mark(function t(){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.model.readData());case 1:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"compile",value:(e=(0,mh.Z)(yh().mark(function t(){var n,e,i;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initPromise;case 2:return n=Vd({},this.compiledBundle.context),e=this.engine.supportWebGPU?this.engine.useWGSL?Ed.WGSL:Ed.GLSL450:Ed.GLSL100,i=this.compiledBundle.shaders[e],n.defines.filter(function(t){return t.runtime}).forEach(function(t){var e="".concat("__DefineValuePlaceholder__").concat(t.name);i=i.replace(e,"".concat(t.value))}),n.shader=i,n.uniforms.forEach(function(t){var e;t.data||t.storageClass===bd.StorageBuffer&&(e=1,t.type===xd.FloatArray?e=1:t.type===xd.Vector4FloatArray&&(e=4),t.data=new Float32Array(n.output.length*e).fill(0))}),this.compiledBundle.context=n,t.next=11,this.engine.createComputeModel(this.compiledBundle.context);case 11:this.model=t.sent;case 12:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}]),t}()).prototype,"engine",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd=(0,r.Z)(Pn.prototype,"configService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=Pn))||a),$d=(me=(0,Ch.b2)(),Ee=(0,Ch.f3)(_h.MaterialComponentManager),me((pe=o=function(){function t(){(0,gh.Z)(this,t),(this.config=void 0,ph.Z)(this,"material",Yd,this),this.entity=void 0,this.component=void 0}return(0,vh.Z)(t,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(t){this.config=t}},{key:"setEntity",value:function(t,e){this.entity=t,this.component=this.material.create(t),this.component.entity=t,this.component.type=e,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),t}(),o.BASIC="basic",Yd=(0,r.Z)((mt=pe).prototype,"material",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=mt))||be),tf=(tn=(0,Ch.b2)(),u=(0,Ch.f3)(_h.MeshComponentManager),i=(0,Ch.f3)(_h.CullableComponentManager),Pn=(0,Ch.f3)(_h.TransformComponentManager),a=(0,Ch.f3)(_h.Systems),me=(0,Ch.t6)(_h.SceneGraphSystem),tn((pe=o=function(){function t(){(0,gh.Z)(this,t),this.attributes={},(this.config=void 0,ph.Z)(this,"mesh",Hd,this),(0,ph.Z)(this,"cullable",qd,this),(0,ph.Z)(this,"transform",Kd,this),(0,ph.Z)(this,"sceneGraphSystem",Jd,this),this.meshComponent=void 0,this.transformComponent=void 0,this.entity=void 0}return(0,vh.Z)(t,[{key:"getEntity",value:function(){return this.entity}},{key:"getTransformComponent",value:function(){return this.transformComponent}},{key:"getMeshComponent",value:function(){return this.meshComponent}},{key:"setConfig",value:function(t){this.config=t}},{key:"setEntity",value:function(t){this.entity=t,this.cullable.create(t),this.meshComponent=this.mesh.create(t),this.transformComponent=this.transform.create(t),this.onEntityCreated()}},{key:"setMaterial",value:function(t){return this.meshComponent.material=t,this}},{key:"setGeometry",value:function(t){return this.meshComponent.geometry=t,this}},{key:"setAttributes",value:function(e){var n=this;Object.keys(e).forEach(function(t){void 0!==e[t]&&e[t]!==n.attributes[t]&&(n.onAttributeChanged({name:t,data:e[t]}),n.attributes[t]=e[t])})}},{key:"setVisible",value:function(e){var n=this;return this.meshComponent.visible=e,this.meshComponent.children.forEach(function(t){t=n.mesh.getComponentByEntity(t);t&&(t.visible=e)}),this}},{key:"isVisible",value:function(){return this.meshComponent.visible}},{key:"attach",value:function(t){return this.sceneGraphSystem.attach(this.entity,t.entity),this}},{key:"detach",value:function(){return this.sceneGraphSystem.detach(this.entity),this}},{key:"detachChildren",value:function(){return this.sceneGraphSystem.detachChildren(this.entity),this}},{key:"onEntityCreated",value:function(){}},{key:"onAttributeChanged",value:function(t){var e=t.name,t=t.data;this.meshComponent&&this.meshComponent.material&&this.meshComponent.material.setUniform(this.convertAttributeName2UniformName(e),t)}},{key:"convertAttributeName2UniformName",value:function(t){return t}}]),t}(),o.POINT="point",o.LINE="line",o.GRID="grid",Hd=(0,r.Z)((Ee=pe).prototype,"mesh",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=(0,r.Z)(Ee.prototype,"cullable",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=(0,r.Z)(Ee.prototype,"transform",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=(0,r.Z)(Ee.prototype,"sceneGraphSystem",[a,me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Ee))||mt),be=n(81550),ef=n.n(be),nf=function(){function s(t,e){(0,gh.Z)(this,s),this.attribute=void 0,this.buffer=void 0;var n=e.buffer,i=e.offset,r=e.stride,o=e.normalized,a=e.size,e=e.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:r||0,normalized:o||!1,divisor:e||0},a&&(this.attribute.size=a)}return(0,vh.Z)(s,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),s}(),rf=((0,Gh.Z)(tn={},qh.POINTS,"points"),(0,Gh.Z)(tn,qh.LINES,"lines"),(0,Gh.Z)(tn,qh.LINE_LOOP,"line loop"),(0,Gh.Z)(tn,qh.LINE_STRIP,"line strip"),(0,Gh.Z)(tn,qh.TRIANGLES,"triangles"),(0,Gh.Z)(tn,qh.TRIANGLE_FAN,"triangle fan"),(0,Gh.Z)(tn,qh.TRIANGLE_STRIP,"triangle strip"),tn),of=((0,Gh.Z)(o={},qh.STATIC_DRAW,"static"),(0,Gh.Z)(o,qh.DYNAMIC_DRAW,"dynamic"),(0,Gh.Z)(o,qh.STREAM_DRAW,"stream"),o),af=((0,Gh.Z)(pe={},qh.BYTE,"int8"),(0,Gh.Z)(pe,qh.UNSIGNED_INT,"int16"),(0,Gh.Z)(pe,qh.INT,"int32"),(0,Gh.Z)(pe,qh.UNSIGNED_BYTE,"uint8"),(0,Gh.Z)(pe,qh.UNSIGNED_SHORT,"uint16"),(0,Gh.Z)(pe,qh.UNSIGNED_INT,"uint32"),(0,Gh.Z)(pe,qh.FLOAT,"float"),pe),sf=((0,Gh.Z)(u={},qh.ALPHA,"alpha"),(0,Gh.Z)(u,qh.LUMINANCE,"luminance"),(0,Gh.Z)(u,qh.LUMINANCE_ALPHA,"luminance alpha"),(0,Gh.Z)(u,qh.RGB,"rgb"),(0,Gh.Z)(u,qh.RGBA,"rgba"),(0,Gh.Z)(u,qh.RGBA4,"rgba4"),(0,Gh.Z)(u,qh.RGB5_A1,"rgb5 a1"),(0,Gh.Z)(u,qh.RGB565,"rgb565"),(0,Gh.Z)(u,qh.DEPTH_COMPONENT,"depth"),(0,Gh.Z)(u,qh.DEPTH_STENCIL,"depth stencil"),u),uf=((0,Gh.Z)(i={},qh.DONT_CARE,"dont care"),(0,Gh.Z)(i,qh.NICEST,"nice"),(0,Gh.Z)(i,qh.FASTEST,"fast"),i),cf=((0,Gh.Z)(Pn={},qh.NEAREST,"nearest"),(0,Gh.Z)(Pn,qh.LINEAR,"linear"),(0,Gh.Z)(Pn,qh.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,Gh.Z)(Pn,qh.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,Gh.Z)(Pn,qh.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,Gh.Z)(Pn,qh.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Pn),hf=((0,Gh.Z)(a={},qh.REPEAT,"repeat"),(0,Gh.Z)(a,qh.CLAMP_TO_EDGE,"clamp"),(0,Gh.Z)(a,qh.MIRRORED_REPEAT,"mirror"),a),lf=((0,Gh.Z)(me={},qh.NONE,"none"),(0,Gh.Z)(me,qh.BROWSER_DEFAULT_WEBGL,"browser"),me),df=((0,Gh.Z)(Ee={},qh.NEVER,"never"),(0,Gh.Z)(Ee,qh.ALWAYS,"always"),(0,Gh.Z)(Ee,qh.LESS,"less"),(0,Gh.Z)(Ee,qh.LEQUAL,"lequal"),(0,Gh.Z)(Ee,qh.GREATER,"greater"),(0,Gh.Z)(Ee,qh.GEQUAL,"gequal"),(0,Gh.Z)(Ee,qh.EQUAL,"equal"),(0,Gh.Z)(Ee,qh.NOTEQUAL,"notequal"),Ee),ff=((0,Gh.Z)(mt={},qh.FUNC_ADD,"add"),(0,Gh.Z)(mt,qh.MIN_EXT,"min"),(0,Gh.Z)(mt,qh.MAX_EXT,"max"),(0,Gh.Z)(mt,qh.FUNC_SUBTRACT,"subtract"),(0,Gh.Z)(mt,qh.FUNC_REVERSE_SUBTRACT,"reverse subtract"),mt),pf=((0,Gh.Z)(be={},qh.ZERO,"zero"),(0,Gh.Z)(be,qh.ONE,"one"),(0,Gh.Z)(be,qh.SRC_COLOR,"src color"),(0,Gh.Z)(be,qh.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,Gh.Z)(be,qh.SRC_ALPHA,"src alpha"),(0,Gh.Z)(be,qh.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,Gh.Z)(be,qh.DST_COLOR,"dst color"),(0,Gh.Z)(be,qh.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,Gh.Z)(be,qh.DST_ALPHA,"dst alpha"),(0,Gh.Z)(be,qh.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,Gh.Z)(be,qh.CONSTANT_COLOR,"constant color"),(0,Gh.Z)(be,qh.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,Gh.Z)(be,qh.CONSTANT_ALPHA,"constant alpha"),(0,Gh.Z)(be,qh.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,Gh.Z)(be,qh.SRC_ALPHA_SATURATE,"src alpha saturate"),be),gf=((0,Gh.Z)(tn={},qh.NEVER,"never"),(0,Gh.Z)(tn,qh.ALWAYS,"always"),(0,Gh.Z)(tn,qh.LESS,"less"),(0,Gh.Z)(tn,qh.LEQUAL,"lequal"),(0,Gh.Z)(tn,qh.GREATER,"greater"),(0,Gh.Z)(tn,qh.GEQUAL,"gequal"),(0,Gh.Z)(tn,qh.EQUAL,"equal"),(0,Gh.Z)(tn,qh.NOTEQUAL,"notequal"),tn),vf=((0,Gh.Z)(o={},qh.ZERO,"zero"),(0,Gh.Z)(o,qh.KEEP,"keep"),(0,Gh.Z)(o,qh.REPLACE,"replace"),(0,Gh.Z)(o,qh.INVERT,"invert"),(0,Gh.Z)(o,qh.INCR,"increment"),(0,Gh.Z)(o,qh.DECR,"decrement"),(0,Gh.Z)(o,qh.INCR_WRAP,"increment wrap"),(0,Gh.Z)(o,qh.DECR_WRAP,"decrement wrap"),o),yf=((0,Gh.Z)(pe={},qh.FRONT,"front"),(0,Gh.Z)(pe,qh.BACK,"back"),pe),mf=function(){function r(t,e){(0,gh.Z)(this,r),this.buffer=void 0;var n=e.data,i=e.usage,e=e.type;this.buffer=t.buffer({data:n,usage:of[i||qh.STATIC_DRAW],type:af[e||qh.UNSIGNED_BYTE]})}return(0,vh.Z)(r,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){}},{key:"subData",value:function(t){var e=t.data,t=t.offset;this.buffer.subdata(e,t)}}]),r}(),xf=n(30813),bf=9007199254740991,Ef={};Ef["[object Float32Array]"]=Ef["[object Float64Array]"]=Ef["[object Int8Array]"]=Ef["[object Int16Array]"]=Ef["[object Int32Array]"]=Ef["[object Uint8Array]"]=Ef["[object Uint8ClampedArray]"]=Ef["[object Uint16Array]"]=Ef["[object Uint32Array]"]=!0,Ef["[object Arguments]"]=Ef["[object Array]"]=Ef["[object ArrayBuffer]"]=Ef["[object Boolean]"]=Ef["[object DataView]"]=Ef["[object Date]"]=Ef["[object Error]"]=Ef["[object Function]"]=Ef["[object Map]"]=Ef["[object Number]"]=Ef["[object Object]"]=Ef["[object RegExp]"]=Ef["[object Set]"]=Ef["[object String]"]=Ef["[object WeakMap]"]=!1;var Sf=Object.prototype.toString;var wf=function(t){return!!(e=t)&&"object"===(0,zh.Z)(e)&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=bf)&&!!Ef[Sf.call(t)];var e};function kf(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Cf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kf(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kf(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _f="attribute vec3 a_Position;\nattribute vec2 a_TexCoord;\n\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  gl_Position = vec4(a_Position, 1.0);\n  v_TexCoord = a_TexCoord;\n}",Mf=0,If=function(){function n(t,e){var s=this;(0,gh.Z)(this,n),this.reGl=t,this.context=e,this.entity=xh++,this.texFBO=void 0,this.computeCommand=void 0,this.textureCache={},this.outputTextureName=void 0,this.swapOutputTextureName=void 0,this.compiledPingpong=void 0,this.dynamicPingpong=void 0;var u={};this.context.uniforms.forEach(function(t){var e,n=t.name,i=t.type,r=t.data,o=t.isReferer,a=t.storageClass;if(a===bd.StorageBuffer)o?(s.textureCache[n]={data:void 0},u["".concat(n,"Size")]=function(){return r.compiledBundle.context.output.textureSize}):(s.textureCache[n]=s.calcDataTexture(n,i,r),o=(e=s.textureCache[n]).textureWidth,e=e.isOutput,u["".concat(n,"Size")]=[o,o],e&&(s.outputTextureName=n,s.context.needPingpong&&(s.outputTextureName="".concat(n,"Output"),s.textureCache[s.outputTextureName]=s.calcDataTexture(n,i,r)))),u[n]=function(){return s.textureCache[n].texture};else if(a===bd.Uniform){if(r&&(Array.isArray(r)||wf(r))&&16<r.length)throw new Error("invalid data type ".concat(i));u[n]=function(){return t.data}}});t=this.getOuputDataTexture(),e=t.textureWidth,t=t.texelCount;u.u_OutputTextureSize=[e,e],u.u_OutputTexelCount=t,this.context.output.textureSize=[e,e];e={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n".concat(this.context.shader),uniforms:u,vert:_f,primitive:"triangle strip",count:4};this.computeCommand=this.reGl(e)}var t;return(0,vh.Z)(n,[{key:"run",value:function(){var t=this;1<this.context.maxIteration&&this.context.needPingpong&&(this.compiledPingpong=!0),(this.compiledPingpong||this.dynamicPingpong)&&this.swap(),this.texFBO=this.reGl.framebuffer({color:this.getOuputDataTexture().texture}),this.texFBO.use(function(){t.computeCommand()})}},{key:"readData",value:(t=(0,mh.Z)(yh().mark(function t(){var e,n,i,r,o,a,s=this;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.reGl({framebuffer:this.texFBO})(function(){e=s.reGl.read()}),!e){t.next=6;break}if(r=this.getOuputDataTexture(),n=r.originalDataLength,i=r.elementsPerTexel,r=r.typedArrayConstructor,r=void 0===r?Float32Array:r,o=[],4!==i)for(a=0;a<e.length;a+=4)1===i?o.push(e[a]):2===i?o.push(e[a],e[a+1]):o.push(e[a],e[a+1],e[a+2]);else o=e;return t.abrupt("return",new r(o.slice(0,n)));case 6:return t.abrupt("return",new Float32Array);case 7:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"confirmInput",value:function(t,e){t=this.entity===t.entity?(this.dynamicPingpong=!0,this):t;this.textureCache[e].id=t.getOuputDataTexture().id,this.textureCache[e].texture=t.getOuputDataTexture().texture}},{key:"updateUniform",value:function(){}},{key:"updateBuffer",value:function(e,t){var n=this.context.uniforms.find(function(t){return t.name===e});n&&(t=(n=this.calcDataTexture(e,n.type,t)).texture,n=n.data,this.textureCache[e].data=n,this.textureCache[e].texture=t)}},{key:"destroy",value:function(){}},{key:"swap",value:function(){this.swapOutputTextureName||this.createSwapOutputDataTexture(),this.compiledPingpong&&(t=this.context.output.name,this.textureCache[t].id=this.getOuputDataTexture().id,this.textureCache[t].texture=this.getOuputDataTexture().texture);var t=this.outputTextureName;this.outputTextureName=this.swapOutputTextureName,this.swapOutputTextureName=t}},{key:"getOuputDataTexture",value:function(){return this.textureCache[this.outputTextureName]}},{key:"createSwapOutputDataTexture",value:function(){var t=this.cloneDataTexture(this.getOuputDataTexture());this.swapOutputTextureName="".concat(this.entity,"-swap"),this.textureCache[this.swapOutputTextureName]=t}},{key:"cloneDataTexture",value:function(t){var e=t.data,n=t.textureWidth;return Cf(Cf({},t),{},{id:Mf++,texture:this.reGl.texture({width:n,height:n,data:e,type:"float"})})}},{key:"calcDataTexture",value:function(t,e,n){var i=1;e===xd.Vector4FloatArray&&(i=4);for(var r=[],o=0;o<n.length;o+=i)1===i?r.push(n[o],0,0,0):2===i?r.push(n[o],n[o+1],0,0):3===i?r.push(n[o],n[o+1],n[o+2],0):4===i&&r.push(n[o],n[o+1],n[o+2],n[o+3]);var a=n.length,s=Math.ceil(a/i),u=Math.ceil(Math.sqrt(s)),e=u*u;s<e&&r.push.apply(r,(0,xf.Z)(new Array(4*(e-s)).fill(0)));e=this.reGl.texture({width:u,height:u,data:r,type:"float"});return{id:Mf++,data:r,originalDataLength:a,typedArrayConstructor:wf(n)?n.constructor:void 0,textureWidth:u,texture:e,texelCount:s,elementsPerTexel:i,isOutput:t===this.context.output.name}}}]),n}(),Tf=function(){function o(t,e){(0,gh.Z)(this,o),this.elements=void 0;var n=e.data,i=e.usage,r=e.type,e=e.count;this.elements=t.elements({data:n,usage:of[i||qh.STATIC_DRAW],type:af[r||qh.UNSIGNED_BYTE],count:e})}return(0,vh.Z)(o,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){t=t.data;this.elements.subdata(t)}},{key:"destroy",value:function(){this.elements.destroy()}}]),o}(),Af=function(){function a(t,e){(0,gh.Z)(this,a),this.framebuffer=void 0;var n=e.width,i=e.height,r=e.color,o=e.colors,i=(e.depth,e.stencil,{width:n,height:i});Array.isArray(o)&&(i.colors=o.map(function(t){return t.get()})),r&&"boolean"!=typeof r&&(i.color=r.get()),this.framebuffer=t.framebuffer(i)}return(0,vh.Z)(a,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,t=t.height;this.framebuffer.resize(e,t)}}]),a}();function Pf(t){var e=(0,zh.Z)(t);return null!=t&&("object"===e||"function"===e)}function Df(e){var n={};return Object.keys(e).forEach(function(t){!function i(r,e,o,a){if(null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||wf(e)||""===e||void 0!==e.resize)return void(o["".concat(a&&a+".").concat(r)]=e);Pf(e)&&Object.keys(e).forEach(function(t){i(t,e[t],o,"".concat(a&&a+".").concat(r))});Array.isArray(e)&&e.forEach(function(e,n){Object.keys(e).forEach(function(t){i(t,e[t],o,"".concat(a&&a+".").concat(r,"[").concat(n,"]"))})})}(t,e[t],n,"")}),n}function Nf(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Of(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nf(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nf(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Lf,Rf=function(){function m(e,t){(0,gh.Z)(this,m),this.reGl=void 0,this.drawCommand=void 0,this.uniforms={},this.reGl=e;var n=t.vs,i=t.fs,r=t.defines,o=t.attributes,a=t.uniforms,s=t.primitive,u=t.count,c=t.elements,h=t.depth,l=t.blend,d=t.stencil,f=t.cull,p=t.instances,g=t.scissor,t=t.viewport,v={};a&&(this.uniforms=Df(a),Object.keys(a).forEach(function(t){v[t]=e.prop(t)}));var y={};Object.keys(o).forEach(function(t){y[t]=o[t].get()});r=r&&this.generateDefines(r)||"",s={attributes:y,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n".concat(r,"\n").concat(i),uniforms:v,vert:"\n".concat(r,"\n").concat(n),primitive:rf[void 0===s?qh.TRIANGLES:s]};p&&(s.instances=p),u&&(s.count=u),c&&(s.elements=c.get()),g&&(s.scissor=g),t&&(s.viewport=t),this.initDepthDrawParams({depth:h},s),this.initBlendDrawParams({blend:l},s),this.initStencilDrawParams({stencil:d},s),this.initCullDrawParams({cull:f},s),this.drawCommand=e(s)}return(0,vh.Z)(m,[{key:"addUniforms",value:function(t){this.uniforms=Of(Of({},this.uniforms),Df(t))}},{key:"draw",value:function(t){var n=Of(Of({},this.uniforms),Df(t.uniforms||{})),i={};Object.keys(n).forEach(function(t){var e=(0,zh.Z)(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?i[t]=n[t]:"string"===e||(i[t]=n[t].get())}),this.drawCommand(i)}},{key:"destroy",value:function(){}},{key:"initDepthDrawParams",value:function(t,e){t=t.depth;t&&(e.depth={enable:void 0===t.enable||!!t.enable,mask:void 0===t.mask||!!t.mask,func:df[t.func||qh.LESS],range:t.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,e){var n,i,r=t.blend;r&&(n=r.enable,i=r.func,t=r.equation,r=r.color,e.blend={enable:!!n,func:{srcRGB:pf[i&&i.srcRGB||qh.SRC_ALPHA],srcAlpha:pf[i&&i.srcAlpha||qh.SRC_ALPHA],dstRGB:pf[i&&i.dstRGB||qh.ONE_MINUS_SRC_ALPHA],dstAlpha:pf[i&&i.dstAlpha||qh.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ff[t&&t.rgb||qh.FUNC_ADD],alpha:ff[t&&t.alpha||qh.FUNC_ADD]},color:void 0===r?[0,0,0,0]:r})}},{key:"initStencilDrawParams",value:function(t,e){var n,i,r,o=t.stencil;o&&(n=o.enable,i=o.mask,t=void 0===(r=o.func)?{cmp:qh.ALWAYS,ref:0,mask:-1}:r,r=void 0===(r=o.opFront)?{fail:qh.KEEP,zfail:qh.KEEP,zpass:qh.KEEP}:r,o=void 0===(o=o.opBack)?{fail:qh.KEEP,zfail:qh.KEEP,zpass:qh.KEEP}:o,e.stencil={enable:!!n,mask:void 0===i?-1:i,func:Of(Of({},t),{},{cmp:gf[t.cmp]}),opFront:{fail:vf[r.fail],zfail:vf[r.zfail],zpass:vf[r.zpass]},opBack:{fail:vf[o.fail],zfail:vf[o.zfail],zpass:vf[o.zpass]}})}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;n&&(t=n.enable,n=void 0===(n=n.face)?qh.BACK:n,e.cull={enable:!!t,face:yf[n]})}},{key:"generateDefines",value:function(e){return Object.keys(e).map(function(t){return"#define ".concat(t," ").concat(Number(e[t]))}).join("\n")}}]),m}(),Bf=function(){function v(t,e){(0,gh.Z)(this,v),this.texture=void 0,this.width=void 0,this.height=void 0;var n=e.data,i=e.type,r=void 0===i?qh.UNSIGNED_BYTE:i,o=e.width,a=e.height,s=e.flipY,u=void 0!==s&&s,c=e.format,h=void 0===c?qh.RGBA:c,l=e.mipmap,d=void 0!==l&&l,f=e.wrapS,p=void 0===f?qh.CLAMP_TO_EDGE:f,g=e.wrapT,i=void 0===g?qh.CLAMP_TO_EDGE:g,s=e.aniso,c=void 0===s?0:s,l=e.alignment,f=void 0===l?1:l,g=e.premultiplyAlpha,s=void 0!==g&&g,l=e.mag,g=void 0===l?qh.NEAREST:l,l=e.min,l=void 0===l?qh.NEAREST:l,e=e.colorSpace,e=void 0===e?qh.BROWSER_DEFAULT_WEBGL:e,c={width:this.width=o,height:this.height=a,type:af[r],format:sf[h],wrapS:hf[p],wrapT:hf[i],mag:cf[g],min:cf[l],alignment:f,flipY:u,colorSpace:lf[e],premultiplyAlpha:s,aniso:c};n&&(c.data=n),"number"==typeof d?c.mipmap=uf[d]:"boolean"==typeof d&&(c.mipmap=d),this.texture=t.texture(c)}return(0,vh.Z)(v,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,t=t.height;this.texture.resize(e,t),this.width=e,this.height=t}},{key:"destroy",value:function(){this.texture.destroy()}}]),v}(),Gf=(0,Ch.b2)()(u=function(){function t(){var r=this;(0,gh.Z)(this,t),this.supportWebGPU=!1,this.useWGSL=!1,this.$canvas=void 0,this.gl=void 0,this.inited=void 0,this.createModel=function(){var e=(0,mh.Z)(yh().mark(function t(i){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i.uniforms)return t.next=3,Promise.all(Object.keys(i.uniforms).map(function(){var e=(0,mh.Z)(yh().mark(function t(e){var n;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i.uniforms[e]&&void 0!==i.uniforms[e].load)return t.next=3,i.uniforms[e].load();t.next=5;break;case 3:n=t.sent,i.uniforms[e]=n;case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()));t.next=3;break;case 3:return t.abrupt("return",new Rf(r.gl,i));case 4:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),this.createAttribute=function(t){return new nf(r.gl,t)},this.createBuffer=function(t){return new mf(r.gl,t)},this.createElements=function(t){return new Tf(r.gl,t)},this.createTexture2D=function(t){return new Bf(r.gl,t)},this.createFramebuffer=function(t){return new Af(r.gl,t)},this.useFramebuffer=function(t,e){r.gl({framebuffer:t?t.get():null})(e)},this.createComputeModel=function(){var e=(0,mh.Z)(yh().mark(function t(e){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new If(r.gl,e));case 1:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),this.clear=function(t){var e=t.color,n=t.depth,i=t.stencil,t=t.framebuffer,t=void 0===t?null:t,i={color:e,depth:n,stencil:i};i.framebuffer=null===t?t:t.get(),r.gl.clear(i)},this.setScissor=function(t){r.gl&&r.gl._gl&&(t.enable&&t.box?(r.gl._gl.enable(qh.SCISSOR_TEST),r.gl._gl.scissor(t.box.x,t.box.y,t.box.width,t.box.height)):r.gl._gl.disable(qh.SCISSOR_TEST),r.gl._refresh())},this.viewport=function(t){var e=t.x,n=t.y,i=t.width,t=t.height;r.gl&&r.gl._gl&&(r.gl._gl.viewport(e,n,i,t),r.gl._refresh())},this.readPixels=function(t){var e=t.framebuffer,t={x:t.x,y:t.y,width:t.width,height:t.height};return e&&(t.framebuffer=e.get()),r.gl.read(t)},this.getCanvas=function(){return r.$canvas},this.getGLContext=function(){return r.gl._gl},this.destroy=function(){r.gl&&(r.gl.destroy(),r.inited=!1)}}var e;return(0,vh.Z)(t,[{key:"init",value:(e=(0,mh.Z)(yh().mark(function t(e){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.inited)return t.abrupt("return");t.next=2;break;case 2:return this.$canvas=e.canvas,t.next=5,new Promise(function(n,i){ef()({canvas:e.canvas,attributes:{alpha:!0,antialias:e.antialias,premultipliedAlpha:!0},pixelRatio:1,extensions:["OES_element_index_uint","OES_texture_float","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(t,e){!t&&e||i(t),n(e)}})});case 5:this.gl=t.sent,this.inited=!0;case 7:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"isFloatSupported",value:function(){return this.gl.limits.readFloat}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),t}())||u;function Uf(e,t,n,i){var r,o;"undefined"!=typeof window&&(r=document.getElementsByTagName("head")[0],(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("src",e),i&&(o.id=i),o.onload=function(){t&&t()},o.onerror=function(t){n&&n("Unable to load script '".concat(e,"'"),t)},r.appendChild(o))}function Ff(){return(Ff=(0,mh.Z)(yh().mark(function t(){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Lf)return t.abrupt("return",Lf);t.next=2;break;case 2:return t.next=4,function(e){return new Promise(function(t,n){Uf(e,function(){t()},function(t,e){n(e)})})}("https://preview.babylonjs.com/glslang/glslang.js");case 4:return Lf=window.glslang("https://preview.babylonjs.com/glslang/glslang.wasm"),t.abrupt("return",Lf);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}var zf=function(){function c(t,e){(0,gh.Z)(this,c),this.engine=t,this.options=e,this.attribute=void 0,this.buffer=void 0;var n=e.buffer,i=e.offset,r=e.stride,o=e.normalized,a=e.size,s=e.divisor,u=e.arrayStride,t=e.attributes,e=e.stepMode;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:r||0,normalized:o||!1,divisor:s||0,arrayStride:u||0,attributes:t,stepMode:e||"vertex"},a&&(this.attribute.size=a)}return(0,vh.Z)(c,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),c}(),jf=function(){function i(t,e){(0,gh.Z)(this,i),this.engine=t,this.options=e,this.buffer=void 0;var n=e.data,t=e.usage;e.type;this.buffer=this.createBuffer(n instanceof Array?new Float32Array(n):n,t||Ld.FB.Vertex|Ld.FB.CopyDst)}return(0,vh.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,t=t.offset;this.setSubData(this.buffer,t,e instanceof Array?new Float32Array(e):e)}},{key:"createBuffer",value:function(t,e){var n=t.byteLength%4,e={size:t.byteLength+n,usage:e},e=this.engine.device.createBuffer(e);return this.setSubData(e,0,t),e}},{key:"setSubData",value:function(t,e,n){(md?this.engine.device.getQueue():this.engine.device.defaultQueue).writeBuffer(t,e,n)}}]),i}();var Wf=function(){function n(t,e){(0,gh.Z)(this,n),this.engine=t,this.context=e,this.entity=xh++,this.uniformGPUBufferLayout=[],this.uniformBuffer=void 0,this.vertexBuffers={},this.outputBuffer=void 0,this.bindGroupEntries=void 0,this.bindGroup=void 0,this.computePipeline=void 0}var e,t,i;return(0,vh.Z)(n,[{key:"init",value:(i=(0,mh.Z)(yh().mark(function t(){var e,n,i,r,o,a,s=this;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.compileComputePipelineStageDescriptor(this.context.shader);case 2:i=t.sent,e=i.computeStage,n=this.context.uniforms.filter(function(t){return t.storageClass===bd.StorageBuffer}),i=this.context.uniforms.filter(function(t){return t.storageClass===bd.Uniform}),r=i.length?1:0,this.bindGroupEntries=[],r&&(o=0,a=[],i.forEach(function(t){if("number"==typeof t.data)s.uniformGPUBufferLayout.push({name:t.name,offset:o}),o+=4,a.push(t.data);else{var e=(null===(n=t.data)||void 0===n?void 0:n.length)||1;3===e&&(e=4,t.data.push(0));var n=o/4%4;if(0<n){var i=4-n;if(1<e&&e<=i)2===e&&(3==i&&(o+=4,a.push(0)),a.push.apply(a,(0,xf.Z)(t.data)),s.uniformGPUBufferLayout.push({name:t.name,offset:o}));else{for(var r=0;r<i;r++)o+=4,a.push(0);a.push.apply(a,(0,xf.Z)(t.data)),s.uniformGPUBufferLayout.push({name:t.name,offset:o})}}o+=4*e}}),this.uniformBuffer=new jf(this.engine,{data:a instanceof Array?new Float32Array(a):a,usage:Ld.FB.Uniform|Ld.FB.CopyDst}),this.bindGroupEntries.push({binding:0,resource:{buffer:this.uniformBuffer.get()}})),n.forEach(function(t){var e;null!==t.data&&(t.type!==xd.Vector4FloatArray&&t.type!==xd.FloatArray||(t.name===s.context.output.name?(e=new jf(s.engine,{data:isFinite(Number(t.data))?[t.data]:t.data,usage:Ld.FB.Storage|Ld.FB.CopyDst|Ld.FB.CopySrc}),s.outputBuffer=e,s.context.output={name:t.name,length:isFinite(Number(t.data))?1:t.data.length,typedArrayConstructor:Float32Array,gpuBuffer:e.get()}):t.isReferer?t.data.model&&t.data.model.outputBuffer&&(e=t.data.model.outputBuffer):e=new jf(s.engine,{data:isFinite(Number(t.data))?[t.data]:t.data,usage:Ld.FB.Storage|Ld.FB.CopyDst|Ld.FB.CopySrc}),s.vertexBuffers[t.name]=e,s.bindGroupEntries.push({binding:r,resource:{name:t.name,refer:e?void 0:t.data,buffer:e?e.get():void 0}}),r++))}),this.computePipeline=this.engine.device.createComputePipeline({computeStage:e}),this.bindGroup=this.engine.device.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),entries:this.bindGroupEntries});case 13:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;this.uniformBuffer&&this.uniformBuffer.destroy(),Object.keys(this.vertexBuffers).forEach(function(t){return e.vertexBuffers[t].destroy()})}},{key:"readData",value:(t=(0,mh.Z)(yh().mark(function t(){var e,n,i,r,o;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.context.output)){t.next=16;break}if(i=n.length,e=n.typedArrayConstructor,n=n.gpuBuffer)return i=i*e.BYTES_PER_ELEMENT,r=this.engine.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),(o=this.engine.device.createCommandEncoder()).copyBufferToBuffer(n,0,r,0,i),(md?this.engine.device.getQueue():this.engine.device.defaultQueue).submit([o.finish()]),t.next=12,r.mapAsync(Ld.gc.Read);t.next=16;break;case 12:return o=r.getMappedRange(),o=new e(o.slice(0)),r.unmap(),t.abrupt("return",o);case 16:return t.abrupt("return",new Float32Array);case 17:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"run",value:function(){var t;this.engine.currentComputePass&&(this.engine.currentComputePass.setPipeline(this.computePipeline),this.engine.currentComputePass.setBindGroup(0,this.bindGroup),(t=this.engine.currentComputePass).dispatch.apply(t,(0,xf.Z)(this.context.dispatch)))}},{key:"updateBuffer",value:function(t,e){t=this.vertexBuffers[t];t&&t.subData({data:e,offset:2<arguments.length&&void 0!==arguments[2]?arguments[2]:0})}},{key:"updateUniform",value:function(e,t){var n=this.uniformGPUBufferLayout.find(function(t){return t.name===e});n&&this.uniformBuffer.subData({data:Number.isFinite(t)?new Float32Array([t]):new Float32Array(t),offset:n.offset})}},{key:"confirmInput",value:function(t,e){var n=this.vertexBuffers[e],i=t.outputBuffer;n&&i&&n!==i&&(e=this.engine.device.createCommandEncoder(),t=(t=t.context.output).length*t.typedArrayConstructor.BYTES_PER_ELEMENT,e.copyBufferToBuffer(i.get(),0,n.get(),0,t),(md?this.engine.device.getQueue():this.engine.device.defaultQueue).submit([e.finish()]))}},{key:"compileShaderToSpirV",value:function(t,e,n){return this.compileRawShaderToSpirV(n+t,e)}},{key:"compileRawShaderToSpirV",value:function(t,e){return this.engine.glslang.compileGLSL(t,e)}},{key:"compileComputePipelineStageDescriptor",value:(e=(0,mh.Z)(yh().mark(function t(e){var n;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e,this.engine.options.useWGSL){t.next=6;break}return t.next=5,this.compileShaderToSpirV(e,"compute","#version 450\n");case 5:n=t.sent;case 6:return t.abrupt("return",{computeStage:{module:this.engine.device.createShaderModule({code:n,isWHLSL:md}),entryPoint:"main"}});case 7:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})}]),n}(),Xf=function(){function i(t,e){(0,gh.Z)(this,i),this.engine=t,this.options=e,this.indexCount=void 0,this.buffer=void 0;var n=e.data,e=(e.usage,e.type,e.count);this.indexCount=e||0,this.buffer=new jf(t,{data:n instanceof Array?new Uint16Array(n):n,usage:Ld.FB.Index|Ld.FB.CopyDst})}return(0,vh.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"subData",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Zf=function(){function i(t,e){(0,gh.Z)(this,i),this.engine=t,this.options=e,this.colorTexture=void 0,this.depthTexture=void 0,this.width=0,this.height=0;e.width,e.height;var n=e.color,t=(e.colors,e.depth);e.stencil;n&&(this.colorTexture=n),t&&(this.depthTexture=t)}return(0,vh.Z)(i,[{key:"get",value:function(){var t;return{color:null===(t=this.colorTexture)||void 0===t?void 0:t.get(),depth:null===(t=this.depthTexture)||void 0===t?void 0:t.get()}}},{key:"destroy",value:function(){var t;null!==(t=this.colorTexture)&&void 0!==t&&t.destroy(),null!==(t=this.depthTexture)&&void 0!==t&&t.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;e===this.width&&n===this.height||(null!==(t=this.colorTexture)&&void 0!==t&&t.resize({width:e,height:n}),null!==(t=this.depthTexture)&&void 0!==t&&t.resize({width:e,height:n})),this.width=e,this.height=n}}]),i}(),Vf=((0,Gh.Z)(i={},qh.POINTS,Ld.YV.PointList),(0,Gh.Z)(i,qh.LINES,Ld.YV.LineList),(0,Gh.Z)(i,qh.LINE_LOOP,Ld.YV.LineList),(0,Gh.Z)(i,qh.LINE_STRIP,Ld.YV.LineStrip),(0,Gh.Z)(i,qh.TRIANGLES,Ld.YV.TriangleList),(0,Gh.Z)(i,qh.TRIANGLE_FAN,Ld.YV.TriangleList),(0,Gh.Z)(i,qh.TRIANGLE_STRIP,Ld.YV.TriangleStrip),i),Yf=((0,Gh.Z)(Pn={},qh.NEVER,Ld.wb.Never),(0,Gh.Z)(Pn,qh.ALWAYS,Ld.wb.Always),(0,Gh.Z)(Pn,qh.LESS,Ld.wb.Less),(0,Gh.Z)(Pn,qh.LEQUAL,Ld.wb.LessEqual),(0,Gh.Z)(Pn,qh.GREATER,Ld.wb.Greater),(0,Gh.Z)(Pn,qh.GEQUAL,Ld.wb.GreaterEqual),(0,Gh.Z)(Pn,qh.EQUAL,Ld.wb.Equal),(0,Gh.Z)(Pn,qh.NOTEQUAL,Ld.wb.NotEqual),Pn),Hf=((0,Gh.Z)(a={},qh.FUNC_ADD,Ld.db.Add),(0,Gh.Z)(a,qh.MIN_EXT,Ld.db.Min),(0,Gh.Z)(a,qh.MAX_EXT,Ld.db.Max),(0,Gh.Z)(a,qh.FUNC_SUBTRACT,Ld.db.Subtract),(0,Gh.Z)(a,qh.FUNC_REVERSE_SUBTRACT,Ld.db.ReverseSubtract),a),qf=((0,Gh.Z)(me={},qh.ZERO,Ld.zi.Zero),(0,Gh.Z)(me,qh.ONE,Ld.zi.One),(0,Gh.Z)(me,qh.SRC_COLOR,Ld.zi.SrcColor),(0,Gh.Z)(me,qh.ONE_MINUS_SRC_COLOR,Ld.zi.OneMinusSrcColor),(0,Gh.Z)(me,qh.SRC_ALPHA,Ld.zi.SrcAlpha),(0,Gh.Z)(me,qh.ONE_MINUS_SRC_ALPHA,Ld.zi.OneMinusSrcAlpha),(0,Gh.Z)(me,qh.DST_COLOR,Ld.zi.DstColor),(0,Gh.Z)(me,qh.ONE_MINUS_DST_COLOR,Ld.zi.OneMinusDstColor),(0,Gh.Z)(me,qh.DST_ALPHA,Ld.zi.DstAlpha),(0,Gh.Z)(me,qh.ONE_MINUS_DST_ALPHA,Ld.zi.OneMinusDstAlpha),(0,Gh.Z)(me,qh.CONSTANT_COLOR,Ld.zi.BlendColor),(0,Gh.Z)(me,qh.ONE_MINUS_CONSTANT_COLOR,Ld.zi.OneMinusBlendColor),(0,Gh.Z)(me,qh.SRC_ALPHA_SATURATE,Ld.zi.SrcAlphaSaturated),me),Kf=((0,Gh.Z)(Ee={},qh.ALPHA,"r8unorm"),(0,Gh.Z)(Ee,qh.RGBA,"rgba8unorm"),(0,Gh.Z)(Ee,qh.DEPTH_COMPONENT,"depth32float"),(0,Gh.Z)(Ee,qh.DEPTH_STENCIL,"depth24plus-stencil8"),Ee),Jf=((0,Gh.Z)(mt={},qh.NEAREST,"nearest"),(0,Gh.Z)(mt,qh.LINEAR,"linear"),mt),Qf=((0,Gh.Z)(be={},qh.REPEAT,"repeat"),(0,Gh.Z)(be,qh.CLAMP_TO_EDGE,"clamp-to-edge"),(0,Gh.Z)(be,qh.MIRRORED_REPEAT,"mirror-repeat"),be);function $f(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function tp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$f(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ep=function(){function n(t,e){(0,gh.Z)(this,n),this.engine=t,this.options=e,this.pipelineLayout=void 0,this.renderPipeline=void 0,this.uniformsBindGroupLayout=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.uniforms={},this.uniformGPUBufferLayout=[],this.attributeCache={},this.indexBuffer=void 0,this.indexCount=void 0}var i,t;return(0,vh.Z)(n,[{key:"init",value:(t=(0,mh.Z)(yh().mark(function t(){var a,i,r,o,s,u,c,h,l,d,f,p=this;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=this.options,l=f.vs,d=f.fs,a=f.attributes,i=f.uniforms,r=f.primitive,f.count,o=f.elements,s=f.depth,u=f.blend,c=f.stencil,h=f.cull,f.instances,t.next=3,this.compilePipelineStageDescriptor(l,d,null);case 3:f=t.sent,l=f.vertexStage,d=f.fragmentStage,i&&this.buildUniformBindGroup(i),o&&(this.indexBuffer=o.get(),this.indexCount=o.indexCount),f={vertexBuffers:Object.keys(a).map(function(t,e){var n=a[t],i=n.get(),r=i.arrayStride,o=i.stepMode,i=i.attributes;return p.attributeCache[t]=n,{arrayStride:r,stepMode:o,attributes:i}})},f={sampleCount:this.engine.mainPassSampleCount,primitiveTopology:Vf[r||qh.TRIANGLES],rasterizationState:tp(tp({},this.getDefaultRasterizationStateDescriptor()),{},{cullMode:(n=(n={cull:h}).cull)&&n.enable?n.face?n.face===qh.FRONT?Ld.Wf.Front:Ld.Wf.Back:void 0:Ld.Wf.None}),depthStencilState:(e=void 0,e=(n={depth:s,stencil:c}).depth,n.stencil,n={compare:Ld.wb.Always,depthFailOp:Ld.xS.Keep,failOp:Ld.xS.Keep,passOp:Ld.xS.Keep},{depthWriteEnabled:e&&e.enable,depthCompare:Yf[(null==e?void 0:e.func)||qh.ALWAYS],format:Ld.EV.Depth24PlusStencil8,stencilFront:n,stencilBack:n,stencilReadMask:4294967295,stencilWriteMask:4294967295}),colorStates:(e={blend:u},n=this.engine.options.swapChainFormat,e=e.blend,[{format:n,alphaBlend:{srcFactor:qf[e&&e.func&&e.func.srcAlpha||qh.ONE],dstFactor:qf[e&&e.func&&e.func.dstAlpha||qh.ZERO],operation:Hf[e&&e.equation&&e.equation.alpha||qh.FUNC_ADD]},colorBlend:{srcFactor:qf[e&&e.func&&e.func.srcRGB||qh.ONE],dstFactor:qf[e&&e.func&&e.func.dstRGB||qh.ZERO],operation:Hf[e&&e.equation&&e.equation.rgb||qh.FUNC_ADD]},writeMask:Ld.Yw.All}]),layout:this.pipelineLayout,vertexStage:l,fragmentStage:d,vertexState:f},this.renderPipeline=this.engine.device.createRenderPipeline(f);case 11:case"end":return t.stop()}var e,n},t,this)})),function(){return t.apply(this,arguments)})},{key:"addUniforms",value:function(t){this.uniforms=tp(tp({},this.uniforms),Df(t))}},{key:"draw",value:function(t){var r=this,n=this.engine.getCurrentRenderPass(),o=tp(tp({},this.uniforms),Df(t.uniforms||{})),a=[];Object.keys(o).forEach(function(e){var t,n,i=(0,zh.Z)(o[e]);"boolean"===i||"number"===i||Array.isArray(o[e])||o[e].BYTES_PER_ELEMENT?null!==(n=null===(t=r.uniformGPUBufferLayout.find(function(t){return t.name===e}))||void 0===t?void 0:t.offset)&&r.uniformBuffer.subData({data:o[e],offset:n}):null!==(t=null===(i=r.uniformGPUBufferLayout.find(function(t){return t.name===e}))||void 0===i?void 0:i.offset)&&(n=(i=(n=o[e].get()).color||n).texture,(i=i.sampler)&&(a.push({binding:t,resource:i}),t++),a.push({binding:t,resource:n.createView()}))}),this.uniformBuffer&&(a[0]={binding:0,resource:{buffer:this.uniformBuffer.get()}}),this.uniformBindGroup=this.engine.device.createBindGroup({layout:this.uniformsBindGroupLayout,entries:a}),this.renderPipeline&&n.setPipeline(this.renderPipeline),n.setBindGroup(0,this.uniformBindGroup),this.indexBuffer&&n.setIndexBuffer(this.indexBuffer.get(),Ld.iD.Uint32,0),Object.keys(this.attributeCache).forEach(function(t,e){n.setVertexBuffer(0+e,r.attributeCache[t].get().buffer,0)}),this.indexBuffer?n.drawIndexed(this.indexCount,this.options.instances||1,0,0,0):n.draw(this.options.count||0,this.options.instances||0,0,0)}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}},{key:"compilePipelineStageDescriptor",value:(i=(0,mh.Z)(yh().mark(function t(e,n,i){var r,o,a;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r="#version 450\n",o=e,a=n,this.engine.options.useWGSL){t.next=10;break}return t.next=6,this.compileShaderToSpirV(e,"vertex",r);case 6:return o=t.sent,t.next=9,this.compileShaderToSpirV(n,"fragment",r);case 9:a=t.sent;case 10:return t.abrupt("return",this.createPipelineStageDescriptor(o,a));case 11:case"end":return t.stop()}},t,this)})),function(t,e,n){return i.apply(this,arguments)})},{key:"compileShaderToSpirV",value:function(t,e,n){return this.compileRawShaderToSpirV(n+t,e)}},{key:"compileRawShaderToSpirV",value:function(t,e){return this.engine.glslang.compileGLSL(t,e)}},{key:"createPipelineStageDescriptor",value:function(t,e){return{vertexStage:{module:this.engine.device.createShaderModule({code:t,isWHLSL:md}),entryPoint:"main"},fragmentStage:{module:this.engine.device.createShaderModule({code:e,isWHLSL:md}),entryPoint:"main"}}}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:Ld.zX.CCW,cullMode:Ld.Wf.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"buildUniformBindGroup",value:function(e){var n=this,i=0,t=function(t){for(var e=0,n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0,a=i;o<a.length;o++)e+=a[o].length;for(var s=new t(e),u=0,c=0,h=i;c<h.length;c++){var l=h[c];s.set(l,u),u+=l.length}return s}.apply(void 0,[Float32Array].concat((0,xf.Z)(Object.keys(e).map(function(t){return e[t]?(n.uniformGPUBufferLayout.push({name:t,offset:i}),i+=4*(e[t].length||1),e[t]):[]})))),r=[],o=!1;t.length&&(o=!0,r.push({binding:0,visibility:Ld.$X.Fragment|Ld.$X.Vertex,type:Ld.$l.UniformBuffer})),Object.keys(e).filter(function(t){return null===e[t]}).forEach(function(t,e){n.uniformGPUBufferLayout.push({name:t,offset:2*e+(o?1:0)}),r.push({binding:2*e+(o?1:0),visibility:Ld.$X.Fragment,type:Ld.$l.Sampler},{binding:2*e+(o?1:0)+1,visibility:Ld.$X.Fragment,type:Ld.$l.SampledTexture})}),this.uniformsBindGroupLayout=this.engine.device.createBindGroupLayout({entries:r}),this.pipelineLayout=this.engine.device.createPipelineLayout({bindGroupLayouts:[this.uniformsBindGroupLayout]}),o&&(this.uniformBuffer=new jf(this.engine,{data:t instanceof Array?new Float32Array(t):t,usage:Ld.FB.Uniform|Ld.FB.CopyDst}))}}]),n}(),np=function(){function n(t,e){(0,gh.Z)(this,n),this.engine=t,this.options=e,this.texture=void 0,this.sampler=void 0,this.width=void 0,this.height=void 0,this.createTexture()}return(0,vh.Z)(n,[{key:"get",value:function(){return{texture:this.texture,sampler:this.sampler}}},{key:"update",value:function(){}},{key:"resize",value:function(t){var e=t.width,t=t.height;e===this.width&&t===this.height||(this.destroy(),this.createTexture()),this.width=e,this.height=t}},{key:"destroy",value:function(){this.texture&&this.texture.destroy()}},{key:"createTexture",value:function(){var t=this.options,e=(t.data,t.type),n=(void 0===e&&qh.UNSIGNED_BYTE,t.width),i=t.height,r=t.flipY,o=t.format,a=void 0===o?qh.RGBA:o,s=t.mipmap,u=t.wrapS,c=void 0===u?qh.CLAMP_TO_EDGE:u,e=t.wrapT,r=void 0===e?qh.CLAMP_TO_EDGE:e,o=t.aniso,s=void 0===o?0:o,u=t.alignment,e=t.premultiplyAlpha,o=t.mag,u=void 0===o?qh.NEAREST:o,e=t.min,o=void 0===e?qh.NEAREST:e,e=t.colorSpace,t=(void 0===e&&qh.BROWSER_DEFAULT_WEBGL,t.usage);this.width=n,this.height=i,this.texture=this.engine.device.createTexture({size:[n,i,1],mipLevelCount:1,sampleCount:1,dimension:Ld.kd.E2d,format:Kf[a],usage:t||Ld.v2.Sampled|Ld.v2.CopyDst}),(!t||t&Ld.v2.Sampled)&&(this.sampler=this.engine.device.createSampler({addressModeU:Qf[c],addressModeV:Qf[r],addressModeW:Qf[c],magFilter:Jf[u],minFilter:Jf[o],maxAnisotropy:s}))}}]),n}(),ip=(0,Ch.b2)()(tn=function(){function t(){var r=this;(0,gh.Z)(this,t),this.supportWebGPU=!0,this.useWGSL=!1,this.options=void 0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.renderTargetEncoder=void 0,this.commandBuffers=new Array(4).fill(void 0),this.currentRenderPass=null,this.mainRenderPass=null,this.currentRenderTargetViewDescriptor=void 0,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.currentRenderTarget=null,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.renderTargetEncoderDescriptor={label:"renderTarget"},this.computeEncoderDescriptor={label:"compute"},this.pipelines={},this.computePipelines={},this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.transientViewport={x:1/0,y:0,width:0,height:0},this.cachedViewport={x:0,y:0,width:0,height:0},this.clear=function(t){t.framebuffer;var e=t.color,n=t.depth,t=t.stencil;r.options.supportCompute&&r.startComputePass(),r.currentRenderTarget?(r.currentRenderPass&&r.endRenderTargetRenderPass(),r.startRenderTargetRenderPass(r.currentRenderTarget,e||null,!!n,!!t)):(r.mainColorAttachments[0].loadValue=e||Ld.Ws.Load,r.mainDepthAttachment.depthLoadValue=n||Ld.Ws.Load,r.mainDepthAttachment.stencilLoadValue=t?r.clearStencilValue:Ld.Ws.Load,r.mainRenderPass&&r.endMainRenderPass(),r.startMainRenderPass())},this.createModel=function(){var e=(0,mh.Z)(yh().mark(function t(e){var n;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new ep(r,e),t.next=3,n.init();case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),this.createAttribute=function(t){return new zf(r,t)},this.createBuffer=function(t){return new jf(r,t)},this.createElements=function(t){return new Xf(r,t)},this.createTexture2D=function(t){return new np(r,t)},this.createFramebuffer=function(t){return new Zf(r,t)},this.useFramebuffer=function(t,e){r.currentRenderTarget&&r.unbindFramebuffer(r.currentRenderTarget),r.currentRenderTarget=t,r.currentRenderTargetViewDescriptor={dimension:Ld.p_.E2d,arrayLayerCount:1,aspect:Ld.H7.All},r.currentRenderPass=null,e()},this.createComputeModel=function(){var e=(0,mh.Z)(yh().mark(function t(e){var n;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Wf(r,e),t.next=3,n.init();case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}(),this.getCanvas=function(){return r.canvas},this.getGLContext=function(){throw new Error("Method not implemented.")},this.viewport=function(t){var e=t.x,n=t.y,i=t.width,t=t.height;r.currentRenderPass?r.transientViewport.x!==1/0?r.getCurrentRenderPass().setViewport(r.transientViewport.x,r.transientViewport.y,r.transientViewport.width,r.transientViewport.height,0,1):e===r.cachedViewport.x&&n===r.cachedViewport.y&&i===r.cachedViewport.width&&t===r.cachedViewport.height||(r.cachedViewport={x:e,y:n,width:i,height:t},r.getCurrentRenderPass().setViewport(e,n,i,t,0,1)):r.transientViewport={x:e,y:n,width:i,height:t}},this.readPixels=function(t){throw new Error("Method not implemented.")}}var e,n;return(0,vh.Z)(t,[{key:"isFloatSupported",value:function(){return!0}},{key:"init",value:(n=(0,mh.Z)(yh().mark(function t(e){return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.canvas=e.canvas,this.options=e,this.useWGSL=!!e.useWGSL,this.mainPassSampleCount=e.antialiasing?this.defaultSampleCount:1,t.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"setScissor",value:function(t){throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy(),this.tempBuffers.forEach(function(t){return t.destroy()}),this.tempBuffers=[]}},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.renderTargetEncoder=this.device.createCommandEncoder(this.renderTargetEncoderDescriptor),this.options.supportCompute&&(this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor))}},{key:"endFrame",value:function(){this.options.supportCompute&&this.endComputePass(),this.endMainRenderPass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.options.supportCompute&&(this.commandBuffers[2]=this.computeEncoder.finish()),this.commandBuffers[3]=this.renderTargetEncoder.finish(),md?this.device.getQueue().submit(this.commandBuffers.filter(function(t){return t})):this.device.defaultQueue.submit(this.commandBuffers.filter(function(t){return t}))}},{key:"getCurrentRenderPass",value:function(){return this.currentRenderTarget&&!this.currentRenderPass?this.startRenderTargetRenderPass(this.currentRenderTarget,null,!1,!1):this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass}},{key:"initGlslang",value:(e=(0,mh.Z)(yh().mark(function t(){var e,n;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,function(){return Ff.apply(this,arguments)}();case 2:return this.glslang=t.sent,t.next=5,null===(e=navigator)||void 0===e||null===(n=e.gpu)||void 0===n?void 0:n.requestAdapter();case 5:return this.adapter=t.sent,t.next=8,this.adapter.requestDevice();case 8:this.device=t.sent;case 9:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext(md?"gpu":"gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:Ld.v2.OutputAttachment|Ld.v2.CopySrc})}},{key:"initMainAttachments",value:function(){this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing?(t={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:Ld.kd.E2d,format:Ld.EV.BGRA8Unorm,usage:Ld.v2.OutputAttachment},this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(t),this.mainColorAttachments=[{attachment:md?this.mainTexture.createDefaultView():this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:Ld.EG.Store}]):this.mainColorAttachments=[{attachment:md?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:Ld.EG.Store}];var t={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:Ld.kd.E2d,format:md?"depth32float-stencil8":Ld.EV.Depth24PlusStencil8,usage:Ld.v2.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(t),this.mainDepthAttachment={attachment:md?this.depthTexture.createDefaultView():this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:Ld.EG.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:Ld.EG.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&!this.currentRenderTarget&&this.endMainRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=md?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=md?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment}),this.mainRenderPass=this.currentRenderPass,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"startRenderTargetRenderPass",value:function(t,e,n){var i,r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=null===(o=t.get().color)||void 0===o?void 0:o.texture;o&&(i=o.createView(this.currentRenderTargetViewDescriptor));var a,t=null===(t=t.get().depth)||void 0===t?void 0:t.texture;t&&(a=t.createView());r=this.renderTargetEncoder.beginRenderPass({colorAttachments:[{attachment:i,loadValue:null!==e?e:Ld.Ws.Load,storeOp:Ld.EG.Store}],depthStencilAttachment:t&&a?{attachment:a,depthLoadValue:n?this.clearDepthValue:Ld.Ws.Load,depthStoreOp:Ld.EG.Store,stencilLoadValue:r?this.clearStencilValue:Ld.Ws.Load,stencilStoreOp:Ld.EG.Store}:void 0});this.currentRenderPass=r,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"endMainRenderPass",value:function(){this.currentRenderPass===this.mainRenderPass&&null!==this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport(),this.currentRenderPass=null,this.mainRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"endRenderTargetRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport())}},{key:"resetCachedViewport",value:function(){this.cachedViewport={x:0,y:0,width:0,height:0}}},{key:"unbindFramebuffer",value:function(t){this.currentRenderPass&&this.currentRenderPass!==this.mainRenderPass&&this.endRenderTargetRenderPass(),this.transientViewport.x=1/0,this.currentRenderTarget=null,this.currentRenderPass=this.mainRenderPass}}]),t}())||tn;function rp(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var op=(0,Ch.b2)()(o=function(){(0,Ih.Z)(e,Od);var t=rp(e);function e(){return(0,gh.Z)(this,e),t.apply(this,arguments)}return(0,vh.Z)(e,[{key:"onEntityCreated",value:function(){var t=this.config,e=t.widthSegments,n=void 0===e?1:e,i=t.heightSegments,r=void 0===i?1:i,o=t.depthSegments,a=void 0===o?1:o,s=t.halfExtents,u=void 0===s?At.al(.5,.5,.5):s,e=n,i=r,o=a,t=(0,kh.Z)(u,3),s=t[0],n=t[1],r=t[2],c=[At.al(-s,-n,r),At.al(s,-n,r),At.al(s,n,r),At.al(-s,n,r),At.al(s,-n,-r),At.al(-s,-n,-r),At.al(-s,n,-r),At.al(s,n,-r)],h=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],l=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],a=1,u=2,t=3,s=4,n=5,d=[],f=[],p=[],g=[],v=[],y=0,r=function(t,e,n){for(var i,r=0;r<=e;r++)for(i=0;i<=n;i++){var o=At.Ue(),a=At.Ue(),s=At.Ue(),u=At.Ue();At.t7(o,c[h[t][0]],c[h[t][1]],r/e),At.t7(a,c[h[t][0]],c[h[t][2]],i/n),At.lu(s,a,c[h[t][0]]),At.IH(u,o,s),o=r/e,s=i/n,d.push(u[0],u[1],u[2]),f.push(l[t][0],l[t][1],l[t][2]),p.push(o,s),o=.875*(o/=3)+4/64,s=.875*(s/=3)+4/64,o+=t%3/3,s+=Math.floor(t/3)/3,g.push(o,s),r<e&&i<n&&(v.push(y+n+1,y+1,y),v.push(y+n+1,y+n+2,y+1)),y++}};r(0,e,i),r(a,e,i),r(u,e,o),r(t,e,o),r(s,o,i),r(n,o,i);o=yd(d),i=this.getComponent();i.indices=Uint32Array.from(v),i.aabb=o,i.vertexCount=y,i.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(f),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(p),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),e}())||o;function ap(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var sp=(0,Ch.b2)()(pe=function(){(0,Ih.Z)(e,Od);var t=ap(e);function e(){return(0,gh.Z)(this,e),t.apply(this,arguments)}return(0,vh.Z)(e,[{key:"onEntityCreated",value:function(){var t=this.config.geometries,t=void 0===t?[]:t,r=this.getComponent();r.aabb=new hl;var o=[],a=[],s=0;t.forEach(function(t){var e=t.aabb,n=t.indices,i=t.vertexCount,t=t.attributes;r.aabb.add(e),r.vertexCount+=i,n&&a.push.apply(a,(0,xf.Z)(n.map(function(t){return t+s}))),s+=i,t.forEach(function(t,e){o[e]?t.data&&(Sd(t.data)?o[e].push(t.data):Xd(t.data)?o[e].data=function(t,e){if(!t&&!e)throw new Error("Please specify valid arguments for parameters a and b.");if(!e||0===e.length)return t;if(!t||0===t.length)return e;if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))throw new Error("The types of the two arguments passed for parameters a and b do not match.");var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}(o[e].data,t.data):o[e].data=o[e].data.concat(t.data)):(o[e]=t,o[e].dirty=!0)})}),r.attributes=o,r.indices=Uint32Array.from(a),r.dirty=!0}}]),e}())||pe;function up(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var cp=(0,Ch.b2)()(u=function(){(0,Ih.Z)(e,Od);var t=up(e);function e(){return(0,gh.Z)(this,e),t.apply(this,arguments)}return(0,vh.Z)(e,[{key:"onEntityCreated",value:function(){for(var t=this.config,e=t.halfExtents,n=void 0===e?[.5,.5]:e,e=t.widthSegments,i=void 0===e?5:e,e=t.lengthSegments,r=void 0===e?5:e,o=[],a=[],s=[],u=[],c=0,h=0;h<=i;h++)for(var l=0;l<=r;l++){var d=-n[0]+2*n[0]*h/i,f=-(-n[1]+2*n[1]*l/r),p=h/i,g=l/r;o.push(d,0,f),a.push(0,1,0),s.push(p,g),h<i&&l<r&&(u.push(c+r+1,c+1,c),u.push(c+r+1,c+r+2,c+1)),c++}t=yd(o),e=this.getComponent();e.indices=Uint32Array.from(u),e.aabb=t,e.vertexCount=c,e.attributes=[{dirty:!0,name:"position",data:Float32Array.from(o),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(a),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(s),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),e}())||u;function hp(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var lp,dp,fp=(0,Ch.b2)()(i=function(){(0,Ih.Z)(e,Od);var t=hp(e);function e(){return(0,gh.Z)(this,e),t.apply(this,arguments)}return(0,vh.Z)(e,[{key:"onEntityCreated",value:function(){for(var t=this.config,e=t.radius,n=void 0===e?.5:e,e=t.latitudeBands,i=void 0===e?16:e,e=t.longitudeBands,r=void 0===e?16:e,o=[],a=[],s=[],u=[],c=0;c<=i;c++)for(var h=c*Math.PI/i,l=Math.sin(h),d=Math.cos(h),f=0;f<=r;f++){var p=2*f*Math.PI/r-Math.PI/2,g=Math.sin(p),v=Math.cos(p)*l,y=d,m=g*l,p=1-f/r,g=1-c/i;o.push(v*n,y*n,m*n),a.push(v,y,m),s.push(p,g)}for(var x=0;x<i;++x)for(var b=0;b<r;++b){var E=x*(r+1)+b,S=E+r+1;u.push(E+1,S,E),u.push(E+1,S+1,S)}t=yd(o),e=this.getComponent();e.indices=Uint32Array.from(u),e.aabb=t,e.vertexCount=o.length/3,e.attributes=[{dirty:!0,name:"position",data:Float32Array.from(o),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(a),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(s),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),e}())||i;function pp(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var gp,vp,yp,mp=(Pn=(0,Ch.b2)(),a=(0,Ch.f3)(_h.RenderEngine),me=(0,Ch.f3)(_h.ShaderModuleService),Pn((lp=(0,r.Z)((Ee=function(){(0,Ih.Z)(o,$d);var r=pp(o);function o(){var t;(0,gh.Z)(this,o);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,ph.Z)(t,"engine",lp,(0,Uh.Z)(t)),(0,ph.Z)(t,"shaderModuleService",dp,(0,Uh.Z)(t)),t}return(0,vh.Z)(o,[{key:"onEntityCreated",value:function(){var t=this.getComponent(),e=this.engine.supportWebGPU?"layout(set = 0, binding = 0) uniform Uniforms {\n  vec4 color;\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} uniforms;\n\nlayout(location = 0) in vec3 position;\n// layout(location = 1) in vec3 barycentric;\n\nlayout(location = 0) out vec4 fragColor;\n// layout(location = 1) out vec3 v_Barycentric;\n\nvoid main() {\n  gl_Position = uniforms.projectionMatrix * uniforms.modelViewMatrix * vec4(position, 1.0);\n  fragColor = uniforms.color;\n  // v_Barycentric = barycentric;\n}":'attribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec4 color;\n\nvarying vec4 fragColor;\n\n#pragma include "uv.vert.declaration"\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  fragColor = color;\n\n  #pragma include "uv.vert.main"\n}',n=this.engine.supportWebGPU?"// layout(set = 0, binding = 1) uniform WireframeUniforms {\n//   float lineWidth;\n//   vec4 lineColor;\n// } wireframe;\n\nlayout(location = 0) in vec4 fragColor;\n// layout(location = 1) in vec3 v_Barycentric;\n\nlayout(location = 0) out vec4 outColor;\n\n// wireframe\n// float edgeFactor() {\n//   vec3 d = fwidth(v_Barycentric);\n//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);\n//   return min(min(a3.x, a3.y), a3.z);\n// }\n\nvoid main() {\n  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));\n  outColor = fragColor;\n}":'varying vec4 fragColor;\n\n#pragma include "uv.frag.declaration"\n#pragma include "map.frag.declaration"\n\nvoid main() {\n  vec4 diffuseColor = fragColor;\n\n  #pragma include "map.frag.main"\n\n  gl_FragColor = diffuseColor;\n}';this.shaderModuleService.registerModule("material-basic",{vs:e,fs:n});var i=this.shaderModuleService.getModule("material-basic"),e=i.vs,n=i.fs,i=i.uniforms;t.vertexShaderGLSL=e,t.fragmentShaderGLSL=n,t.setUniform(i),this.config.map&&(t.setDefines({USE_UV:1,USE_MAP:1}),t.setUniform({map:this.config.map,uvTransform:_t.create()}))}}]),o}()).prototype,"engine",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=(0,r.Z)(Ee.prototype,"shaderModuleService",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Ee))||mt);function xp(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var bp,Ep,Sp,wp=(be=(0,Ch.b2)(),tn=(0,Ch.f3)(_h.Systems),o=(0,Ch.t6)(_h.MaterialSystem),pe=(0,Ch.f3)(_h.Systems),u=(0,Ch.t6)(_h.GeometrySystem),i=(0,Ch.f3)(_h.ShaderModuleService),be((gp=(0,r.Z)((Pn=function(){(0,Ih.Z)(o,tf);var r=xp(o);function o(){var t;(0,gh.Z)(this,o);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,ph.Z)(t,"materialSystem",gp,(0,Uh.Z)(t)),(0,ph.Z)(t,"geometrySystem",vp,(0,Uh.Z)(t)),(0,ph.Z)(t,"shaderModuleService",yp,(0,Uh.Z)(t)),t}return(0,vh.Z)(o,[{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data,t=this.getMeshComponent();t&&t.material&&("gridColor"===e?(t.material.setUniform("u_GridColor",n),t.material.setUniform("u_GridColor2",n)):"gridSize"===e&&(t.material.setUniform("u_GridSize",n),t.material.setUniform("u_GridSize2",n)))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:"attribute vec3 a_Position;\n\nvarying vec3 v_Position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nvoid main() {\n  v_Position = a_Position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_Position, 1.);\n}",fs:"// generate grid, borrow from clay.gl viewer\n// @see https://github.com/pissang/clay-viewer/blob/master/src/graphic/ground.glsl\n#extension GL_OES_standard_derivatives : enable\n\nvarying vec3 v_Position;\n// varying vec3 v_Normal;\n\nuniform float u_GridSize : 5;\nuniform float u_GridSize2 : .5;\nuniform vec4 u_GridColor : [0, 0, 0, 1];\nuniform vec4 u_GridColor2 : [0.3, 0.3, 0.3, 1];\nuniform bool u_GridEnabled : true;\n\n// uniform vec3 u_LightDirection;\n// uniform vec3 u_LightColor;\n// uniform vec3 u_Camera;\n\nvoid main() {\n  // vec3 n = v_Normal;\n  // vec3 l = normalize(u_LightDirection);\n  // float NdotL = clamp(dot(n, l), 0.001, 1.0);\n\n  gl_FragColor = vec4(1.);\n\n  if (u_GridEnabled) {\n    float wx = v_Position.x;\n    float wz = v_Position.z;\n    // float x0 = abs(fract(wx / u_GridSize - 0.5) - 0.5) / fwidth(wx) * u_GridSize / 2.0;\n    // float z0 = abs(fract(wz / u_GridSize - 0.5) - 0.5) / fwidth(wz) * u_GridSize / 2.0;\n\n    float x1 = abs(fract(wx / u_GridSize2 - 0.5) - 0.5) / fwidth(wx) * u_GridSize2;\n    float z1 = abs(fract(wz / u_GridSize2 - 0.5) - 0.5) / fwidth(wz) * u_GridSize2;\n\n    // float v0 = 1.0 - clamp(min(x0, z0), 0.0, 1.0);\n    float v1 = 1.0 - clamp(min(x1, z1), 0.0, 1.0);\n    // if (v0 > 0.1) {\n        // gl_FragColor = mix(gl_FragColor, u_GridColor, v0);\n    // }\n    // else {\n        gl_FragColor = mix(gl_FragColor, u_GridColor2, v1);\n    // }\n  }\n\n  // float shadowFactor = calcShadow(u_ShadowMap, v_PositionFromLight, l, n);\n  // vec3 diffuseColor = u_LightColor * NdotL * shadowFactor;\n\n  // gl_FragColor.rgb *= diffuseColor;\n}"});var t=this.shaderModuleService.getModule("grid"),e=t.vs,n=t.fs,t=t.uniforms,e=this.materialSystem.createShaderMaterial({vertexShader:e,fragmentShader:n});this.setMaterial(e);n=this.geometrySystem.createBufferGeometry({vertexCount:4});this.setGeometry(n),e.setCull({enable:!1,face:qh.BACK}).setDepth({enable:!0,func:qh.LESS}),e.setUniform(t),this.setAttributes({gridColor:this.config.gridColor,gridSize:this.config.gridSize}),n.setIndex([0,3,2,2,1,0]),n.setAttribute("a_Position",Float32Array.from([-4,-1,-4,4,-1,-4,4,-1,4,-4,-1,4]),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})}}]),o}()).prototype,"materialSystem",[tn,o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=(0,r.Z)(Pn.prototype,"geometrySystem",[pe,u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=(0,r.Z)(Pn.prototype,"shaderModuleService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=Pn))||a),kp=n(32644),Cp=n(40582);function _p(t,e,n,i,r){Mp(e,i,-r),Mp(e,i,r),t.push(n),t.push(n)}function Mp(t,e,n){t.push([[e[0],e[1]],n])}function Ip(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var Tp,Ap,Pp,Dp=(me=(0,Ch.b2)(),Ee=(0,Ch.f3)(_h.Systems),mt=(0,Ch.t6)(_h.MaterialSystem),be=(0,Ch.f3)(_h.Systems),tn=(0,Ch.t6)(_h.GeometrySystem),o=(0,Ch.f3)(_h.ShaderModuleService),me((bp=(0,r.Z)((pe=function(){(0,Ih.Z)(o,tf);var r=Ip(o);function o(){var t;(0,gh.Z)(this,o);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,ph.Z)(t,"materialSystem",bp,(0,Uh.Z)(t)),(0,ph.Z)(t,"geometrySystem",Ep,(0,Uh.Z)(t)),(0,ph.Z)(t,"shaderModuleService",Sp,(0,Uh.Z)(t)),t.vertexCount=void 0,t}return(0,vh.Z)(o,[{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data,i=this.getMeshComponent();if(i&&i.material)switch(e){case"dashArray":i.material.setUniform("u_dash_array",n);break;case"dashOffset":i.material.setUniform("u_dash_offset",n);break;case"dashRatio":i.material.setUniform("u_dash_ratio",n);break;case"thickness":i.material.setUniform("u_thickness",n);break;case"color":var r=new Array(this.vertexCount).fill(void 0).map(function(){return n}).reduce(function(t,e){return[].concat((0,xf.Z)(t),(0,xf.Z)(e))},[]);i.geometry.setAttribute("a_color",Float32Array.from(r),{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]})}}},{key:"onEntityCreated",value:function(){var t=this;this.shaderModuleService.registerModule("line",{vs:"attribute vec2 a_pos;\nattribute vec4 a_color;\nattribute float a_line_miter;\nattribute vec2 a_line_normal;\nattribute float a_counters;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float u_thickness : 0.02;\nuniform vec2 u_viewport;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n  v_color = a_color;\n  v_counters = a_counters;\n\n  vec3 normal = normalize(vec3(a_line_normal, 0.0));\n\n  vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);\n\n  v_normal = vec2(normal * sign(a_line_miter));\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_pos, 0.0, 1.0) + offset;\n}\n",fs:"uniform float u_dash_array : 0.02;\nuniform float u_dash_offset : 0;\nuniform float u_dash_ratio : 0;\nuniform float u_thickness : 0.02;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n    float blur = 1. - smoothstep(0.98, 1., length(v_normal));\n\n    gl_FragColor = v_color;\n    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}"});var e=this.shaderModuleService.getModule("line"),n=e.vs,i=e.fs,r=e.uniforms,o=this.materialSystem.createShaderMaterial({vertexShader:n,fragmentShader:i}),a=function(t,e,n){var i=[0,0],r=[0,0],o=[0,0],a=[0,0],s=-1,u=!1,c=null,h=(0,kp.create)(),l=n||0,d=[],f=[],p=[],g=[0,0];e&&(t=t.slice()).push(t[0]);for(var v=t.length,y=1;y<v;y++){var m,x=l,b=t[y-1],E=t[y],S=y<t.length-1?t[y+1]:null;g.push(y/v,y/v),(0,Cp.o7)(i,E,b),c||(0,Cp.mJ)(c=[0,0],i),u||(u=!0,_p(f,d,b,c,1)),p.push([x+0,x+1,x+2]),S?((0,Cp.o7)(r,S,E),m=(0,Cp.x7)(o,a,i,r,1),b=(0,kp.dot)(o,c)<0?-1:1,S=3<m,s=(isFinite(m)?S?(m=3,g.push(y/v),Mp(d,c,-b),f.push(E),Mp(d,a,m*b),f.push(E),p.push(s!==-b?[x,x+2,x+3]:[x+2,x+1,x+3]),p.push([x+2,x+3,x+4]),(0,Cp.mJ)(h,r),(0,kp.copy)(c,h),Mp(d,c,-b),f.push(E),l+=3):(_p(f,d,E,a,m),p.push(1===s?[x,x+2,x+3]:[x+2,x+1,x+3]),b=-1,(0,kp.copy)(c,a),l+=2):((0,Cp.mJ)(c,i),_p(f,d,E,c,1),p.push(1===s?[x,x+2,x+3]:[x+2,x+1,x+3]),l+=2),b)):((0,Cp.mJ)(c,i),_p(f,d,E,c,1),p.push(1===s?[x,x+2,x+3]:[x+2,x+1,x+3]),l+=2)}return{normals:d,attrIndex:p,attrPos:f,attrCounters:g}}(this.config.points,!1),s=a.normals,u=a.attrIndex,e=a.attrPos,n=a.attrCounters,i=e.length;this.vertexCount=i;a=this.geometrySystem.createBufferGeometry({vertexCount:i});this.setMaterial(o),this.setGeometry(a),o.setCull({enable:!1,face:qh.BACK}).setUniform(r),this.setAttributes({dashArray:this.config.dashArray,dashOffset:this.config.dashOffset,dashRatio:this.config.dashRatio,thickness:this.config.thickness});var c=[],h=[];s.forEach(function(t){var e=t[0],t=t[1];c.push([e[0],e[1]]),h.push(t)}),a.setIndex(u.reduce(function(t,e){return[].concat((0,xf.Z)(t),(0,xf.Z)(e))},[])),a.setAttribute("a_pos",Float32Array.from(e.reduce(function(t,e){return[].concat((0,xf.Z)(t),(0,xf.Z)(e))},[])),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]});i=new Array(i).fill(void 0).map(function(){return(0,xf.Z)(t.config.color)}).reduce(function(t,e){return[].concat((0,xf.Z)(t),(0,xf.Z)(e))},[]);a.setAttribute("a_color",Float32Array.from(i),{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]}),a.setAttribute("a_line_miter",Float32Array.from(h),{arrayStride:4,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float"}]}),a.setAttribute("a_line_normal",Float32Array.from(c.reduce(function(t,e){return[].concat((0,xf.Z)(t),(0,xf.Z)(e))},[])),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:3,offset:0,format:"float2"}]}),a.setAttribute("a_counters",Float32Array.from(n),{arrayStride:4,stepMode:"vertex",attributes:[{shaderLocation:4,offset:0,format:"float"}]})}}]),o}()).prototype,"materialSystem",[Ee,mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ep=(0,r.Z)(pe.prototype,"geometrySystem",[be,tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sp=(0,r.Z)(pe.prototype,"shaderModuleService",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=pe))||u);function Np(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Op(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=(0,Ah.Z)(n);return e=i?(t=(0,Ah.Z)(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),(0,Th.Z)(this,e)}}var Lp,Rp,Bp,Gp=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],Up=(i=(0,Ch.b2)(),Pn=(0,Ch.f3)(_h.Systems),a=(0,Ch.t6)(_h.MaterialSystem),me=(0,Ch.f3)(_h.Systems),Ee=(0,Ch.t6)(_h.GeometrySystem),mt=(0,Ch.f3)(_h.ShaderModuleService),i((Tp=(0,r.Z)((be=function(){(0,Ih.Z)(o,tf);var r=Op(o);function o(){var t;(0,gh.Z)(this,o);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t=r.call.apply(r,[this].concat(n)),(0,ph.Z)(t,"materialSystem",Tp,(0,Uh.Z)(t)),(0,ph.Z)(t,"geometrySystem",Ap,(0,Uh.Z)(t)),(0,ph.Z)(t,"shaderModuleService",Pp,(0,Uh.Z)(t)),t}return(0,vh.Z)(o,[{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data,t=this.getMeshComponent();t&&t.material&&("strokeWidth"===e?t.material.setUniform("u_stroke_width",n):"strokeColor"===e?t.material.setUniform("u_stroke_color",n):"strokeOpacity"===e?t.material.setUniform("u_stroke_opacity",n):"opacity"===e?t.material.setUniform("u_opacity",n):"blur"===e&&t.material.setUniform("u_blur",n))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:'attribute vec2 position;\nattribute vec4 color;\nattribute float shape;\nattribute vec2 offset;\nattribute float size;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nuniform float u_stroke_width : 0.01;\nuniform float u_device_pixel_ratio;\nuniform vec2 u_viewport;\n\nvarying vec4 v_color;\nvarying vec4 v_data;\nvarying float v_radius;\n\n#pragma include "picking"\n\nvoid main() {\n  v_color = color;\n  v_radius = size;\n\n  lowp float antialiasblur = 1.0 / u_device_pixel_ratio * (size + u_stroke_width);\n\n  // construct point coords\n  v_data = vec4(position, antialiasblur, shape);\n\n  gl_Position = projectionMatrix * modelViewMatrix\n    * vec4(position * size + offset, 0.0, 1.0);\n\n  setPickingColor(a_PickingColor);\n}',fs:"uniform float u_blur : 0.05;\nuniform float u_opacity : 0.7;\nuniform float u_stroke_width : 0.01;\nuniform vec4 u_stroke_color : [0, 0, 0, 0];\nuniform float u_stroke_opacity : 1;\n\nvarying vec4 v_color;\nvarying vec4 v_data;\nvarying float v_radius;\n\n#pragma include \"sdf2d\"\n#pragma include \"picking\"\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  float antialiasblur = v_data.z;\n  float antialiased_blur = -max(u_blur, antialiasblur);\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  // if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  // } else if (shape == 1) {\n  //   outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n  //   inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  // } else if (shape == 2) {\n  //   outer_df = sdBox(v_data.xy, vec2(1.));\n  //   inner_df = sdBox(v_data.xy, vec2(r));\n  // } else if (shape == 3) {\n  //   outer_df = sdPentagon(v_data.xy, 0.8);\n  //   inner_df = sdPentagon(v_data.xy, r * 0.8);\n  // } else if (shape == 4) {\n  //   outer_df = sdHexagon(v_data.xy, 0.8);\n  //   inner_df = sdHexagon(v_data.xy, r * 0.8);\n  // } else if (shape == 5) {\n  //   outer_df = sdOctogon(v_data.xy, 1.0);\n  //   inner_df = sdOctogon(v_data.xy, r);\n  // } else if (shape == 6) {\n  //   outer_df = sdHexagram(v_data.xy, 0.52);\n  //   inner_df = sdHexagram(v_data.xy, r * 0.52);\n  // } else if (shape == 7) {\n  //   outer_df = sdRhombus(v_data.xy, vec2(1.0));\n  //   inner_df = sdRhombus(v_data.xy, vec2(r));\n  // } else if (shape == 8) {\n  //   outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n  //   inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  // }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;\n\n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  gl_FragColor.a = gl_FragColor.a * opacity_t;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}"});var t=this.shaderModuleService.getModule("grid"),e=t.vs,n=t.fs,t=t.uniforms,e=this.materialSystem.createShaderMaterial({vertexShader:e,fragmentShader:n,cull:{enable:!1},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:qh.SRC_ALPHA,dstRGB:qh.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}});e.setUniform(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Np(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Np(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({u_device_pixel_ratio:window.devicePixelRatio},t));n=this.buildAttributes(),t=this.geometrySystem.createInstancedBufferGeometry({maxInstancedCount:n.instancedOffsets.length/2,vertexCount:6});t.setIndex([0,2,1,0,3,2]),t.setAttribute("position",Float32Array.from(n.positions),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]}),t.setAttribute("offset",Float32Array.from(n.instancedOffsets),{arrayStride:8,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),t.setAttribute("color",Float32Array.from(n.instancedColors),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),t.setAttribute("size",Float32Array.from(n.instancedSizes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}),t.setAttribute("shape",Float32Array.from(n.instancedShapes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float"}]}),t.setAttribute("a_PickingColor",Float32Array.from(n.instancedPickingColors),{arrayStride:12,stepMode:"instance",attributes:[{shaderLocation:6,offset:0,format:"float3"}]}),this.setMaterial(e),this.setGeometry(t)}},{key:"buildAttribute",value:function(t,e,n){var i;(i=e.instancedPickingColors).push.apply(i,(0,xf.Z)([(n=t.id||n)+1&255,n+1>>8&255,n+1>>8>>8&255])),e.instancedShapes.push(Gp.indexOf(t.shape||"circle")),(n=e.instancedColors).push.apply(n,(0,xf.Z)(t.color||[1,0,0,1])),(n=e.instancedOffsets).push.apply(n,(0,xf.Z)(t.position||[0,0])),(e=e.instancedSizes).push.apply(e,(0,xf.Z)(t.size||[.2,.2]))}},{key:"buildAttributes",value:function(){var n=this,i={positions:[1,1,1,-1,-1,-1,-1,1],instancedOffsets:[],instancedColors:[],instancedSizes:[],instancedShapes:[],instancedPickingColors:[]};return Array.isArray(this.config)?this.config.forEach(function(t,e){n.buildAttribute(t,i,e)}):this.buildAttribute(this.config,i,0),i}}]),o}()).prototype,"materialSystem",[Pn,a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ap=(0,r.Z)(be.prototype,"geometrySystem",[me,Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=(0,r.Z)(be.prototype,"shaderModuleService",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=be))||tn);function Fp(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return zp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zp(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,e=function(){};return{s:e,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}function zp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var jp,Wp,Xp=(o=(0,Ch.b2)(),pe=(0,Ch.f3)(_h.RenderEngine),u=(0,Ch.f3)(_h.ShaderModuleService),i=(0,Ch.f3)(_h.ConfigService),o((Lp=(0,r.Z)((Pn=function(){function t(){(0,gh.Z)(this,t),(this.container=void 0,ph.Z)(this,"engine",Lp,this),(0,ph.Z)(this,"shaderModule",Rp,this),(0,ph.Z)(this,"configService",Bp,this),this.inited=!1,this.rendering=!1,this.pendings=[],this.views=[],this.size=void 0}var e,n;return(0,vh.Z)(t,[{key:"init",value:(n=(0,mh.Z)(yh().mark(function t(){var e,n,i;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shaderModule.registerBuiltinModules(),this.shaderModule.registerModule("uv.vert.declaration",{vs:"#ifdef USE_UV\n  attribute vec2 uv;\n\t#ifdef UVS_VERTEX_ONLY\n    vec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif"}),this.shaderModule.registerModule("uv.vert.main",{vs:"#ifdef USE_UV\n  vUv = (uvTransform * vec3(uv, 1)).xy;\n#endif"}),this.shaderModule.registerModule("uv.frag.declaration",{fs:"#if (defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ))\n  varying vec2 vUv;\n#endif"}),this.shaderModule.registerModule("map.frag.declaration",{fs:"#ifdef USE_MAP\n  uniform sampler2D map;\n#endif"}),this.shaderModule.registerModule("map.frag.main",{fs:"#ifdef USE_MAP\n  vec4 texelColor = texture2D(map, vUv);\n  // texelColor = mapTexelToLinear(texelColor);\n  diffuseColor *= texelColor;\n#endif"}),e=this.container.getAll(_h.Systems),(i=this.configService.get()).canvas)return t.next=11,this.engine.init({canvas:i.canvas,swapChainFormat:Ld.EV.BGRA8Unorm,antialiasing:!1});t.next=30;break;case 11:n=Fp(e),t.prev=12,n.s();case 14:if((i=n.n()).done){t.next=21;break}if((i=i.value).initialize)return t.next=19,i.initialize();t.next=19;break;case 19:t.next=14;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(12),n.e(t.t0);case 26:return t.prev=26,n.f(),t.finish(26);case 29:this.inited=!0;case 30:case"end":return t.stop()}},t,this,[[12,23,26,29]])})),function(){return n.apply(this,arguments)})},{key:"render",value:(e=(0,mh.Z)(yh().mark(function t(){var e,n,i,r,o,a=arguments;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.inited||this.rendering)return t.abrupt("return");t.next=2;break;case 2:for(this.pendings.length&&this.pendings.forEach(function(t){t()}),this.rendering=!0,this.engine.beginFrame(),o=this.container.getAll(_h.Systems),e=a.length,n=new Array(e),i=0;i<e;i++)n[i]=a[i];r=Fp(o),t.prev=8,r.s();case 10:if((o=r.n()).done){t.next=17;break}if((o=o.value).execute)return t.next=15,o.execute(n);t.next=15;break;case 15:t.next=10;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(8),r.e(t.t0);case 22:return t.prev=22,r.f(),t.finish(22);case 25:this.engine.endFrame(),this.rendering=!1;case 27:case"end":return t.stop()}},t,this,[[8,19,22,25]])})),function(){return e.apply(this,arguments)})},{key:"clear",value:function(t){var e=this;return this.inited?this.engine.clear(t):this.pendings.unshift(function(){e.engine.clear(t),e.pendings.shift()}),this}},{key:"setSize",value:function(t){var e=t.width,n=t.height,t=this.engine.getCanvas();return this.size={width:e,height:n},t.width=e,t.height=n,this}},{key:"getSize",value:function(){return this.size}}]),t}()).prototype,"engine",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=(0,r.Z)(Pn.prototype,"shaderModule",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=(0,r.Z)(Pn.prototype,"configService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=Pn))||a),Zp=(0,Ch.b2)()(me=function(){function t(){(0,gh.Z)(this,t),this.entities=[]}return(0,vh.Z)(t,[{key:"getEntities",value:function(){return this.entities}},{key:"addRenderable",value:function(t){return this.addEntity(t.getEntity()),this}},{key:"removeRenderable",value:function(t){return this.removeEntity(t.getEntity()),this}},{key:"addLight",value:function(){}},{key:"addEntity",value:function(t){return-1===this.entities.indexOf(t)&&this.entities.push(t),this}},{key:"removeEntity",value:function(t){t=this.entities.indexOf(t);return this.entities.splice(t,1),this}}]),t}())||me,Vp=(0,Ch.b2)()(Ee=function(){function t(){(0,gh.Z)(this,t),this.cache={}}return(0,vh.Z)(t,[{key:"get",value:function(t){return this.cache[t]}},{key:"set",value:function(t,e){this.cache[t]=e}}]),t}())||Ee;function Yp(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Hp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yp(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yp(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var qp,Kp,Jp=(mt=(0,Ch.b2)(),be=(0,Ch.f3)(Vp),tn=(0,Ch.f3)(_h.RenderEngine),mt((jp=(0,r.Z)((o=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"textureCache",jp,this),(0,ph.Z)(this,"engine",Wp,this),this.config=void 0,this.loaded=!1,this.texture=void 0}var e;return(0,vh.Z)(t,[{key:"setConfig",value:function(t){this.config=t}},{key:"isLoaded",value:function(){return this.loaded}},{key:"load",value:(e=(0,mh.Z)(yh().mark(function t(){var r=this;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.config.url)return t.abrupt("return",new Promise(function(e,t){var n,i=r.textureCache.get(r.config.url);i?e(i):((n=new Image).crossOrigin="Anonymous",n.src=r.config.url,n.onload=function(){var t=r.engine.createTexture2D(Hp(Hp({},r.config),{},{data:n,width:n.width,height:n.height,flipY:!0}));r.textureCache.set(r.config.url,t),r.texture=t,r.loaded=!0,e(t)},n.onerror=function(){t()})}));t.next=4;break;case 4:return this.loaded=!0,this.texture=this.engine.createTexture2D(this.config),t.abrupt("return",this.texture);case 7:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})}]),t}()).prototype,"textureCache",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp=(0,r.Z)(o.prototype,"engine",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=o))||pe),Qp=(u=(0,Ch.b2)(),i=(0,Ch.f3)(_h.Systems),Pn=(0,Ch.t6)(_h.RendererSystem),u((qp=(0,r.Z)((a=function(){function t(){(0,gh.Z)(this,t),(0,ph.Z)(this,"rendererSystem",qp,this),this.camera=void 0,this.scene=void 0,this.viewport={x:0,y:0,width:0,height:0},this.clearColor=[1,1,1,1]}return(0,vh.Z)(t,[{key:"getCamera",value:function(){return this.camera}},{key:"getScene",value:function(){return this.scene}},{key:"getViewport",value:function(){return this.viewport}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setCamera",value:function(t){return this.camera=t,this}},{key:"setScene",value:function(t){return this.scene=t,this}},{key:"setViewport",value:function(t){return this.viewport=t,this}},{key:"setClearColor",value:function(t){return this.clearColor=t,this}},{key:"pick",value:function(t){return this.rendererSystem.pick(t,this)}}]),t}()).prototype,"rendererSystem",[i,Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=a))||me);function $p(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}var tg=(Ee=(0,Ch.b2)(),mt=(0,Ch.f3)(_h.ConfigService),Ee((Kp=(0,r.Z)((be=function(){function i(){(0,gh.Z)(this,i),(0,ph.Z)(this,"configService",Kp,this),this.container=void 0}var t;return(0,vh.Z)(i,[{key:"getEngine",value:(t=(0,mh.Z)(yh().mark(function t(){var e,n,i;return yh().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.container.get(_h.RenderEngine),i=this.configService.get(),n=i.canvas,i=i.engineOptions,t.next=4,e.init(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$p(Object(n),!0).forEach(function(t){(0,Gh.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({canvas:n||Rd(),swapChainFormat:Ld.EV.BGRA8Unorm,antialiasing:!1},i));case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"getTransformComponent",value:function(t){return this.container.get(_h.TransformComponentManager).getComponentByEntity(t)}},{key:"getMeshComponent",value:function(t){return this.container.get(_h.MeshComponentManager).getComponentByEntity(t)}},{key:"setConfig",value:function(t){this.configService.set(t)}},{key:"setContainer",value:function(t){this.container=t}},{key:"getContainer",value:function(){return this.container}},{key:"createEntity",value:function(){return xh++}},{key:"createScene",value:function(){return this.container.get(Zp)}},{key:"createCamera",value:function(){return this.container.get(Nd)}},{key:"createView",value:function(){return this.container.get(Qp)}},{key:"createRenderable",value:function(t,e){var n=t?this.container.getNamed(_h.Renderable,t):this.container.get(tf),t=xh++;return n.setConfig(e||{}),n.setEntity(t),n}},{key:"createGeometry",value:function(t,e){var n=this.container.getNamed(_h.Geometry,t),t=xh++;return n.setConfig(e||{}),n.setEntity(t),n.getComponent()}},{key:"createMaterial",value:function(t,e){var n=this.container.getNamed(_h.Material,t),i=xh++;return n.setConfig(e||{}),n.setEntity(i,t),n.getComponent()}},{key:"createTexture2D",value:function(t){var e=this.container.get(Jp);return e.setConfig(t),e}},{key:"createBufferGeometry",value:function(t){return this.container.getNamed(_h.Systems,_h.GeometrySystem).createBufferGeometry(t)}},{key:"createInstancedBufferGeometry",value:function(t){return this.container.getNamed(_h.Systems,_h.GeometrySystem).createInstancedBufferGeometry(t)}},{key:"createShaderMaterial",value:function(t){return this.container.getNamed(_h.Systems,_h.MaterialSystem).createShaderMaterial(t)}},{key:"createKernel",value:function(t){var e=this.container.get(Qd);return"string"==typeof t?e.setBundle(JSON.parse(t)):e.setBundle(t),e.init(),e}},{key:"createRenderer",value:function(){var t=this.container.get(Xp);return t.container=this.container,t.init(),t}},{key:"destroy",value:function(){this.container.getAll(_h.Systems).forEach(function(t){t.tearDown&&t.tearDown()}),this.container.get(_h.RenderEngine).destroy(),this.container.get(_h.InteractorService).destroy()}}],[{key:"create",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=((n=new Ch.W2).parent=vd,n.bind(_h.Systems).to(nd).inSingletonScope().whenTargetNamed(_h.SceneGraphSystem),n.bind(_h.Systems).to(Bh).inSingletonScope().whenTargetNamed(_h.FrameGraphSystem),n.bind(_h.Systems).to(Pl).inSingletonScope().whenTargetNamed(_h.MeshSystem),n.bind(_h.Systems).to(Qh).inSingletonScope().whenTargetNamed(_h.GeometrySystem),n.bind(_h.Systems).to(ul).inSingletonScope().whenTargetNamed(_h.MaterialSystem),n.bind(_h.Systems).to(Jl).inSingletonScope().whenTargetNamed(_h.RendererSystem),n.bind(_h.ResourcePool).to(ad).inSingletonScope(),n.bind(_h.ConfigService).to(ud).inSingletonScope(),n.bind(_h.InteractorService).to(cd).inSingletonScope(),n.bind(_h.RenderPass).to(Ul).inSingletonScope().whenTargetNamed(Ul.IDENTIFIER),n.bind(_h.RenderPass).to(Kl).inSingletonScope().whenTargetNamed(Kl.IDENTIFIER),n.bind(_h.RenderPass).to(ql).inSingletonScope().whenTargetNamed(ql.IDENTIFIER),n.bind(_h.RenderPassFactory).toFactory(function(e){return function(t){return e.container.getNamed(_h.RenderPass,t)}}),n),n=navigator.gpu?ip:Gf;e.isBound(_h.RenderEngine)||e.bind(_h.RenderEngine).to(n).inSingletonScope(),e.bind(Xp).toSelf(),e.bind(Qd).toSelf(),e.bind(tf).toSelf(),e.bind(Qp).toSelf(),e.bind(Nd).toSelf(),e.bind(Zp).toSelf(),e.bind(i).toSelf(),e.bind(Vp).toSelf(),e.bind(Jp).toSelf(),e.bind(_h.Geometry).to(op).whenTargetNamed(Od.BOX),e.bind(_h.Geometry).to(fp).whenTargetNamed(Od.SPHERE),e.bind(_h.Geometry).to(cp).whenTargetNamed(Od.PLANE),e.bind(_h.Geometry).to(sp).whenTargetNamed(Od.MERGED),e.bind(_h.Material).to(mp).whenTargetNamed($d.BASIC),e.bind(_h.Renderable).to(Up).whenTargetNamed(tf.POINT),e.bind(_h.Renderable).to(Dp).whenTargetNamed(tf.LINE),e.bind(_h.Renderable).to(wp).whenTargetNamed(tf.GRID);n=e.get(i);return n.setContainer(e),n.setConfig(t),n}}]),i}()).prototype,"configService",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=be))||tn);const eg=(t,e)=>{let n;return n=t?Uc(t)?()=>t:t:()=>e||1,n},ng=t=>{const i=[],r=t.length;var e=t[0].length;for(let n=0;n<e;n++)t.forEach((t,e)=>{if(i.push(t[n]),e===r-1)for(;i.length%4!=0;)i.push(0)});return new Float32Array(i)};var ig=function(t,a,s,u){return new(s=s||Promise)(function(n,e){function i(t){try{o(u.next(t))}catch(t){e(t)}}function r(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(i,r)}o((u=u.apply(t,a||[])).next())})};Lc;var rg=function(t,a,s,u){return new(s=s||Promise)(function(n,e){function i(t){try{o(u.next(t))}catch(t){e(t)}}function r(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(i,r)}o((u=u.apply(t,a||[])).next())})};Lc;Lc;class og{constructor(t){this.id=t.id||0,this.rx=t.rx,this.ry=t.ry,this.fx=0,this.fy=0,this.mass=t.mass,this.degree=t.degree,this.g=t.g||0}distanceTo(t){var e=this.rx-t.rx,t=this.ry-t.ry;return Math.hypot(e,t)}setPos(t,e){this.rx=t,this.ry=e}resetForce(){this.fx=0,this.fy=0}addForce(t){var e=t.rx-this.rx,n=t.ry-this.ry;let i=Math.hypot(e,n);i=i<1e-4?1e-4:i;t=this.g*(this.degree+1)*(t.degree+1)/i;this.fx+=t*e/i,this.fy+=t*n/i}in(t){return t.contains(this.rx,this.ry)}add(t){var e=this.mass+t.mass,t={rx:(this.rx*this.mass+t.rx*t.mass)/e,ry:(this.ry*this.mass+t.ry*t.mass)/e,mass:e,degree:this.degree+t.degree};return new og(t)}}class ag{constructor(t){this.xmid=t.xmid,this.ymid=t.ymid,this.length=t.length,this.massCenter=t.massCenter||[0,0],this.mass=t.mass||1}getLength(){return this.length}contains(t,e){var n=this.length/2;return t<=this.xmid+n&&t>=this.xmid-n&&e<=this.ymid+n&&e>=this.ymid-n}NW(){var t={xmid:this.xmid-this.length/4,ymid:this.ymid+this.length/4,length:this.length/2};return new ag(t)}NE(){var t={xmid:this.xmid+this.length/4,ymid:this.ymid+this.length/4,length:this.length/2};return new ag(t)}SW(){var t={xmid:this.xmid-this.length/4,ymid:this.ymid-this.length/4,length:this.length/2};return new ag(t)}SE(){var t={xmid:this.xmid+this.length/4,ymid:this.ymid-this.length/4,length:this.length/2};return new ag(t)}}class sg{constructor(t){this.body=null,this.quad=null,this.NW=null,this.NE=null,this.SW=null,this.SE=null,this.theta=.5,null!=t&&(this.quad=t)}insert(t){null!=this.body?this._isExternal()?(this.quad&&(this.NW=new sg(this.quad.NW()),this.NE=new sg(this.quad.NE()),this.SW=new sg(this.quad.SW()),this.SE=new sg(this.quad.SE())),this._putBody(this.body),this._putBody(t),this.body=this.body.add(t)):(this.body=this.body.add(t),this._putBody(t)):this.body=t}_putBody(t){this.quad&&(t.in(this.quad.NW())&&this.NW?this.NW.insert(t):t.in(this.quad.NE())&&this.NE?this.NE.insert(t):t.in(this.quad.SW())&&this.SW?this.SW.insert(t):t.in(this.quad.SE())&&this.SE&&this.SE.insert(t))}_isExternal(){return null==this.NW&&null==this.NE&&null==this.SW&&null==this.SE}updateForce(t){null!=this.body&&t!==this.body&&(this._isExternal()||(this.quad?this.quad.getLength():0)/this.body.distanceTo(t)<this.theta?t.addForce(this.body):(this.NW&&this.NW.updateForce(t),this.NE&&this.NE.updateForce(t),this.SW&&this.SW.updateForce(t),this.SE&&this.SE.updateForce(t)))}}Lc;const ug=new Proxy({},{get:(t,e)=>{return e=e,Hc.has(e)?Hc.get(e):null},set:(t,e,n)=>(qc(e,n),!0)});qc("grid",class extends Lc{constructor(t){super(),this.begin=[0,0],this.preventOverlap=!0,this.preventOverlapPadding=10,this.condense=!1,this.sortBy="degree",this.nodeSize=30,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.row=0,this.col=0,this.cellWidth=0,this.cellHeight=0,this.cellUsed={},this.id2manPos={},this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{begin:[0,0],preventOverlap:!0,preventOverlapPadding:10,condense:!1,rows:void 0,cols:void 0,position:void 0,sortBy:"degree",nodeSize:30}}execute(){const r=this,t=r.nodes;var e=t.length,n=r.begin;if(0!==e){if(1===e)return t[0].x=n[0],t[0].y=n[1],void(r.onLayoutEnd&&r.onLayoutEnd());var i=r.edges;const c=[];t.forEach(t=>{c.push(t)});const h={};if(c.forEach((t,e)=>{h[t.id]=e}),("degree"===r.sortBy||!Rc(r.sortBy)||void 0===c[0][r.sortBy])&&(r.sortBy="degree",Fc(t[0].degree))){const l=zc(c.length,h,i);c.forEach((t,e)=>{t.degree=l[e]})}c.sort((t,e)=>e[r.sortBy]-t[r.sortBy]),r.width||"undefined"==typeof window||(r.width=window.innerWidth),r.height||"undefined"==typeof window||(r.height=window.innerHeight);var o=r.rows,n=null!=r.cols?r.cols:r.columns;if(r.cells=e,null!=o&&null!=n?(r.rows=o,r.cols=n):null!=o&&null==n?(r.rows=o,r.cols=Math.ceil(r.cells/r.rows)):null==o&&null!=n?(r.cols=n,r.rows=Math.ceil(r.cells/r.cols)):(r.splits=Math.sqrt(r.cells*r.height/r.width),r.rows=Math.round(r.splits),r.cols=Math.round(r.width/r.height*r.splits)),r.cols*r.rows>r.cells){o=r.small(),n=r.large();(o-1)*n>=r.cells?r.small(o-1):(n-1)*o>=r.cells&&r.large(n-1)}else for(;r.cols*r.rows<r.cells;){var a=r.small(),s=r.large();(s+1)*a>=r.cells?r.large(s+1):r.small(a+1)}r.cellWidth=r.width/r.cols,r.cellHeight=r.height/r.rows,r.condense&&(r.cellWidth=0,r.cellHeight=0),r.preventOverlap&&c.forEach(t=>{t.x&&t.y||(t.x=0,t.y=0);let e,n;Gc(t.size)?(e=t.size[0],n=t.size[1]):Uc(t.size)&&(e=t.size,n=t.size),void 0!==e&&void 0!==n||(n=Gc(r.nodeSize)?(e=r.nodeSize[0],r.nodeSize[1]):Uc(r.nodeSize)?(e=r.nodeSize,r.nodeSize):e=30);var i=r.preventOverlapPadding,t=e+i,i=n+i;r.cellWidth=Math.max(r.cellWidth,t),r.cellHeight=Math.max(r.cellHeight,i)}),r.cellUsed={},r.row=0,r.col=0,r.id2manPos={};for(let e=0;e<c.length;e++){var u=c[e];let t;if(r.position&&(t=r.position(u)),t&&(void 0!==t.row||void 0!==t.col)){const d={row:t.row,col:t.col};if(void 0===d.col)for(d.col=0;r.used(d.row,d.col);)d.col++;else if(void 0===d.row)for(d.row=0;r.used(d.row,d.col);)d.row++;r.id2manPos[u.id]=d,r.use(d.row,d.col)}r.getPos(u)}return r.onLayoutEnd&&r.onLayoutEnd(),{edges:i,nodes:c}}r.onLayoutEnd&&r.onLayoutEnd()}small(t){let e;var n=this.rows||5,i=this.cols||5;return null==t?e=Math.min(n,i):Math.min(n,i)===this.rows?this.rows=t:this.cols=t,e}large(t){let e;var n=this.rows||5,i=this.cols||5;return null==t?e=Math.max(n,i):Math.max(n,i)===this.rows?this.rows=t:this.cols=t,e}used(t,e){return this.cellUsed[`c-${t}-${e}`]||!1}use(t,e){this.cellUsed[`c-${t}-${e}`]=!0}moveToNextCell(){var t=this.cols||5;this.col++,this.col>=t&&(this.col=0,this.row++)}getPos(t){var e=this,n=e.begin,i=e.cellWidth,r=e.cellHeight;let o,a;var s=e.id2manPos[t.id];if(s)o=s.col*i+i/2+n[0],a=s.row*r+r/2+n[1];else{for(;e.used(e.row,e.col);)e.moveToNextCell();o=e.col*i+i/2+n[0],a=e.row*r+r/2+n[1],e.use(e.row,e.col),e.moveToNextCell()}t.x=o,t.y=a}getType(){return"grid"}}),qc("random",class extends Lc{constructor(t){super(),this.center=[0,0],this.width=300,this.height=300,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{center:[0,0],width:300,height:300}}execute(){const e=this,t=e.nodes,n=e.center;return e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight),t&&t.forEach(t=>{t.x=.9*(Math.random()-.5)*e.width+n[0],t.y=.9*(Math.random()-.5)*e.height+n[1]}),e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:this.edges}}getType(){return"random"}}),qc("force",class extends Lc{constructor(t){super(),this.center=[0,0],this.nodeStrength=null,this.edgeStrength=null,this.preventOverlap=!1,this.clusterNodeStrength=null,this.clusterEdgeStrength=null,this.clusterEdgeDistance=null,this.clusterNodeSize=null,this.clusterFociStrength=null,this.linkDistance=50,this.alphaDecay=.028,this.alphaMin=.001,this.alpha=.3,this.collideStrength=1,this.workerEnabled=!1,this.tick=()=>{},this.onLayoutEnd=()=>{},this.ticking=void 0,t&&this.updateCfg(t)}getDefaultCfg(){return{center:[0,0],nodeStrength:null,edgeStrength:null,preventOverlap:!1,nodeSize:void 0,nodeSpacing:void 0,linkDistance:50,forceSimulation:null,alphaDecay:.028,alphaMin:.001,alpha:.3,collideStrength:1,clustering:!1,clusterNodeStrength:-1,clusterEdgeStrength:.1,clusterEdgeDistance:100,clusterFociStrength:.8,clusterNodeSize:10,tick(){},onLayoutEnd(){},workerEnabled:!1}}init(t){this.nodes=t.nodes||[];const e=t.edges||[];this.edges=e.map(e=>{const n={},i=["targetNode","sourceNode","startPoint","endPoint"];return Object.keys(e).forEach(t=>{-1<i.indexOf(t)||(n[t]=e[t])}),n}),this.ticking=!1}execute(t){const n=this;var i=n.nodes,r=n.edges;if(!n.ticking){let e=n.forceSimulation;var o,a,s,u,c=n.alphaMin,h=n.alphaDecay,l=n.alpha;if(e){if(t)if(n.clustering&&n.clusterForce&&(n.clusterForce.nodes(i),n.clusterForce.links(r)),e.nodes(i),r&&n.edgeForce)n.edgeForce.links(r);else if(r&&!n.edgeForce){const f=th.Z().id(t=>t.id).links(r);n.edgeStrength&&f.strength(n.edgeStrength),n.linkDistance&&f.distance(n.linkDistance),n.edgeForce=f,e.force("link",f)}n.preventOverlap&&n.overlapProcess(e),e.alpha(l).restart(),this.ticking=!0}else try{const p=Jc.Z();if(n.nodeStrength&&p.strength(n.nodeStrength),e=Qc.Z().nodes(i),n.clustering){const g=rh();g.centerX(n.center[0]).centerY(n.center[1]).template("force").strength(n.clusterFociStrength),r&&g.links(r),i&&g.nodes(i),g.forceLinkDistance(n.clusterEdgeDistance).forceLinkStrength(n.clusterEdgeStrength).forceCharge(n.clusterNodeStrength).forceNodeSize(n.clusterNodeSize),n.clusterForce=g,e.force("group",g)}if(e.force("center",$c.Z(n.center[0],n.center[1])).force("charge",p).alpha(l).alphaDecay(h).alphaMin(c),n.preventOverlap&&n.overlapProcess(e),r){const v=th.Z().id(t=>t.id).links(r);n.edgeStrength&&v.strength(n.edgeStrength),n.linkDistance&&v.distance(n.linkDistance),n.edgeForce=v,e.force("link",v)}if(!n.workerEnabled||"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope||(n.workerEnabled=!1),n.workerEnabled){e.stop();var d=(o=e,a=o.alphaMin(),s=o.alphaTarget(),u=o.alpha(),o=Math.log((a-s)/(u-s))/Math.log(1-o.alphaDecay()),o=Math.ceil(o));for(let t=1;t<=d;t++)e.tick(),postMessage({nodes:i,currentTick:t,totalTicks:d,type:oh.TICK},void 0);n.ticking=!1}else e.on("tick",()=>{n.tick()}).on("end",()=>{n.ticking=!1,n.onLayoutEnd&&n.onLayoutEnd()}),n.ticking=!0;n.forceSimulation=e,n.ticking=!0}catch(t){n.ticking=!1}}}overlapProcess(t){const e=this.nodeSize,n=this.nodeSpacing;let i,r;var o=this.collideStrength;if(r=Uc(n)?()=>n:Yc(n)?n:()=>0,e)if(Yc(e))i=t=>{return e(t)+r(t)};else if(Gc(e)){const a=(e[0]>e[1]?e[0]:e[1])/2;i=t=>a+r(t)}else if(Uc(e)){const s=e/2;i=t=>s+r(t)}else i=()=>10;else i=t=>{return t.size?Gc(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])/2+r(t):t.size/2+r(t):10+r(t)};t.force("collisionForce",eh.Z(i).strength(o))}updateCfg(t){this.ticking&&(this.forceSimulation.stop(),this.ticking=!1),this.forceSimulation=null,Object.assign(this,t)}destroy(){this.ticking&&(this.forceSimulation.stop(),this.ticking=!1),this.nodes=null,this.edges=null,this.destroyed=!0}}),qc("circular",class extends Lc{constructor(t){super(),this.radius=null,this.startRadius=null,this.endRadius=null,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.divisions=1,this.ordering=null,this.angleRatio=1,this.nodes=[],this.edges=[],this.nodeMap={},this.degrees=[],this.width=300,this.height=300,this.updateCfg(t)}getDefaultCfg(){return{radius:null,startRadius:null,endRadius:null,startAngle:0,endAngle:2*Math.PI,clockwise:!0,divisions:1,ordering:null,angleRatio:1}}execute(){var t=this;const e=t.nodes;var n=t.edges,s=e.length;if(0!==s){t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);var u=t.center;if(1===s)return e[0].x=u[0],e[0].y=u[1],void(t.onLayoutEnd&&t.onLayoutEnd());let i=t.radius,r=t.startRadius,o=t.endRadius;var c=t.divisions,h=t.startAngle,l=t.endAngle,d=(l-h)/s;const y={};e.forEach((t,e)=>{y[t.id]=e}),t.nodeMap=y;var f=zc(e.length,y,n);t.degrees=f,i||r||o?!r&&o?r=o:r&&!o&&(o=r):i=t.height>t.width?t.width/2:t.height/2;var p=d*t.angleRatio,d=t.ordering;let a=[];a="topology"===d?t.topologyOrdering():"topology-directed"===d?t.topologyOrdering(!0):"degree"===d?t.degreeOrdering():e;var g=t.clockwise,v=Math.ceil(s/c);for(let n=0;n<s;++n){let t=i;t||null===r||null===o||(t=r+n*(o-r)/(s-1)),t=t||10+100*n/(s-1);let e=h+n%v*p+2*Math.PI/c*Math.floor(n/v);g||(e=l-n%v*p-2*Math.PI/c*Math.floor(n/v)),a[n].x=u[0]+Math.cos(e)*t,a[n].y=u[1]+Math.sin(e)*t,a[n].weight=f[n]}return t.onLayoutEnd&&t.onLayoutEnd(),{nodes:a,edges:this.edges}}t.onLayoutEnd&&t.onLayoutEnd()}topologyOrdering(t=!1){var o,e,a;const s=this.degrees,u=this.edges,c=this.nodes,h=Vc(c),l=this.nodeMap,d=[h[0]],f=[c[0]],p=[],g=c.length;p[0]=!0,o=h,e=u,a=l,t=t,o.forEach((t,e)=>{o[e].children=[],o[e].parent=[]}),t?e.forEach(t=>{let e=0;t.source&&(e=a[t.source]);let n=0;t.target&&(n=a[t.target]);const i=o[e].children,r=o[n].parent;i.push(o[n].id),r.push(o[e].id)}):e.forEach(t=>{let e=0;t.source&&(e=a[t.source]);let n=0;t.target&&(n=a[t.target]);const i=o[e].children,r=o[n].children;i.push(o[n].id),r.push(o[e].id)});let v=0;return h.forEach((t,n)=>{if(0!==n)if(n!==g-1&&s[n]===s[n+1]&&!function(e,n,i){var r=i.length;for(let t=0;t<r;t++)if(e.id===i[t].source&&n.id===i[t].target||n.id===i[t].source&&e.id===i[t].target)return 1}(d[v],t,u)||p[n]){var i=d[v].children;let e=!1;for(let t=0;t<i.length;t++){var r=l[i[t]];if(s[r]===s[n]&&!p[r]){d.push(h[r]),f.push(c[l[h[r].id]]),p[r]=!0,e=!0;break}}let t=0;for(;!e&&(p[t]||(d.push(h[t]),f.push(c[l[h[t].id]]),p[t]=!0,e=!0),t++,t!==g););}else d.push(t),f.push(c[l[t.id]]),p[n]=!0,v++}),f}degreeOrdering(){const t=this.nodes,n=[],i=this.degrees;return t.forEach((t,e)=>{t.degree=i[e],n.push(t)}),n.sort(ah),n}getType(){return"circular"}}),qc("dagre",class extends Lc{constructor(t){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1}}execute(){const i=this,{nodes:s,nodeSize:t,rankdir:e,combos:u}=i;if(s){const c=i.edges||[],h=new(sh().graphlib.Graph)({multigraph:!0,compound:!0});let r;r=t?Gc(t)?()=>t:()=>[t,t]:t=>t.size?Gc(t.size)?t.size:[t.size,t.size]:[40,40];let o=uh(i.nodesepFunc,i.nodesep,50),a=uh(i.ranksepFunc,i.ranksep,50);"LR"!==e&&"RL"!==e||(o=uh(i.ranksepFunc,i.ranksep,50),a=uh(i.nodesepFunc,i.nodesep,50)),h.setDefaultEdgeLabel(()=>({})),h.setGraph(i);const l={};s.forEach(t=>{var e=r(t),n=a(t),i=o(t),i=e[0]+2*i,n=e[1]+2*n;h.setNode(t.id,{width:i,height:n}),this.sortByCombo&&t.comboId&&(l[t.comboId]||(l[t.comboId]=!0,h.setNode(t.comboId,{})),h.setParent(t.id,t.comboId))}),this.sortByCombo&&u&&u.forEach(t=>{t.parentId&&(l[t.parentId]||(l[t.parentId]=!0,h.setNode(t.parentId,{})),h.setParent(t.id,t.parentId))}),c.forEach(t=>{h.setEdge(t.source,t.target,{weight:t.weight||1})}),sh().layout(h);let n;return h.nodes().forEach(e=>{n=h.node(e);var t=s.findIndex(t=>t.id===e);s[t]&&(s[t].x=n.x,s[t].y=n.y)}),h.edges().forEach(e=>{n=h.edge(e);var t=c.findIndex(t=>t.source===e.v&&t.target===e.w);i.controlPoints&&"loop"!==c[t].type&&(c[t].controlPoints=n.points.slice(1,n.points.length-1))}),i.onLayoutEnd&&i.onLayoutEnd(),{nodes:s,edges:c}}}getType(){return"dagre"}}),qc("radial",class extends Lc{constructor(t){super(),this.maxIteration=1e3,this.focusNode=null,this.unitRadius=null,this.linkDistance=50,this.preventOverlap=!1,this.strictRadial=!0,this.maxPreventOverlapIteration=200,this.sortStrength=10,this.nodes=[],this.edges=[],this.updateCfg(t)}getDefaultCfg(){return{maxIteration:1e3,focusNode:null,unitRadius:null,linkDistance:50,preventOverlap:!1,nodeSize:void 0,nodeSpacing:void 0,strictRadial:!0,maxPreventOverlapIteration:200,sortBy:void 0,sortStrength:10}}execute(){const o=this,a=o.nodes;var s=o.edges||[];if(a&&0!==a.length){o.width||"undefined"==typeof window||(o.width=window.innerWidth),o.height||"undefined"==typeof window||(o.height=window.innerHeight),o.center||(o.center=[o.width/2,o.height/2]);const f=o.center;if(1===a.length)return a[0].x=f[0],a[0].y=f[1],void(o.onLayoutEnd&&o.onLayoutEnd());const p=o.linkDistance;let n=null;if(Rc(o.focusNode)){let e=!1;for(let t=0;t<a.length;t++)a[t].id===o.focusNode&&(n=a[t],o.focusNode=n,e=!0,t=a.length);e||(n=null)}else n=o.focusNode;n||(n=a[0],o.focusNode=n);const g=function(t,n){let i=-1;return t.forEach((t,e)=>{t.id===n&&(i=e)}),i}(a,n.id);o.focusIndex=g;var u=Wc({nodes:a,edges:s},!1),c=jc(u),h=o.maxToFocus(c,g);o.handleInfinity(c,g,h+1);const v=(o.distances=c)[g];var l=o.width||500,d=o.height||500;let t=l-f[0]>f[0]?f[0]:l-f[0],e=d-f[1]>f[1]?f[1]:d-f[1];0===t&&(t=l/2),0===e&&(e=d/2);const y=e>t?t:e,m=Math.max(...v),x=[];v.forEach((t,e)=>{o.unitRadius||(o.unitRadius=y/m),x[e]=t*o.unitRadius}),o.radii=x;h=o.eIdealDisMatrix(),c=function(n){var t=n.length,i=n[0].length;const r=[];for(let e=0;e<t;e++){const o=[];for(let t=0;t<i;t++)0!==n[e][t]?o.push(1/(n[e][t]*n[e][t])):o.push(0);r.push(o)}return r}(o.eIdealDistances=h);o.weights=c;const b=new lh({linkDistance:p,distances:h});let i=b.layout();i.forEach(t=>{Fc(t[0])&&(t[0]=Math.random()*p),Fc(t[1])&&(t[1]=Math.random()*p)}),o.positions=i,i.forEach((t,e)=>{a[e].x=t[0]+f[0],a[e].y=t[1]+f[1]}),i.forEach(t=>{t[0]-=i[g][0],t[1]-=i[g][1]}),o.run();c=o.preventOverlap;const E=o.nodeSize;let r;h=o.strictRadial;if(c){const S=o.nodeSpacing;let e;e=Uc(S)?()=>S:Yc(S)?S:()=>0,r=E?Gc(E)?t=>{return(E[0]>E[1]?E[0]:E[1])+e(t)}:t=>E+e(t):t=>{return t.size?Gc(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])+e(t):t.size+e(t):10+e(t)};h={nodes:a,nodeSizeFunc:r,adjMatrix:u,positions:i,radii:x,height:d,width:l,strictRadial:h,focusID:g,iterations:o.maxPreventOverlapIteration||200,k:i.length/4.5};const w=new dh(h);i=w.layout()}return i.forEach((t,e)=>{a[e].x=t[0]+f[0],a[e].y=t[1]+f[1]}),o.onLayoutEnd&&o.onLayoutEnd(),{nodes:a,edges:s}}o.onLayoutEnd&&o.onLayoutEnd()}run(){var e=this.maxIteration,n=this.positions||[],i=this.weights||[],r=this.eIdealDistances||[],o=this.radii||[];for(let t=0;t<=e;t++){var a=t/e;this.oneIteration(a,n,o,r,i)}}oneIteration(n,i,c,h,l){const d=1-n,r=this.focusIndex;i.forEach((s,u)=>{var t=fh(s,[0,0]),e=0===t?0:1/t;if(u!==r){let r=0,o=0,a=0;i.forEach((t,e)=>{var n,i;u!==e&&(n=0===(i=fh(s,t))?0:1/i,i=h[e][u],a+=l[u][e],r+=l[u][e]*(t[0]+i*(s[0]-t[0])*n),o+=l[u][e]*(t[1]+i*(s[1]-t[1])*n))});t=0===c[u]?0:1/c[u];a*=d,a+=n*t*t,r*=d,r+=n*t*s[0]*e,s[0]=r/a,o*=d,o+=n*t*s[1]*e,s[1]=o/a}})}eIdealDisMatrix(){const a=this,s=a.nodes;if(!s)return[];const t=a.distances,e=a.linkDistance,u=a.radii||[],c=a.unitRadius||50,n=[];return t&&t.forEach((t,r)=>{const o=[];t.forEach((n,i)=>{if(r===i)o.push(0);else if(u[r]===u[i])if("data"===a.sortBy)o.push(n*(Math.abs(r-i)*a.sortStrength)/(u[r]/c));else if(a.sortBy){let t=s[r][a.sortBy]||0,e=s[i][a.sortBy]||0;Rc(t)&&(t=t.charCodeAt(0)),Rc(e)&&(e=e.charCodeAt(0)),o.push(n*(Math.abs(t-e)*a.sortStrength)/(u[r]/c))}else o.push(n*e/(u[r]/c));else{i=(e+c)/2;o.push(n*i)}}),n.push(o)}),n}handleInfinity(i,r,n){var o=i.length;for(let e=0;e<o;e++)if(i[r][e]===1/0){i[r][e]=n,i[e][r]=n;for(let t=0;t<o;t++)i[e][t]!==1/0&&i[r][t]===1/0&&(i[r][t]=n+i[e][t],i[t][r]=n+i[e][t])}for(let n=0;n<o;n++)if(n!==r)for(let e=0;e<o;e++)if(i[n][e]===1/0){let t=Math.abs(i[r][n]-i[r][e]);t=0===t?1:t,i[n][e]=t}}maxToFocus(e,n){let i=0;for(let t=0;t<e[n].length;t++)e[n][t]!==1/0&&(i=e[n][t]>i?e[n][t]:i);return i}getType(){return"radial"}}),qc("concentric",class extends Lc{constructor(t){super(),this.nodeSize=30,this.minNodeSpacing=10,this.preventOverlap=!1,this.equidistant=!1,this.startAngle=1.5*Math.PI,this.clockwise=!0,this.sortBy="degree",this.nodes=[],this.edges=[],this.width=300,this.height=300,this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{nodeSize:30,minNodeSpacing:10,preventOverlap:!1,sweep:void 0,equidistant:!1,startAngle:1.5*Math.PI,clockwise:!0,maxLevelDiff:void 0,sortBy:"degree"}}execute(){const a=this,t=a.nodes;var e=a.edges,s=t.length;if(0!==s){a.width||"undefined"==typeof window||(a.width=window.innerWidth),a.height||"undefined"==typeof window||(a.height=window.innerHeight),a.center||(a.center=[a.width/2,a.height/2]);const c=a.center;if(1===s)return t[0].x=c[0],t[0].y=c[1],void(a.onLayoutEnd&&a.onLayoutEnd());const h=[];let n;n=Gc(a.nodeSize)?Math.max(a.nodeSize[0],a.nodeSize[1]):a.nodeSize,t.forEach(t=>{h.push(t);let e=n;Gc(t.size)?e=Math.max(t.size[0],t.size[1]):Uc(t.size)&&(e=t.size),n=Math.max(n,e)}),a.clockwise=void 0!==a.counterclockwise?!a.counterclockwise:a.clockwise;const l={},d={};if(h.forEach((t,e)=>{l[t.id]=t,d[t.id]=e}),!("degree"!==a.sortBy&&Rc(a.sortBy)&&void 0!==h[0][a.sortBy]||(a.sortBy="degree",Uc(t[0].degree)))){const p=zc(t.length,d,e);h.forEach((t,e)=>{t.degree=p[e]})}h.sort((t,e)=>e[a.sortBy]-t[a.sortBy]),a.maxValueNode=h[0],a.maxLevelDiff=a.maxLevelDiff||a.maxValueNode[a.sortBy]/4;const f=[[]];let i=f[0];h.forEach(t=>{var e;0<i.length&&(e=Math.abs(i[0][a.sortBy]-t[a.sortBy]),a.maxLevelDiff&&e>=a.maxLevelDiff&&(i=[],f.push(i))),i.push(t)});let r=n+a.minNodeSpacing;a.preventOverlap||(s=0<f.length&&1<f[0].length,s=(Math.min(a.width,a.height)/2-r)/(f.length+(s?1:0)),r=Math.min(r,s));let o=0;if(f.forEach(t=>{let e=a.sweep;void 0===e&&(e=2*Math.PI-2*Math.PI/t.length);var n,i=t.dTheta=e/Math.max(1,t.length-1);1<t.length&&a.preventOverlap&&(n=Math.cos(i)-Math.cos(0),i=Math.sin(i)-Math.sin(0),i=Math.sqrt(r*r/(n*n+i*i)),o=Math.max(i,o)),t.r=o,o+=r}),a.equidistant){let n=0,i=0;for(let t=0;t<f.length;t++){var u=f[t].r-i;n=Math.max(n,u)}i=0,f.forEach((t,e)=>{0===e&&(i=t.r),t.r=i,i+=n})}return f.forEach(t=>{const n=t.dTheta,i=t.r;t.forEach((t,e)=>{e=a.startAngle+(a.clockwise?1:-1)*n*e;t.x=c[0]+i*Math.cos(e),t.y=c[1]+i*Math.sin(e)})}),a.onLayoutEnd&&a.onLayoutEnd(),{nodes:t,edges:e}}a.onLayoutEnd&&a.onLayoutEnd()}getType(){return"concentric"}}),qc("mds",class extends Lc{constructor(t){super(),this.center=[0,0],this.linkDistance=50,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{center:[0,0],linkDistance:50}}execute(){var t=this;const{nodes:n,edges:e=[]}=t,i=t.center;if(n&&0!==n.length){if(1===n.length)return n[0].x=i[0],n[0].y=i[1],void(t.onLayoutEnd&&t.onLayoutEnd());var r=t.linkDistance,o=Wc({nodes:n,edges:e},!1),o=jc(o);t.handleInfinity(o);r=((t,n)=>{const i=[];return t.forEach(t=>{const e=[];t.forEach(t=>{e.push(t*n)}),i.push(e)}),i})(o,r);t.scaledDistances=r;const a=t.runMDS();return t.positions=a,a.forEach((t,e)=>{n[e].x=t[0]+i[0],n[e].y=t[1]+i[1]}),t.onLayoutEnd&&t.onLayoutEnd(),{nodes:n,edges:e}}t.onLayoutEnd&&t.onLayoutEnd()}runMDS(){var t=this.scaledDistances;const e=ch.Z.mul(ch.Z.pow(t,2),-.5);var n=e.mean("row"),i=e.mean("column"),t=e.mean();e.add(t).subRowVector(n).subColumnVector(i);const r=new hh.Z(e),o=ch.Z.sqrt(r.diagonalMatrix).diagonal();return r.leftSingularVectors.toJSON().map(t=>ch.Z.mul([t],[o]).toJSON()[0].splice(0,2))}handleInfinity(i){let r=-999999;i.forEach(t=>{t.forEach(t=>{t!==1/0&&r<t&&(r=t)})}),i.forEach((t,n)=>{t.forEach((t,e)=>{t===1/0&&(i[n][e]=r)})})}getType(){return"mds"}}),qc("fruchterman",class extends Lc{constructor(t){super(),this.maxIteration=1e3,this.gravity=10,this.speed=1,this.clustering=!1,this.clusterGravity=10,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:1e3,gravity:10,speed:1,clustering:!1,clusterGravity:10}}execute(){var t=this;const e=t.nodes;if(e&&0!==e.length){t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);var n=t.center;if(1===e.length)return e[0].x=n[0],e[0].y=n[1],void(t.onLayoutEnd&&t.onLayoutEnd());const i={},r={};return e.forEach((t,e)=>{Uc(t.x)||(t.x=Math.random()*this.width),Uc(t.y)||(t.y=Math.random()*this.height),i[t.id]=t,r[t.id]=e}),t.nodeMap=i,t.nodeIdxMap=r,t.run()}t.onLayoutEnd&&t.onLayoutEnd()}run(){var e=this;const n=e.nodes;var i=e.edges,r=e.maxIteration;const o=e.center;var t=e.height*e.width;const a=Math.sqrt(t)/10;var s=t/(n.length+1);const u=Math.sqrt(s),c=e.gravity,h=e.speed;var l=e.clustering;const d={};if(l){n.forEach(t=>{var e;void 0===d[t.cluster]&&(e={name:t.cluster,cx:0,cy:0,count:0},d[t.cluster]=e);const n=d[t.cluster];Uc(t.x)&&(n.cx+=t.x),Uc(t.y)&&(n.cy+=t.y),n.count++});for(const f in d)d[f].cx/=d[f].count,d[f].cy/=d[f].count}for(let t=0;t<r;t++){const p=[];if(n.forEach((t,e)=>{p[e]={x:0,y:0}}),e.applyCalculate(n,i,p,u,s),l){const g=e.clusterGravity||c;n.forEach((t,e)=>{var n,i,r;Uc(t.x)&&Uc(t.y)&&(n=d[t.cluster],i=Math.sqrt((t.x-n.cx)*(t.x-n.cx)+(t.y-n.cy)*(t.y-n.cy)),r=u*g,p[e].x-=r*(t.x-n.cx)/i,p[e].y-=r*(t.y-n.cy)/i)});for(const v in d)d[v].cx=0,d[v].cy=0,d[v].count=0;n.forEach(t=>{const e=d[t.cluster];Uc(t.x)&&(e.cx+=t.x),Uc(t.y)&&(e.cy+=t.y),e.count++});for(const y in d)d[y].cx/=d[y].count,d[y].cy/=d[y].count}n.forEach((t,e)=>{var n;Uc(t.x)&&Uc(t.y)&&(n=.01*u*c,p[e].x-=n*(t.x-o[0]),p[e].y-=n*(t.y-o[1]))}),n.forEach((t,e)=>{var n,i;Uc(t.x)&&Uc(t.y)&&(0<(n=Math.sqrt(p[e].x*p[e].x+p[e].y*p[e].y))&&(i=Math.min(a*(h/800),n),t.x+=p[e].x/n*i,t.y+=p[e].y/n*i))})}return e.onLayoutEnd&&e.onLayoutEnd(),{nodes:n,edges:i}}applyCalculate(t,e,n,i,r){this.calRepulsive(t,n,r),this.calAttractive(e,n,i)}calRepulsive(t,u,c){t.forEach((a,s)=>{u[s]={x:0,y:0},t.forEach((i,r)=>{if(s!==r&&Uc(a.x)&&Uc(i.x)&&Uc(a.y)&&Uc(i.y)){let t=a.x-i.x,e=a.y-i.y,n=t*t+e*e;0===n&&(n=1,o=r<s?1:-1,t=.01*o,e=.01*o);var o=c/n;u[s].x+=t*o,u[s].y+=e*o}})})}calAttractive(t,a,s){t.forEach(t=>{var e,n,i,r,o;t.source&&t.target&&((e=this.nodeIdxMap[t.source])!==(n=this.nodeIdxMap[t.target])&&(o=this.nodeMap[t.source],r=this.nodeMap[t.target],Uc(r.x)&&Uc(o.x)&&Uc(r.y)&&Uc(o.y)&&(i=r.x-o.x,t=r.y-o.y,r=Math.sqrt(i*i+t*t),a[n].x-=i/r*(o=r*r/s),a[n].y-=t/r*o,a[e].x+=i/r*o,a[e].y+=t/r*o)))})}getType(){return"fruchterman"}}),qc("fruchterman-gpu",class extends Lc{constructor(t){super(),this.maxIteration=1e3,this.gravity=10,this.speed=1,this.clustering=!1,this.clusterField="cluster",this.clusterGravity=10,this.workerEnabled=!1,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:1e3,gravity:10,speed:1,clustering:!1,clusterGravity:10}}execute(){return ig(this,void 0,void 0,function*(){var t=this;const e=t.nodes;if(e&&0!==e.length){t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);var n=t.center;if(1===e.length)return e[0].x=n[0],e[0].y=n[1],void(t.onLayoutEnd&&t.onLayoutEnd());const i={},r={};e.forEach((t,e)=>{Uc(t.x)||(t.x=Math.random()*this.width),Uc(t.y)||(t.y=Math.random()*this.height),i[t.id]=t,r[t.id]=e}),t.nodeMap=i,t.nodeIdxMap=r,yield t.run()}else t.onLayoutEnd&&t.onLayoutEnd()})}executeWithWorker(r,o){return ig(this,void 0,void 0,function*(){const t=this.nodes;var e=this.center;if(t&&0!==t.length){if(1===t.length)return t[0].x=e[0],void(t[0].y=e[1]);const n={},i={};t.forEach((t,e)=>{Uc(t.x)||(t.x=Math.random()*this.width),Uc(t.y)||(t.y=Math.random()*this.height),n[t.id]=t,i[t.id]=e}),this.nodeMap=n,this.nodeIdxMap=i,yield this.run(r,o)}})}run(b,E){return ig(this,void 0,void 0,function*(){var t=this;const e=t.nodes;var n=t.edges;const r=t.maxIteration;var i=t.center,o=t.height*t.width;let a=Math.sqrt(o)/10;var s=o/(e.length+1),u=Math.sqrt(s),c=t.speed;const h=t.clustering;var{array:l,count:d}=((t,e)=>{const i=[],r=t.length,o={};return e.forEach(n=>{t.forEach((t,e)=>{if(void 0===o[n[t]]&&(o[n[t]]=Object.keys(o).length),i.push(o[n[t]]),e===r-1)for(;i.length%4!=0;)i.push(0)})}),{array:new Float32Array(i),count:Object.keys(o).length}})([t.clusterField],e),f=e.length,{maxEdgePerVetex:p,array:o}=((t,e)=>{const n=[],i=[],r={};let o=0;for(o=0;o<t.length;o++){var a=t[o];r[a.id]=o,n.push(a.x),n.push(a.y),n.push(0),n.push(0),i.push([])}for(o=0;o<e.length;o++){var s=e[o];i[r[s.source]].push(r[s.target]),i[r[s.target]].push(r[s.source])}let u=0;for(o=0;o<t.length;o++){var c=n.length,h=i[o],l=h.length;n[4*o+2]=c,n[4*o+3]=h.length,u=Math.max(u,h.length);for(let t=0;t<l;++t){var d=h[t];n.push(+d)}}for(;n.length%4!=0;)n.push(0);return{maxEdgePerVetex:u,array:new Float32Array(n)}})(e,n),n=t.workerEnabled;let g;g=n?tg.create({canvas:b,engineOptions:{supportCompute:!0}}):tg.create({engineOptions:{supportCompute:!0}});const v=t.onLayoutEnd,y=[];for(let t=0;t<d;t++)y.push(0,0,0,0);const m=g.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_K : f32;\\n  [[offset 4]] u_K2 : f32;\\n  [[offset 8]] u_Center : vec2<f32>;\\n  [[offset 16]] u_Gravity : f32;\\n  [[offset 20]] u_ClusterGravity : f32;\\n  [[offset 24]] u_Speed : f32;\\n  [[offset 28]] u_MaxDisplace : f32;\\n  [[offset 32]] u_Clustering : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AttributeArray : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_ClusterCenters : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 3, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nvar xDist : f32 = currentNode.x - nextNode.x;\\nvar yDist : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nvar param : f32 = gWebGPUUniformParams.u_K2 / dist;\\nif (dist > 0.0) {dx = dx + param * xDist;\\ndy = dy + param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {var sign : f32 = select(1.0, -1.0, i < j);\\ndx = dx + param * std::sign;\\ndy = dy + param * std::sign;}}}}\\nreturn vec2<f32>(dx, dy);}\\nfn calcGravity(currentNode : vec4<f32>, nodeAttributes : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nvar vx : f32 = currentNode.x - gWebGPUUniformParams.u_Center.x;\\nvar vy : f32 = currentNode.y - gWebGPUUniformParams.u_Center.y;\\nvar gf : f32 = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (gWebGPUUniformParams.u_Clustering == 1.0) {var clusterIdx : i32 = i32(nodeAttributes.x);\\nvar center : vec4<f32> = gWebGPUBuffer2.u_ClusterCenters[clusterIdx];\\nvar cvx : f32 = currentNode.x - center.x;\\nvar cvy : f32 = currentNode.y - center.y;\\nvar dist : f32 = std::sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nvar parma : f32 = (gWebGPUUniformParams.u_K * gWebGPUUniformParams.u_ClusterGravity) / dist;\\ndx = dx + parma * cvx;\\ndy = dy + parma * cvy;}\\nreturn vec2<f32>(dx, dy);}\\nfn calcAttractive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nvar arr_offset : i32 = i32(std::floor(currentNode.z + 0.5));\\nvar length : i32 = i32(std::floor(currentNode.w + 0.5));\\nvar node_buffer : vec4<f32>;\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\nvar arr_idx : i32 = arr_offset + i32(p);\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\nvar float_j : f32 = select(node_buffer.x, select(node_buffer.y, select(node_buffer.z, node_buffer.w, buf_offset == 2), buf_offset == 1), buf_offset == 0);\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\nvar xDist : f32 = currentNode.x - nextNode.x;\\nvar yDist : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nvar attractiveF : f32 = dist / gWebGPUUniformParams.u_K;\\nif (dist > 0.0) {dx = dx - xDist * attractiveF;\\ndy = dy - yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {var sign : f32 = select(1.0, -1.0, i < i32(float_j));\\ndx = dx - std::sign * attractiveF;\\ndy = dy - std::sign * attractiveF;}}}\\nreturn vec2<f32>(dx, dy);}\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\nvar dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nif (i >= __DefineValuePlaceholder__VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\ndx = dx + repulsive.x;\\ndy = dy + repulsive.y;\\nvar attractive : vec2<f32> = calcAttractive(i, currentNode);\\ndx = dx + attractive.x;\\ndy = dy + attractive.y;\\nvar nodeAttributes : vec4<f32> = gWebGPUBuffer1.u_AttributeArray[i];\\nvar gravity : vec2<f32> = calcGravity(currentNode, nodeAttributes);\\ndx = dx - gravity.x;\\ndy = dy - gravity.y;\\ndx = dx * gWebGPUUniformParams.u_Speed;\\ndy = dy * gWebGPUUniformParams.u_Speed;\\nvar distLength : f32 = std::sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {var limitedDist : f32 = std::min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\ngWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_K;\\n  float u_K2;\\n  vec2 u_Center;\\n  float u_Gravity;\\n  float u_ClusterGravity;\\n  float u_Speed;\\n  float u_MaxDisplace;\\n  float u_Clustering;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_AttributeArray[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 3) buffer readonly  GWebGPUBuffer2 {\\n  vec4 u_ClusterCenters[];\\n} gWebGPUBuffer2;\\n\\n\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nvec2 calcRepulsive(int i, vec4 currentNode) {float dx = 0.0;\\nfloat dy = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat param = gWebGPUUniformParams.u_K2 / dist;\\nif (dist > 0.0) {dx += param * xDist;\\ndy += param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < j) ? (1.0) : (-1.0);\\ndx += param * sign;\\ndy += param * sign;}}}}\\nreturn vec2(dx, dy);}\\nvec2 calcGravity(vec4 currentNode, vec4 nodeAttributes) {float dx = 0.0;\\nfloat dy = 0.0;\\nfloat vx = currentNode.x - gWebGPUUniformParams.u_Center.x;\\nfloat vy = currentNode.y - gWebGPUUniformParams.u_Center.y;\\nfloat gf = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (gWebGPUUniformParams.u_Clustering == 1.0) {int clusterIdx = int(nodeAttributes.x);\\nvec4 center = gWebGPUBuffer2.u_ClusterCenters[clusterIdx];\\nfloat cvx = currentNode.x - center.x;\\nfloat cvy = currentNode.y - center.y;\\nfloat dist = sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nfloat parma = (gWebGPUUniformParams.u_K * gWebGPUUniformParams.u_ClusterGravity) / dist;\\ndx += parma * cvx;\\ndy += parma * cvy;}\\nreturn vec2(dx, dy);}\\nvec2 calcAttractive(int i, vec4 currentNode) {float dx = 0.0;\\nfloat dy = 0.0;\\nint arr_offset = int(floor(currentNode.z + 0.5));\\nint length = int(floor(currentNode.w + 0.5));\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + int(p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat attractiveF = dist / gWebGPUUniformParams.u_K;\\nif (dist > 0.0) {dx -= xDist * attractiveF;\\ndy -= yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < int(float_j)) ? (1.0) : (-1.0);\\ndx -= sign * attractiveF;\\ndy -= sign * attractiveF;}}}\\nreturn vec2(dx, dy);}\\nvoid main() {int i = globalInvocationID.x;\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nif (i >= VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvec2 repulsive = calcRepulsive(i, currentNode);\\ndx += repulsive.x;\\ndy += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode);\\ndx += attractive.x;\\ndy += attractive.y;\\nvec4 nodeAttributes = gWebGPUBuffer1.u_AttributeArray[i];\\nvec2 gravity = calcGravity(currentNode, nodeAttributes);\\ndx -= gravity.x;\\ndy -= gravity.y;\\ndx *= gWebGPUUniformParams.u_Speed;\\ndy *= gWebGPUUniformParams.u_Speed;\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {float limitedDist = min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\ngWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_K;\\nuniform float u_K2;\\nuniform vec2 u_Center;\\nuniform float u_Gravity;\\nuniform float u_ClusterGravity;\\nuniform float u_Speed;\\nuniform float u_MaxDisplace;\\nuniform float u_Clustering;\\nuniform sampler2D u_AttributeArray;\\nuniform vec2 u_AttributeArraySize;\\nvec4 getDatau_AttributeArray(vec2 address2D) {\\n  return vec4(texture2D(u_AttributeArray, address2D).rgba);\\n}\\nvec4 getDatau_AttributeArray(float address1D) {\\n  return getDatau_AttributeArray(addrTranslation_1Dto2D(address1D, u_AttributeArraySize));\\n}\\nvec4 getDatau_AttributeArray(int address1D) {\\n  return getDatau_AttributeArray(float(address1D));\\n}\\nuniform sampler2D u_ClusterCenters;\\nuniform vec2 u_ClusterCentersSize;\\nvec4 getDatau_ClusterCenters(vec2 address2D) {\\n  return vec4(texture2D(u_ClusterCenters, address2D).rgba);\\n}\\nvec4 getDatau_ClusterCenters(float address1D) {\\n  return getDatau_ClusterCenters(addrTranslation_1Dto2D(address1D, u_ClusterCentersSize));\\n}\\nvec4 getDatau_ClusterCenters(int address1D) {\\n  return getDatau_ClusterCenters(float(address1D));\\n}\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat param = u_K2 / dist;\\nif (dist > 0.0) {dx += param * xDist;\\ndy += param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < j) ? (1.0) : (-1.0);\\ndx += param * sign;\\ndy += param * sign;}}}}\\nreturn vec2(dx, dy);}\\nvec2 calcGravity(vec4 currentNode, vec4 nodeAttributes) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nfloat vx = currentNode.x - u_Center.x;\\nfloat vy = currentNode.y - u_Center.y;\\nfloat gf = (0.01 * u_K) * u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (u_Clustering == 1.0) {int clusterIdx = int(nodeAttributes.x);\\nvec4 center = getDatau_ClusterCenters(clusterIdx);\\nfloat cvx = currentNode.x - center.x;\\nfloat cvy = currentNode.y - center.y;\\nfloat dist = sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nfloat parma = (u_K * u_ClusterGravity) / dist;\\ndx += parma * cvx;\\ndy += parma * cvy;}\\nreturn vec2(dx, dy);}\\nvec2 calcAttractive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nint arr_offset = int(floor(currentNode.z + 0.5));\\nint length = int(floor(currentNode.w + 0.5));\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + int(p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\nvec4 nextNode = getDatau_Data(int(float_j));\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat attractiveF = dist / u_K;\\nif (dist > 0.0) {dx -= xDist * attractiveF;\\ndy -= yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < int(float_j)) ? (1.0) : (-1.0);\\ndx -= sign * attractiveF;\\ndy -= sign * attractiveF;}}}\\nreturn vec2(dx, dy);}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 currentNode = getDatau_Data(i);\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nif (i >= VERTEX_COUNT) {gl_FragColor = vec4(currentNode);\\nreturn ;}\\nvec2 repulsive = calcRepulsive(i, currentNode);\\ndx += repulsive.x;\\ndy += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode);\\ndx += attractive.x;\\ndy += attractive.y;\\nvec4 nodeAttributes = getDatau_AttributeArray(i);\\nvec2 gravity = calcGravity(currentNode, nodeAttributes);\\ndx -= gravity.x;\\ndy -= gravity.y;\\ndx *= u_Speed;\\ndy *= u_Speed;\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {float limitedDist = min(u_MaxDisplace * u_Speed, distLength);\\ngl_FragColor = vec4(vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w));}if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"MAX_EDGE_PER_VERTEX","type":"Float","runtime":true},{"name":"VERTEX_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]},{"name":"u_K","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_K2","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Center","type":"vec2<f32>","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Gravity","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterGravity","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Speed","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_MaxDisplace","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Clustering","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AttributeArray","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterCenters","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_Data","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([f,1,1]).setBinding({u_Data:o,u_K:u,u_K2:s,u_Gravity:t.gravity,u_ClusterGravity:t.clusterGravity||t.gravity||1,u_Speed:c,u_MaxDisplace:a,u_Clustering:h?1:0,u_Center:i,u_AttributeArray:l,u_ClusterCenters:y,MAX_EDGE_PER_VERTEX:p,VERTEX_COUNT:f});let x;h&&(x=g.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\n\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 0, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributes : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_ClusterCenters : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar center : vec4<f32> = gWebGPUBuffer2.u_ClusterCenters[i];\\nvar sumx : f32 = 0.0;\\nvar sumy : f32 = 0.0;\\nvar count : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {var attributes : vec4<f32> = gWebGPUBuffer1.u_NodeAttributes[j];\\nvar clusterIdx : i32 = i32(attributes.x);\\nvar vertex : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nif (clusterIdx == i) {sumx = sumx + vertex.x;\\nsumy = sumy + vertex.y;\\ncount = count + 1.0;}}\\ngWebGPUBuffer2.u_ClusterCenters[i] = vec4<f32>(sumx / count, sumy / count, count, i);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\n\\nlayout(std430, set = 0, binding = 0) buffer readonly  GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_NodeAttributes[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 2) buffer   GWebGPUBuffer2 {\\n  vec4 u_ClusterCenters[];\\n} gWebGPUBuffer2;\\n\\n\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define CLUSTER_COUNT __DefineValuePlaceholder__CLUSTER_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\nvoid main() {int i = globalInvocationID.x;\\nvec4 center = gWebGPUBuffer2.u_ClusterCenters[i];\\nfloat sumx = 0.0;\\nfloat sumy = 0.0;\\nfloat count = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 attributes = gWebGPUBuffer1.u_NodeAttributes[j];\\nint clusterIdx = int(attributes.x);\\nvec4 vertex = gWebGPUBuffer0.u_Data[j];\\nif (clusterIdx == i) {sumx += vertex.x;\\nsumy += vertex.y;\\ncount += 1.0;}}\\ngWebGPUBuffer2.u_ClusterCenters[i] = vec4(sumx / count, sumy / count, count, i);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define CLUSTER_COUNT __DefineValuePlaceholder__CLUSTER_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform sampler2D u_NodeAttributes;\\nuniform vec2 u_NodeAttributesSize;\\nvec4 getDatau_NodeAttributes(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributes, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributes(float address1D) {\\n  return getDatau_NodeAttributes(addrTranslation_1Dto2D(address1D, u_NodeAttributesSize));\\n}\\nvec4 getDatau_NodeAttributes(int address1D) {\\n  return getDatau_NodeAttributes(float(address1D));\\n}\\nuniform sampler2D u_ClusterCenters;\\nuniform vec2 u_ClusterCentersSize;\\nvec4 getDatau_ClusterCenters(vec2 address2D) {\\n  return vec4(texture2D(u_ClusterCenters, address2D).rgba);\\n}\\nvec4 getDatau_ClusterCenters(float address1D) {\\n  return getDatau_ClusterCenters(addrTranslation_1Dto2D(address1D, u_ClusterCentersSize));\\n}\\nvec4 getDatau_ClusterCenters(int address1D) {\\n  return getDatau_ClusterCenters(float(address1D));\\n}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 center = getDatau_ClusterCenters(i);\\nfloat sumx = 0.0;\\nfloat sumy = 0.0;\\nfloat count = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 attributes = getDatau_NodeAttributes(j);\\nint clusterIdx = int(attributes.x);\\nvec4 vertex = getDatau_Data(j);\\nif (clusterIdx == i) {sumx += vertex.x;\\nsumy += vertex.y;\\ncount += 1.0;}}\\ngl_FragColor = vec4(vec4(sumx / count, sumy / count, count, i));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"VERTEX_COUNT","type":"Float","runtime":true},{"name":"CLUSTER_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributes","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterCenters","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_ClusterCenters","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([d,1,1]).setBinding({u_Data:o,u_NodeAttributes:l,u_ClusterCenters:y,VERTEX_COUNT:f,CLUSTER_COUNT:d}));yield ig(this,void 0,void 0,function*(){for(let t=0;t<r;t++)yield m.execute(),h&&(x.setBinding({u_Data:m}),yield x.execute(),m.setBinding({u_ClusterCenters:x})),m.setBinding({u_MaxDisplace:a*=.99});const i=yield m.getOutput();b?E.postMessage({type:oh.GPUEND,vertexEdgeData:i}):e.forEach((t,e)=>{var n=i[4*e],e=i[4*e+1];t.x=n,t.y=e}),v&&v()})})}getType(){return"fruchterman-gpu"}}),qc("gForce",class extends Lc{constructor(t){super(),this.maxIteration=1e3,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=1e3,this.minMovement=.5,this.interval=.02,this.factor=1,this.linkDistance=1,this.gravity=10,this.preventOverlap=!0,this.tick=()=>{},this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:500,gravity:10,enableTick:!0}}execute(){const n=this,e=n.nodes;if(void 0!==n.timeInterval&&"undefined"!=typeof window&&window.clearInterval(n.timeInterval),e&&0!==e.length){n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);var i=n.center;if(1===e.length)return e[0].x=i[0],e[0].y=i[1],void(n.onLayoutEnd&&n.onLayoutEnd());const r={},o={};e.forEach((t,e)=>{Uc(t.x)||(t.x=Math.random()*n.width),Uc(t.y)||(t.y=Math.random()*n.height),r[t.id]=t,o[t.id]=e}),n.nodeMap=r,n.nodeIdxMap=o,n.linkDistance=Kc(n.linkDistance,1),n.nodeStrength=Kc(n.nodeStrength,1),n.edgeStrength=Kc(n.edgeStrength,1);const a=n.nodeSize;let t;if(n.preventOverlap){const s=n.nodeSpacing;let e;e=Uc(s)?()=>s:Yc(s)?s:()=>0,t=a?Gc(a)?t=>{return(a[0]>a[1]?a[0]:a[1])+e(t)}:t=>a+e(t):t=>{return t.size?Gc(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])+e(t):t.size+e(t):10+e(t)}}n.nodeSize=t;i=n.edges;n.degrees=zc(e.length,n.nodeIdxMap,i),n.getMass||(n.getMass=t=>n.degrees[n.nodeIdxMap[t.id]]||1),n.run()}else n.onLayoutEnd&&n.onLayoutEnd()}run(){const a=this,s=a.nodes,u=a.edges,c=a.maxIteration;if("undefined"!=typeof window){let e=0;this.timeInterval=window.setInterval(()=>{const n=[],r=[];if(s){s.forEach((t,e)=>{n[2*e]=0,n[2*e+1]=0,r[2*e]=0,r[2*e+1]=0}),a.calRepulsive(n,s),u&&a.calAttractive(n,u),a.calGravity(n,s);var t=Math.max(.02,a.interval-.002*e);a.updateVelocity(n,r,t,s);const o=[];s.forEach(t=>{o.push({x:t.x,y:t.y})}),a.updatePosition(r,t,s),a.tick&&a.tick();let i=0;s.forEach((t,e)=>{var n=t.x-o[e].x,e=t.y-o[e].y;i+=Math.sqrt(n*n+e*e)}),i/=s.length,i<a.minMovement&&(window.clearInterval(a.timeInterval),a.onLayoutEnd&&a.onLayoutEnd()),e++,e>c&&(window.clearInterval(a.timeInterval),a.onLayoutEnd&&a.onLayoutEnd())}},0)}}calRepulsive(h,t){const l=this.getMass,d=this.nodeStrength,f=this.factor,p=this.coulombDisScale,g=this.preventOverlap,v=this.nodeSize;t.forEach((s,u)=>{const c=l?l(s):1;t.forEach((t,e)=>{var n,i,r,o,a;e<=u||(i=s.x-t.x,r=s.y-t.y,o=((a=Math.sqrt(i*i+r*r)+.01)+.1)*p,n=i/a,i=r/a,r=(d(s)+d(t))/2*f/(o*o),o=l?l(t):1,h[2*u]+=n*r/c,h[2*u+1]+=i*r/c,h[2*e]-=n*r/o,h[2*e+1]-=i*r/o,g&&a<(v(s)+v(t))/2&&(a=(d(s)+d(t))/2/(a*a),h[2*u]+=n*a/c,h[2*u+1]+=i*a/c,h[2*e]-=n*a/o,h[2*e+1]-=i*a/o))})})}calAttractive(u,t){const c=this.nodeMap,h=this.nodeIdxMap,l=this.linkDistance,d=this.edgeStrength,f=this.getMass;t.forEach((t,e)=>{var n=c[t.source],i=c[t.target],r=i.x-n.x,o=i.y-n.y,a=Math.sqrt(r*r+o*o)+.01,s=r/a,r=o/a,o=((l(t)||1)-a)*d(t),a=h[t.source],t=h[t.target],n=f?f(n):1,i=f?f(i):1;u[2*a]-=s*o/n,u[2*a+1]-=r*o/n,u[2*t]+=s*o/i,u[2*t+1]+=r*o/i})}calGravity(r,o){var a=this.center,s=this.gravity,u=this.degrees,t=o.length;for(let i=0;i<t;i++){var c,h=o[i];let t=h.x-a[0],e=h.y-a[1],n=s;!this.getCenter||(c=this.getCenter(h,u[i]))&&Uc(c[0])&&Uc(c[1])&&Uc(c[2])&&(t=h.x-c[0],e=h.y-c[1],n=c[2]),n&&(r[2*i]-=n*t,r[2*i+1]-=n*e)}}updateVelocity(o,a,t,e){const s=this,u=t*s.damping;e.forEach((t,e)=>{let n=o[2*e]*u||.01,i=o[2*e+1]*u||.01;var r=Math.sqrt(n*n+i*i);r>s.maxSpeed&&(r=s.maxSpeed/r,n*=r,i*=r),a[2*e]=n,a[2*e+1]=i})}updatePosition(i,r,t){t.forEach((t,e)=>{var n=i[2*e]*r,e=i[2*e+1]*r;t.x+=n,t.y+=e})}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval)}destroy(){this.stop(),this.tick=null,this.nodes=null,this.edges=null,this.destroyed=!0}getType(){return"gForce"}}),qc("gForce-gpu",class extends Lc{constructor(t){super(),this.maxIteration=1e3,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=1e3,this.minMovement=1,this.interval=.02,this.factor=1,this.linkDistance=1,this.gravity=10,this.workerEnabled=!1,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:2e3,gravity:10,clustering:!1,clusterGravity:10}}execute(){return rg(this,void 0,void 0,function*(){const n=this,t=n.nodes;if(t&&0!==t.length){n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);var e=n.center;if(1===t.length)return t[0].x=e[0],t[0].y=e[1],void(n.onLayoutEnd&&n.onLayoutEnd());const i={},r={};t.forEach((t,e)=>{Uc(t.x)||(t.x=Math.random()*n.width),Uc(t.y)||(t.y=Math.random()*n.height),i[t.id]=t,r[t.id]=e}),n.nodeMap=i,n.nodeIdxMap=r,n.nodeStrength=eg(n.nodeStrength,1),n.edgeStrength=eg(n.edgeStrength,1),yield n.run()}else n.onLayoutEnd&&n.onLayoutEnd()})}executeWithWorker(t,e){const n=this,i=n.nodes;var r=n.center;if(i&&0!==i.length){if(1===i.length)return i[0].x=r[0],void(i[0].y=r[1]);const o={},a={};i.forEach((t,e)=>{Uc(t.x)||(t.x=Math.random()*n.width),Uc(t.y)||(t.y=Math.random()*n.height),o[t.id]=t,a[t.id]=e}),n.nodeMap=o,n.nodeIdxMap=a,n.nodeStrength=eg(n.nodeStrength,1),n.edgeStrength=eg(n.edgeStrength,1),n.run(t,e)}}run(E,S){return rg(this,void 0,void 0,function*(){const r=this,t=r.nodes;var e=r.edges;const n=r.maxIteration;r.width||"undefined"==typeof window||(r.width=window.innerWidth),r.height||"undefined"==typeof window||(r.height=window.innerHeight);var i=t.length;r.linkDistance=eg(r.linkDistance),r.edgeStrength=eg(r.edgeStrength);const{maxEdgePerVetex:o,array:a}=((t,e,n,i)=>{const r=[],o=[],a={};let s=0;for(s=0;s<t.length;s++){var u=t[s];a[u.id]=s,r.push(u.x),r.push(u.y),r.push(0),r.push(0),o.push([])}for(s=0;s<e.length;s++){var c=e[s];o[a[c.source]].push(a[c.target]),o[a[c.source]].push(n(c)),o[a[c.source]].push(i(c)),o[a[c.source]].push(0),o[a[c.target]].push(a[c.source]),o[a[c.target]].push(n(c)),o[a[c.target]].push(i(c)),o[a[c.target]].push(0)}let h=0;for(s=0;s<t.length;s++){var l=r.length,d=o[s],f=d.length;r[4*s+2]=l+1048576*f/4,r[4*s+3]=0,h=Math.max(h,f/4);for(let t=0;t<f;++t){var p=d[t];r.push(+p)}}for(;r.length%4!=0;)r.push(0);return{maxEdgePerVetex:h,array:new Float32Array(r)}})(t,e,r.linkDistance,r.edgeStrength);r.degrees=zc(t.length,r.nodeIdxMap,e);const s=[],u=[],c=[],h=[],l=[];r.getMass||(r.getMass=t=>r.degrees[r.nodeIdxMap[t.id]]||1);const d=r.gravity,f=r.center;t.forEach((t,e)=>{s.push(r.getMass(t)),u.push(r.nodeStrength(t)),r.degrees[e]||(r.degrees[e]=0);let n=[f[0],f[1],d];!r.getCenter||(e=r.getCenter(t,r.degrees[e]))&&Uc(e[0])&&Uc(e[1])&&Uc(e[2])&&(n=e),c.push(n[0]),h.push(n[1]),l.push(n[2])});var p=ng([s,r.degrees,u]),g=ng([c,h,l]),e=r.workerEnabled;let v;v=e?tg.create({canvas:E,engineOptions:{supportCompute:!0}}):tg.create({engineOptions:{supportCompute:!0}});const y=r.onLayoutEnd,m=[];a.forEach(t=>{m.push(t)});for(let t=0;t<4;t++)m.push(0);const x=v.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_damping : f32;\\n  [[offset 4]] u_maxSpeed : f32;\\n  [[offset 8]] u_minMovement : f32;\\n  \\n  [[offset 12]] u_coulombDisScale : f32;\\n  [[offset 16]] u_factor : f32;\\n  \\n  \\n  [[offset 20]] u_interval : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AveMovement : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributeArray1 : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 3, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\ntype GWebGPUBuffer3 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributeArray2 : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 4, set 0]] var<storage_buffer> gWebGPUBuffer3 : GWebGPUBuffer3;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn unpack_float(packedValue : f32) -> vec2<i32> {var packedIntValue : i32 = i32(packedValue);\\nvar v0 : i32 = packedIntValue / 1048576;\\nreturn vec2<i32>(v0, packedIntValue - (v0 * 1048576));}\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nvar vx : f32 = currentNode.x - nextNode.x;\\nvar vy : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.01;\\nvar n_dist : f32 = dist * gWebGPUUniformParams.u_coulombDisScale;\\nvar direx : f32 = vx / dist;\\nvar direy : f32 = vy / dist;\\nvar attributesi : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvar attributesj : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[j];\\nvar massi : f32 = attributesi.x;\\nvar nodeStrengthi : f32 = attributesi.z;\\nvar nodeStrengthj : f32 = attributesj.z;\\nvar nodeStrength : f32 = (nodeStrengthi + nodeStrengthj) / 2.0;\\nvar param : f32 = (1000.0 * gWebGPUUniformParams.u_factor) / (n_dist * n_dist);\\nax = ax + direx * param;\\nay = ay + direy * param;}}\\nreturn vec2<f32>(ax, ay);}\\nfn calcGravity(i : i32, currentNode : vec4<f32>, attributes2 : vec4<f32>) -> vec2<f32> {var vx : f32 = currentNode.x - attributes2.x;\\nvar vy : f32 = currentNode.y - attributes2.y;\\nvar ax : f32 = vx * attributes2.w;\\nvar ay : f32 = vy * attributes2.w;\\nreturn vec2<f32>(ax, ay);}\\nfn calcAttractive(i : i32, currentNode : vec4<f32>, attributes1 : vec4<f32>) -> vec2<f32> {var mass : f32 = attributes1.x;\\nvar ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nvar compressed : vec2<i32> = unpack_float(currentNode.z);\\nvar length : i32 = compressed.x;\\nvar arr_offset : i32 = compressed.y;\\nvar node_buffer : vec4<f32>;\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\nvar arr_idx : i32 = arr_offset + (4 * p);\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\nvar float_j : f32 = node_buffer.x;\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\nvar vx : f32 = nextNode.x - currentNode.x;\\nvar vy : f32 = nextNode.y - currentNode.y;\\nvar dist : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.01;\\nvar direx : f32 = vx / dist;\\nvar direy : f32 = vy / dist;\\nvar edgeLength : f32 = node_buffer.y;\\nvar edgeStrength : f32 = node_buffer.z;\\nvar diff : f32 = edgeLength - dist;\\nvar param : f32 = (diff * edgeStrength) / mass;\\nax = ax - direx * param;\\nay = ay - direy * param;}\\nreturn vec2<f32>(ax, ay);}\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\nvar movement : vec4<f32> = gWebGPUBuffer1.u_AveMovement[0];\\nvar ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nif ((i >= __DefineValuePlaceholder__VERTEX_COUNT) || (movement.x < gWebGPUUniformParams.u_minMovement)) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvar nodeAttributes1 : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvar nodeAttributes2 : vec4<f32> = gWebGPUBuffer3.u_NodeAttributeArray2[i];\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\nax = ax + repulsive.x;\\nay = ay + repulsive.y;\\nvar attractive : vec2<f32> = calcAttractive(i, currentNode, nodeAttributes1);\\nax = ax + attractive.x;\\nay = ay + attractive.y;\\nvar gravity : vec2<f32> = calcGravity(i, currentNode, nodeAttributes2);\\nax = ax - gravity.x;\\nay = ay - gravity.y;\\nvar param : f32 = gWebGPUUniformParams.u_interval * gWebGPUUniformParams.u_damping;\\nvar vx : f32 = ax * param;\\nvar vy : f32 = ay * param;\\nvar vlength : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > gWebGPUUniformParams.u_maxSpeed) {var param2 : f32 = gWebGPUUniformParams.u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nvar distx : f32 = vx * gWebGPUUniformParams.u_interval;\\nvar disty : f32 = vy * gWebGPUUniformParams.u_interval;\\nvar distLength : f32 = std::sqrt((distx * distx) + (disty * disty));\\ngWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_damping;\\n  float u_maxSpeed;\\n  float u_minMovement;\\n  \\n  float u_coulombDisScale;\\n  float u_factor;\\n  \\n  \\n  float u_interval;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_AveMovement[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 3) buffer readonly  GWebGPUBuffer2 {\\n  vec4 u_NodeAttributeArray1[];\\n} gWebGPUBuffer2;\\n\\nlayout(std430, set = 0, binding = 4) buffer readonly  GWebGPUBuffer3 {\\n  vec4 u_NodeAttributeArray2[];\\n} gWebGPUBuffer3;\\n\\n\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define SHIFT_20 1048576.0\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nivec2 unpack_float(float packedValue) {int packedIntValue = int(packedValue);\\nint v0 = packedIntValue / int(SHIFT_20);\\nreturn ivec2(v0, packedIntValue - (v0 * int(SHIFT_20)));}\\nvec2 calcRepulsive(int i, vec4 currentNode) {float ax = 0.0;\\nfloat ay = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\nfloat vx = currentNode.x - nextNode.x;\\nfloat vy = currentNode.y - nextNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat n_dist = dist * gWebGPUUniformParams.u_coulombDisScale;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nvec4 attributesi = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvec4 attributesj = gWebGPUBuffer2.u_NodeAttributeArray1[j];\\nfloat massi = attributesi.x;\\nfloat nodeStrengthi = attributesi.z;\\nfloat nodeStrengthj = attributesj.z;\\nfloat nodeStrength = (nodeStrengthi + nodeStrengthj) / 2.0;\\nfloat param = (1000.0 * gWebGPUUniformParams.u_factor) / (n_dist * n_dist);\\nax += direx * param;\\nay += direy * param;}}\\nreturn vec2(ax, ay);}\\nvec2 calcGravity(int i, vec4 currentNode, vec4 attributes2) {float vx = currentNode.x - attributes2.x;\\nfloat vy = currentNode.y - attributes2.y;\\nfloat ax = vx * attributes2.w;\\nfloat ay = vy * attributes2.w;\\nreturn vec2(ax, ay);}\\nvec2 calcAttractive(int i, vec4 currentNode, vec4 attributes1) {float mass = attributes1.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nivec2 compressed = unpack_float(currentNode.z);\\nint length = compressed.x;\\nint arr_offset = compressed.y;\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + (4 * p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\nfloat float_j = node_buffer.x;\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\nfloat vx = nextNode.x - currentNode.x;\\nfloat vy = nextNode.y - currentNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nfloat edgeLength = node_buffer.y;\\nfloat edgeStrength = node_buffer.z;\\nfloat diff = edgeLength - dist;\\nfloat param = (diff * edgeStrength) / mass;\\nax -= direx * param;\\nay -= direy * param;}\\nreturn vec2(ax, ay);}\\nvoid main() {int i = globalInvocationID.x;\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\nvec4 movement = gWebGPUBuffer1.u_AveMovement[0];\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nif ((i >= VERTEX_COUNT) || (movement.x < gWebGPUUniformParams.u_minMovement)) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvec4 nodeAttributes1 = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvec4 nodeAttributes2 = gWebGPUBuffer3.u_NodeAttributeArray2[i];\\nvec2 repulsive = calcRepulsive(i, currentNode);\\nax += repulsive.x;\\nay += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode, nodeAttributes1);\\nax += attractive.x;\\nay += attractive.y;\\nvec2 gravity = calcGravity(i, currentNode, nodeAttributes2);\\nax -= gravity.x;\\nay -= gravity.y;\\nfloat param = gWebGPUUniformParams.u_interval * gWebGPUUniformParams.u_damping;\\nfloat vx = ax * param;\\nfloat vy = ay * param;\\nfloat vlength = sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > gWebGPUUniformParams.u_maxSpeed) {float param2 = gWebGPUUniformParams.u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nfloat distx = vx * gWebGPUUniformParams.u_interval;\\nfloat disty = vy * gWebGPUUniformParams.u_interval;\\nfloat distLength = sqrt((distx * distx) + (disty * disty));\\ngWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define SHIFT_20 1048576.0\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_damping;\\nuniform float u_maxSpeed;\\nuniform float u_minMovement;\\nuniform sampler2D u_AveMovement;\\nuniform vec2 u_AveMovementSize;\\nvec4 getDatau_AveMovement(vec2 address2D) {\\n  return vec4(texture2D(u_AveMovement, address2D).rgba);\\n}\\nvec4 getDatau_AveMovement(float address1D) {\\n  return getDatau_AveMovement(addrTranslation_1Dto2D(address1D, u_AveMovementSize));\\n}\\nvec4 getDatau_AveMovement(int address1D) {\\n  return getDatau_AveMovement(float(address1D));\\n}\\nuniform float u_coulombDisScale;\\nuniform float u_factor;\\nuniform sampler2D u_NodeAttributeArray1;\\nuniform vec2 u_NodeAttributeArray1Size;\\nvec4 getDatau_NodeAttributeArray1(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributeArray1, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributeArray1(float address1D) {\\n  return getDatau_NodeAttributeArray1(addrTranslation_1Dto2D(address1D, u_NodeAttributeArray1Size));\\n}\\nvec4 getDatau_NodeAttributeArray1(int address1D) {\\n  return getDatau_NodeAttributeArray1(float(address1D));\\n}\\nuniform sampler2D u_NodeAttributeArray2;\\nuniform vec2 u_NodeAttributeArray2Size;\\nvec4 getDatau_NodeAttributeArray2(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributeArray2, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributeArray2(float address1D) {\\n  return getDatau_NodeAttributeArray2(addrTranslation_1Dto2D(address1D, u_NodeAttributeArray2Size));\\n}\\nvec4 getDatau_NodeAttributeArray2(int address1D) {\\n  return getDatau_NodeAttributeArray2(float(address1D));\\n}\\nuniform float u_interval;\\nivec2 unpack_float(float packedValue) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint packedIntValue = int(packedValue);\\nint v0 = packedIntValue / int(SHIFT_20);\\nreturn ivec2(v0, packedIntValue - (v0 * int(SHIFT_20)));}\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\nfloat vx = currentNode.x - nextNode.x;\\nfloat vy = currentNode.y - nextNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat n_dist = dist * u_coulombDisScale;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nvec4 attributesi = getDatau_NodeAttributeArray1(i);\\nvec4 attributesj = getDatau_NodeAttributeArray1(j);\\nfloat massi = attributesi.x;\\nfloat nodeStrengthi = attributesi.z;\\nfloat nodeStrengthj = attributesj.z;\\nfloat nodeStrength = (nodeStrengthi + nodeStrengthj) / 2.0;\\nfloat param = (1000.0 * u_factor) / (n_dist * n_dist);\\nax += direx * param;\\nay += direy * param;}}\\nreturn vec2(ax, ay);}\\nvec2 calcGravity(int i, vec4 currentNode, vec4 attributes2) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat vx = currentNode.x - attributes2.x;\\nfloat vy = currentNode.y - attributes2.y;\\nfloat ax = vx * attributes2.w;\\nfloat ay = vy * attributes2.w;\\nreturn vec2(ax, ay);}\\nvec2 calcAttractive(int i, vec4 currentNode, vec4 attributes1) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat mass = attributes1.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nivec2 compressed = unpack_float(currentNode.z);\\nint length = compressed.x;\\nint arr_offset = compressed.y;\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + (4 * p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\nfloat float_j = node_buffer.x;\\nvec4 nextNode = getDatau_Data(int(float_j));\\nfloat vx = nextNode.x - currentNode.x;\\nfloat vy = nextNode.y - currentNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nfloat edgeLength = node_buffer.y;\\nfloat edgeStrength = node_buffer.z;\\nfloat diff = edgeLength - dist;\\nfloat param = (diff * edgeStrength) / mass;\\nax -= direx * param;\\nay -= direy * param;}\\nreturn vec2(ax, ay);}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 currentNode = getDatau_Data(i);\\nvec4 movement = getDatau_AveMovement(0.0);\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nif ((i >= VERTEX_COUNT) || (movement.x < u_minMovement)) {gl_FragColor = vec4(currentNode);\\nreturn ;}\\nvec4 nodeAttributes1 = getDatau_NodeAttributeArray1(i);\\nvec4 nodeAttributes2 = getDatau_NodeAttributeArray2(i);\\nvec2 repulsive = calcRepulsive(i, currentNode);\\nax += repulsive.x;\\nay += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode, nodeAttributes1);\\nax += attractive.x;\\nay += attractive.y;\\nvec2 gravity = calcGravity(i, currentNode, nodeAttributes2);\\nax -= gravity.x;\\nay -= gravity.y;\\nfloat param = u_interval * u_damping;\\nfloat vx = ax * param;\\nfloat vy = ay * param;\\nfloat vlength = sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > u_maxSpeed) {float param2 = u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nfloat distx = vx * u_interval;\\nfloat disty = vy * u_interval;\\nfloat distLength = sqrt((distx * distx) + (disty * disty));\\ngl_FragColor = vec4(vec4(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"MAX_EDGE_PER_VERTEX","type":"Float","runtime":true},{"name":"VERTEX_COUNT","type":"Float","runtime":true},{"name":"SHIFT_20","type":"Float","value":1048576,"runtime":false}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]},{"name":"u_damping","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_maxSpeed","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_minMovement","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AveMovement","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_coulombDisScale","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_factor","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributeArray1","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributeArray2","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_interval","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_Data","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([i,1,1]).setBinding({u_Data:a,u_damping:r.damping,u_maxSpeed:r.maxSpeed,u_minMovement:r.minMovement,u_coulombDisScale:r.coulombDisScale,u_factor:r.factor,u_NodeAttributeArray1:p,u_NodeAttributeArray2:g,MAX_EDGE_PER_VERTEX:o,VERTEX_COUNT:i,u_AveMovement:m,u_interval:r.interval}),b=v.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_iter : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AveMovement : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\n\\n\\n\\n\\n\\n\\n\\n\\nfn main() -> void {var movement : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {var vertex : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nmovement = movement + vertex.w;}\\nmovement = movement / f32(__DefineValuePlaceholder__VERTEX_COUNT);\\ngWebGPUBuffer1.u_AveMovement[0] = vec4<f32>(movement, 0.0, 0.0, 0.0);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_iter;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer   GWebGPUBuffer1 {\\n  vec4 u_AveMovement[];\\n} gWebGPUBuffer1;\\n\\n\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\nvoid main() {float movement = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 vertex = gWebGPUBuffer0.u_Data[j];\\nmovement += vertex.w;}\\nmovement = movement / float(VERTEX_COUNT);\\ngWebGPUBuffer1.u_AveMovement[0] = vec4(movement, 0.0, 0.0, 0.0);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_iter;\\nuniform sampler2D u_AveMovement;\\nuniform vec2 u_AveMovementSize;\\nvec4 getDatau_AveMovement(vec2 address2D) {\\n  return vec4(texture2D(u_AveMovement, address2D).rgba);\\n}\\nvec4 getDatau_AveMovement(float address1D) {\\n  return getDatau_AveMovement(addrTranslation_1Dto2D(address1D, u_AveMovementSize));\\n}\\nvec4 getDatau_AveMovement(int address1D) {\\n  return getDatau_AveMovement(float(address1D));\\n}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat movement = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 vertex = getDatau_Data(j);\\nmovement += vertex.w;}\\nmovement = movement / float(VERTEX_COUNT);\\ngl_FragColor = vec4(vec4(movement, 0.0, 0.0, 0.0));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"VERTEX_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_iter","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AveMovement","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_AveMovement","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([1,1,1]).setBinding({u_Data:a,VERTEX_COUNT:i,u_AveMovement:[0,0,0,0]});yield rg(this,void 0,void 0,function*(){for(let t=0;t<n;t++){yield x.execute(),b.setBinding({u_Data:x}),yield b.execute();var e=Math.max(.02,r.interval-.002*t);x.setBinding({u_interval:e,u_AveMovement:b})}const i=yield x.getOutput();E?S.postMessage({type:oh.GPUEND,vertexEdgeData:i}):t.forEach((t,e)=>{var n=i[4*e],e=i[4*e+1];t.x=n,t.y=e}),y&&y()})})}getType(){return"gForce-gpu"}}),qc("comboForce",class extends Lc{constructor(t){super(),this.center=[0,0],this.maxIteration=100,this.gravity=10,this.comboGravity=10,this.linkDistance=10,this.alpha=1,this.alphaMin=.001,this.alphaDecay=1-Math.pow(this.alphaMin,1/300),this.alphaTarget=0,this.velocityDecay=.6,this.edgeStrength=.6,this.nodeStrength=30,this.preventOverlap=!1,this.preventNodeOverlap=!1,this.preventComboOverlap=!1,this.collideStrength=void 0,this.nodeCollideStrength=.5,this.comboCollideStrength=.5,this.comboSpacing=20,this.comboPadding=10,this.optimizeRangeFactor=1,this.onTick=()=>{},this.onLayoutEnd=()=>{},this.depthAttractiveForceScale=1,this.depthRepulsiveForceScale=2,this.nodes=[],this.edges=[],this.combos=[],this.comboTrees=[],this.width=300,this.height=300,this.bias=[],this.nodeMap={},this.oriComboMap={},this.indexMap={},this.comboMap={},this.previousLayouted=!1,this.updateCfg(t)}getDefaultCfg(){return{maxIteration:100,center:[0,0],gravity:10,speed:1,comboGravity:30,preventOverlap:!1,preventComboOverlap:!0,preventNodeOverlap:!0,nodeSpacing:void 0,collideStrength:void 0,nodeCollideStrength:.5,comboCollideStrength:.5,comboSpacing:20,comboPadding:10,edgeStrength:.6,nodeStrength:30,linkDistance:10}}execute(){var t=this;const e=t.nodes;var n=t.center;if(t.comboTree={id:"comboTreeRoot",depth:-1,children:t.comboTrees},e&&0!==e.length){if(1===e.length)return e[0].x=n[0],e[0].y=n[1],void(t.onLayoutEnd&&t.onLayoutEnd());t.initVals(),t.run(),t.onLayoutEnd&&t.onLayoutEnd()}else t.onLayoutEnd&&t.onLayoutEnd()}run(){var e=this;const n=e.nodes;var i=e.previousLayouted?e.maxIteration/5:e.maxIteration;e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight);var t=e.center;const r=e.velocityDecay,o=e.comboMap;e.previousLayouted||e.initPos(o);for(let t=0;t<i;t++){const u=[];n.forEach((t,e)=>{u[e]={x:0,y:0}}),e.applyCalculate(u),e.applyComboCenterForce(u),n.forEach((t,e)=>{Uc(t.x)&&Uc(t.y)&&(t.x+=u[e].x*r,t.y+=u[e].y*r)}),e.alpha+=(e.alphaTarget-e.alpha)*e.alphaDecay,e.onTick()}const a=[0,0];n.forEach(t=>{Uc(t.x)&&Uc(t.y)&&(a[0]+=t.x,a[1]+=t.y)}),a[0]/=n.length,a[1]/=n.length;const s=[t[0]-a[0],t[1]-a[1]];n.forEach((t,e)=>{Uc(t.x)&&Uc(t.y)&&(t.x+=s[0],t.y+=s[1])}),e.combos.forEach(t=>{var e=o[t.id];e&&e.empty&&(t.x=e.cx||t.x,t.y=e.cy||t.y)}),e.previousLayouted=!0}initVals(){var t=this,e=t.edges;const n=t.nodes,i=t.combos,r={},o={},a={};n.forEach((t,e)=>{o[t.id]=t,a[t.id]=e}),t.nodeMap=o,t.indexMap=a;const s={};i.forEach(t=>{s[t.id]=t}),t.oriComboMap=s,t.comboMap=t.getComboMap();var u=t.preventOverlap;t.preventComboOverlap=t.preventComboOverlap||u,t.preventNodeOverlap=t.preventNodeOverlap||u;u=t.collideStrength;u&&(t.comboCollideStrength=u,t.nodeCollideStrength=u),t.comboCollideStrength=t.comboCollideStrength||0,t.nodeCollideStrength=t.nodeCollideStrength||0;for(let t=0;t<e.length;++t)r[e[t].source]?r[e[t].source]++:r[e[t].source]=1,r[e[t].target]?r[e[t].target]++:r[e[t].target]=1;const c=[];for(let t=0;t<e.length;++t)c[t]=r[e[t].source]/(r[e[t].source]+r[e[t].target]);this.bias=c;const h=t.nodeSize,l=t.nodeSpacing;let d,f;if(f=Uc(l)?()=>l:Yc(l)?l:()=>0,this.nodeSpacing=f,h)if(Yc(h))d=t=>h(t);else if(Gc(h)){const k=(h[0]>h[1]?h[0]:h[1])/2;d=t=>k}else{const C=h/2;d=t=>C}else d=t=>{return t.size?Gc(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])/2:t.size/2:10};this.nodeSize=d;const p=t.comboSpacing;let g;g=Uc(p)?()=>p:Yc(p)?p:()=>0,this.comboSpacing=g;const v=t.comboPadding;let y;y=Uc(v)?()=>v:Gc(v)?()=>Math.max.apply(null,v):Yc(v)?v:()=>0,this.comboPadding=y;let m=this.linkDistance,x;m=m||10,x=Uc(m)?t=>m:m,this.linkDistance=x;let b=this.edgeStrength,E;b=b||1,E=Uc(b)?t=>b:b,this.edgeStrength=E;let S=this.nodeStrength,w;S=S||30,w=Uc(S)?t=>S:S,this.nodeStrength=w}initPos(r){const t=this.nodes;t.forEach((t,e)=>{var n=t.comboId,i=r[n];n&&i?(t.x=i.cx+100/(e+1),t.y=i.cy+100/(e+1)):(t.x=100/(e+1),t.y=100/(e+1))})}getComboMap(){const s=this,u=s.nodeMap,c=s.indexMap,t=s.comboTrees,h=s.oriComboMap,l={};return(t||[]).forEach(t=>{const a=[];Zc(t,t=>{if("node"===t.itemType)return!0;if(!h[t.id])return!0;var e,n,i;void 0===l[t.id]&&(i={id:t.id,name:t.id,cx:0,cy:0,count:0,depth:s.oriComboMap[t.id].depth,children:[]},l[t.id]=i);const r=t.children;r&&r.forEach(t=>!l[t.id]&&!u[t.id]||void a.push(t));const o=l[t.id];return o.cx=0,(o.cy=0)===a.length&&(o.empty=!0,e=h[t.id],n=Object.keys(u).length,t={id:i=`${t.id}-visual-child-${n}`,x:e.x,y:e.y,depth:o.depth+1,itemType:"node"},s.nodes.push(t),u[i]=t,c[i]=n,o.cx=e.x,o.cy=e.y,a.push(t)),a.forEach(t=>{if(o.count++,"node"!==t.itemType){var e=l[t.id];return Uc(e.cx)&&(o.cx+=e.cx),void(Uc(e.cy)&&(o.cy+=e.cy))}t=u[t.id];t&&(Uc(t.x)&&(o.cx+=t.x),Uc(t.y)&&(o.cy+=t.y))}),o.cx/=o.count,o.cy/=o.count,o.children=a,!0})}),l}applyComboCenterForce(c){var t=this.gravity;const h=this.comboGravity||t,l=this.alpha,e=this.comboTrees,d=this.indexMap,f=this.nodeMap,p=this.comboMap;(e||[]).forEach(t=>{Zc(t,t=>{if("node"===t.itemType)return!0;if(!p[t.id])return!0;const o=p[t.id],a=(o.depth+1)/10*.5,s=o.cx,u=o.cy;return o.cx=0,o.cy=0,o.children.forEach(t=>{if("node"!==t.itemType){var e=p[t.id];return e&&Uc(e.cx)&&(o.cx+=e.cx),void(e&&Uc(e.cy)&&(o.cy+=e.cy))}var n=f[t.id],i=n.x-s||.005,r=n.y-u||.005,e=Math.sqrt(i*i+r*r),t=d[n.id],e=h*l/e*a;c[t].x-=i*e,c[t].y-=r*e,Uc(n.x)&&(o.cx+=n.x),Uc(n.y)&&(o.cy+=n.y)}),o.cx/=o.count,o.cy/=o.count,!0})})}applyCalculate(t){var e=this.comboMap;const n=this.nodes,a={};n.forEach((o,t)=>{n.forEach((e,n)=>{if(!(t<n)){var i=o.x-e.x||.005,r=o.y-e.y||.005;let t=i*i+r*r;n=Math.sqrt(t);t<1&&(t=n),a[`${o.id}-${e.id}`]={vx:i,vy:r,vl2:t,vl:n},a[`${e.id}-${o.id}`]={vl2:t,vl:n,vx:-i,vy:-r}}})}),this.updateComboSizes(e),this.calRepulsive(t,a),this.calAttractive(t,a),this.preventComboOverlap&&this.comboNonOverlapping(t,e)}updateComboSizes(r){const a=this,t=a.comboTrees,s=a.nodeMap,u=a.nodeSize,c=a.comboSpacing,h=a.comboPadding;(t||[]).forEach(t=>{const i=[];Zc(t,t=>{if("node"===t.itemType)return!0;const o=r[t.id];if(!o)return!1;const e=t.children;e&&e.forEach(t=>{(r[t.id]||s[t.id])&&i.push(t)}),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0,i.forEach(t=>{if("node"!==t.itemType)return!0;var e=s[t.id];if(!e)return!0;var n=u(e),i=e.x-n,r=e.y-n,t=e.x+n,n=e.y+n;o.minX>i&&(o.minX=i),o.minY>r&&(o.minY=r),o.maxX<t&&(o.maxX=t),o.maxY<n&&(o.maxY=n)});let n=a.oriComboMap[t.id].size||10;Gc(n)&&(n=n[0]);t=Math.max(o.maxX-o.minX,o.maxY-o.minY,n);return o.r=t/2+c(o)/2+h(o),!0})})}comboNonOverlapping(v,y){var t=this.comboTree;const m=this.comboCollideStrength,x=this.indexMap,b=this.nodeMap;Zc(t,t=>{if(!y[t.id]&&!b[t.id]&&"comboTreeRoot"!==t.id)return!1;const e=t.children;return e&&1<e.length&&e.forEach((f,p)=>{if("node"===f.itemType)return!1;const g=y[f.id];g&&e.forEach((t,e)=>{if(p<=e)return!1;if("node"===t.itemType)return!1;var n=y[t.id];if(!n)return!1;var i=g.cx-n.cx||.005,r=g.cy-n.cy||.005,o=i*i+r*r,a=g.r,e=n.r,n=a+e,e=e*e,a=a*a;if(o<n*n){const s=f.children;if(!s||0===s.length)return!1;const u=t.children;if(!u||0===u.length)return!1;o=Math.sqrt(o),o=(n-o)/o*m;const c=i*o,h=r*o,l=e/(a+e),d=1-l;s.forEach(t=>{if("node"!==t.itemType)return!1;if(b[t.id]){const e=x[t.id];u.forEach(t=>{if("node"!==t.itemType)return!1;if(!b[t.id])return!1;t=x[t.id];v[e].x+=c*l,v[e].y+=h*l,v[t].x-=c*d,v[t].y-=h*d})}})}})}),!0})}calRepulsive(h,l){const r=this,o=r.nodes,d=r.width*r.optimizeRangeFactor,f=r.nodeStrength,p=r.alpha,g=r.nodeCollideStrength,v=r.preventNodeOverlap,y=r.nodeSize,m=r.nodeSpacing,x=r.depthRepulsiveForceScale,a=r.center;o.forEach((u,c)=>{var t,e,n,i;u.x&&u.y&&(a&&(t=r.gravity,e=u.x-a[0]||.005,n=u.y-a[1]||.005,i=Math.sqrt(e*e+n*n),h[c].x-=e*t*p/i,h[c].y-=n*t*p/i),o.forEach((e,n)=>{if(c!==n&&e.x&&e.y){var{vl2:i,vl:r}=l[`${u.id}-${e.id}`];if(!(r>d)){var{vx:o,vy:a}=l[`${u.id}-${e.id}`];let t=Math.log(Math.abs(e.depth-u.depth)/10)+1||1;t=t<1?1:t,e.comboId!==u.comboId&&(t+=1);var s=t?Math.pow(x,t):1,s=f(e)*p/i*s;h[c].x+=o*s,h[c].y+=a*s,c<n&&v&&(i<(e=(s=y(u)+m(u))+(i=y(e)+m(e)))*e&&(r=a*(e=(e-r)/r*g),h[c].x+=(e=o*e)*(i=(i=i*i)/(s*s+i)),h[c].y+=r*i,h[n].x-=e*(i=1-i),h[n].y-=r*i))}}}))})}calAttractive(c,h){const t=this,e=t.edges,l=t.linkDistance,d=t.alpha,f=t.edgeStrength,p=t.bias,g=t.depthAttractiveForceScale;e.forEach((n,i)=>{if(n.source&&n.target&&n.source!==n.target){var r,o=t.indexMap[n.source],a=t.indexMap[n.target],s=t.nodeMap[n.source],u=t.nodeMap[n.target];if(s&&u){let t=Math.log(Math.abs(s.depth-u.depth)/10);s.comboId===u.comboId&&(t/=2);let e=t?Math.pow(g,t):1;s.comboId!==u.comboId&&1===e?e=g/2:s.comboId===u.comboId&&(e=2),Uc(u.x)&&Uc(s.x)&&Uc(u.y)&&Uc(s.y)&&({vl:r,vx:u,vy:s}=h[`${n.target}-${n.source}`],n=u*(r=(r-l(n))/r*d*f(n)*e),r=s*r,i=p[i],c[a].x-=n*i,c[a].y-=r*i,c[o].x+=n*(1-i),c[o].y+=r*(1-i))}}})}getType(){return"comboForce"}}),qc("forceAtlas2",class extends Lc{constructor(t){super(),this.center=[0,0],this.width=300,this.height=300,this.nodes=[],this.edges=[],this.kr=5,this.kg=1,this.mode="normal",this.preventOverlap=!1,this.dissuadeHubs=!1,this.barnesHut=!1,this.maxIteration=0,this.ks=.1,this.ksmax=10,this.tao=.1,this.onLayoutEnd=()=>{},this.prune=!1,this.updateCfg(t)}getDefaultCfg(){return{}}execute(){var i=this;let{nodes:r,maxIteration:t,onLayoutEnd:e,prune:n}=i;i.width||"undefined"==typeof window||(i.width=window.innerWidth),i.height||"undefined"==typeof window||(i.height=window.innerHeight);const o=[];var a=r.length;for(let n=0;n<a;n+=1){var s=r[n];let t=10,e=10;Uc(s.size)&&(t=s.size,e=s.size),Gc(s.size)&&(isNaN(s.size[0])||(t=s.size[0]),isNaN(s.size[1])||(e=s.size[1])),i.getWidth&&!isNaN(i.getWidth(s))&&(e=i.getWidth(s)),i.getHeight&&!isNaN(i.getHeight(s))&&(t=i.getHeight(s));s=Math.max(t,e);o.push(s)}!i.barnesHut&&250<a&&(i.barnesHut=!0),!i.prune&&100<a&&(i.prune=!0),0!==this.maxIteration||i.prune?0===this.maxIteration&&n&&(t=100,a<=200&&100<a?t=500:200<a&&(t=950),this.maxIteration=t):(t=250,a<=200&&100<a?t=1e3:200<a&&(t=1200),this.maxIteration=t),i.kr||(i.kr=50,100<a&&a<=500?i.kr=20:500<a&&(i.kr=1)),i.kg||(i.kg=20,100<a&&a<=500?i.kg=10:500<a&&(i.kg=1)),this.nodes=i.updateNodesByForces(o),e()}updateNodesByForces(t){let{nodes:a,edges:e,maxIteration:n}=this;var s=e.filter(t=>t.source!==t.target),u=a.length,i=s.length;const c=[],h={},l={},r=[];for(let t=0;t<u;t+=1)h[a[t].id]=t,void(c[t]=0)!==a[t].x&&!isNaN(a[t].x)||(a[t].x=1e3*Math.random()),void 0!==a[t].y&&!isNaN(a[t].y)||(a[t].y=1e3*Math.random()),r.push({x:a[t].x,y:a[t].y});for(let o=0;o<i;o+=1){let e,n,i=0,r=0;for(let t=0;t<u;t+=1)a[t].id===s[o].source?(e=a[t],i=t):a[t].id===s[o].target&&(n=a[t],r=t),l[o]={sourceIdx:i,targetIdx:r};e&&(c[h[e.id]]+=1),n&&(c[h[n.id]]+=1)}var o=n;if(a=this.iterate(o,h,l,i,c,t),this.prune){for(let t=0;t<i;t+=1)c[l[t].sourceIdx]<=1?(a[l[t].sourceIdx].x=a[l[t].targetIdx].x,a[l[t].sourceIdx].y=a[l[t].targetIdx].y):c[l[t].targetIdx]<=1&&(a[l[t].targetIdx].x=a[l[t].sourceIdx].x,a[l[t].targetIdx].y=a[l[t].sourceIdx].y);this.prune=!1,this.barnesHut=!1,a=this.iterate(100,h,l,i,c,t)}return a}iterate(t,e,n,i,r,o){let{nodes:a,kr:s,preventOverlap:u,barnesHut:c}=this;var h=a.length;let l=0;let d=t;var f;let p=[];const g=[],v=[];for(let t=0;t<h;t+=1)p[2*t]=0,p[2*t+1]=0,c&&(f={id:t,rx:a[t].x,ry:a[t].y,mass:1,g:s,degree:r[t]},v[t]=new og(f));for(;0<d;){for(let t=0;t<h;t+=1)g[2*t]=p[2*t],g[2*t+1]=p[2*t+1],p[2*t]=0,p[2*t+1]=0;p=this.getAttrForces(d,50,i,e,n,r,o,p),p=c&&(u&&50<d||!u)?this.getOptRepGraForces(p,v,r):this.getRepGraForces(d,50,p,100,o,r);var y=this.updatePos(p,g,l,r);a=y.nodes,l=y.sg,d--,this.tick&&this.tick()}return a}getAttrForces(r,o,e,a,n,s,u,c){var{nodes:i,preventOverlap:h,dissuadeHubs:l,mode:d,prune:f}=this;for(let t=0;t<e;t+=1){var p=i[n[t].sourceIdx],g=n[t].sourceIdx,v=i[n[t].targetIdx],y=n[t].targetIdx;if(!f||!(s[g]<=1||s[y]<=1)){let t=[v.x-p.x,v.y-p.y],e=Math.hypot(t[0],t[1]);e=e<1e-4?1e-4:e,t[0]=t[0]/e,t[1]=t[1]/e,h&&r<o&&(e=e-u[g]-u[y]);let n=e,i=n;"linlog"===d&&(n=Math.log(1+e),i=n),l&&(n=e/s[g],i=e/s[y]),h&&r<o&&e<=0?(n=0,i=0):h&&r<o&&0<e&&(n=e,i=e),c[2*a[p.id]]+=n*t[0],c[2*a[v.id]]-=i*t[0],c[2*a[p.id]+1]+=n*t[1],c[2*a[v.id]+1]-=i*t[1]}}return c}getRepGraForces(o,a,s,u,c,h){var{nodes:l,preventOverlap:d,kr:f,kg:e,center:n,prune:p}=this,g=l.length;for(let r=0;r<g;r+=1){for(let i=r+1;i<g;i+=1)if(!p||!(h[r]<=1||h[i]<=1)){let t=[l[i].x-l[r].x,l[i].y-l[r].y],e=Math.hypot(t[0],t[1]);e=e<1e-4?1e-4:e,t[0]=t[0]/e,t[1]=t[1]/e,d&&o<a&&(e=e-c[r]-c[i]);let n=f*(h[r]+1)*(h[i]+1)/e;d&&o<a&&e<0?n=u*(h[r]+1)*(h[i]+1):d&&o<a&&0===e?n=0:d&&o<a&&0<e&&(n=f*(h[r]+1)*(h[i]+1)/e),s[2*r]-=n*t[0],s[2*i]+=n*t[0],s[2*r+1]-=n*t[1],s[2*i+1]+=n*t[1]}let t=[l[r].x-n[0],l[r].y-n[1]];var i=Math.hypot(t[0],t[1]);t[0]=t[0]/i,t[1]=t[1]/i;i=e*(h[r]+1);s[2*r]-=i*t[0],s[2*r+1]-=i*t[1]}return s}getOptRepGraForces(i,r,o){var{nodes:a,kg:s,center:u,prune:e}=this,c=a.length;let n=9e10,h=-9e10,l=9e10,d=-9e10;for(let t=0;t<c;t+=1)e&&o[t]<=1||(r[t].setPos(a[t].x,a[t].y),a[t].x>=h&&(h=a[t].x),a[t].x<=n&&(n=a[t].x),a[t].y>=d&&(d=a[t].y),a[t].y<=l&&(l=a[t].y));var t=Math.max(h-n,d-l),t={xmid:(h+n)/2,ymid:(d+l)/2,length:t,massCenter:u,mass:c},f=new ag(t);let p=new sg(f);for(let t=0;t<c;t+=1)e&&o[t]<=1||r[t].in(f)&&p.insert(r[t]);for(let n=0;n<c;n+=1)if(!(e&&o[n]<=1)){r[n].resetForce(),p.updateForce(r[n]),i[2*n]-=r[n].fx,i[2*n+1]-=r[n].fy;let t=[a[n].x-u[0],a[n].y-u[1]],e=Math.hypot(t[0],t[1]);e=e<1e-4?1e-4:e,t[0]=t[0]/e,t[1]=t[1]/e;var g=s*(o[n]+1);i[2*n]-=g*t[0],i[2*n+1]-=g*t[1]}return i}updatePos(i,e,r,o){let{nodes:a,ks:s,tao:t,prune:u,ksmax:c}=this;var n,h,l=a.length;let d=[],f=[],p=0,g=0;for(let t=0;t<l;t+=1)u&&o[t]<=1||(h=[i[2*t]-e[2*t],i[2*t+1]-e[2*t+1]],n=Math.hypot(h[0],h[1]),h=[i[2*t]+e[2*t],i[2*t+1]+e[2*t+1]],h=Math.hypot(h[0],h[1]),d[t]=n,f[t]=h/2,p+=(o[t]+1)*d[t],g+=(o[t]+1)*f[t]);var v=r;r=t*g/p,0!==v&&(r=1.5*v<r?1.5*v:r);for(let n=0;n<l;n+=1)if(!(u&&o[n]<=1)){let t=s*r/(1+r*Math.sqrt(d[n])),e=Math.hypot(i[2*n],i[2*n+1]);e=e<1e-4?1e-4:e;var y=c/e;t=t>y?y:t;var m=t*i[2*n],y=t*i[2*n+1];a[n].x+=m,a[n].y+=y}return{nodes:a,sg:r}}});function cg(t){return new hg(function(){var l="LAYOUT_RUN",d="LAYOUT_END",f="LAYOUT_ERROR",p="GPU_LAYOUT_RUN";layout.registerLayout("grid",layout.GridLayout),layout.registerLayout("random",layout.RandomLayout),layout.registerLayout("force",layout.ForceLayout),layout.registerLayout("circular",layout.CircularLayout),layout.registerLayout("dagre",layout.DagreLayout),layout.registerLayout("radial",layout.RadialLayout),layout.registerLayout("concentric",layout.ConcentricLayout),layout.registerLayout("mds",layout.MDSLayout),layout.registerLayout("fruchterman",layout.FruchtermanLayout),layout.registerLayout("fruchterman-gpu",layout.FruchtermanGPULayout),layout.registerLayout("gForce",layout.GForceLayout),layout.registerLayout("gForce-gpu",layout.GForceGPULayout),layout.registerLayout("comboForce",layout.ComboForceLayout),layout.registerLayout("forceAtlas2",layout.ForceAtlas2Layout),onmessage=function(t){var e;(e=(e=t).data.type)!==l&&e!==p||function(t){var e=this;switch(t.data.type){case l:var n,i=t.data,r=i.nodes,o=i.edges,a=i.layoutCfg,s=(h=void 0===a?{}:a).type;if(!(u=layout.getLayoutByName(s))){this.postMessage({type:f,message:"layout "+s+" not found"});break}h.onLayoutEnd=function(){e.postMessage({type:d,nodes:r}),null!=n&&n.destroy()},(n=new u(h)).init({nodes:r,edges:o}),n.execute();break;case p:var u,c=t.data,i=c.nodes,o=c.edges,a=c.layoutCfg,c=c.canvas,s=(h=void 0===a?{}:a).type;if(!(u=layout.getLayoutByName(s))){this.postMessage({type:f,message:"layout "+s+" not found"});break}if("gpu"!==s.split("-")[1]){this.postMessage({type:f,message:"layout "+s+" does not support GPU"});break}var h=new u(h);h.init({nodes:i,edges:o}),h.executeWithWorker(c,this)}}(t)}},t=void 0===t?"https://unpkg.com/@antv/layout@latest/dist/layout.min.js":t)}var hg=function(t,e){return t=t.toString(),t=new Blob(["importScripts('"+e+"');("+t+")()"],{type:"text/javascript"}),new Worker(URL.createObjectURL(t))},lg="LAYOUT_RUN",dg="LAYOUT_END",fg="LAYOUT_ERROR",pg="LAYOUT_TICK",gg="GPU_LAYOUT_RUN",vg="GPU_LAYOUT_END",yg=function i(){return"undefined"==typeof window||"undefined"==typeof document?{}:{canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=(window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" rel="external nofollow" rel="external nofollow" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" rel="external nofollow" rel="external nofollow" style="color:#000">here</a>.']:['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" rel="external nofollow" rel="external nofollow" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" rel="external nofollow" rel="external nofollow" style="color:#000">here</a>.']).join("\n")),t},addGetWebGLMessage:function(t){var e=void 0!==(t=t||{}).parent?t.parent:document.body,n=void 0!==t.id?t.id:"oldie",t=i().getWebGLErrorMessage();t.id=n,e.appendChild(t)}}};function mg(t){return(mg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xg(t){return setTimeout(t,16)}function bg(t){return clearTimeout(t)}var Eg,Sg=function(t){return("undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame)||xg)(t)},wg=function(t){return("undefined"!=typeof window&&(window.cancelAnimationFrame||window.webkitCancelAnimationFrame)||bg)(t)},kg=["fruchterman","gForce"],Cg=["force","grid","circular"];function _g(t){var e=Eg.call(this,t)||this;return e.graph=t,e.layoutCfg=t.get("layout")||{},e.layoutType=e.getLayoutType(),e.worker=null,e.workerData={},e.initLayout(),e}var Mg,Ig,Tg,Ag,Pg=(Eg=ve,(0,na.ZT)(_g,Eg),_g.prototype.initLayout=function(){},_g.prototype.getWorker=function(){return this.worker||("undefined"==typeof Worker?this.worker=null:this.worker=cg(this.layoutCfg.workerScriptURL),this.worker)},_g.prototype.stopWorker=function(){var t=this.workerData;this.worker&&(this.worker.terminate(),this.worker=null,t.requestId&&(wg(t.requestId),t.requestId=null),t.requestId2&&(wg(t.requestId2),t.requestId2=null))},_g.prototype.execLayoutMethod=function(h,l){var d=this;return new Promise(function(t,e){var n,i=d.graph,r=h.type;h.onLayoutEnd=function(){i.emit("aftersublayout",{type:r}),t()},r&&d.isGPU&&d.hasGPUVersion(r)&&(r+="-gpu"),"force"===r||"g6force"===r||"gForce"===r?(n=h.onTick,h.tick=function(){n&&n(),i.refreshPositions()}):"comboForce"===h.type&&(h.comboTrees=i.get("comboTrees"));var o,a;try{o=new ug[r](h)}catch(t){e()}o.enableTick&&(a=h.onTick,o.tick=function(){a&&a(),i.refreshPositions()});var s,u,c=d.filterLayoutData(d.data,h);u=l,null!==(e=null==(s=c)?void 0:s.nodes)&&void 0!==e&&e.length&&s.nodes.forEach(function(t){t.layoutOrder=u}),o.init(c),i.emit("beforesublayout",{type:r}),o.execute(),o.isCustomLayout&&h.onLayoutEnd&&h.onLayoutEnd(),d.layoutMethods[l]=o})},_g.prototype.updateLayoutMethod=function(o,a){var s=this;return new Promise(function(t,e){var n=s.graph,i=null==a?void 0:a.type;a.onLayoutEnd=function(){n.emit("aftersublayout",{type:i}),t()};var r=s.filterLayoutData(s.data,a);o.init(r),o.updateCfg(a),n.emit("beforesublayout",{type:i}),o.execute(),o.isCustomLayout&&a.onLayoutEnd&&a.onLayoutEnd()})},_g.prototype.layout=function(t){var n=this,e=this.graph;this.data=this.setDataFromGraph();var i=this.data,r=i.nodes,o=i.hiddenNodes;if(!r)return!1;var a=e.get("width"),i=e.get("height"),s={};Object.assign(s,{width:a,height:i,center:[a/2,i/2]},this.layoutCfg),this.layoutCfg=s,this.destoryLayoutMethods(),e.emit("beforelayout"),this.initPositions(s.center,r),this.initPositions(s.center,o);o=s.type;o&&"gpu"===o.split("-")[1]&&(o=o.split("-")[0],s.gpuEnabled=!0);o=!1;s.gpuEnabled&&(o=!0,yg().webgl||(o=!1)),this.isGPU=o;var u=s.onLayoutEnd,o=s.layoutEndFormatted,c=s.adjust;if(o||(s.layoutEndFormatted=!0,s.onAllLayoutEnd=function(){return(0,na.mG)(n,void 0,void 0,function(){return(0,na.Jh)(this,function(t){switch(t.label){case 0:return u&&u(),this.refreshLayout(),c&&s.pipes?[4,this.adjustPipesBox(this.data,c)]:[3,2];case 1:t.sent(),this.refreshLayout(),t.label=2;case 2:return e.emit("afterlayout"),[2]}})})}),this.stopWorker(),s.workerEnabled&&this.layoutWithWorker(this.data))return!0;var h=Promise.resolve();return s.type?h=h.then(function(){return n.execLayoutMethod(s,0)}):s.pipes&&s.pipes.forEach(function(t,e){h=h.then(function(){return n.execLayoutMethod(t,e)})}),h.then(function(){s.onAllLayoutEnd&&s.onAllLayoutEnd(),t&&t()}).catch(function(t){}),!1},_g.prototype.layoutWithWorker=function(e){var n=this,t=this.layoutCfg,i=this.graph,r=this.getWorker(),o=this.workerData;if(!r)return!1;o.requestId=null,o.requestId2=null,o.currentTick=null,o.currentTickData=null,i.emit("beforelayout");var a=Promise.resolve();if(t.type)a=a.then(function(){return n.runWebworker(r,e,t)});else if(t.pipes)for(var s=0,u=t.pipes;s<u.length;s++)!function(t){a=a.then(function(){return n.runWebworker(r,e,t)})}(u[s]);return a.then(function(){t.onAllLayoutEnd&&t.onAllLayoutEnd()}).catch(function(t){}),!0},_g.prototype.runWebworker=function(t,e,i){var r=this,n=this.isGPU,o=this.filterLayoutData(e,i),a=o.nodes,s=o.edges,u=document.createElement("canvas"),e=n&&"undefined"!=typeof window&&window.navigator&&!navigator.gpu&&"OffscreenCanvas"in window&&"transferControlToOffscreen"in u,n=function(e,n){var i={};if(e&&"object"===mg(e))return Object.keys(e).forEach(function(t){e.hasOwnProperty(t)&&n(e[t])&&(i[t]=e[t])}),i;return e}(i,function(t){return"function"!=typeof t});return e?(u=u.transferControlToOffscreen(),n.type=n.type+"-gpu",t.postMessage({type:gg,nodes:a,edges:s,layoutCfg:n,canvas:u},[u])):t.postMessage({type:lg,nodes:a,edges:s,layoutCfg:n}),new Promise(function(e,n){t.onmessage=function(t){r.handleWorkerMessage(e,n,t,o,i)}})},_g.prototype.handleWorkerMessage=function(t,e,n,i,r){function o(){r.onTick&&r.onTick()}var a=this.graph,s=this.workerData,u=n.data,n=u.type;switch(n){case pg:s.currentTick=u.currentTick,s.currentTickData=u,s.requestId||(s.requestId=Sg(function(){Dg(i,u),a.refreshPositions(),o(),u.currentTick===u.totalTicks?t():s.currentTick===u.totalTicks&&(s.requestId2=Sg(function(){Dg(i,s.currentTickData),a.refreshPositions(),s.requestId2=null,o(),t()})),s.requestId=null}));break;case dg:null==s.currentTick&&(Dg(i,u),t());break;case vg:null==s.currentTick&&(function(t,e){for(var n=t.nodes,i=e.vertexEdgeData,r=n.length,o=0;o<r;o++){var a=n[o],s=i[4*o],u=i[4*o+1];a.x=s,a.y=u}}(i,u),t());break;case fg:default:e()}},_g.prototype.updateLayoutCfg=function(t){var i,r=this,e=this.graph,n=this.layoutMethods,o=at({},this.layoutCfg,t);this.layoutCfg=o,null!=n&&n.length?(this.data=this.setDataFromGraph(),this.stopWorker(),t.workerEnabled&&this.layoutWithWorker(this.data)||(e.emit("beforelayout"),i=Promise.resolve(),1===n.length?i=i.then(function(){return r.updateLayoutMethod(n[0],o)}):null!=n&&n.forEach(function(t,e){var n=o.pipes[e];i=i.then(function(){return r.updateLayoutMethod(t,n)})}),i.then(function(){o.onAllLayoutEnd&&o.onAllLayoutEnd()}).catch(function(t){}))):this.layout()},_g.prototype.adjustPipesBox=function(r,s){var u=this;return new Promise(function(t){var e=r.nodes;null!=e&&e.length||t(),Cg.includes(s)||t();var n={center:u.layoutCfg.center,nodeSize:function(t){return Math.max(t.height,t.width)},preventOverlap:!0,onLayoutEnd:function(){}},e=u.getLayoutBBox(e),o=e.groupNodes,i=e.layoutNodes,a=q(i);n.onLayoutEnd=function(){null!=i&&i.forEach(function(t,e){var n,i=t.x-(null===(n=a[e])||void 0===n?void 0:n.x),r=t.y-(null===(t=a[e])||void 0===t?void 0:t.y);null!==(e=o[e])&&void 0!==e&&e.forEach(function(t){t.x+=i,t.y+=r})}),t()},new ug[s](n).layout({nodes:i})})},_g.prototype.hasGPUVersion=function(t){for(var e=kg.length,n=0;n<e;n++)if(kg[n]===t)return!0;return!1},_g.prototype.destroy=function(){this.destoryLayoutMethods();var t=this.worker;t&&(t.terminate(),this.worker=null),this.destroyed=!0,this.graph.set("layout",void 0),this.layoutCfg=void 0,this.layoutType=void 0,this.layoutMethods=void 0,this.graph=null},_g);function Dg(t,e){for(var n=t.nodes,i=e.nodes,r=n.length,o=0;o<r;o++){var a=n[o];a.x=i[o].x,a.y=i[o].y}}function Ng(t){Mg||(Mg=document.createElement("table"),Ig=document.createElement("tr"),Tg=/^\s*<(\w+|!)[^>]*>/,Ag={tr:document.createElement("tbody"),tbody:Mg,thead:Mg,tfoot:Mg,td:Ig,th:Ig,"*":document.createElement("div")});var e=Tg.test(t)&&RegExp.$1;e&&e in Ag||(e="*");e=Ag[e];t=t.replace(/(^\s*)|(\s*$)/g,""),e.innerHTML=""+t;t=e.childNodes[0];return e.removeChild(t),t}var Og,Lg=sc;function Rg(t){var e=Og.call(this,t)||this,t=e.get("defaultNode");return t||e.set("defaultNode",{type:"circle"}),t.type||(t.type="circle",e.set("defaultNode",t)),e.destroyed=!1,e}var Bg,o=(Og=ge,(0,na.ZT)(Rg,Og),Rg.prototype.initLayoutController=function(){var t=new Pg(this);this.set({layoutController:t})},Rg.prototype.initEventController=function(){var t=new Oc(this);this.set({eventController:t})},Rg.prototype.initCanvas=function(){var t=this.get("container");if("string"==typeof t&&(t=document.getElementById(t),this.set("container",t)),!t)throw new Error("invalid container");var e=t.clientWidth,n=t.clientHeight,e=this.get("width")||e,n=this.get("height")||n,i="svg"===this.get("renderer")?new ac({container:t,width:e,height:n}):(i={container:t,width:e,height:n},(n=this.get("pixelRatio"))&&(i.pixelRatio=n),new Rs(i));this.set("canvas",i)},Rg.prototype.initPlugins=function(){var e=this;S(e.get("plugins"),function(t){!t.destroyed&&t.initPlugin&&t.initPlugin(e)})},Rg.prototype.downloadImageWatermark=function(i,r,o,a){return(0,na.mG)(this,void 0,void 0,function(){var e,n;return(0,na.Jh)(this,function(t){switch(t.label){case 0:return e=i.style.backgroundImage,e=e.slice(5,e.length-2),(n=new Image).src=e,[4,new Promise(function(e){n.onload=function(){var t=r.createPattern(n,"repeat");r.rect(0,0,o,a),r.fillStyle=t,r.fill(),e("")}})];case 1:return t.sent(),[2]}})})},Rg.prototype.asyncToDataUrl=function(u,c,h,l,d,t){var e=this,f=document.querySelector(".g6-graph-watermarker"),n=this.get("canvas"),p=n.getRenderer(),g=t||n.get("el"),v="";u=u||"image/png",setTimeout(function(){return(0,na.mG)(e,void 0,void 0,function(){var e,n,i,r,o,a,s;return(0,na.Jh)(this,function(t){switch(t.label){case 0:return"svg"!==p?[3,1]:(e=g.cloneNode(!0),s=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(s=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",s)).replaceChild(e,s.documentElement),s=(new XMLSerializer).serializeToString(s),v="data:image/svg+xml;charset=utf8,"+encodeURIComponent(s),[3,4]);case 1:return n=void 0,i=g.getContext("2d"),r=l||this.get("width"),o=d||this.get("height"),a=void 0,f?[4,this.downloadImageWatermark(f,i,r,o)]:[3,3];case 2:t.sent(),t.label=3;case 3:c&&(s="undefined"!=typeof window?window.devicePixelRatio:1,n=i.getImageData(0,0,r*s,o*s),a=i.globalCompositeOperation,i.globalCompositeOperation="destination-over",i.fillStyle=c,i.fillRect(0,0,r,o)),v=g.toDataURL(u),c&&(i.clearRect(0,0,r,o),i.putImageData(n,0,0),i.globalCompositeOperation=a),t.label=4;case 4:return h&&h(v),[2]}})})},16)},Rg.prototype.toDataURL=function(t,e){var n=this.get("canvas"),i=n.getRenderer(),r=n.get("el");t=t||"image/png";var o,a,s,u,c="";return"svg"===i?(a=r.cloneNode(!0),o=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(u=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",o)).replaceChild(a,u.documentElement),s=(new XMLSerializer).serializeToString(u),c="data:image/svg+xml;charset=utf8,"+encodeURIComponent(s)):(n=void 0,i=r.getContext("2d"),o=this.get("width"),a=this.get("height"),u=void 0,e&&(s="undefined"!=typeof window?window.devicePixelRatio:1,n=i.getImageData(0,0,o*s,a*s),u=i.globalCompositeOperation,i.globalCompositeOperation="destination-over",i.fillStyle=e,i.fillRect(0,0,o,a)),c=r.toDataURL(t),e&&(i.clearRect(0,0,o,a),i.putImageData(n,0,0),i.globalCompositeOperation=u)),c},Rg.prototype.toFullDataURL=function(r,o,t){var e=this.get("group").getCanvasBBox(),n=e.height,i=e.width,a=this.get("renderer"),s=Ng('<id="virtual-image"></div>'),u=t?t.backgroundColor:void 0,c=t?t.padding:void 0;c?N(c)&&(c=[c,c,c,c]):c=[0,0,0,0];var h=n+c[0]+c[2],l=i+c[1]+c[3],d={container:s,height:h,width:l,quickHit:!0},f=new("svg"===a?ac:Rs)(d),t=this.get("group").clone(),s=q(t.getMatrix()),d=(e.maxX+e.minX)/2,e=(e.maxY+e.minY)/2;s=Lg(s=s||[1,0,0,0,1,0,0,0,1],[["t",-d,-e],["t",i/2+c[3],n/2+c[0]]]),t.resetMatrix(),t.setMatrix(s),f.add(t);var p=f.get("el"),g="";o=o||"image/png",setTimeout(function(){var t,e,n,i;"svg"===a?(t=p.cloneNode(!0),n=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(i=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",n)).replaceChild(t,i.documentElement),e=(new XMLSerializer).serializeToString(i),g="data:image/svg+xml;charset=utf8,"+encodeURIComponent(e)):(n=void 0,t=p.getContext("2d"),i=void 0,u&&(e="undefined"!=typeof window?window.devicePixelRatio:1,n=t.getImageData(0,0,l*e,h*e),i=t.globalCompositeOperation,t.globalCompositeOperation="destination-over",t.fillStyle=u,t.fillRect(0,0,l,h)),g=p.toDataURL(o),u&&(t.clearRect(0,0,l,h),t.putImageData(n,0,0),t.globalCompositeOperation=i)),r&&r(g)},16)},Rg.prototype.downloadFullImage=function(i,r,t){var o=this,e=this.get("group").getCanvasBBox(),n=e.height,a=e.width,s=this.get("renderer"),u=Ng('<id="virtual-image"></div>'),c=document.querySelector(".g6-graph-watermarker"),h=t?t.backgroundColor:void 0,l=t?t.padding:void 0;l?N(l)&&(l=[l,l,l,l]):l=[0,0,0,0];var d=n+l[0]+l[2],t=a+l[1]+l[3];c&&(g=(f=this.get("graphWaterMarker").cfg||{}).width,p=f.height,d=Math.ceil(d/p)*p,t=Math.ceil(t/g)*g);var f={container:u,height:d,width:t},p=new("svg"===s?ac:Rs)(f),g=this.get("group").clone(),u=q(g.getMatrix()),f=(e.maxX+e.minX)/2,e=(e.maxY+e.minY)/2;u=Lg(u=u||[1,0,0,0,1,0,0,0,1],[["t",-f,-e],["t",a/2+l[3],n/2+l[0]]]),g.resetMatrix(),g.setMatrix(u),p.add(g);p=p.get("el");this.asyncToDataUrl(r=r||"image/png",h,function(t){var e=document.createElement("a"),n=(i||"graph")+("svg"===s?".svg":"."+r.split("/")[1]);o.dataURLToImage(t,s,e,n);n=document.createEvent("MouseEvents");n.initEvent("click",!1,!1),e.dispatchEvent(n)},t,d,p)},Rg.prototype.downloadImage=function(t,e,n){var i=this;this.isAnimating()&&this.stopAnimate();var r=this.get("canvas").getRenderer();e=e||"image/png";var o=(t||"graph")+("svg"===r?".svg":e.split("/")[1]),a=document.createElement("a");this.asyncToDataUrl(e,n,function(t){i.dataURLToImage(t,r,a,o);t=document.createEvent("MouseEvents");t.initEvent("click",!1,!1),a.dispatchEvent(t)})},Rg.prototype.dataURLToImage=function(t,e,n,i){if("undefined"!=typeof window)if(window.Blob&&window.URL&&"svg"!==e){var r=t.split(","),o="";r&&0<r.length&&((e=r[0].match(/:(.*?);/))&&2<=e.length&&(o=e[1]));for(var a=atob(r[1]),s=a.length,u=new Uint8Array(s);s--;)u[s]=a.charCodeAt(s);var c=new Blob([u],{type:o});window.navigator.msSaveBlob?window.navigator.msSaveBlob(c,i):n.addEventListener("click",function(){n.download=i,n.href=window.URL.createObjectURL(c)})}else n.addEventListener("click",function(){n.download=i,n.href=t})},Rg.prototype.addPlugin=function(t){t.destroyed||(this.get("plugins").push(t),t.initPlugin(this))},Rg.prototype.removePlugin=function(t){var e=this.get("plugins"),n=e.indexOf(t);0<=n&&(t.destroyPlugin(),e.splice(n,1))},Rg.prototype.setImageWaterMarker=function(t,e){void 0===t&&(t=Ic.waterMarkerImage);var n=this.get("container");(n=_(n)?document.getElementById(n):n).style.position||(n.style.position="relative");var i=this.get("graphWaterMarker"),r=Q({},Ic.imageWaterMarkerConfig,e),o=r.width,e=r.height,a=r.compatible,s=r.image;i||(o={container:n,width:o,height:e,capture:!1},(e=this.get("pixelRatio"))&&(o.pixelRatio=e),i=new Rs(o),this.set("graphWaterMarker",i)),i.get("el").style.display="none";var u=i.get("context"),c=s.rotate,h=s.x,l=s.y;u.rotate(-c*Math.PI/180);var d=new Image;d.crossOrigin="anonymous",d.src=t,d.onload=function(){var t;u.drawImage(d,h,l,s.width,s.height),u.rotate(c*Math.PI/180),a?n.style.cssText="background-image: url("+i.get("el").toDataURL("image/png")+");background-repeat:repeat;":((t=document.querySelector(".g6-graph-watermarker"))||((t=document.createElement("div")).className="g6-graph-watermarker"),t.className="g6-graph-watermarker",i.destroyed||(t.style.cssText="background-image: url("+i.get("el").toDataURL("image/png")+");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:-1;",n.appendChild(t)))}},Rg.prototype.setTextWaterMarker=function(t,e){var n=this.get("container");(n=_(n)?document.getElementById(n):n).style.position||(n.style.position="relative");var i=this.get("graphWaterMarker"),r=Q({},Ic.textWaterMarkerConfig,e),o=r.width,a=r.height,s=r.compatible,e=r.text;i||(h={container:n,width:o,height:a,capture:!1},(c=this.get("pixelRatio"))&&(h.pixelRatio=c),i=new Rs(h),this.set("graphWaterMarker",i)),i.get("el").style.display="none";var u=i.get("context"),r=e.rotate,o=e.fill,a=e.fontFamily,c=e.fontSize,h=e.baseline,l=e.x,d=e.y,f=e.lineHeight;u.rotate(-r*Math.PI/180),u.font=c+"px "+a,u.fillStyle=o,u.textBaseline=h;for(var p=t.length-1;0<=p;p--)u.fillText(t[p],l,d+p*f);u.rotate(r*Math.PI/180),s?n.style.cssText="background-image: url("+i.get("el").toDataURL("image/png")+");background-repeat:repeat;":((s=document.querySelector(".g6-graph-watermarker"))||((s=document.createElement("div")).className="g6-graph-watermarker"),s.style.cssText="background-image: url("+i.get("el").toDataURL("image/png")+");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:99;",n.appendChild(s))},Rg.prototype.destroy=function(){S(this.get("plugins"),function(t){t.destroyPlugin()});var t=this.get("tooltips");if(t)for(var e=0;e<t.length;e++){var n,i=t[e];i&&((n=i.parentElement)&&n.removeChild(i))}this.get("eventController").destroy(),this.get("layoutController").destroy(),this.get("graphWaterMarker")&&this.get("graphWaterMarker").destroy(),document.querySelector(".g6-graph-watermarker")&&document.querySelector(".g6-graph-watermarker").remove(),Og.prototype.destroy.call(this)},Rg),pe=n(81746),Gg=n.n(pe),Ug=Jo.traverseTree,Fg=function(e,n){var t=e?N(e)?function(t){return e}:e:function(t){return n||1};return t},zg=function(t,e){for(var n=[],i=[],r={},o=0,o=0;o<t.length;o++){var a=t[o];r[a.id]=o,n.push(a.x),n.push(a.y),n.push(0),n.push(0),i.push([])}for(o=0;o<e.length;o++){var s=e[o];i[r[s.source]].push(r[s.target]),i[r[s.target]].push(r[s.source])}var u=0;for(o=0;o<t.length;o++){var c=n.length,h=i[o],l=h.length;n[4*o+2]=c,n[4*o+3]=h.length;for(var u=Math.max(u,h.length),d=0;d<l;++d){var f=h[d];n.push(+f)}}for(;n.length%4!=0;)n.push(0);return{array:new Float32Array(n),maxEdgePerVetex:u}},jg=function(t,e,n){for(var i=[],r=[],o={},a=0,a=0;a<t.length;a++){var s=t[a];o[s.id]=a,i.push(s.x),i.push(s.y),i.push(0),i.push(0),r.push([])}for(a=0;a<e.length;a++){var u=e[a];r[o[u.source]].push(o[u.target]),r[o[u.source]].push(n(u)),r[o[u.target]].push(o[u.source]),r[o[u.target]].push(n(u))}var c=0;for(a=0;a<t.length;a++){var h=i.length,l=r[a],d=l.length;i[4*a+2]=h,i[4*a+3]=d/2;for(var c=Math.max(c,d/2),f=0;f<d;++f){var p=l[f];i.push(+p)}}for(;i.length%4!=0;)i.push(0);return{array:new Float32Array(i),maxEdgePerVetex:c}},Wg=function(t,e,n,i){for(var r=[],o=[],a={},s=0,s=0;s<t.length;s++){var u=t[s];a[u.id]=s,r.push(u.x),r.push(u.y),r.push(0),r.push(0),o.push([])}for(s=0;s<e.length;s++){var c=e[s];o[a[c.source]].push(a[c.target]),o[a[c.source]].push(n(c)),o[a[c.source]].push(i(c)),o[a[c.source]].push(0),o[a[c.target]].push(a[c.source]),o[a[c.target]].push(n(c)),o[a[c.target]].push(i(c)),o[a[c.target]].push(0)}var h=0;for(s=0;s<t.length;s++){var l=r.length,d=o[s],f=d.length;r[4*s+2]=l+1048576*f/4,r[4*s+3]=0;for(var h=Math.max(h,f/4),p=0;p<f;++p){var g=d[p];r.push(+g)}}for(;r.length%4!=0;)r.push(0);return{array:new Float32Array(r),maxEdgePerVetex:h}},Xg=function(t,e){var i=[],r=t.length,o={};return e.forEach(function(n){t.forEach(function(t,e){if(void 0===o[n[t]]&&(o[n[t]]=Object.keys(o).length),i.push(o[n[t]]),e===r-1)for(;i.length%4!=0;)i.push(0)})}),{array:new Float32Array(i),count:Object.keys(o).length}},Zg=function(t){for(var i=[],r=t.length,e=t[0].length,n=0;n<e;n++)!function(n){t.forEach(function(t,e){if(i.push(t[n]),e===r-1)for(;i.length%4!=0;)i.push(0)})}(n);return new Float32Array(i)},Vg=function(i,t){var r={x:1/0,y:1/0},e={x:-1/0,y:-1/0},o="x",a="y";t&&0<=["V","TB","BT"].indexOf(t)&&(a="x",o="y");var n=0;Ug(i,function(t){return n++,t.x>e.x&&(e.x=t.x),t.x<r.x&&(r.x=t.x),t.y>e.y&&(e.y=t.y),t.y<r.y&&(r.y=t.y),!0});var s=2*Math.PI/n,u=e[a]-r[a];return 0==u||Ug(i,function(t){var e=(t[a]-r[a])/u*(2*Math.PI-s)+s,n=Math.abs("x"===o?t.x-i.x:t.y-i.y);return t.x=n*Math.cos(e),t.y=n*Math.sin(e),!0}),i},u=(0,na.pi)((0,na.pi)((0,na.pi)((0,na.pi)({},Jo),l),f),d),Yg=u.radialLayout,Hg=u.traverseTree;function qg(t){t=Bg.call(this,t)||this;return t.layoutAnimating=!1,t.set("removeList",[]),t.set("layoutMethod",t.getLayout()),t}Bg=o,(0,na.ZT)(qg,Bg),qg.prototype.getLayout=function(){var e=this.get("layout");return e?"function"==typeof e?e:(e.type||(e.type="dendrogram"),e.direction||(e.direction="TB"),e.radial?function(t){t=Gg()[e.type](t,e);return Yg(t),t}:function(t){return Gg()[e.type](t,e)}):null},qg.indexOfChild=function(t,n){var i=-1;return S(t,function(t,e){if(n===t.id)return i=e,!1}),i},qg.prototype.getDefaultCfg=function(){var t=Bg.prototype.getDefaultCfg.call(this);return t.animate=!0,t},qg.prototype.innerAddChild=function(t,e,n){var i=this,r=t.data;r&&(r.x=t.x,r.y=t.y,r.depth=t.depth);var o,a=i.addItem("node",r,!1);return e&&(a.set("parent",e),n&&((r=e.get("originAttrs"))?a.set("originAttrs",r):(o=e.getModel(),a.set("originAttrs",{x:o.x,y:o.y}))),(o=e.get("children"))?o.push(a):e.set("children",[a]),i.addItem("edge",{source:e.get("id"),target:a.get("id"),id:e.get("id")+":"+a.get("id")},!1)),S(t.children||[],function(t){i.innerAddChild(t,a,n)}),i.emit("afteraddchild",{item:a,parent:e}),a},qg.prototype.innerUpdateChild=function(t,e,n){var i=this,r=i.findById(t.id);if(r){S(t.children||[],function(t){i.innerUpdateChild(t,r,n)});var o,a,s=r.get("children");if(s)if(0<s.length)for(var u=s.length-1;0<=u;u--){var c=s[u].getModel();-1===qg.indexOfChild(t.children||[],c.id)&&(i.innerRemoveChild(c.id,{x:t.x,y:t.y},n),s.splice(u,1))}r.get("originAttrs")&&(o=r.get("originAttrs").x,a=r.get("originAttrs").y);var h=r.getModel();n&&r.set("originAttrs",{x:h.x,y:h.y}),r.set("model",t.data),o===t.x&&a===t.y||r.updatePosition({x:t.x,y:t.y})}else i.innerAddChild(t,e,n)},qg.prototype.innerRemoveChild=function(t,e,n){var i=this,r=i.findById(t);r&&(S(r.get("children"),function(t){i.innerRemoveChild(t.getModel().id,e,n)}),n?(t=r.getModel(),r.set("to",e),r.set("originAttrs",{x:t.x,y:t.y}),i.get("removeList").push(r)):i.removeItem(r))},qg.prototype.changeData=function(t){var e=this;this.getNodes().map(function(t){return e.clearItemStates(t)}),this.getEdges().map(function(t){return e.clearItemStates(t)}),t?(e.data(t),e.render()):e.layout(this.get("fitView"))},qg.prototype.changeLayout=function(t){this.updateLayout(t)},qg.prototype.updateLayout=function(t){t&&(this.set("layout",t),this.set("layoutMethod",this.getLayout()),this.layout())},qg.prototype.refreshLayout=function(t){this.layout(t)},qg.prototype.layout=function(t){var e=this,n=e.get("data"),i=e.get("layoutMethod")(n,e.get("layout")),r=e.get("animate");e.emit("beforerefreshlayout",{data:n,layoutData:i}),e.emit("beforelayout"),e.innerUpdateChild(i,void 0,r),t&&e.get("viewController").fitView(),r?e.layoutAnimate(i):(e.refresh(),e.paint()),e.emit("afterrefreshlayout",{data:n,layoutData:i}),e.emit("afterlayout")},qg.prototype.addChild=function(t,e){this.emit("beforeaddchild",{model:t,parent:e}),_(e)||(e=e.get("id"));e=this.findDataById(e);e&&(e.children||(e.children=[]),e.children.push(t),this.changeData())},qg.prototype.updateChildren=function(t,e){e&&this.findById(e)&&(this.findDataById(e).children=t,this.changeData())},qg.prototype.updateChild=function(t,e){var n;e&&this.findById(e)?(n=this.findDataById(e),e=this.findById(t.id),n.children||(n.children=[]),e?(e=qg.indexOfChild(n.children,t.id),n.children[e]=t):n.children.push(t),this.changeData()):this.changeData(t)},qg.prototype.removeChild=function(t){var e=this.findById(t);e&&((t=e.get("parent"))&&!t.destroyed&&(t=(t=this.findDataById(t.get("id")))&&t.children||[],e=e.getModel(),e=qg.indexOfChild(t,e.id),t.splice(e,1)),this.changeData())},qg.prototype.findDataById=function(e,t){var n=this;if(t=t||n.get("data"),e===t.id)return t;var i=null;return S(t.children||[],function(t){return t.id===e?(i=t,!1):!(i=n.findDataById(e,t))&&void 0}),i},qg.prototype.layoutAnimate=function(a,s){var u=this,t=this.get("animateCfg");u.emit("beforeanimate",{data:a}),u.getEdges().forEach(function(t){var e=t.get("model");e.sourceAnchor||(e.sourceAnchor=t.get("sourceAnchorIndex"))}),this.get("canvas").animate(function(o){Hg(a,function(t){var e,n,i,r=u.findById(t.id);return r&&(e=r.get("originAttrs"),n=r.get("model"),e||(e={x:n.x,y:n.y},r.set("originAttrs",e)),s?(i=s(r,o,e,a),r.set("model",Object.assign(n,i))):(n.x=e.x+(t.x-e.x)*o,n.y=e.y+(t.y-e.y)*o)),!0}),S(u.get("removeList"),function(t){var e=t.getModel(),n=t.get("originAttrs"),t=t.get("to");e.x=n.x+(t.x-n.x)*o,e.y=n.y+(t.y-n.y)*o}),u.refreshPositions()},{duration:t.duration,easing:t.ease,callback:function(){S(u.getNodes(),function(t){t.set("originAttrs",null)}),S(u.get("removeList"),function(t){u.removeItem(t)}),u.set("removeList",[]),t.callback&&t.callback(),u.emit("afteranimate",{data:a})},delay:t.delay})},qg.prototype.stopLayoutAnimate=function(){this.get("canvas").stopAnimate(),this.emit("layoutanimateend",{data:this.get("data")}),this.layoutAnimating=!1},qg.prototype.isLayoutAnimating=function(){return this.layoutAnimating},qg.prototype.render=function(){if(!this.get("data"))throw new Error("data must be defined first");this.clear(),this.emit("beforerender"),this.layout(this.get("fitView")),this.emit("afterrender")},qg.prototype.save=function(){return this.get("data")},i=qg;function Kg(t){this._cfgs=Q(this.getDefaultCfgs(),t),this._events={},this.destroyed=!1}var Jg,Qg,Pn=(Kg.prototype.getDefaultCfgs=function(){return{}},Kg.prototype.initPlugin=function(n){var i=this;i.set("graph",n);var t=i.getEvents(),r={};S(t,function(t,e){t=P(i,t);r[e]=t,n.on(e,t)}),this._events=r,this.init()},Kg.prototype.getEvents=function(){return{}},Kg.prototype.get=function(t){return this._cfgs[t]},Kg.prototype.set=function(t,e){this._cfgs[t]=e},Kg.prototype.destroy=function(){},Kg.prototype.destroyPlugin=function(){this.destroy();var n=this.get("graph"),t=this._events;S(t,function(t,e){n.off(e,t)}),this._events=null,this._cfgs=null,this.destroyed=!0},Kg),a=(Jg=function(t,e){return(Jg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Jg(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),$g="url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAwIDEwIEwgNDAgMTAgTSAxMCAwIEwgMTAgNDAgTSAwIDIwIEwgNDAgMjAgTSAyMCAwIEwgMjAgNDAgTSAwIDMwIEwgNDAgMzAgTSAzMCAwIEwgMzAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2UwZTBlMCIgb3BhY2l0eT0iMC4yIiBzdHJva2Utd2lkdGg9IjEiLz48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=)";function tv(){return null!==Qg&&Qg.apply(this,arguments)||this}var ev,nv,me=(a(tv,Qg=Pn),tv.prototype.getDefaultCfgs=function(){return{img:$g}},tv.prototype.init=function(){var t=this.get("graph"),e=t.get("minZoom"),n=t.get("container"),i=t.get("canvas").get("el"),r=t.get("width"),o=t.get("height"),a=this.get("img")||$g,t=Ng("<div class='g6-grid-container' style=\"position: absolute; left:0;top:0;right:0;bottom:0;overflow: hidden;z-index: -1;\"></div>"),a=Ng("<div \n        class='g6-grid' \n        style='position:absolute;\n        transform-origin: 0% 0% 0px;\n        background-image: "+a+";\n        user-select: none\n        '></div>");t.appendChild(a),We(t,{width:r+"px",height:o+"px",left:n.offsetLeft+"px",top:n.offsetTop+"px"}),We(a,{width:r/e+"px",height:o/e+"px",left:"0px",top:"0px"}),n.insertBefore(t,i),this.set("container",t),this.set("gridContainer",a)},tv.prototype.getEvents=function(){return{viewportchange:"updateGrid"}},tv.prototype.updateGrid=function(t){var e=this.get("gridContainer"),t=t.matrix;We(e,{transform:"matrix("+(t=t||[1,0,0,0,1,0,0,0,1])[0]+", "+t[1]+", "+t[3]+", "+t[4]+", 0, 0)"})},tv.prototype.getContainer=function(){return this.get("container")},tv.prototype.destroy=function(){var t=this.get("graph").get("container"),e=this.get("container");t.removeChild(e)},tv),Ee=n(38186),r=n.n(Ee),mt=(ev=function(t,e){return(ev=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}ev(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});function iv(){return null!==nv&&nv.apply(this,arguments)||this}r()("\n  .g6-component-contextmenu {\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    background-color: rgba(255, 255, 255, 0.9);\n    padding: 10px 8px;\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\n  }\n  .g6-contextmenu-ul {\n    padding: 0;\n    margin: 0;\n    list-style: none;\n  }\n\n");var rv,ov,be=(mt(iv,nv=Pn),iv.prototype.getDefaultCfgs=function(){return{offsetX:6,offsetY:6,handleMenuClick:void 0,getContent:function(t){return"\n          <ul class='g6-contextmenu-ul'>\n            <li>菜单项1</li>\n            <li>菜单项2</li>\n          </ul>\n        "},shouldBegin:function(t){return!0},onHide:function(){return!0},itemTypes:["node","edge","combo"]}},iv.prototype.getEvents=function(){return{contextmenu:"onMenuShow"}},iv.prototype.init=function(){var t=Ng("<div class="+(this.get("className")||"g6-component-contextmenu")+"></div>");We(t,{top:"0px",position:"absolute",visibility:"hidden"});var e=(e=this.get("container"))||this.get("graph").get("container");(e=_(e)?document.getElementById(e):e).appendChild(t),this.set("menu",t)},iv.prototype.onMenuShow=function(e){var n=this;e.preventDefault(),e.stopPropagation();var t,i,r,o,a,s,u,c,h,l,d,f=this.get("itemTypes");if(e.item){if(e.item&&e.item.getType&&-1===f.indexOf(e.item.getType()))return void n.onMenuHide()}else if(-1===f.indexOf("canvas"))return;this.get("shouldBegin")(e)&&(t=this.get("menu"),h=this.get("getContent"),i=this.get("graph"),d=h(e,i),_(d)?t.innerHTML=d:t.innerHTML=d.outerHTML,this.removeMenuEventListener(),(r=this.get("handleMenuClick"))&&(this.set("handleMenuClickWrapper",l=function(t){r(t.target,e.item,i)}),t.addEventListener("click",l)),o=i.get("width"),a=i.get("height"),s=t.getBoundingClientRect(),u=this.get("offsetX")||0,c=this.get("offsetY")||0,f=i.getContainer().offsetTop,h=i.getContainer().offsetLeft,d=e.canvasX+h+u,l=e.canvasY+f+c,d+s.width>o&&(d=e.canvasX-s.width-u+h),We(t,{top:(l=l+s.height>a?e.canvasY-s.height-c+f:l)+"px",left:d+"px",visibility:"visible"}),d=function(t){n.onMenuHide()},document.body.addEventListener("click",d),this.set("handler",d))},iv.prototype.removeMenuEventListener=function(){var t=this.get("handleMenuClickWrapper"),e=this.get("handler");t&&(this.get("menu").removeEventListener("click",t),this.set("handleMenuClickWrapper",null)),e&&document.body.removeEventListener("click",e)},iv.prototype.onMenuHide=function(){var t=this.get("menu");t&&We(t,{visibility:"hidden"}),this.removeMenuEventListener()},iv.prototype.destroy=function(){var t,e=this.get("menu");this.removeMenuEventListener(),e&&(t=(t=this.get("container"))||this.get("graph").get("container"),(t=_(t)?document.getElementById(t):t).removeChild(e))},iv),tn=(rv=function(t,e){return(rv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}rv(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),av=function(){return(av=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},sv=Math.max,uv=sc;function cv(){var e=null!==ov&&ov.apply(this,arguments)||this;return e.handleUpdateCanvas=K(function(t){e.destroyed||e.updateCanvas()},100,!1),e}var hv,lv,ve=(tn(cv,ov=Pn),cv.prototype.getDefaultCfgs=function(){return{container:null,className:"g6-minimap",viewportClassName:"g6-minimap-viewport",type:"default",padding:50,size:[200,120],delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0}},cv.prototype.getEvents=function(){return{beforepaint:"updateViewport",beforeanimate:"disableRefresh",afteranimate:"enableRefresh",viewportchange:"disableOneRefresh"}},cv.prototype.disableRefresh=function(){this.set("refresh",!1)},cv.prototype.enableRefresh=function(){this.set("refresh",!0),this.updateCanvas()},cv.prototype.disableOneRefresh=function(){this.set("viewportChange",!0)},cv.prototype.initViewport=function(){var t,r,e,o,a,s,u,c,h,l,d,f,p=this,g=this._cfgs,v=g.size,y=g.graph;this.destroyed||(t=this.get("canvas").get("container"),r=Ng("\n      <div\n        class="+g.viewportClassName+"\n        style='position:absolute;\n          left:0;\n          top:0;\n          box-sizing:border-box;\n          outline: 2px solid #1980ff'\n        draggable=true>\n      </div>"),e=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),f=d=l=h=c=u=a=o=0,r.addEventListener("dragstart",function(e){var t,n;if(e.dataTransfer){var i=new Image;i.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' %3E%3Cpath /%3E%3C/svg%3E",null!==(n=(t=e.dataTransfer).setDragImage)&&void 0!==n&&n.call(t,i,0,0);try{e.dataTransfer.setData("text/html","view-port-minimap")}catch(t){e.dataTransfer.setData("text","view-port-minimap")}}g.refresh=!1,e.target===r&&(i=r.style,u=parseInt(i.left,10),c=parseInt(i.top,10),h=parseInt(i.width,10),l=parseInt(i.height,10),h>v[0]||l>v[1]||(f=y.getZoom(),d=p.get("ratio"),s=!0,o=e.clientX,a=e.clientY))},s=!1),r.addEventListener(e?"dragover":"drag",function(t){var e,n;!s||G(t.clientX)||G(t.clientY)||(e=o-t.clientX,n=a-t.clientY,(u-e<0||u-e+h>=v[0])&&(e=0),(c-n<0||c-n+l>=v[1])&&(n=0),We(r,{left:(u-=e)+"px",top:(c-=n)+"px"}),y.translate(e*f/d,n*f/d),o=t.clientX,a=t.clientY)},!1),r.addEventListener("dragend",function(){s=!1,g.refresh=!0},!1),this.set("viewport",r),t.appendChild(r))},cv.prototype.updateViewport=function(){var t,e,n,i,r,o,a,s,u;this.destroyed||(t=this.get("ratio"),this.get("dx"),this.get("dy"),s=this.get("totaldx"),u=this.get("totaldy"),r=this.get("graph"),e=this.get("size"),n=r.get("width"),i=r.get("height"),a=r.getPointByCanvas(0,0),o=r.getPointByCanvas(n,i),(n=this.get("viewport"))||this.initViewport(),r.getZoom(),i=(o.x-a.x)*t,r=(o.y-a.y)*t,s=(o=a.x*t+s)+i,u=(a=a.y*t+u)+r,o<0&&(i+=o,o=0),s>e[0]&&(i-=s-e[0]),a<0&&(r+=a,a=0),u>e[1]&&(r-=u-e[1]),this.set("ratio",t),We(n,{left:o+"px",top:a+"px",width:i+"px",height:r+"px"}))},cv.prototype.updateGraphShapes=function(){var t=this._cfgs.graph,e=this.get("canvas"),n=t.get("group");n.destroyed||((n=n.clone()).resetMatrix(),e.clear(),e.add(n),"svg"===t.get("renderer")&&this.updateVisible(n))},cv.prototype.updateVisible=function(t){var e,n=this;t.isGroup()||t.get("visible")?(e=t.get("children"))&&e.length&&e.forEach(function(t){t.get("visible")||t.hide(),n.updateVisible(t)}):t.hide()},cv.prototype.updateKeyShapes=function(){var e=this,t=this._cfgs.graph;S(t.getEdges(),function(t){e.updateOneEdgeKeyShape(t)}),S(t.getNodes(),function(t){e.updateOneNodeKeyShape(t)}),this.clearDestroyedShapes()},cv.prototype.updateOneNodeKeyShape=function(t){var e=this.get("canvas"),n=e.get("children")[0]||e.addGroup(),i=this.get("itemMap")||{},r=i[t.get("id")],o=t.getBBox(),a=t.get("keyShape").clone(),s=a.attr(),e={x:o.centerX,y:o.centerY};r?e=Object.assign(s,e):n.add(r=a);a=r.get("type");"rect"!==a&&"image"!==a||(e.x=o.minX,e.y=o.minY),r.attr(e),t.isVisible()||r.hide(),r.exist=!0,i[t.get("id")]=r,this.set("itemMap",i)},cv.prototype.updateDelegateShapes=function(){var e=this,t=this._cfgs.graph;S(t.getEdges(),function(t){e.updateOneEdgeKeyShape(t)}),S(t.getNodes(),function(t){e.updateOneNodeDelegateShape(t)}),this.clearDestroyedShapes()},cv.prototype.clearDestroyedShapes=function(){var t=this.get("itemMap")||{},e=Object.keys(t);if(e&&0!==e.length)for(var n=e.length-1;0<=n;n--){var i=t[e[n]],r=i.exist;i.exist=!1,r||(i.remove(),delete t[e[n]])}},cv.prototype.updateOneEdgeKeyShape=function(t){var e=this.get("canvas"),n=e.get("children")[0]||e.addGroup(),i=this.get("itemMap")||{},r=i[t.get("id")];r?(e=t.get("keyShape").attr("path"),r.attr("path",e)):(r=t.get("keyShape").clone(),n.add(r),r.toBack()),t.isVisible()||r.hide(),r.exist=!0,i[t.get("id")]=r,this.set("itemMap",i)},cv.prototype.updateOneNodeDelegateShape=function(t){var e=this.get("canvas"),n=e.get("children")[0]||e.addGroup(),i=this.get("delegateStyle"),r=this.get("itemMap")||{},o=r[t.get("id")],a=t.getBBox();o?(e={x:a.minX,y:a.minY,width:a.width,height:a.height},o.attr(e)):o=n.addShape("rect",{attrs:av({x:a.minX,y:a.minY,width:a.width,height:a.height},i),name:"minimap-node-shape"}),t.isVisible()||o.hide(),o.exist=!0,r[t.get("id")]=o,this.set("itemMap",r)},cv.prototype.init=function(){this.initContainer(),this.get("graph").on("afterupdateitem",this.handleUpdateCanvas),this.get("graph").on("afteritemstatechange",this.handleUpdateCanvas),this.get("graph").on("afteradditem",this.handleUpdateCanvas),this.get("graph").on("afterremoveitem",this.handleUpdateCanvas),this.get("graph").on("afterrender",this.handleUpdateCanvas),this.get("graph").on("afterlayout",this.handleUpdateCanvas)},cv.prototype.initContainer=function(){var t=this.get("graph"),e=this.get("size"),n=this.get("className"),i=this.get("container"),n=Ng("<div class='"+n+"' style='width: "+e[0]+"px; height: "+e[1]+"px; overflow: hidden'></div>");((i=_(i)?document.getElementById(i):i)||t.get("container")).appendChild(n),this.set("container",n);i=Ng('<div class="g6-minimap-container" style="position: relative;"></div>');n.appendChild(i),i.addEventListener("dragenter",function(t){t.preventDefault()}),i.addEventListener("dragover",function(t){t.preventDefault()});e=new("svg"===t.get("renderer")?ac:Rs)({container:i,width:e[0],height:e[1]});this.set("canvas",e),this.updateCanvas()},cv.prototype.updateCanvas=function(){if(this.get("refresh")){var t=this.get("graph");if(!t.get("destroyed")){this.get("viewportChange")&&(this.set("viewportChange",!1),this.updateViewport());var e=this.get("size"),n=this.get("canvas"),i=this.get("type"),r=this.get("padding");if(!n.destroyed){switch(i){case"default":this.updateGraphShapes();break;case"keyShape":this.updateKeyShapes();break;case"delegate":this.updateDelegateShapes()}var o,a,s,u,c=n.get("children")[0];c&&(c.resetMatrix(),o=c.getCanvasBBox(),u=(s=t.get("canvas").getCanvasBBox()).width,a=s.height,Number.isFinite(o.width)&&(u=sv(o.width,u),a=sv(o.height,a)),u+=2*r,a+=2*r,i=Math.min(e[0]/u,e[1]/a),n=[1,0,0,0,1,0,0,0,1],s=t=0,Number.isFinite(o.minX)&&(t=-o.minX),Number.isFinite(o.minY)&&(s=-o.minY),u=(e[0]-(u-2*r)*i)/2,r=(e[1]-(a-2*r)*i)/2,n=uv(n,[["t",t,s],["s",i,i],["t",u,r]]),c.setMatrix(n),this.set("ratio",i),this.set("totaldx",u+t*i),this.set("totaldy",r+s*i),this.set("dx",u),this.set("dy",r),this.updateViewport())}}}},cv.prototype.getCanvas=function(){return this.get("canvas")},cv.prototype.getViewport=function(){return this.get("viewport")},cv.prototype.getContainer=function(){return this.get("container")},cv.prototype.destroy=function(){this.get("canvas").destroy();var t=this.get("container");t.parentNode.removeChild(t)},cv);function dv(t,e,n){var i=t.x-e.x,e=t.y-e.y;return!n||Math.abs(i)>n||Math.abs(e)>n?Math.sqrt(i*i+e*e):n}function fv(t,e){var n=(e.source.y-e.target.y)/(e.source.x-e.target.x),t=(n*n*e.source.x+n*(t.y-e.source.y)+t.x)/(n*n+1);return{x:t,y:n*(t-e.source.x)+e.source.y}}function pv(){return null!==lv&&lv.apply(this,arguments)||this}var gv,vv,ge=((hv=function(t,e){return(hv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}hv(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)})(pv,lv=Pn),pv.prototype.getDefaultCfgs=function(){return{edgeBundles:[],edgePoints:[],K:.1,lambda:.1,divisions:1,divRate:2,cycles:6,iterations:90,iterRate:.6666667,bundleThreshold:.6,eps:1e-6,onLayoutEnd:function(){},onTick:function(){}}},pv.prototype.init=function(){var t=this.get("graph"),e=this.get("onTick");this.set("tick",function(){e&&e(),t.refreshPositions()})},pv.prototype.bundling=function(t){var o=this;if(o.set("data",t),!o.isTicking()){var e=t.edges||[],t=t.nodes||[],a={},n=!1;if(t.forEach(function(t){null===t.x||null===!t.y||void 0===t.x?n=!0:t.y,a[t.id]=t}),n)throw new Error("please layout the graph or assign x and y for nodes first");o.set("nodeIdMap",a);var s=o.get("divisions"),i=o.get("divRate"),u=o.divideEdges(s);o.set("edgePoints",u);t=o.getEdgeBundles();o.set("edgeBundles",t);for(var r=o.get("cycles"),c=o.get("iterations"),h=o.get("iterRate"),l=o.get("lambda"),d=0;d<r;d++){for(var f=0;f<c;f++)!function(){var r=[];e.forEach(function(t,e){if(t.source!==t.target){var n=a[t.source],t=a[t.target];r[e]=o.getEdgeForces({source:n,target:t},e,s,l);for(var i=0;i<s+1;i++)u[e][i].x+=r[e][i].x,u[e][i].y+=r[e][i].y}})}();l/=2,s*=i,c*=h,u=o.divideEdges(s),o.set("edgePoints",u)}e.forEach(function(t,e){t.source!==t.target&&(t.type="polyline",t.controlPoints=u[e].slice(1,u[e].length-1))}),o.get("graph").refresh()}},pv.prototype.updateBundling=function(e){var t,n=this,i=e.data;i&&n.set("data",i),n.get("ticking")&&n.set("ticking",!1),Object.keys(e).forEach(function(t){n.set(t,e[t])}),e.onTick&&(t=this.get("graph"),n.set("tick",function(){e.onTick(),t.refresh()})),n.bundling(i)},pv.prototype.divideEdges=function(n){var i=this,t=i.get("data").edges,r=i.get("nodeIdMap"),c=i.get("edgePoints");return c&&void 0!==c||(c=[]),t.forEach(function(t,o){c[o]&&void 0!==c[o]||(c[o]=[]);var a,s,u,e=r[t.source],t=r[t.target];1===n?(c[o].push({x:e.x,y:e.y}),c[o].push({x:.5*(e.x+t.x),y:.5*(e.y+t.y)}),c[o].push({x:t.x,y:t.y})):(a=(c[o]&&c[o]!==[]?i.getEdgeLength(c[o]):dv({x:e.x,y:e.y},{x:t.x,y:t.y}))/(n+1),s=a,u=[{x:e.x,y:e.y}],c[o].forEach(function(t,e){if(0!==e){for(var n=dv(t,c[o][e-1]);s<n;){var i=s/n,r={x:c[o][e-1].x,y:c[o][e-1].y};r.x+=i*(t.x-c[o][e-1].x),r.y+=i*(t.y-c[o][e-1].y),u.push(r),n-=s,s=a}s-=n}}),u.push({x:t.x,y:t.y}),c[o]=u)}),c},pv.prototype.getEdgeLength=function(n){var i=0;return n.forEach(function(t,e){0!==e&&(i+=dv(t,n[e-1]))}),i},pv.prototype.getEdgeBundles=function(){var a=this,e=a.get("data").edges||[],s=a.get("bundleThreshold"),u=a.get("nodeIdMap"),c=(c=a.get("edgeBundles"))||[];return e.forEach(function(t,e){c[e]&&void 0!==c[e]||(c[e]=[])}),e.forEach(function(t,i){var r=u[t.source],o=u[t.target];e.forEach(function(t,e){var n;e<=i||(n=u[t.source],t=u[t.target],t=a.getBundleScore({source:r,target:o},{source:n,target:t}),s<=t&&(c[i].push(e),c[e].push(i)))})}),c},pv.prototype.getBundleScore=function(t,e){return t.vx=t.target.x-t.source.x,t.vy=t.target.y-t.source.y,e.vx=e.target.x-e.source.x,e.vy=e.target.y-e.source.y,t.length=dv({x:t.source.x,y:t.source.y},{x:t.target.x,y:t.target.y}),e.length=dv({x:e.source.x,y:e.source.y},{x:e.target.x,y:e.target.y}),this.getAngleScore(t,e)*this.getScaleScore(t,e)*this.getPositionScore(t,e)*this.getVisibilityScore(t,e)},pv.prototype.getAngleScore=function(t,e){var n,i;return(n={x:t.vx,y:t.vy},i={x:e.vx,y:e.vy},n.x*i.x+n.y*i.y)/(t.length*e.length)},pv.prototype.getScaleScore=function(t,e){var n=(t.length+e.length)/2;return 2/(n/Math.min(t.length,e.length)+Math.max(t.length,e.length)/n)},pv.prototype.getPositionScore=function(t,e){var n=(t.length+e.length)/2;return n/(n+dv({x:(t.source.x+t.target.x)/2,y:(t.source.y+t.target.y)/2},{x:(e.source.x+e.target.x)/2,y:(e.source.y+e.target.y)/2}))},pv.prototype.getVisibilityScore=function(t,e){var n=this.getEdgeVisibility(t,e),t=this.getEdgeVisibility(e,t);return n<t?n:t},pv.prototype.getEdgeVisibility=function(t,e){var n=fv(e.source,t),i=fv(e.target,t),e={x:(n.x+i.x)/2,y:(n.y+i.y)/2},t={x:(t.source.x+t.target.x)/2,y:(t.source.y+t.target.y)/2};return Math.max(0,1-2*dv(e,t)/dv(n,i))},pv.prototype.getEdgeForces=function(t,e,n,i){for(var r=this.get("edgePoints"),o=this.get("K")/(dv(t.source,t.target)*(n+1)),a=[{x:0,y:0}],s=1;s<n;s++){var u={x:0,y:0},c=this.getSpringForce({pre:r[e][s-1],cur:r[e][s],next:r[e][s+1]},o),h=this.getElectrostaticForce(s,e);u.x=i*(c.x+h.x),u.y=i*(c.y+h.y),a.push(u)}return a.push({x:0,y:0}),a},pv.prototype.getSpringForce=function(t,e){var n=t.pre.x+t.next.x-2*t.cur.x,t=t.pre.y+t.next.y-2*t.cur.y;return{x:n*=e,y:t*=e}},pv.prototype.getElectrostaticForce=function(n,i){var r=this.get("eps"),t=this.get("edgeBundles"),o=this.get("edgePoints"),t=t[i],a={x:0,y:0};return t.forEach(function(t){var e={x:o[t][n].x-o[i][n].x,y:o[t][n].y-o[i][n].y};(Math.abs(e.x)>r||Math.abs(e.y)>r)&&(t=1/dv(o[t][n],o[i][n]),a.x+=e.x*t,a.y+=e.y*t)}),a},pv.prototype.isTicking=function(){return this.get("ticking")},pv.prototype.getSimulation=function(){return this.get("forceSimulation")},pv.prototype.destroy=function(){this.get("ticking")&&this.getSimulation().stop(),lv.prototype.destroy.call(this)},pv),pe=(gv=function(t,e){return(gv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}gv(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),yv=function(){return(yv=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},mv={stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:.1,fill:"#ccc"};function xv(){return null!==vv&&vv.apply(this,arguments)||this}var bv,l=(pe(xv,vv=Pn),xv.prototype.getDefaultCfgs=function(){return{trigger:"mousemove",d:1.5,r:300,delegateStyle:q(mv),showLabel:!1,maxD:5,minD:0,scaleRBy:"unset",scaleDBy:"unset",showDPercent:!0}},xv.prototype.getEvents=function(){var t;switch(this.get("trigger")){case"click":t={click:"magnify"};break;case"drag":t={click:"createDelegate"};break;default:t={mousemove:"magnify"}}return t},xv.prototype.init=function(){var t=this.get("r");this.set("cachedMagnifiedModels",[]),this.set("cachedOriginPositions",{}),this.set("r2",t*t);var e=this.get("d");this.set("molecularParam",(e+1)*t)},xv.prototype.createDelegate=function(t){var e=this,n=this,i=n.get("delegate");i&&!i.destroyed||(n.magnify(t),(i=n.get("delegate")).on("dragstart",function(t){n.set("delegateCenterDiff",{x:i.attr("x")-t.x,y:i.attr("y")-t.y})}),i.on("drag",function(t){n.magnify(t)}),"wheel"===this.get("scaleDBy")&&i.on("mousewheel",function(t){e.scaleDByWheel(t)}),"wheel"===this.get("scaleRBy")&&i.on("mousewheel",function(t){n.scaleRByWheel(t)}))},xv.prototype.scaleRByWheel=function(t){var e,n,i,r,o,a,s=this;t&&t.originalEvent&&(t.preventDefault&&t.preventDefault(),e=s.get("graph"),n=((o=s.get("delegate"))?{x:o.attr("x"),y:o.attr("y")}:void 0)||e.getPointByClient(t.clientX,t.clientY),a=t.originalEvent.wheelDelta<0?.95:1/.95,i=s.get("maxR"),r=s.get("minR"),((o=s.get("r"))>(i||e.get("height"))&&1<a||o<(r||.05*e.get("height"))&&a<1)&&(a=1),s.set("r",o*=a),s.set("r2",o*o),a=s.get("d"),s.set("molecularParam",(a+1)*o),s.set("delegateCenterDiff",void 0),s.magnify(t,n))},xv.prototype.scaleRByDrag=function(t){var e,n,i,r,o,a,s=this;t&&(o=s.get("dragPrePos"),n=(e=s.get("graph")).getPointByClient(t.clientX,t.clientY),a=t.x-o.x<0?.95:1/.95,i=s.get("maxR"),r=s.get("minR"),((o=s.get("r"))>(i||e.get("height"))&&1<a||o<(r||.05*e.get("height"))&&a<1)&&(a=1),s.set("r",o*=a),s.set("r2",o*o),a=s.get("d"),s.set("molecularParam",(a+1)*o),s.magnify(t,n),s.set("dragPrePos",{x:t.x,y:t.y}))},xv.prototype.scaleDByWheel=function(t){var e,n,i;(t||t.originalEvent)&&(t.preventDefault&&t.preventDefault(),i=t.originalEvent.wheelDelta<(i=0)?-.1:.1,e=this.get("d")+i,n=this.get("maxD"),i=this.get("minD"),e<n&&i<e&&(this.set("d",e),i=this.get("r"),this.set("molecularParam",(e+1)*i),i=(i=this.get("delegate"))?{x:i.attr("x"),y:i.attr("y")}:void 0,this.set("delegateCenterDiff",void 0),this.magnify(t,i)))},xv.prototype.scaleDByDrag=function(t){var e=this.get("dragPrePos"),n=0<t.x-e.x?.1:-.1,i=this.get("d")+n,e=this.get("maxD"),n=this.get("minD");i<e&&n<i&&(this.set("d",i),n=this.get("r"),this.set("molecularParam",(i+1)*n),this.magnify(t)),this.set("dragPrePos",{x:t.x,y:t.y})},xv.prototype.magnify=function(t,e){var n=this;n.restoreCache();var i=n.get("graph"),r=n.get("cachedMagnifiedModels"),o=n.get("cachedOriginPositions"),a=n.get("showLabel"),s=n.get("r"),u=n.get("r2"),c=n.get("d"),h=n.get("molecularParam"),l=i.getNodes(),d=l.length,f=e?{x:e.x,y:e.y}:{x:t.x,y:t.y};!n.get("dragging")||"mousemove"!==n.get("trigger")&&"click"!==n.get("trigger")||(f=n.get("cacheCenter"));t=n.get("delegateCenterDiff");t&&(f.x+=t.x,f.y+=t.y),n.updateDelegate(f,s);for(var p=0;p<d;p++){var g=l[p].getModel(),v=g.x,y=g.y;if(!isNaN(v)&&!isNaN(y)){var m=(v-f.x)*(v-f.x)+(y-f.y)*(y-f.y);if(!isNaN(m)&&m<u&&0!=m){var x=Math.sqrt(m),b=h*x/(c*x+s),E=(v-f.x)/x,m=(y-f.y)/x;if(g.x=E*b+f.x,g.y=m*b+f.y,o[g.id]||(o[g.id]={x:v,y:y,texts:[]}),r.push(g),a&&2*x<s)for(var S=l[p].getContainer().getChildren(),w=S.length,k=0;k<w;k++){var C=S[k];"text"===C.get("type")&&(o[g.id].texts.push({visible:C.get("visible"),shape:C}),C.set("visible",!0))}}}}i.refreshPositions()},xv.prototype.restoreCache=function(){for(var t=this.get("cachedMagnifiedModels"),e=this.get("cachedOriginPositions"),n=t.length,i=0;i<n;i++){var r=t[i],o=e[r.id];r.x=o.x,r.y=o.y;for(var a=o.texts.length,s=0;s<a;s++){var u=o.texts[s];u.shape.set("visible",u.visible)}}this.set("cachedMagnifiedModels",[]),this.set("cachedOriginPositions",{})},xv.prototype.updateParams=function(t){var e=this,n=t.r,i=t.d,r=t.trigger,o=t.minD,a=t.maxD,s=t.minR,u=t.maxR,c=t.scaleDBy,h=t.scaleRBy;isNaN(t.r)||(e.set("r",n),e.set("r2",n*n)),isNaN(i)||e.set("d",i),isNaN(a)||e.set("maxD",a),isNaN(o)||e.set("minD",o),isNaN(u)||e.set("maxR",u),isNaN(s)||e.set("minR",s);var l,u=e.get("d"),s=e.get("r");e.set("molecularParam",(u+1)*s),"mousemove"!==r&&"click"!==r&&"drag"!==r||e.set("trigger",r),"drag"!==c&&"wheel"!==c&&"unset"!==c||(e.set("scaleDBy",c),e.get("delegate").remove(),e.get("delegate").destroy(),(l=e.get("dPercentText"))&&(l.remove(),l.destroy())),"drag"!==h&&"wheel"!==h&&"unset"!==h||(e.set("scaleRBy",h),e.get("delegate").remove(),e.get("delegate").destroy(),(l=e.get("dPercentText"))&&(l.remove(),l.destroy()))},xv.prototype.updateDelegate=function(t,e){var n,i,r=this,o=this,a=o.get("graph"),s=o.get("delegate");!s||s.destroyed?(n=a.get("group"),i=o.get("delegateStyle")||mv,s=n.addShape("circle",{attrs:yv({r:e/1.5,x:t.x,y:t.y},i),name:"lens-shape",draggable:!0}),"drag"!==this.get("trigger")&&("wheel"===this.get("scaleRBy")?s.on("mousewheel",function(t){o.scaleRByWheel(t)}):"drag"===this.get("scaleRBy")&&(s.on("dragstart",function(t){o.set("dragging",!0),o.set("cacheCenter",{x:t.x,y:t.y}),o.set("dragPrePos",{x:t.x,y:t.y})}),s.on("drag",function(t){o.scaleRByDrag(t)}),s.on("dragend",function(t){o.set("dragging",!1)})),"wheel"===this.get("scaleDBy")?s.on("mousewheel",function(t){r.scaleDByWheel(t)}):"drag"===this.get("scaleDBy")&&(s.on("dragstart",function(t){o.set("dragging",!0),o.set("cacheCenter",{x:t.x,y:t.y}),o.set("dragPrePos",{x:t.x,y:t.y})}),s.on("drag",function(t){r.scaleDByDrag(t)}),s.on("dragend",function(t){o.set("dragging",!1)})))):s.attr({x:t.x,y:t.y,r:e/1.5}),o.get("showDPercent")&&(n=Math.round((o.get("d")-o.get("minD"))/(o.get("maxD")-o.get("minD"))*100),i=o.get("dPercentText"),e=t.y+e/1.5+16,!i||i.destroyed?(i=a.get("group").addShape("text",{attrs:{text:n+"%",x:t.x,y:e,fill:"#aaa",stroke:"#fff",lineWidth:1,fontSize:12}}),o.set("dPercentText",i)):i.attr({text:n+"%",x:t.x,y:e})),o.set("delegate",s)},xv.prototype.clear=function(){var t=this.get("graph");this.restoreCache(),t.refreshPositions();t=this.get("delegate");t&&!t.destroyed&&(t.remove(),t.destroy());t=this.get("dPercentText");t&&!t.destroyed&&(t.remove(),t.destroy())},xv.prototype.destroy=function(){this.clear()},xv),f=(bv=function(t,e){return(bv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}bv(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});r()("\n  .g6-component-toolbar {\n    position: absolute;\n    list-style-type: none;\n    padding: 6px;\n    left: 0px;\n    top: 0px;\n    background-color: rgba(255, 255, 255, 0.9);\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    margin: 0;\n  }\n  .g6-component-toolbar li {\n    float: left;\n    text-align: center;\n    width: 35px;\n    height: 24px;\n    cursor: pointer;\n\t\tlist-style-type:none;\n    list-style: none;\n    margin-left: 0px;\n  }\n  .g6-component-toolbar li .icon {\n    opacity: 0.7;\n  }\n  .g6-component-toolbar li .icon:hover {\n    opacity: 1;\n  }\n");var Ev;function Sv(){return null!==Ev&&Ev.apply(this,arguments)||this}var wv,kv,d=(f(Sv,Ev=Pn),Sv.prototype.getDefaultCfgs=function(){return{handleClick:void 0,getContent:function(t){return'\n          <ul class=\'g6-component-toolbar\'>\n            <li code=\'redo\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M256 682.666667c0-102.741333 66.730667-213.333333 213.333333-213.333334 107.008 0 190.762667 56.576 230.570667 125.354667L611.968 682.666667H853.333333v-241.365334l-91.562666 91.562667C704.768 448.469333 601.130667 384 469.333333 384c-196.096 0-298.666667 150.229333-298.666666 298.666667h85.333333z" fill="" p-id="2041"></path>\n              </svg>\n            </li>\n            <li code=\'undo\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M170.666667 682.666667h241.365333l-87.936-87.978667C363.904 525.909333 447.658667 469.333333 554.666667 469.333333c146.602667 0 213.333333 110.592 213.333333 213.333334h85.333333c0-148.437333-102.570667-298.666667-298.666666-298.666667-131.797333 0-235.392 64.469333-292.48 148.821333L170.666667 441.301333V682.666667z" fill="" p-id="2764"></path>\n              </svg>\n            </li>\n            <li  code=\'zoomOut\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M658.432 428.736a33.216 33.216 0 0 1-33.152 33.152H525.824v99.456a33.216 33.216 0 0 1-66.304 0V461.888H360.064a33.152 33.152 0 0 1 0-66.304H459.52V296.128a33.152 33.152 0 0 1 66.304 0V395.52H625.28c18.24 0 33.152 14.848 33.152 33.152z m299.776 521.792a43.328 43.328 0 0 1-60.864-6.912l-189.248-220.992a362.368 362.368 0 0 1-215.36 70.848 364.8 364.8 0 1 1 364.8-364.736 363.072 363.072 0 0 1-86.912 235.968l192.384 224.64a43.392 43.392 0 0 1-4.8 61.184z m-465.536-223.36a298.816 298.816 0 0 0 298.432-298.432 298.816 298.816 0 0 0-298.432-298.432A298.816 298.816 0 0 0 194.24 428.8a298.816 298.816 0 0 0 298.432 298.432z"></path>\n              </svg>\n            </li>\n            <li code=\'zoomIn\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M639.936 416a32 32 0 0 1-32 32h-256a32 32 0 0 1 0-64h256a32 32 0 0 1 32 32z m289.28 503.552a41.792 41.792 0 0 1-58.752-6.656l-182.656-213.248A349.76 349.76 0 0 1 480 768 352 352 0 1 1 832 416a350.4 350.4 0 0 1-83.84 227.712l185.664 216.768a41.856 41.856 0 0 1-4.608 59.072zM479.936 704c158.784 0 288-129.216 288-288S638.72 128 479.936 128a288.32 288.32 0 0 0-288 288c0 158.784 129.216 288 288 288z" p-id="3853"></path>\n              </svg>\n            </li>\n            <li code=\'realZoom\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="24">\n                <path d="M384 320v384H320V320h64z m256 0v384H576V320h64zM512 576v64H448V576h64z m0-192v64H448V384h64z m355.968 576H92.032A28.16 28.16 0 0 1 64 931.968V28.032C64 12.608 76.608 0 95.168 0h610.368L896 192v739.968a28.16 28.16 0 0 1-28.032 28.032zM704 64v128h128l-128-128z m128 192h-190.464V64H128v832h704V256z"></path>\n              </svg>\n            </li>\n            <li code=\'autoZoom\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="24">\n                <path d="M684.288 305.28l0.128-0.64-0.128-0.64V99.712c0-19.84 15.552-35.904 34.496-35.712a35.072 35.072 0 0 1 34.56 35.776v171.008h170.944c19.648 0 35.84 15.488 35.712 34.432a35.072 35.072 0 0 1-35.84 34.496h-204.16l-0.64-0.128a32.768 32.768 0 0 1-20.864-7.552c-1.344-1.024-2.816-1.664-3.968-2.816-0.384-0.32-0.512-0.768-0.832-1.088a33.472 33.472 0 0 1-9.408-22.848zM305.28 64a35.072 35.072 0 0 0-34.56 35.776v171.008H99.776A35.072 35.072 0 0 0 64 305.216c0 18.944 15.872 34.496 35.84 34.496h204.16l0.64-0.128a32.896 32.896 0 0 0 20.864-7.552c1.344-1.024 2.816-1.664 3.904-2.816 0.384-0.32 0.512-0.768 0.768-1.088a33.024 33.024 0 0 0 9.536-22.848l-0.128-0.64 0.128-0.704V99.712A35.008 35.008 0 0 0 305.216 64z m618.944 620.288h-204.16l-0.64 0.128-0.512-0.128c-7.808 0-14.72 3.2-20.48 7.68-1.28 1.024-2.752 1.664-3.84 2.752-0.384 0.32-0.512 0.768-0.832 1.088a33.664 33.664 0 0 0-9.408 22.912l0.128 0.64-0.128 0.704v204.288c0 19.712 15.552 35.904 34.496 35.712a35.072 35.072 0 0 0 34.56-35.776V753.28h170.944c19.648 0 35.84-15.488 35.712-34.432a35.072 35.072 0 0 0-35.84-34.496z m-593.92 11.52c-0.256-0.32-0.384-0.768-0.768-1.088-1.088-1.088-2.56-1.728-3.84-2.688a33.088 33.088 0 0 0-20.48-7.68l-0.512 0.064-0.64-0.128H99.84a35.072 35.072 0 0 0-35.84 34.496 35.072 35.072 0 0 0 35.712 34.432H270.72v171.008c0 19.84 15.552 35.84 34.56 35.776a35.008 35.008 0 0 0 34.432-35.712V720l-0.128-0.64 0.128-0.704a33.344 33.344 0 0 0-9.472-22.848zM512 374.144a137.92 137.92 0 1 0 0.128 275.84A137.92 137.92 0 0 0 512 374.08z"></path>\n              </svg>\n            </li>\n          </ul>\n        '},zoomSensitivity:2}},Sv.prototype.init=function(){var e=this,n=this.get("graph"),t=this.get("getContent")(n),i=t;_(t)&&(i=Ng(t));t=this.get("className");i.setAttribute("class",t||"g6-component-toolbar");t=(t=this.get("container"))||this.get("graph").get("container");(t=_(t)?document.getElementById(t):t).appendChild(i),this.set("toolBar",i);var r=this.get("handleClick");i.addEventListener("click",function(t){t=function(t){if(!t)return[];if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;){if(e.push(n),"HTML"===n.tagName)return e.push(document,window),e;n=n.parentElement}return e}(t).filter(function(t){return"LI"===t.nodeName});0===t.length||(t=t[0].getAttribute("code"))&&(r?r(t,n):e.handleDefaultOperator(t,n))});t=this.get("position");t&&We(i,{top:t.y+"px",left:t.x+"px"}),this.bindUndoRedo()},Sv.prototype.bindUndoRedo=function(){var t=this.get("graph"),n=document.querySelector('.g6-component-toolbar li[code="undo"]'),i=document.querySelector('.g6-component-toolbar li[code="undo"] svg'),r=document.querySelector('.g6-component-toolbar li[code="redo"]'),o=document.querySelector('.g6-component-toolbar li[code="redo"] svg');n&&i&&r&&o&&t.on("stackchange",function(t){var e=t.undoStack,t=t.redoStack,e=e.length,t=t.length;1===e?(n.setAttribute("style","cursor: not-allowed"),i.setAttribute("style","opacity: 0.4")):(n.removeAttribute("style"),i.removeAttribute("style")),0===t?(r.setAttribute("style","cursor: not-allowed"),o.setAttribute("style","opacity: 0.4")):(r.removeAttribute("style"),o.removeAttribute("style"))})},Sv.prototype.undo=function(){var n=this.get("graph"),t=n.getUndoStack();if(t&&1!==t.length){var e=t.pop();if(e){t=e.action;n.pushStack(t,q(e.data),"redo");var i=e.data.before;if(i="add"===t?e.data.after:i)switch(t){case"visible":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){var e=n.findById(t.id);t.visible?n.showItem(e,!1):n.hideItem(e,!1)})});break;case"render":case"update":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){n.updateItem(t.id,t,!1)})});break;case"changedata":n.changeData(i,!1);break;case"delete":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){var e=t.itemType;delete t.itemType,n.addItem(e,t,!1)})});break;case"add":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){n.removeItem(t.id,!1)})});break;case"updateComboTree":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){n.updateComboTree(t.id,t.parentId,!1)})})}}}},Sv.prototype.redo=function(){var n=this.get("graph"),t=n.getRedoStack();if(t&&0!==t.length){var e=t.pop();if(e){var t=e.action,i=e.data.after;if(n.pushStack(t,q(e.data)),i="delete"===t?e.data.before:i)switch(t){case"visible":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){var e=n.findById(t.id);t.visible?n.showItem(e,!1):n.hideItem(e,!1)})});break;case"render":case"update":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){n.updateItem(t.id,t,!1)})});break;case"changedata":n.changeData(i,!1);break;case"delete":i.edges&&i.edges.forEach(function(t){n.removeItem(t.id,!1)}),i.nodes&&i.nodes.forEach(function(t){n.removeItem(t.id,!1)}),i.combos&&i.combos.forEach(function(t){n.removeItem(t.id,!1)});break;case"add":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){var e=t.itemType;delete t.itemType,n.addItem(e,t,!1)})});break;case"updateComboTree":Object.keys(i).forEach(function(t){t=i[t];t&&t.forEach(function(t){n.updateComboTree(t.id,t.parentId,!1)})})}}}},Sv.prototype.handleDefaultOperator=function(t,e){var n=e.getZoom();switch(t){case"redo":this.redo();break;case"undo":this.undo();break;case"zoomOut":var i=1/(1-.05*this.get("zoomSensitivity"));if((this.get("maxZoom")||e.get("maxZoom"))<i*n)return;e.zoomTo(n*i);break;case"zoomIn":i=1-.05*this.get("zoomSensitivity");if(i*n<(this.get("minZoom")||e.get("minZoom")))return;e.zoomTo(n*i);break;case"realZoom":e.zoomTo(1);break;case"autoZoom":e.fitView([20,20])}},Sv.prototype.destroy=function(){var t=this.get("toolBar");t&&(e=(e=this.get("container"))||this.get("graph").get("container"),(e=_(e)?document.getElementById(e):e).removeChild(t));var e=this.get("handleClick");e&&t.removeEventListener("click",e)},Sv),a=(wv=function(t,e){return(wv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}wv(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});function Cv(){return null!==kv&&kv.apply(this,arguments)||this}r()("\n  .g6-component-tooltip {\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    background-color: rgba(255, 255, 255, 0.9);\n    padding: 10px 8px;\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\n  }\n  .tooltip-type {\n    padding: 0;\n    margin: 0;\n  }\n  .tooltip-id {\n    color: #531dab;\n  }\n");var Ee=(a(Cv,kv=Pn),Cv.prototype.getDefaultCfgs=function(){return{offsetX:6,offsetY:6,getContent:function(t){return"\n          <h4 class='tooltip-type'>类型："+t.item.getType()+"</h4>\n          <span class='tooltip-id'>ID："+t.item.getID()+"</span>\n        "},shouldBegin:function(t){return!0},itemTypes:["node","edge","combo"],trigger:"mouseenter",fixToNode:void 0}},Cv.prototype.getEvents=function(){return"click"===this.get("trigger")?{"node:click":"onClick","edge:click":"onClick","combo:click":"onClick","canvas:click":"onMouseLeave",afterremoveitem:"onMouseLeave",contextmenu:"onMouseLeave",drag:"onMouseLeave"}:{"node:mouseenter":"onMouseEnter","node:mouseleave":"onMouseLeave","node:mousemove":"onMouseMove","edge:mouseenter":"onMouseEnter","edge:mouseleave":"onMouseLeave","edge:mousemove":"onMouseMove","combo:mouseenter":"onMouseEnter","combo:mouseleave":"onMouseLeave","combo:mousemove":"onMouseMove",afterremoveitem:"onMouseLeave",contextmenu:"onMouseLeave","node:drag":"onMouseLeave"}},Cv.prototype.init=function(){var t=Ng("<div class="+(this.get("className")||"g6-component-tooltip")+"></div>"),e=(e=this.get("container"))||this.get("graph").get("container");_(e)&&(e=document.getElementById(e)),We(t,{position:"absolute",visibility:"hidden",display:"none"}),e.appendChild(t),this.set("tooltip",t)},Cv.prototype.onClick=function(t){var e,n=this.get("itemTypes");t.item&&t.item.getType&&-1===n.indexOf(t.item.getType())||(e=t.item,n=this.get("graph"),this.currentTarget===e?(this.currentTarget=null,this.hideTooltip(),n.emit("tooltipchange",{item:t.item,action:"hide"})):(this.currentTarget=e,this.showTooltip(t),n.emit("tooltipchange",{item:t.item,action:"show"})))},Cv.prototype.onMouseEnter=function(t){var e,n=this.get("itemTypes");t.item&&t.item.getType&&-1===n.indexOf(t.item.getType())||(e=t.item,n=this.get("graph"),this.currentTarget=e,this.showTooltip(t),n.emit("tooltipchange",{item:t.item,action:"show"}))},Cv.prototype.onMouseMove=function(t){var e=this.get("itemTypes");t.item&&t.item.getType&&-1===e.indexOf(t.item.getType())||this.currentTarget&&t.item===this.currentTarget&&this.showTooltip(t)},Cv.prototype.onMouseLeave=function(){this.hideTooltip(),this.get("graph").emit("tooltipchange",{item:this.currentTarget,action:"hide"}),this.currentTarget=null},Cv.prototype.showTooltip=function(t){var e,n;t.item&&(n=this.get("itemTypes"),t.item.getType&&-1===n.indexOf(t.item.getType())||(e=this.get("tooltip"),n=this.get("getContent")(t),_(n)?e.innerHTML=n:e.innerHTML=n.outerHTML,this.updatePosition(t)))},Cv.prototype.hideTooltip=function(){var t=this.get("tooltip");t&&We(t,{visibility:"hidden",display:"none"})},Cv.prototype.updatePosition=function(t){var e,n,i,r,o,a,s=this.get("shouldBegin"),u=this.get("tooltip");s(t)?(e=(o=this.get("graph")).get("width"),n=o.get("height"),i=this.get("offsetX")||0,r=this.get("offsetY")||0,a=o.getPointByClient(t.clientX,t.clientY),s=this.get("fixToNode"),(t=t.item).getType&&"node"===t.getType()&&s&&m(s)&&2<=s.length&&(a={x:(t=t.getBBox()).minX+t.width*s[0],y:t.minY+t.height*s[1]}),a=(s=o.getCanvasByPoint(a.x,a.y)).x,s=s.y,o={x:a+(o=o.getContainer()).offsetLeft+i,y:s+o.offsetTop+r},We(u,{visibility:"visible",display:"unset"}),a+(a=u.getBoundingClientRect()).width+i>e&&(o.x-=a.width+i),s+a.height+r>n&&(o.y-=a.height+r),We(u,{left:o.x+"px",top:o.y+"px"})):We(u,{visibility:"hidden",display:"none"})},Cv.prototype.hide=function(){this.onMouseLeave()},Cv.prototype.destroy=function(){var t,e=this.get("tooltip");e&&(t=(t=this.get("container"))||this.get("graph").get("container"),(t=_(t)?document.getElementById(t):t).removeChild(e))},Cv),_v={};function Mv(t,e){_v[t]=e}function Iv(t){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=t,this.initCfg(),this.init()}var mt=(Iv.prototype.translate=function(t){return t},Iv.prototype.change=function(t){at(this.__cfg__,t),this.init()},Iv.prototype.clone=function(){return this.constructor(this.__cfg__)},Iv.prototype.getTicks=function(){var n=this;return rt(this.ticks,function(t,e){return g(t)?t:{text:n.getText(t,e),tickValue:t,value:n.scale(t)}})},Iv.prototype.getText=function(t,e){var n=this.formatter,t=n?n(t,e):t;return G(t)||!y(t.toString)?"":t.toString()},Iv.prototype.getConfig=function(t){return this.__cfg__[t]},Iv.prototype.init=function(){at(this,this.__cfg__),this.setDomain(),et(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},Iv.prototype.initCfg=function(){},Iv.prototype.setDomain=function(){},Iv.prototype.calculateTicks=function(){var t=this.tickMethod,e=[];if(_(t)){var n=_v[t];if(!n)throw new Error("There is no method to to calculate ticks!");e=n(this)}else y(t)&&(e=t(this));return e},Iv.prototype.rangeMin=function(){return z(this.range)},Iv.prototype.rangeMax=function(){return j(this.range)},Iv.prototype.calcPercent=function(t,e,n){return N(t)?(t-e)/(n-e):NaN},Iv.prototype.calcValue=function(t,e,n){return e+t*(n-e)},Iv),Tv=function(t,e){return(Tv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Av(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Tv(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}Object.create;var Pv;Object.create;function Dv(){var t=null!==Pv&&Pv.apply(this,arguments)||this;return t.type="cat",t.isCategory=!0,t}var Nv=(Av(Dv,Pv=mt),Dv.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var t=0;t<this.values.length;t++)this.translateIndexMap.set(this.values[t],t)}},Dv.prototype.translate=function(t){this.buildIndexMap();var e=this.translateIndexMap.get(t);return e=void 0===e?N(t)?t:NaN:e},Dv.prototype.scale=function(t){t=this.translate(t),t=this.calcPercent(t,this.min,this.max);return this.calcValue(t,this.rangeMin(),this.rangeMax())},Dv.prototype.invert=function(t){var e=this.max-this.min,t=this.calcPercent(t,this.rangeMin(),this.rangeMax()),t=Math.round(e*t)+this.min;return t<this.min||t>this.max?NaN:this.values[t]},Dv.prototype.getText=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=t;return N(t)&&!this.values.includes(t)&&(i=this.values[i]),Pv.prototype.getText.apply(this,function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i}([i],e))},Dv.prototype.initCfg=function(){this.tickMethod="cat"},Dv.prototype.setDomain=function(){var t;G(this.getConfig("min"))&&(this.min=0),G(this.getConfig("max"))&&(t=this.values.length,this.max=1<t?t-1:t),this.translateIndexMap&&(this.translateIndexMap=void 0)},Dv),Ov=n(19432);function Lv(t,e){return(Ov.format||Ov.default.format)(t,e)}function Rv(t){return _(t)&&(t=(0<t.indexOf("T")?new Date(t):new Date(t.replace(/-/gi,"/"))).getTime()),t=Z(t)?t.getTime():t}var Bv,Gv=1e3,Uv=36e5,Fv=24*Uv,zv=31*Fv,jv=365*Fv,Wv=[["HH:mm:ss",Gv],["HH:mm:ss",1e4],["HH:mm:ss",3e4],["HH:mm",6e4],["HH:mm",6e5],["HH:mm",18e5],["HH",Uv],["HH",6*Uv],["HH",12*Uv],["YYYY-MM-DD",Fv],["YYYY-MM-DD",4*Fv],["YYYY-WW",7*Fv],["YYYY-MM",zv],["YYYY-MM",4*zv],["YYYY-MM",6*zv],["YYYY",380*Fv]];function Xv(t,e,n){var s,t=(s=function(t){return t[1]},function(t,e,n,i){for(var r=G(n)?0:n,o=G(i)?t.length:i;r<o;){var a=r+o>>>1;s(t[a])>e?o=a:r=1+a}return r}(Wv,(e-t)/n)-1),n=Wv[t];return t<0?n=Wv[0]:t>=Wv.length&&(n=j(Wv)),n}function Zv(){var t=null!==Bv&&Bv.apply(this,arguments)||this;return t.type="timeCat",t}var Vv,tn=(Av(Zv,Bv=Nv),Zv.prototype.translate=function(t){t=Rv(t);var e=this.values.indexOf(t);return e=-1===e?N(t)&&t<this.values.length?t:NaN:e},Zv.prototype.getText=function(t,e){var n=this.translate(t);if(-1<n){var i=this.values[n],n=this.formatter;return i=n?n(i,e):Lv(i,this.mask)}return t},Zv.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},Zv.prototype.setDomain=function(){var n=this.values;S(n,function(t,e){n[e]=Rv(t)}),n.sort(function(t,e){return t-e}),Bv.prototype.setDomain.call(this)},Zv);function Yv(){var t=null!==Vv&&Vv.apply(this,arguments)||this;return t.isContinuous=!0,t}var Hv,pe=(Av(Yv,Vv=mt),Yv.prototype.scale=function(t){if(G(t))return NaN;var e=this.rangeMin(),n=this.rangeMax();return this.max===this.min?e:e+this.getScalePercent(t)*(n-e)},Yv.prototype.init=function(){Vv.prototype.init.call(this);var t=this.ticks,e=z(t),t=j(t);e<this.min&&(this.min=e),t>this.max&&(this.max=t),G(this.minLimit)||(this.min=e),G(this.maxLimit)||(this.max=t)},Yv.prototype.setDomain=function(){var t=k(this.values),e=t.min,t=t.max;G(this.min)&&(this.min=e),G(this.max)&&(this.max=t),this.min>this.max&&(this.min=e,this.max=t)},Yv.prototype.calculateTicks=function(){var e=this,t=Vv.prototype.calculateTicks.call(this);return t=!this.nice?I(t,function(t){return t>=e.min&&t<=e.max}):t},Yv.prototype.getScalePercent=function(t){var e=this.max,n=this.min;return(t-n)/(e-n)},Yv.prototype.getInvertPercent=function(t){return(t-this.rangeMin())/(this.rangeMax()-this.rangeMin())},Yv);function qv(){var t=null!==Hv&&Hv.apply(this,arguments)||this;return t.type="linear",t.isLinear=!0,t}var Kv,Jv=(Av(qv,Hv=pe),qv.prototype.invert=function(t){t=this.getInvertPercent(t);return this.min+t*(this.max-this.min)},qv.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},qv);function Qv(t,e){var n=Math.E,t=0<=e?Math.pow(n,Math.log(e)/t):-1*Math.pow(n,Math.log(-e)/t);return t}function $v(t,e){return 1===t?1:Math.log(e)/Math.log(t)}function ty(t,e,n){var i=n=G(n)?Math.max.apply(null,t):n;return S(t,function(t){0<t&&t<i&&(i=t)}),i=1<(i=i===n?n/e:i)?1:i}function ey(){var t=null!==Kv&&Kv.apply(this,arguments)||this;return t.type="log",t}var ny,f=(Av(ey,Kv=pe),ey.prototype.invert=function(t){var e=this.base,n=$v(e,this.max),i=this.rangeMin(),r=this.rangeMax()-i,o=this.positiveMin;if(o){if(0===t)return 0;var a,s=1/(n-(a=$v(e,o/e)))*r;if(t<s)return t/s*o}else a=$v(e,this.min);return Math.pow(e,(t-i)/r*(n-a)+a)},ey.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},ey.prototype.setDomain=function(){Kv.prototype.setDomain.call(this);var t=this.min;if(t<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");0===t&&(this.positiveMin=ty(this.values,this.base,this.max))},ey.prototype.getScalePercent=function(t){var e=this.max,n=this.min;if(e===n)return 0;if(t<=0)return 0;var i=this.base,r=this.positiveMin;return r&&(n=+r/i),t<r?t/r/($v(i,e)-$v(i,n)):($v(i,t)-$v(i,n))/($v(i,e)-$v(i,n))},ey);function iy(){var t=null!==ny&&ny.apply(this,arguments)||this;return t.type="pow",t}var ry,r=(Av(iy,ny=pe),iy.prototype.invert=function(t){var e=this.getInvertPercent(t),n=this.exponent,i=Qv(n,this.max),t=Qv(n,this.min),i=e*(i-t)+t,t=0<=i?1:-1;return Math.pow(i,n)*t},iy.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},iy.prototype.getScalePercent=function(t){var e=this.max,n=this.min;if(e===n)return 0;var i=this.exponent;return(Qv(i,t)-Qv(i,n))/(Qv(i,e)-Qv(i,n))},iy);function oy(){var t=null!==ry&&ry.apply(this,arguments)||this;return t.type="time",t}var ay,a=(Av(oy,ry=Jv),oy.prototype.getText=function(t,e){var n=this.translate(t),t=this.formatter;return t?t(n,e):Lv(n,this.mask)},oy.prototype.scale=function(t){return(_(t)||Z(t))&&(t=this.translate(t)),ry.prototype.scale.call(this,t)},oy.prototype.translate=Rv,oy.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},oy.prototype.setDomain=function(){var n,i,r,o,t=this.values,e=this.getConfig("min"),a=this.getConfig("max");G(e)&&N(e)||(this.min=this.translate(this.min)),G(a)&&N(a)||(this.max=this.translate(this.max)),t&&t.length&&(n=[],r=i=1/0,o=0,S(t,function(t){var e=Rv(t);if(isNaN(e))throw new TypeError("Invalid Time: "+t+" in time scale!");e<i?(r=i,i=e):e<r&&(r=e),o<e&&(o=e),n.push(e)}),1<t.length&&(this.minTickInterval=r-i),G(e)&&(this.min=i),G(a)&&(this.max=o))},oy);function sy(){var t=null!==ay&&ay.apply(this,arguments)||this;return t.type="quantize",t}var uy,n=(Av(sy,ay=pe),sy.prototype.invert=function(t){var e=this.ticks,n=e.length,i=this.getInvertPercent(t),r=Math.floor(i*(n-1));if(n-1<=r)return j(e);if(r<0)return z(e);var o=e[r],t=r/(n-1);return o+(i-t)/((r+1)/(n-1)-t)*(e[r+1]-o)},sy.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},sy.prototype.calculateTicks=function(){var t=ay.prototype.calculateTicks.call(this);return this.nice||(j(t)!==this.max&&t.push(this.max),z(t)!==this.min&&t.unshift(this.min)),t},sy.prototype.getScalePercent=function(n){var t=this.ticks;if(n<z(t))return 0;if(n>j(t))return 1;var i=0;return S(t,function(t,e){return t<=n&&void(i=e)}),i/(t.length-1)},sy);function cy(){var t=null!==uy&&uy.apply(this,arguments)||this;return t.type="quantile",t}var hy,pe=(Av(cy,uy=n),cy.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},cy),ly={};function dy(t,e){if(ly[t])throw new Error("type '"+t+"' existed.");ly[t]=e}function fy(){var t=null!==hy&&hy.apply(this,arguments)||this;return t.type="identity",t.isIdentity=!0,t}var mt=(Av(fy,hy=mt),fy.prototype.calculateTicks=function(){return this.values},fy.prototype.scale=function(t){return this.values[0]!==t&&N(t)?t:this.range[0]},fy.prototype.invert=function(t){var e=this.range;return t<e[0]||t>e[1]?NaN:this.values[0]},fy),py=[1,5,2,2.5,4,3],gy=100*Number.EPSILON;function vy(t,e,n,i,r,o){if(void 0===n&&(n=5),void 0===i&&(i=!0),void 0===r&&(r=py),void 0===o&&(o=[.25,.2,.5,.05]),"number"!=typeof t||"number"!=typeof e||!n)return{min:0,max:0,ticks:[]};if(e-t<1e-15||1===n)return{min:t,max:e,ticks:[t]};for(var a,s,u,c,h,l,d,f,p,g,v,y,m={score:-2,lmin:0,lmax:0,lstep:0},x=1;x<1/0;){for(var b=0,E=r;b<E.length;b++){var S=E[b],w=(p=S,v=x,y=void 0,y=ft(g=r),1-$(g,p)/(y-1)-v+1);if(Number.isNaN(w))throw new Error("NaN");if(o[0]*w+o[1]+o[2]+o[3]<m.score){x=1/0;break}for(var k=2;k<1/0;){var C=(f=n)<=(d=k)?2-(d-1)/(f-1):1;if(o[0]*w+o[1]+o[2]*C+o[3]<m.score)break;for(var _=Math.ceil(Math.log10((e-t)/(k+1)/x/S));_<1/0;){var M=x*S*Math.pow(10,_),I=(I=e-(I=t))<(l=M*(k-1))?1-Math.pow((l-I)/2,2)/Math.pow(.1*I,2):1;if(o[0]*w+o[1]*I+o[2]*C+o[3]<m.score)break;var I=Math.floor(e/M)*x-(k-1)*x,T=Math.ceil(t/M)*x;if(T<I)_+=1;else{for(var A=I;A<=T;A+=1){var P=A*(M/x),D=P+M*(k-1),N=M,O=(a=S,s=x,u=P,R=D,c=N,h=O=void 0,O=ft(L=r),h=$(L,a),L=0,a=(u%(a=c)+a)%a,1-h/(O-1)-s+(L=(a<gy||c-a<gy)&&u<=0&&0<=R?1:L)),L=(s=P,c=D,a=void 0,a=(u=e)-(R=t),1-.5*(Math.pow(u-c,2)+Math.pow(R-s,2))/Math.pow(.1*a,2)),R=(u=t,c=e,R=((R=k)-1)/((s=D)-(a=P)),a=(n-1)/(Math.max(s,c)-Math.min(u,a)),2-Math.max(R/a,a/R)),R=o[0]*O+o[1]*L+o[2]*R+ +o[3];R>m.score&&(!i||P<=t&&e<=D)&&(m.lmin=P,m.lmax=D,m.lstep=N,m.score=R)}_+=1}}k+=1}}x+=1}for(var B=Number.isInteger(m.lstep)?0:Math.ceil(Math.abs(Math.log10(m.lstep))),G=[],U=m.lmin;U<=m.lmax;U+=m.lstep)G.push(U);var F=B?rt(G,function(t){return Number.parseFloat(t.toFixed(B))}):G;return{min:Math.min(t,z(F)),max:Math.max(e,j(F)),ticks:F}}function yy(t){var e=t.values,n=t.tickInterval,i=t.tickCount,r=e;if(N(n))return I(r,function(t,e){return e%n==0});var o=t.min,a=t.max;if(G(o)&&(o=0),G(a)&&(a=e.length-1),N(i)&&i<a-o){i=vy(o,a,i,!1,[1,2,5,3,4,7,6,8,9]).ticks;return I(i,function(t){return o<=t&&t<=a}).map(function(t){return e[t]})}return e.slice(o,a+1)}var my=Math.sqrt(50),xy=Math.sqrt(10),by=Math.sqrt(2),Ey=(Sy.prototype.domain=function(t){return t?(this._domain=Array.from(t,Number),this):this._domain.slice()},Sy.prototype.nice=function(t){void 0===t&&(t=5);var e,n=this._domain.slice(),i=0,r=this._domain.length-1,o=this._domain[i],a=this._domain[r];return a<o&&(o=(e=[a,o])[0],a=e[1],i=(e=[r,i])[0],r=e[1]),0<(e=wy(o,a,t))?e=wy(o=Math.floor(o/e)*e,a=Math.ceil(a/e)*e,t):e<0&&(e=wy(o=Math.ceil(o*e)/e,a=Math.floor(a*e)/e,t)),0<e?(n[i]=Math.floor(o/e)*e,n[r]=Math.ceil(a/e)*e,this.domain(n)):e<0&&(n[i]=Math.ceil(o*e)/e,n[r]=Math.floor(a*e)/e,this.domain(n)),this},Sy.prototype.ticks=function(t){return function(t,e,n){var i,r,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&0<n)return[t];(i=e<t)&&(r=t,t=e,e=r);if(0===(a=wy(t,e,n))||!isFinite(a))return[];if(0<a)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(r=Math.ceil(e-t+1));++s<r;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(r=Math.ceil(t-e+1));++s<r;)o[s]=(t-s)/a;i&&o.reverse();return o}(this._domain[0],this._domain[this._domain.length-1],(t=void 0===t?5:t)||5)},Sy);function Sy(){this._domain=[0,1]}function wy(t,e,n){t=(e-t)/Math.max(0,n),n=Math.floor(Math.log(t)/Math.LN10),t/=Math.pow(10,n);return 0<=n?(my<=t?10:xy<=t?5:by<=t?2:1)*Math.pow(10,n):-Math.pow(10,-n)/(my<=t?10:xy<=t?5:by<=t?2:1)}function ky(t,e,n){t="ceil"===n?Math.ceil(t/e):"floor"===n?Math.floor(t/e):Math.round(t/e);return t*e}function Cy(t,e,n){for(var t=ky(t,n,"floor"),i=ky(e,n,"ceil"),t=D(t,n),i=D(i,n),r=[],o=t;o<=i;o+=n){var a=D(o,n);r.push(a)}return{min:t,max:i,ticks:r}}function _y(t,e,n){var i=t.minLimit,r=t.maxLimit,o=t.min,a=t.max,t=t.tickCount,s=void 0===t?5:t,u=G(i)?G(e)?o:e:i,n=G(r)?G(n)?a:n:r;if(n<u&&(n=(r=[u,n])[0],u=r[1]),s<=2)return[u,n];for(var c=(n-u)/(s-1),h=[],l=0;l<s;l++)h.push(u+c*l);return h}function My(t,e,n){var i={max:0,min:0,ticks:[]};if(t===e)return{max:e,min:t,ticks:[t]};var r=(e-t)/(n=void 0===n?5:n),n=Math.pow(10,Math.floor(Math.log10(r))),o=n<1?Math.ceil(Math.abs(Math.log10(n))):0,a=n;2*n-r<1.5*(r-a)&&5*n-r<2.75*(r-(a=2*n))&&10*n-r<1.5*(r-(a=5*n))&&(a=10*n);r=Math.ceil(e/a),n=Math.floor(t/a);i.max=Math.max(r*a,e),i.min=Math.min(n*a,t);for(var s=Number.parseFloat((n*a).toFixed(o));s<e;)i.ticks.push(s),s+=a,o&&(s=Number.parseFloat(s.toFixed(o)));return i.ticks.push(s),i}function Iy(t){return new Date(t).getFullYear()}function Ty(t){return new Date(t).getMonth()}Mv("cat",yy),Mv("time-cat",function(t){var e=yy(t);return(t=j(t.values))!==j(e)&&e.push(t),e}),Mv("wilkinson-extended",function(t){var e=t.min,n=t.max,i=t.tickCount,r=t.nice,o=t.tickInterval,a=t.minLimit,s=t.maxLimit,r=vy(e,n,i,r).ticks;return G(a)&&G(s)?o?Cy(e,n,o).ticks:r:_y(t,z(r),j(r))}),Mv("r-pretty",function(t){var e=t.min,n=t.max,i=t.tickCount,r=t.tickInterval,o=t.minLimit,a=t.maxLimit,i=My(e,n,i).ticks;return G(o)&&G(a)?r?Cy(e,n,r).ticks:i:_y(t,z(i),j(i))}),Mv("time",function(t){var e=t.min,n=t.max,i=t.minTickInterval,r=t.tickInterval,t=t.tickCount;r?t=Math.ceil((n-e)/r):(1<(t=(n-e)/(r=Xv(e,n,t)[1])/t)&&(r*=Math.ceil(t)),i&&r<i&&(r=i));for(var o=[],a=e;a<n+r;a+=r)o.push(a);return o}),Mv("time-pretty",function(t){var e=t.min,n=t.max,i=t.minTickInterval,r=t.tickCount,t=t.tickInterval,o=[];t||(t=(n-e)/r,i&&t<i&&(t=i));var a,s,u,c,h=Iy(e);if(jv<t)for(var l=Iy(n),d=Math.ceil(t/jv),f=h;f<=l+d;f+=d)o.push(new Date(f,0,1).getTime());else if(zv<t)for(var p=Math.ceil(t/zv),g=Ty(e),v=(c=n,r=Iy(u=e),i=Iy(c),u=Ty(u),12*(i-r)+(Ty(c)-u)%12),f=0;f<=v+p;f+=p)o.push(new Date(h,f+g,1).getTime());else if(Fv<t)for(var y=(S=new Date(e)).getFullYear(),m=S.getMonth(),x=S.getDate(),b=Math.ceil(t/Fv),E=(c=e,u=n,Math.ceil((u-c)/Fv)),f=0;f<E+b;f+=b)o.push(new Date(y,m,x+f).getTime());else if(Uv<t)for(var S,y=(S=new Date(e)).getFullYear(),m=S.getMonth(),b=S.getDate(),w=S.getHours(),k=Math.ceil(t/Uv),C=(a=e,s=n,Math.ceil((s-a)/Uv)),f=0;f<=C+k;f+=k)o.push(new Date(y,m,b,w+f).getTime());else if(6e4<t)for(var _=(s=e,a=n,Math.ceil((a-s)/6e4)),M=Math.ceil(t/6e4),f=0;f<=_+M;f+=M)o.push(e+6e4*f);else{t=t;t<Gv&&(t=Gv);for(var I=Math.floor(e/Gv)*Gv,T=Math.ceil((n-e)/Gv),A=Math.ceil(t/Gv),f=0;f<T+A;f+=A)o.push(I+f*Gv)}return o.length,o}),Mv("log",function(t){var e,n=t.base,i=t.tickCount,r=t.min,o=t.max,t=t.values,a=$v(n,o);e=0<r?Math.floor($v(n,r)):(e=ty(t,n,o),Math.floor($v(n,e)));for(var s=Math.ceil((a-e)/i),u=[],c=e;c<a+s;c+=s)u.push(Math.pow(n,c));return r<=0&&u.unshift(0),u}),Mv("pow",function(t){var n=t.exponent,e=t.tickCount,i=Math.ceil(Qv(n,t.max));return My(Math.floor(Qv(n,t.min)),i,e).ticks.map(function(t){var e=0<=t?1:-1;return Math.pow(t,n)*e})}),Mv("quantile",function(t){var e=t.tickCount;if(!(t=t.values)||!t.length)return[];for(var n,i,r,o=t.slice().sort(function(t,e){return t-e}),a=[],s=0;s<e;s++)a.push((i=s/(e-1),r=void 0,r=(n=o).length*i,1===i?n[n.length-1]:0===i?n[0]:r%1!=0?n[Math.ceil(r)-1]:n.length%2==0?(n[r-1]+n[r])/2:n[r]));return a}),Mv("d3-linear",function(t){var e,n,i,r,o=t.min,a=t.max,s=t.tickInterval,u=t.minLimit,c=t.maxLimit,h=(n=(e=t).min,i=e.max,r=e.nice,h=e.tickCount,(e=new Ey).domain([n,i]),r&&e.nice(h),e.ticks(h));return G(u)&&G(c)?s?Cy(o,a,s).ticks:h:_y(t,z(h),j(h))}),dy("cat",Nv),dy("category",Nv),dy("identity",mt),dy("linear",Jv),dy("log",f),dy("pow",r),dy("time",a),dy("timeCat",tn),dy("quantize",n),dy("quantile",pe);var Ay=function(t,e){for(var n=0,i=e.length,r=t.length;n<i;n++,r++)t[r]=e[n];return t};function Py(t){return rt(t,function(t,e){return[0===e?"M":"L",t[0],t[1]]})}function Dy(t,n,i,e){void 0===e&&(e=!0);var r=new Jv({values:t}),o=new Nv({values:rt(t,function(t,e){return e})}),t=rt(t,function(t,e){return[o.scale(e)*n,i-r.scale(t)*i]});return(e?function(t){if(t.length<=2)return Py(t);var e=[];S(t,function(t){it(t,e.slice(e.length-2))||e.push(t[0],t[1])});var n=sr(e,!1),t=(i=z(t))[0],i=i[1];return n.unshift(["M",t,i]),n}:Py)(t)}function Ny(t,n,i){for(var r=new Jv({values:t}),o=new Nv({values:rt(t,function(t,e){return e})}),e=rt(t,function(t,e){return[o.scale(e)*n,i-r.scale(t)*i]}),a=[],s=0;s<e.length;s++){var u=e[s],u=function(t){var e,n=t.x,i=t.y,r=t.y0,t=t.size;i=m(i)?(e=i[0],i[1]):(e=r,i);t=m(n)?(o=n[0],n[1]):(o=n-t/2,n+t/2);var o=[{x:o,y:e},{x:o,y:i}];return o.push({x:t,y:i},{x:t,y:e}),o}({x:u[0],y:u[1],y0:i,size:5});a.push.apply(a,u)}return function(t,e){void 0===e&&(e=!0);var n=[],i=t[0];n.push(["M",i.x,i.y]);for(var r=1,o=t.length;r<o;r++)n.push(["L",t[r].x,t[r].y]);e&&(n.push(["L",i.x,i.y]),n.push(["z"]));return n}(a)}function Oy(t,e,n,i){var r=Ay([],t),t=(t=n,i=new Jv({values:n=i}),n=Math.max(0,i.min),t-i.scale(n)*t);return r.push(["L",e,t]),r.push(["L",0,t]),r.push(["Z"]),r}var Ly=function(){return(Ly=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Ry={stroke:"#C5C5C5",strokeOpacity:.85},By={fill:"#CACED4",opacity:.85};function Gy(t){var e=t.x,n=void 0===e?0:e,i=t.y,r=void 0===i?0:i,o=t.width,a=void 0===o?200:o,s=t.height,u=void 0===s?26:s,c=t.smooth,h=void 0===c||c,e=t.isArea,i=void 0!==e&&e,o=t.data,s=void 0===o?[]:o,c=t.lineStyle,e=t.areaStyle,o=t.group,t=t.interval,t=void 0===t?null:t;this.group=o,this.x=n,this.y=r,this.width=a,this.height=u,this.data=s,this.smooth=h,this.isArea=i,this.lineStyle=Object.assign({},Ry,c),this.areaStyle=Object.assign({},By,e),this.intervalConfig=t,this.renderLine()}var Uy=(Gy.prototype.renderLine=function(){var t=this.x,e=this.y,n=this.width,i=this.height,r=this.data,o=this.smooth,a=this.isArea,s=this.lineStyle,u=this.areaStyle,c=this.group.addGroup({name:"trend-group"});r&&(o=Dy(r,n,i,o),c.addShape("path",{attrs:Ly({path:o},s)}),a&&(r=Oy(o,n,i,r),c.addShape("path",{attrs:Ly({path:r},u)}))),this.intervalConfig&&c.addShape("path",{attrs:Ly({path:Ny(this.intervalConfig.data,n,i)},this.intervalConfig.style)}),c.move(t,e)},Gy.prototype.destory=function(){this.group.destroy()},Gy),Fy=function(){return(Fy=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},zy={fill:"#1890ff",stroke:"#1890ff",type:"trend",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#0050b3"},jy={fill:"#fff",stroke:"#1890ff",radius:2,opacity:1,cursor:"ew-resize"};function Wy(t){var e=t.group,n=t.name,i=t.type,r=t.x,o=void 0===r?0:r,a=t.y,s=void 0===a?0:a,r=t.width,a=void 0===r?2:r,r=t.height,r=void 0===r?24:r,t=t.style,t=void 0===t?{}:t;this.group=e,this.name=n,this.handleType=i,this.x=o,this.y=s,this.width=a,this.height=r,"trend"===i?this.style=Fy(Fy({},zy),t):"simple"===i&&(this.style=Fy(Fy({},jy),t)),this.renderHandle()}var Xy=(Wy.prototype.setX=function(t){this.setXY(t,void 0)},Wy.prototype.setY=function(t){this.setXY(void 0,t)},Wy.prototype.setXY=function(t,e){N(t)&&(this.x=t),N(e)&&(this.y=e),this.updateXY()},Wy.prototype.renderHandle=function(){var t=this.width,e=this.height,n=this.style,i=this.name,r=n.fill,o=n.stroke,a=n.radius,s=n.opacity,n=n.cursor;this.handleGroup=this.group.addGroup(),"trend"===this.handleType?(this.verticalLine=this.handleGroup.addShape("rect",{attrs:{x:0,y:0,width:t,height:e,fill:r,stroke:o,radius:a,opacity:s,cursor:n},name:i+"-handler"}),this.topCircle=this.handleGroup.addShape("circle",{attrs:{x:t/2,y:0,r:2*t,fill:r,stroke:o,radius:a,opacity:s,cursor:n},name:i+"-handler"}),this.bottomCircle=this.handleGroup.addShape("circle",{attrs:{x:t/2,y:e,r:2*t,fill:r,stroke:o,radius:a,opacity:s,cursor:n},name:i+"-handler"})):"simple"===this.handleType&&(this.topCircle=this.handleGroup.addShape("circle",{attrs:{x:t/2,y:e/2,r:2*t,fill:r,stroke:o,radius:a,opacity:s,cursor:n,lineWidth:2},name:i+"-handler"})),this.updateXY(),"trend"===this.handleType?this.bindTrendEvents():"simple"===this.handleType&&this.bindSimpleEvents()},Wy.prototype.bindSimpleEvents=function(){var e=this,t=this.name;this.handleGroup.on(t+"-handler:mouseenter",function(){var t=e.style.highLightFill;e.topCircle.attr("fill",t)}),this.handleGroup.on(t+"-handler:mouseleave",function(){var t=e.style.fill;e.topCircle.attr("fill",t)})},Wy.prototype.bindTrendEvents=function(){var e=this,t=this.name;this.handleGroup.on(t+"-handler:mouseenter",function(){var t=e.style.highLightFill;e.verticalLine.attr("fill",t),e.topCircle.attr("fill",t),e.bottomCircle.attr("fill",t)}),this.handleGroup.on(t+"-handler:mouseleave",function(){var t=e.style.fill;e.verticalLine.attr("fill",t),e.topCircle.attr("fill",t),e.bottomCircle.attr("fill",t)})},Wy.prototype.show=function(){this.handleGroup.show()},Wy.prototype.hide=function(){this.handleGroup.hide()},Wy.prototype.updateXY=function(){this.handleGroup.setMatrix([1,0,0,0,1,0,this.x,this.y,1])},Wy),Zy="timebarstartplay",Vy="timebarendplay",Yy="valuechange",Hy="timebarConfigChanged",qy="playPauseBtn",Ky="nextStepBtn",Jy="preStepBtn",Qy=function(){return(Qy=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function $y(t){this.config=Q({},t),this.init()}var tm=($y.prototype.update=function(t){this.config=Q({},this.config,t),this.updateElement(),this.renderMarker()},$y.prototype.init=function(){this.initElement(),this.renderMarker()},$y.prototype.initElement=function(){var t=this.config,e=t.group,n=t.style,i=n.scale,r=void 0===i?1:i,o=n.offsetX,t=n.offsetY,i=this.config.x+(void 0===o?0:o),o=this.config.y+(void 0===t?0:t),t=e.addGroup({name:qy});this.startMarkerGroup=t.addGroup({name:qy}),this.circle=e.addShape("circle",{attrs:Qy({x:i,y:o,r:this.config.r*r},n),name:qy}),this.startMarker=this.startMarkerGroup.addShape("path",{attrs:{path:this.getStartMarkerPath(i,o,r),fill:n.stroke||"#aaa"}}),this.pauseMarkerGroup=t.addGroup({name:qy});e=.25*this.config.r*r,t=.5*this.config.r*Math.sqrt(3)*r;this.pauseLeftMarker=this.pauseMarkerGroup.addShape("rect",{attrs:{x:i-.375*this.config.r*r,y:o-t/2,width:e,height:t,fill:n.stroke||"#aaa",lineWidth:0}}),this.pauseRightMarker=this.pauseMarkerGroup.addShape("rect",{attrs:{x:i+1/8*this.config.r*r,y:o-t/2,width:e,height:t,fill:n.stroke||"#aaa",lineWidth:0}})},$y.prototype.updateElement=function(){var t=this.config.style,e=t.scale,n=void 0===e?1:e,i=t.offsetX,r=t.offsetY,e=this.config.x+(void 0===i?0:i),t=this.config.y+(void 0===r?0:r);this.circle.attr("x",e),this.circle.attr("y",t),this.circle.attr("r",this.config.r*n),this.startMarker.attr("path",this.getStartMarkerPath(e,t,n));i=.25*this.config.r*n,r=.5*this.config.r*Math.sqrt(3)*n;this.pauseLeftMarker.attr("x",e-.375*this.config.r*n),this.pauseLeftMarker.attr("y",t-r/2),this.pauseLeftMarker.attr("width",i),this.pauseLeftMarker.attr("height",r),this.pauseRightMarker.attr("x",e+1/8*this.config.r*n),this.pauseRightMarker.attr("y",t-r/2),this.pauseRightMarker.attr("width",i),this.pauseRightMarker.attr("height",r)},$y.prototype.renderMarker=function(){this.config.isPlay?(this.startMarkerGroup.hide(),this.pauseMarkerGroup.show()):(this.startMarkerGroup.show(),this.pauseMarkerGroup.hide())},$y.prototype.getStartMarkerPath=function(t,e,n){n=.5*this.config.r*Math.sqrt(3)*n;return[["M",t-n/Math.sqrt(3)/2,e-n/2],["L",t+n/Math.sqrt(3),e],["L",t-n/Math.sqrt(3)/2,e+n/2]]},$y),em=function(){return(em=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},nm=sc,im={fill:"#aaa",fillOpacity:.35,stroke:"#aaa"},rm={fill:"#fff"},om={fill:"green"},am={pointer:{fill:"#aaa",lineWidth:0},scroller:{stroke:"#aaa",fill:"#aaa",lineWidth:1,lineAppendWidth:5,cursor:"pointer"},text:{fill:"#aaa",textBaseline:"top"}},sm={check:{stroke:"green",lineWidth:3},box:{fill:"#fff",stroke:"#aaa",lineWidth:2,radius:3,width:12,height:12},text:{fill:"#aaa",fontSize:12,textBaseline:"top"}},um={speed:1,loop:!1,fill:"#fff",stroke:"#fff",hideTimeTypeController:!1,preBtnStyle:{fill:"#aaa",stroke:"#aaa"},nextBtnStyle:{fill:"#aaa",stroke:"#aaa"},playBtnStyle:{fill:"#aaa",stroke:"#aaa",fillOpacity:.05},speedControllerStyle:am,timeTypeControllerStyle:sm};function cm(t){this.controllerCfg=Q({},um,t),this.group=t.group,this.controllerGroup=this.group.addGroup({name:"controller-group"}),this.speedAxisY=[],this.currentSpeed=this.controllerCfg.speed,this.currentType="range",this.fontFamily=t.fontFamily||"Arial, sans-serif",this.init()}var hm=(cm.prototype.init=function(){this.renderPlayButton()},cm.prototype.getNextMarkerPath=function(t,e,n){return[["M",t,e-n],["L",t+n,e],["L",t,e+n],["Z",t,e-n],["M",t,e],["L",t-n,e-n],["L",t-n,e+n],["Z"]]},cm.prototype.getPreMarkerPath=function(t,e,n){return[["M",t,e-n],["L",t-n,e],["L",t,e+n],["L",t,e-n],["M",t,e],["L",t+n,e-n],["L",t+n,e+n],["Z"]]},cm.prototype.renderPlayButton=function(){var t=this.controllerCfg,e=t.width,n=t.height,i=t.x,r=t.y,o=t.hideTimeTypeController,a=t.fill,s=void 0===a?"#aaa":a,u=t.stroke,c=void 0===u?"green":u,h=em(em({},im),t.playBtnStyle||{}),a=em(em({},rm),t.preBtnStyle||{}),u=em(em({},om),t.nextBtnStyle||{}),t=n/2-5,r=r+10,n=this.controllerGroup.addShape("rect",{attrs:{x:i,y:r,width:e,height:n,stroke:c,fill:s},name:"container-rect"});this.playButton?this.playButton.update({x:e/2,y:r,r:t}):this.playButton=new tm({group:this.controllerGroup,x:e/2,y:r+t+5,r:t,isPlay:this.isPlay,style:h});c=a.offsetX||0,s=a.offsetY||0,h=(a.scale||1)*t;this.controllerGroup.addShape("path",{attrs:em({path:this.getPreMarkerPath(e/2-5*t+c,r+t+5+s,.5*h)},a),name:Jy});s=u.offsetX||0,h=u.offsetY||0,a=(u.scale||1)*t;this.controllerGroup.addShape("path",{attrs:em({path:this.getNextMarkerPath(e/2+5*t+s,r+t+5+h,.5*a)},u),name:Ky}),n.toBack(),this.renderSpeedBtn(),o||this.renderToggleTime(),this.bindEvent();u=this.controllerCfg.scale,n=void 0===u?1:u,o=this.controllerGroup.getCanvasBBox(),u=(o.maxX+o.minX)/2,o=(o.maxY+o.minY)/2,o=nm([1,0,0,0,1,0,0,0,1],[["t",-u,-o],["s",n,n],["t",u,o]]);this.controllerGroup.setMatrix(o)},cm.prototype.renderSpeedBtn=function(){var t=this.controllerCfg,e=t.y,n=t.width,i=t.hideTimeTypeController,r=em(em({},am),this.controllerCfg.speedControllerStyle||{}),o=r.scroller,a=void 0===o?{}:o,s=r.text,u=void 0===s?{}:s,c=r.pointer,t=void 0===c?{}:c,o=r.scale,s=void 0===o?1:o,c=r.offsetX,o=void 0===c?0:c,c=r.offsetY,r=void 0===c?0:c,h=this.controllerGroup.addGroup({name:"speed-group"});this.speedGroup=h;var l=[],d=5;this.speedAxisY=[19,22,26,32,39];for(var f=0;f<5;f++){var p=e+this.speedAxisY[f],g=n-(i?50:110);h.addShape("line",{attrs:em({x1:g,x2:15+g,y1:p,y2:p},a),speed:d,name:"speed-rect"}),this.speedAxisY[f]=p,l.push(d),d-=1}this.speedText=h.addShape("text",{attrs:em({x:n-(i?50:110)+20,y:this.speedAxisY[0]+4,text:"1.0X",fontFamily:this.fontFamily||"Arial, sans-serif"},u)}),this.speedPoint=h.addShape("path",{attrs:em({path:this.getPointerPath(n-(i?50:110),0),matrix:[1,0,0,0,1,0,0,this.speedAxisY[4],1]},t)});c=this.speedGroup.getCanvasBBox(),u=(c.maxX+c.minX)/2,t=(c.maxY+c.minY)/2,c=this.speedGroup.getMatrix()||[1,0,0,0,1,0,0,0,1],c=nm(c,[["t",-u,-t],["s",s,s],["t",u+o*s,t+r*s]]);this.speedGroup.setMatrix(c)},cm.prototype.getPointerPath=function(t,e){return[["M",t,e],["L",t-10,e-4],["L",t-10,e+4],["Z"]]},cm.prototype.renderToggleTime=function(){var t=this.controllerCfg.width,e=em(em({},sm),this.controllerCfg.timeTypeControllerStyle||{}),n=e.scale,i=void 0===n?1:n,r=e.offsetX,o=void 0===r?0:r,a=e.offsetY,n=void 0===a?0:a,r=e.box,a=void 0===r?{}:r,r=e.check,r=void 0===r?{}:r,e=e.text,e=void 0===e?{}:e;this.toggleGroup=this.controllerGroup.addGroup({name:"toggle-group"}),this.toggleGroup.addShape("rect",{attrs:em({x:t-50,y:this.speedAxisY[0]+3.5},a),isChecked:!1,name:"toggle-model"}),this.checkedIcon=this.toggleGroup.addShape("path",{attrs:em({path:[["M",t-50+3,this.speedAxisY[1]+6],["L",t-50+7,this.speedAxisY[1]+10],["L",t-50+12,this.speedAxisY[1]+4]]},r),capture:!1}),this.checkedIcon.hide(),this.checkedText=this.toggleGroup.addShape("text",{attrs:em({text:(null===(r=this.controllerCfg)||void 0===r?void 0:r.timePointControllerText)||"单一时间",x:t-50+15,y:this.speedAxisY[0]+4,fontFamily:"undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif"},e)});r=this.toggleGroup.getCanvasBBox(),t=(r.maxX+r.minX)/2,e=(r.maxY+r.minY)/2,r=this.toggleGroup.getMatrix()||[1,0,0,0,1,0,0,0,1],r=nm(r,[["t",-t,-e],["s",i,i],["t",t+o*i,e+n*i]]);this.toggleGroup.setMatrix(r)},cm.prototype.bindEvent=function(){var o=this;this.speedGroup.on("speed-rect:click",function(t){var e=t.target.attr("y1"),n=o.speedPoint.attr("matrix"),t=o.speedAxisY.indexOf(n[7]||0),e=o.speedAxisY.indexOf(e),t=o.speedAxisY[e]-o.speedAxisY[t],n=nm(n,[["t",0,t]]);o.speedPoint.setMatrix(n),o.currentSpeed=o.speedAxisY.length-e,o.speedText.attr("text",o.currentSpeed+".0X"),o.group.emit(Hy,{speed:o.currentSpeed,type:o.currentType})}),this.speedGroup.on("mousewheel",function(t){t.preventDefault();var n,i=(e=o.speedPoint.attr("matrix")||[1,0,0,0,1,0,0,0,1])[7];-1===(r=o.speedAxisY.indexOf(i))&&(n=1/0,o.speedAxisY.forEach(function(t,e){t=Math.abs(t-i);t<n&&(n=t,r=e)}));var r=0<t.originalEvent.deltaY?Math.max(0,r-1):Math.min(o.speedAxisY.length-1,r+1),t=o.speedAxisY[r]-i,e=nm(e,[["t",0,t]]);o.speedPoint.setMatrix(e),o.currentSpeed=o.speedAxisY.length-r,o.speedText.attr("text",o.currentSpeed+".0X"),o.group.emit(Hy,{speed:o.currentSpeed,type:o.currentType})}),this.toggleGroup&&this.toggleGroup.on("toggle-model:click",function(t){var e,n=t.target.get("isChecked");n?(o.checkedIcon.hide(),o.checkedText.attr("text",(null===(e=o.controllerCfg)||void 0===e?void 0:e.timePointControllerText)||"单一时间"),o.currentType="range"):(o.checkedIcon.show(),o.checkedText.attr("text",(null===(e=o.controllerCfg)||void 0===e?void 0:e.timeRangeControllerText)||"时间范围"),o.currentType="single"),t.target.set("isChecked",!n),o.group.emit(Hy,{type:o.currentType,speed:o.currentSpeed})})},cm.prototype.destroy=function(){this.speedGroup.off("speed-rect:click"),this.toggleGroup&&(this.toggleGroup.off("toggle-model:click"),this.toggleGroup.destroy()),this.speedGroup.destroy()},cm),lm=function(){return(lm=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},dm={fill:"#416180",opacity:.05},fm={fill:"#416180",opacity:.15,radius:5},pm={fill:"#5B8FF9",opacity:.3,cursor:"grab"},gm={width:2,height:24},vm={textBaseline:"middle",fill:"#000",opacity:.45},ym={textAlign:"center",textBaseline:"top",fill:"#607889",opacity:.35},mm={lineWidth:1,stroke:"#ccc"};function xm(t){var n=this;this.prevX=0,this.onMouseDown=function(e){return function(t){n.currentHandler=e;t=t.originalEvent;t.stopPropagation(),t.preventDefault(),n.prevX=st(t,"touches.0.pageX",t.pageX);t=n.canvas.get("container");t.addEventListener("mousemove",n.onMouseMove),t.addEventListener("mouseup",n.onMouseUp),t.addEventListener("mouseleave",n.onMouseUp),t.addEventListener("touchmove",n.onMouseMove),t.addEventListener("touchend",n.onMouseUp),t.addEventListener("touchcancel",n.onMouseUp)}},this.onMouseMove=function(t){t.stopPropagation(),t.preventDefault();var e=st(t,"touches.0.pageX",t.pageX),t=e-n.prevX,t=n.adjustOffsetRange(t/n.width);n.updateStartEnd(t),n.updateUI(),n.prevX=e},this.onMouseUp=function(){n.currentHandler&&(n.currentHandler=void 0);var t=n.canvas.get("container");t&&(t.removeEventListener("mousemove",n.onMouseMove),t.removeEventListener("mouseup",n.onMouseUp),t.removeEventListener("mouseleave",n.onMouseUp),t.removeEventListener("touchmove",n.onMouseMove),t.removeEventListener("touchend",n.onMouseUp),t.removeEventListener("touchcancel",n.onMouseUp))};var e=t.x,i=void 0===e?0:e,r=t.y,o=void 0===r?0:r,a=t.width,s=void 0===a?100:a,u=t.height,c=t.padding,h=void 0===c?10:c,l=t.trendCfg,d=t.controllerCfg,f=void 0===d?{speed:1}:d,p=t.backgroundStyle,g=void 0===p?{}:p,v=t.foregroundStyle,y=void 0===v?{}:v,m=t.handlerStyle,x=void 0===m?{}:m,b=t.textStyle,e=void 0===b?{}:b,r=t.start,a=void 0===r?0:r,c=t.end,d=void 0===c?1:c,p=t.minText,v=void 0===p?"":p,m=t.maxText,b=void 0===m?"":m,r=t.group,c=t.graph,p=t.canvas,m=t.tick,m=void 0===m?{tickLabelStyle:{},tickLineStyle:{},tickLabelFormatter:function(t){return t},ticks:[]}:m,t=t.type;this.graph=c,this.canvas=p,this.group=r,this.timeBarType=t,this.x=i,this.y=o,this.width=s,this.height=u,this.padding=h,this.ticks=m.ticks,this.trendCfg=l,this.controllerCfg=f,this.currentSpeed=f.speed||1,this.tickLabelFormatter=m.tickLabelFormatter,"trend"===t?this.backgroundStyle=lm(lm({},dm),g):"simple"===t&&(this.backgroundStyle=lm(lm({},fm),g)),this.foregroundStyle=lm(lm({},pm),y),this.handlerStyle=lm(lm({},gm),x),this.textStyle=lm(lm({},vm),e),this.tickLabelStyle=lm(lm({},ym),m.tickLabelStyle),this.tickLineStyle=lm(lm({},mm),m.tickLineStyle),this.currentMode="range",this.start=a,this.end=d,this.minText=v,this.maxText=b,this.fontFamily="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif",this.renderSlider()}var bm=(xm.prototype.update=function(t){var e=t.x,n=t.y,i=t.width,r=t.height,o=t.minText,a=t.maxText,s=t.start,t=t.end;this.start=Math.min(1,Math.max(s,0)),this.end=Math.min(1,Math.max(t,0)),at(this,{x:e,y:n,width:i,height:r,minText:o,maxText:a}),this.updateUI()},xm.prototype.setText=function(t,e){this.minTextShape.attr("text",t),this.maxTextShape.attr("text",e)},xm.prototype.renderSlider=function(){var i=this,t=this.width,r=this.height,e=this.timeBarType;"trend"===e&&ft(st(this.trendCfg,"data"))&&(s=new Uy(lm(lm({x:this.x,y:this.y,width:t,height:r},this.trendCfg),{group:this.group})),this.trendComponent=s);var n=this.group.addGroup({name:"slider-group"});n.addShape("rect",{attrs:lm({x:0,y:0,width:t,height:r},this.backgroundStyle)});var o=this.group.addGroup();"trend"===e?(this.minTextShape=o.addShape("text",{attrs:lm({x:0,y:r/2+this.y,textAlign:"right",text:this.minText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif"},this.textStyle),capture:!1}),this.maxTextShape=o.addShape("text",{attrs:lm({y:r/2+this.y,textAlign:"left",text:this.maxText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif"},this.textStyle),capture:!1})):(this.minTextShape=o.addShape("text",{attrs:lm({x:0,y:this.y-10,textAlign:"center",text:this.minText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif"},this.textStyle),capture:!1}),this.maxTextShape=o.addShape("text",{attrs:lm({y:this.y-10,textAlign:"center",text:this.maxText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif"},this.textStyle),capture:!1})),this.foregroundShape=this.group.addGroup().addShape("rect",{attrs:lm({x:0,y:this.y,height:r},this.foregroundStyle)}),this.foregroundShape.on("mousedown",function(t){t.target.attr("cursor","grabbing")}),this.foregroundShape.on("mouseup",function(t){t.target.attr("cursor",i.foregroundStyle.cursor||"grab")});var a=st(this.handlerStyle,"width",2),s=st(this.handlerStyle,"height",24),o=this.group.addGroup({name:"minHandlerShape"});this.minHandlerShape=new Xy({name:"minHandlerShape",group:o,type:e,x:this.x,y:this.y,width:a,height:s,style:this.handlerStyle});o=this.group.addGroup({name:"maxHandlerShape"});this.maxHandlerShape=new Xy({name:"maxHandlerShape",group:o,type:e,x:this.x,y:this.y,width:a,height:s,style:this.handlerStyle});var s=this.ticks,u=t/(s.length-1);this.tickPosList=[],this.textList&&this.textList.length&&this.textList.forEach(function(t){t.destroy()});var c=-1/0;this.textList=s.map(function(t,e){i.tickPosList.push(i.x+e*u),i.tickLabelFormatter?(n=i.tickLabelFormatter(t),!_(n)&&n&&(n=t.date)):n=t.date;var t=i.group.addShape("text",{attrs:lm({x:i.x+e*u,y:i.y+r+5,text:n,fontFamily:i.fontFamily||"Arial, sans-serif"},i.tickLabelStyle)}),n=i.group.addShape("line",{attrs:lm({x1:i.x+e*u,y1:i.y+r+2,x2:i.x+e*u,y2:i.y+r+6},i.tickLineStyle)});n.toBack();e=t.getBBox();return e.minX>c?(t.show(),n.show(),c=e.minX+e.width+10):(t.hide(),n.hide()),t}),this.controllerBtnGroup=new hm(lm({group:this.group,x:this.x,y:this.y+r+25,width:t,height:35},this.controllerCfg)),this.updateStartEnd(0),this.updateUI(),n.move(this.x,this.y),this.bindEvents()},xm.prototype.bindEvents=function(){var n=this,t=this.group.find(function(t){return"minHandlerShape"===t.get("name")});t&&(t.on("minHandlerShape-handler:mousedown",this.onMouseDown(this.minHandlerShape)),t.on("minHandlerShape-handler:touchstart",this.onMouseDown(this.minHandlerShape)));t=this.group.find(function(t){return"maxHandlerShape"===t.get("name")});t&&(t.on("maxHandlerShape-handler:mousedown",this.onMouseDown(this.maxHandlerShape)),t.on("maxHandlerShape-handler:touchstart",this.onMouseDown(this.maxHandlerShape))),this.foregroundShape.on("mousedown",this.onMouseDown(this.foregroundShape)),this.foregroundShape.on("touchstart",this.onMouseDown(this.foregroundShape)),this.group.on(qy+":click",function(){n.isPlay=!n.isPlay,n.currentHandler=n.maxHandlerShape,n.changePlayStatus()}),this.group.on(Ky+":click",function(){n.currentHandler=n.maxHandlerShape,n.updateStartEnd(.01),n.updateUI()}),this.group.on(Jy+":click",function(){n.currentHandler=n.maxHandlerShape,n.updateStartEnd(-.01),n.updateUI()}),this.group.on(Hy,function(t){var e=t.type,t=t.speed;n.currentSpeed=t,"single"===(n.currentMode=e)?(n.minHandlerShape.hide(),n.foregroundShape.hide(),n.minTextShape.hide()):"range"===e&&(n.minHandlerShape.show(),n.foregroundShape.show(),n.minTextShape.show())})},xm.prototype.adjustTickIndex=function(t){for(var e=0;e<this.tickPosList.length-1;e++)if(this.tickPosList[e]<=t&&t<=this.tickPosList[e+1])return Math.abs(this.tickPosList[e]-t)<Math.abs(t-this.tickPosList[e+1])?e:e+1;return 0},xm.prototype.adjustOffsetRange=function(t){switch(this.currentHandler){case this.minHandlerShape:var e=0-this.start,n=1-this.start;return Math.min(n,Math.max(e,t));case this.maxHandlerShape:e=0-this.end,n=1-this.end;return Math.min(n,Math.max(e,t));case this.foregroundShape:e=0-this.start,n=1-this.end;return Math.min(n,Math.max(e,t));default:return 0}},xm.prototype.updateStartEnd=function(t){var e=this.ticks[this.adjustTickIndex(this.start*this.width)],n=this.ticks[this.adjustTickIndex(this.end*this.width)];if(!this.currentHandler)return this.minText=this.tickLabelFormatter?this.tickLabelFormatter(e):e.date,void(this.maxText=this.tickLabelFormatter?this.tickLabelFormatter(n):n.date);switch(this.currentHandler){case this.minHandlerShape:this.maxText=this.maxTextShape.attr("text"),this.start+=t,this.minText=this.tickLabelFormatter?this.tickLabelFormatter(e):e.date;break;case this.maxHandlerShape:this.minText=this.minTextShape.attr("text"),this.end+=t,this.maxText=this.tickLabelFormatter?this.tickLabelFormatter(n):n.date;break;case this.foregroundShape:this.start+=t,this.end+=t,this.minText=this.tickLabelFormatter?this.tickLabelFormatter(e):e.date,this.maxText=this.tickLabelFormatter?this.tickLabelFormatter(n):n.date}},xm.prototype.updateUI=function(){var n=this;this.start<0&&(this.start=0),1<this.end&&(this.end=1);var t=this.x+this.start*this.width,e=this.x+this.end*this.width;this.foregroundShape.attr("x",t),this.foregroundShape.attr("width",e-t);var i=st(this.handlerStyle,"width",2);this.setText(this.minText,this.maxText);var r=this.dodgeText([t,e]),o=r[0],r=r[1];this.minHandlerShape.setX(t-i/2),S(o,function(t,e){return n.minTextShape.attr(e,t)}),this.maxHandlerShape.setX(e-i/2),S(r,function(t,e){return n.maxTextShape.attr(e,t)}),"range"===this.currentMode?this.graph.emit(Yy,{value:[this.start,this.end].sort()}):"single"===this.currentMode&&this.graph.emit(Yy,{value:[this.end,this.end]})},xm.prototype.dodgeText=function(t){var e=st(this.handlerStyle,"width",2),n=this.minTextShape,i=this.maxTextShape,r=t[0],o=t[1],t=!1;o<r&&(r=(a=[o,r])[0],o=a[1],n=(s=[i,n])[0],i=s[1],t=!0);var a=n.getBBox(),s=i.getBBox(),n=null,i=null;return"trend"===this.timeBarType?(n=r-a.width<this.x+2?{x:r+e/2+2,textAlign:"left"}:{x:r-e/2-2,textAlign:"right"},i=o+s.width>this.x+this.width?{x:o-e/2-2,textAlign:"right"}:{x:o+e/2+2,textAlign:"left"}):"simple"===this.timeBarType&&(n=a.width>r-2?{x:r+e/2+2,textAlign:"center"}:{x:r-e/2-2,textAlign:"center"},i=s.width>this.width-o-2?{x:o-e/2-2,textAlign:"center"}:{x:o+e/2+2,textAlign:"center"}),t?[i,n]:[n,i]},xm.prototype.startPlay=function(){var i=this;return"undefined"!=typeof window?window.requestAnimationFrame(function(){var t=i.ticks,e=i.width,n=i.currentSpeed,t=e/t.length,n=i.adjustOffsetRange(t/(1e3*(10-n)/60)/i.width);i.updateStartEnd(n),i.updateUI(),i.isPlay&&(i.playHandler=i.startPlay())}):void 0},xm.prototype.changePlayStatus=function(t){void 0===t&&(t=!0),this.controllerBtnGroup.playButton.update({isPlay:this.isPlay}),this.isPlay?(this.playHandler=this.startPlay(),this.graph.emit(Zy,null)):this.playHandler&&("undefined"!=typeof window&&window.cancelAnimationFrame(this.playHandler),t&&this.graph.emit(Vy,null))},xm.prototype.destory=function(){this.graph.off(Yy);var t=this.group,e=t.find(function(t){return"minHandlerShape"===t.get("name")});e&&(e.off("minHandlerShape-handler:mousedown"),e.off("minHandlerShape-handler:touchstart"),e.destroy());e=t.find(function(t){return"maxHandlerShape"===t.get("name")});e&&(e.off("maxHandlerShape-handler:mousedown"),e.off("maxHandlerShape-handler:touchstart"),e.destroy()),this.foregroundShape.off("mousedown"),this.foregroundShape.off("touchstart"),this.foregroundShape.destroy(),t.off(qy+":click"),t.off(Ky+":click"),t.off(Jy+":click"),t.off(Hy),t.destroy(),this.trendComponent&&this.trendComponent.destory()},xm);function Em(t){var e=t.x,n=void 0===e?0:e,i=t.y,r=void 0===i?0:i,o=t.container,a=t.text,s=t.padding,u=void 0===s?[4,4,4,4]:s,c=t.className,e=void 0===c?"g6-component-timebar-tooltip":c,i=t.backgroundColor,s=void 0===i?"#000":i,c=t.textColor,i=void 0===c?"#fff":c,c=t.opacity,c=void 0===c?.8:c,t=t.fontSize,t=void 0===t?12:t;this.container=o,this.className=e,this.backgroundColor=s,this.textColor=i,this.x=n,this.y=r,this.text=a,this.padding=u,this.opacity=c,this.fontSize=t,this.render()}var Sm=(Em.prototype.render=function(){var t=this,e=t.className,n=(t.x,t.y,t.backgroundColor),i=t.textColor,r=t.text,o=t.padding,a=t.opacity,s=t.fontSize,u=t.container,a=Ng("<div class='"+e+"' style=\"position: absolute; width: fit-content; height: fit-content; opacity: "+a+'"></div>');(u=_(u)?document.getElementById(u):u).appendChild(a),t.parentHeight=u.offsetHeight,t.parentWidth=u.offsetWidth,We(a,{visibility:"hidden",top:0,left:0});o=Ng("\n      <div style='position: absolute; white-space:nowrap; background-color: "+n+"; font-size: "+s+"px; border-radius: 4px; width: fit-content; height: fit-content; color: "+i+"; padding: "+o[0]+"px "+o[1]+"px "+o[2]+"px "+o[3]+"px'></div>");o.innerHTML=r,a.appendChild(o),t.backgroundDOM=o;n=Ng("<div style='position: absolute; width: 0px; height: 0px; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid "+n+"'></div>");a.appendChild(n),t.arrowDOM=n,t.container=a},Em.prototype.show=function(t){var e=this,n=t.text,i=t.x;t.y,t.clientX,t.clientY;e.backgroundDOM.innerHTML=n;var r=e.backgroundDOM.offsetWidth,o=e.backgroundDOM.offsetHeight,t=e.arrowDOM.offsetWidth,n=e.arrowDOM.offsetHeight;We(e.container,{top:-o-n+"px",left:i+"px",visibility:"visible"}),We(e.backgroundDOM,{marginLeft:-r/2+"px"}),We(e.arrowDOM,{marginLeft:-t/2+"px",top:o+"px"});o=i-r/2,i+=r/2;o<0?We(e.backgroundDOM,{marginLeft:-r/2-o+"px"}):i>e.parentWidth&&We(e.backgroundDOM,{marginLeft:-r/2-i+e.parentWidth+12+"px"})},Em.prototype.hide=function(){We(this.container,{top:0,left:0,visibility:"hidden"})},Em),wm=function(){return(wm=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},km={fill:"#5B8FF9"},Cm={fill:"#e6e8e9"};function _m(t){this.frameCount=0,this.fontFamily="Arial, sans-serif";var e=t.graph,n=t.canvas,i=t.group,r=t.width,o=t.height,a=t.padding,s=t.data,u=t.start,c=t.end,h=t.x,l=void 0===h?0:h,d=t.y,f=void 0===d?0:d,p=t.tickLabelFormatter,g=t.selectedTickStyle,h=void 0===g?km:g,d=t.unselectedTickStyle,g=void 0===d?Cm:d,d=t.tooltipBackgroundColor,t=t.tooltipFomatter;this.graph=e,this.group=i,this.sliceGroup=i.addGroup({name:"slice-group"}),this.canvas=n,this.width=r,this.height=o,this.padding=a,this.data=s,this.start=u,this.end=c,this.tickLabelFormatter=p,this.selectedTickStyle=h,this.unselectedTickStyle=g,this.x=l,this.y=f,this.tooltipBackgroundColor=d,this.tooltipFomatter=t,this.fontFamily="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif",this.renderSlices(),this.initEvent()}var Mm,Im,Tm=(_m.prototype.renderSlices=function(){var s=this,u=this.width,t=this.height,c=this.padding,e=this.data,n=this.start,i=this.end,h=this.tickLabelFormatter,l=this.selectedTickStyle,d=this.unselectedTickStyle,f=t-(3*c+4+10)-2*c,p=e.length,g=(u-2*c-2*(p-1))/p;this.tickWidth=g;var v=this.sliceGroup,y=[],m=[],x=Math.round(p*n),b=Math.round(p*i);this.startTickRectId=x,this.endTickRectId=b,e.forEach(function(t,e){var n=v.addShape("rect",{attrs:wm({x:c+e*(2+g),y:c,width:g,height:f},x<=e&&e<=b?l:d),draggable:!0,name:"tick-rect-"+e}),i=v.addShape("rect",{attrs:{x:c+e*g+2*(2*e-1)/2,y:c,width:0===e||e===p-1?1+g:2+g,height:f,fill:"#fff",opacity:0},draggable:!0,name:"pick-rect-"+e});i.toFront();var r,o=n.getBBox(),a=(o.minX+o.maxX)/2;y.push({rect:n,pickRect:i,value:t.date,x:a,y:o.minY}),h?(r=h(t),!_(r)&&r&&(r=t.date)):e%Math.round(p/10)==0&&(r=t.date),r&&(m.push(r),o=o.maxY+2*c,v.addShape("line",{attrs:{stroke:"#BFBFBF",x1:a,y1:o,x2:a,y2:o+4}}),(r=(o=v.addShape("text",{attrs:{fill:"#8c8c8c",stroke:"#fff",lineWidth:1,x:a,y:o+4+c,textAlign:"center",text:r,textBaseline:"top",fontSize:10,fontFamily:s.fontFamily||"Arial, sans-serif"},capture:!1})).getBBox()).maxX>u?o.attr("textAlign","right"):r.minX<0&&o.attr("textAlign","left"))}),this.tickRects=y;e=this.group;this.currentSpeed=1,this.controllerBtnGroup=new hm({group:e,x:this.x,y:this.y+t+5,width:u,height:40,hideTimeTypeController:!0,speed:this.currentSpeed,fontFamily:this.fontFamily||"Arial, sans-serif"})},_m.prototype.initEvent=function(){var s=this,t=this.sliceGroup;t.on("click",function(t){var e,n,i=t.target;"rect"===i.get("type")&&i.get("name")&&(e=parseInt(i.get("name").split("-")[2],10),isNaN(e)||(t=s.tickRects,n=s.unselectedTickStyle,t.forEach(function(t){t.rect.attr(n)}),i=s.selectedTickStyle,t[e].rect.attr(i),s.startTickRectId=e,t=(s.endTickRectId=e)/t.length,s.graph.emit(Yy,{value:[t,t]})))}),t.on("dragstart",function(t){var e=s.tickRects,n=s.unselectedTickStyle;e.forEach(function(t){t.rect.attr(n)});var i=t.target,t=parseInt(i.get("name").split("-")[2],10),i=s.selectedTickStyle;e[t].rect.attr(i);e=(s.startTickRectId=t)/e.length;s.graph.emit(Yy,{value:[e,e]}),s.dragging=!0}),t.on("dragover",function(t){if(s.dragging&&"rect"===t.target.get("type")){for(var e=parseInt(t.target.get("name").split("-")[2],10),n=s.startTickRectId,i=s.tickRects,r=s.selectedTickStyle,o=s.unselectedTickStyle,a=0;a<i.length;a++)i[a].rect.attr(n<=a&&a<=e?r:o);t=i.length;s.endTickRectId=e,s.graph.emit(Yy,{value:[n/t,e/t]})}}),t.on("drop",function(t){var e,n,i;s.dragging&&(s.dragging=!1,"rect"===t.target.get("type")&&(e=s.startTickRectId,(n=parseInt(t.target.get("name").split("-")[2],10))<e||(i=s.selectedTickStyle,(t=s.tickRects)[n].rect.attr(i),s.endTickRectId=n,t=t.length,s.graph.emit(Yy,{value:[e/t,n/t]}))))});var t=this.tooltipBackgroundColor,n=this.tooltipFomatter,i=this.canvas,r=new Sm({container:i.get("container"),backgroundColor:t}),o=this.tickRects;o.forEach(function(t){t=t.pickRect;t.on("mouseenter",function(t){var e=t.target;"rect"===e.get("type")&&(t=parseInt(e.get("name").split("-")[2],10),e=i.getClientByPoint(o[t].x,o[t].y),r.show({x:o[t].x,y:o[t].y,clientX:e.x,clientY:e.y,text:n?n(o[t].value):o[t].value}))}),t.on("mouseleave",function(t){r.hide()})});t=this.group;t.on(qy+":click",function(){s.isPlay=!s.isPlay,s.changePlayStatus()}),t.on(Ky+":click",function(){s.updateStartEnd(1)}),t.on(Jy+":click",function(){s.updateStartEnd(-1)}),t.on(Hy,function(t){t.type;t=t.speed;s.currentSpeed=t})},_m.prototype.changePlayStatus=function(t){void 0===t&&(t=!0),this.controllerBtnGroup.playButton.update({isPlay:this.isPlay}),this.isPlay?(this.playHandler=this.startPlay(),this.graph.emit(Zy,null)):this.playHandler&&("undefined"!=typeof window&&window.cancelAnimationFrame(this.playHandler),t&&this.graph.emit(Vy,null))},_m.prototype.startPlay=function(){var e=this;return"undefined"!=typeof window?window.requestAnimationFrame(function(){var t=e.currentSpeed;e.frameCount%(60/t)==0&&(e.frameCount=0,e.updateStartEnd(1)),e.frameCount++,e.isPlay&&(e.playHandler=e.startPlay())}):void 0},_m.prototype.updateStartEnd=function(t){var e=this,n=this.tickRects,i=n.length,r=this.unselectedTickStyle,o=this.selectedTickStyle,a=e.endTickRectId;if(0<t?e.endTickRectId++:(n[e.endTickRectId].rect.attr(r),e.endTickRectId--),a!==e.startTickRectId)e.endTickRectId<e.startTickRectId&&(e.startTickRectId=e.endTickRectId);else{for(var s=e.startTickRectId;s<=e.endTickRectId-1;s++)n[s].rect.attr(r);e.startTickRectId=e.endTickRectId}n[e.endTickRectId]&&(n[e.endTickRectId].rect.attr(o),o=e.startTickRectId/i,i=e.endTickRectId/i,this.graph.emit(Yy,{value:[o,i]}))},_m.prototype.destory=function(){this.graph.off(Yy);var t=this.sliceGroup;t.off("click"),t.off("dragstart"),t.off("dragover"),t.off("drop"),this.tickRects.forEach(function(t){t=t.pickRect;t.off("mouseenter"),t.off("mouseleave")}),this.tickRects.length=0,t.off(qy+":click"),t.off(Ky+":click"),t.off(Jy+":click"),t.off(Hy),this.sliceGroup.destroy()},_m),a=(Mm=function(t,e){return(Mm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Mm(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Am=function(){return(Am=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Pm=function(t,e){var n={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n};function Dm(){return null!==Im&&Im.apply(this,arguments)||this}var Nm,Om,tn=(a(Dm,Im=Pn),Dm.prototype.getDefaultCfgs=function(){return{container:null,className:"g6-component-timebar",padding:10,type:"trend",trend:{data:[],isArea:!1,smooth:!0},controllerCfg:{speed:1,loop:!1},slider:{start:.1,end:.9,minText:"min",maxText:"max"},tick:{start:.1,end:.9,data:[]},textStyle:{},filterEdge:!1}},Dm.prototype.initContainer=function(){var t,e=this.get("graph"),n=this._cfgs,i=n.width,r=n.height,o=this.get("className")||"g6-component-timebar",a=this.get("container"),n=this.get("graph").get("container");a?t=a=_(a)?document.getElementById(a):a:We(t=Ng("<div class='"+o+"'></div>"),{position:"relative"}),n.appendChild(t),this.set("timeBarContainer",t);r=new("SVG"===e.get("renderer")?ac:Rs)({container:t,width:i,height:r});this.set("canvas",r)},Dm.prototype.init=function(){this.initContainer();var t=this.get("canvas").addGroup({name:"timebar-group"});this.set("timeBarGroup",t),this.renderTrend(),this.initEvent();t="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif";this.set("fontFamily",t)},Dm.prototype.renderTrend=function(){var t=this._cfgs,e=t.width,n=t.x,i=t.y,r=t.padding,o=t.type,a=t.trend,s=t.slider,u=t.controllerCfg,c=t.textStyle,h=t.tick,l=t.backgroundStyle,d=t.foregroundStyle,f=a.data,p=Pm(a,["data"]),g=e-2*r,v="trend"===o?26:4,y=this.get("graph"),t=this.get("timeBarGroup"),a=this.get("canvas"),e=null;"trend"===o||"simple"===o?e=new bm(Am(Am({graph:y,canvas:a,group:t,type:o,x:n+r,y:"trend"===o?i+r:i+r+15,width:g,height:v,padding:r,backgroundStyle:l,foregroundStyle:d,trendCfg:Am(Am({},p),{data:f.map(function(t){return t.value})})},s),{tick:{ticks:f,tickLabelFormatter:h.tickLabelFormatter,tickLabelStyle:h.tickLabelStyle,tickLineStyle:h.tickLineStyle},handlerStyle:Am(Am({},s.handlerStyle),{height:s.height||v}),controllerCfg:u,textStyle:c})):"tick"===o&&(e=new Tm(Am({graph:y,canvas:a,group:t,x:n+r,y:i+r},h))),this.set("timebar",e)},Dm.prototype.filterData=function(t){var e,n,i,r,o,a=t.value,s=null,u=this._cfgs.type;"trend"===u||"simple"===u?s=this._cfgs.trend.data:"tick"===u&&(s=this._cfgs.tick.data),s&&0!==s.length&&(e=this.get("rangeChange"),n=this.get("graph"),r=Math.round(s.length*a[0]),i=(i=Math.round(s.length*a[1]))>=s.length?s.length-1:i,r=r>=s.length?s.length-1:r,t=(a=null===(t=this._cfgs.tick)||void 0===t?void 0:t.tickLabelFormatter)?a(s[r]):s[r].date,a=a?a(s[i]):s[i].date,"tick"!==u&&this.get("timebar").setText(t,a),e?e(n,t,a):((!this.cacheGraphData||this.cacheGraphData.nodes&&0===this.cacheGraphData.nodes.length)&&(this.cacheGraphData=n.get("data")),t=this.cacheGraphData.nodes.filter(function(t){return t.date>=s[r].date&&t.date<=s[i].date}),o=t.map(function(t){return t.id}),a=[],this.cacheGraphData.edges&&(a=this.cacheGraphData.edges.filter(function(t){return o.includes(t.source)&&o.includes(t.target)}),this.get("filterEdge")&&(a=a.filter(function(t){return t.date>=s[r].date&&t.date<=s[i].date}))),n.changeData({nodes:t,edges:a})))},Dm.prototype.initEvent=function(){var e=this,n=0,i=0,t=this._cfgs.type;t&&"trend"!==t&&"simple"!==t?"tick"===t&&(n=this._cfgs.tick.start,i=this._cfgs.tick.end):(n=this._cfgs.slider.start,i=this._cfgs.slider.end);t=this.get("graph");t.on("afterrender",function(t){e.filterData({value:[n,i]})}),t.on(Yy,ut(function(t){e.filterData(t)},200,{trailing:!0,leading:!0}))},Dm.prototype.destroy=function(){var t=this.get("timebar");t&&t.destory&&t.destory(),Im.prototype.destroy.call(this);var e=this.get("timeBarContainer");e&&(t=(t=this.get("container"))||this.get("graph").get("container"),(t=_(t)?document.getElementById(t):t).removeChild(e))},Dm),n=(Nm=function(t,e){return(Nm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Nm(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Lm=Jo.applyMatrix;function Rm(){return null!==Om&&Om.apply(this,arguments)||this}var Bm,Gm,pe=(n(Rm,Om=Pn),Rm.prototype.getDefaultCfgs=function(){return{container:null,className:"g6-minimap",viewportClassName:"g6-minimap-viewport",width:200,delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0}},Rm.prototype.getEvents=function(){return{beforepaint:"updateViewport",beforeanimate:"disableRefresh",afteranimate:"enableRefresh",viewportchange:"disableOneRefresh"}},Rm.prototype.disableRefresh=function(){this.set("refresh",!1)},Rm.prototype.enableRefresh=function(){this.set("refresh",!0),this.updateCanvas()},Rm.prototype.disableOneRefresh=function(){this.set("viewportChange",!0)},Rm.prototype.initViewport=function(){var t,o,a,s,u,c,h,l,d,f,p,g=this,i=this._cfgs,v=i.graph;this.destroyed||(t=this.get("container"),_(t)&&(t=document.getElementById(t)),o=Ng("<div class="+i.viewportClassName+"\n      style='position:absolute;\n        left:0;\n        top:0;\n        box-sizing:border-box;\n        border: 2px solid #1980ff'>\n      </div>"),p=f=d=l=h=c=s=a=0,t.addEventListener("mousedown",function(t){var e,n;i.refresh=!1,t.target===o&&(n=o.style,l=parseInt(n.width,10),d=parseInt(n.height,10),e=g.get("width"),n=g.get("height"),e<l||n<d||(p=v.getZoom(),f=g.get("ratio"),u=!0,a=t.clientX,s=t.clientY))},u=!1),t.addEventListener("mousemove",function(t){var e,n,i,r;!u||G(t.clientX)||G(t.clientY)||(e=g.get("width"),n=g.get("height"),r=o.style,c=parseInt(r.left,10),h=parseInt(r.top,10),l=parseInt(r.width,10),d=parseInt(r.height,10),i=a-t.clientX,r=s-t.clientY,c-i<0?i=c:e<=c-i+l&&(i=0),h-r<0?r=h:n<=h-r+d&&(r=0),We(o,{left:(c-=i)+"px",top:(h-=r)+"px"}),v.translate(i*p/f,r*p/f),a=t.clientX,s=t.clientY)},!1),t.addEventListener("mouseleave",function(){u=!1,i.refresh=!0},!1),t.addEventListener("mouseup",function(){u=!1,i.refresh=!0},!1),this.set("viewport",o),t.appendChild(o))},Rm.prototype.updateViewport=function(){var t,e,n,i,r,o,a,s,u,c,h;this.destroyed||(t=this.get("ratio"),e=this.get("width"),n=this.get("height"),h=(c=(s=this.get("graph")).get("width"))/s.get("height"),o=[((i=(u=s.getGroup()).getCanvasBBox()).minX+i.maxX)/2,(i.minY+i.maxY)/2],r=[i.maxX-i.minX,i.maxY-i.minY],a={centerX:o[0],centerY:o[1],width:0,height:0,minX:0,minY:0},i[0]/i[1]>h?(a.width=r[0],a.height=a.width/h):(a.height=r[1],a.width=a.height*h),a.minX=o[0]-a.width/2,a.minY=o[1]-a.height/2,r=u.getMatrix(),h=_t.invert([1,0,0,0,1,0,0,0,1],r=r||[1,0,0,0,1,0,0,0,1]),o=Lm({x:a.minX,y:a.minY},h),u=s.getCanvasByPoint(o.x,o.y),(r=this.get("viewport"))||this.initViewport(),h=c/a.width,c=(s=e*-u.x/a.width)+(o=h*e),h=(u=n*-u.y/a.height)+(a=h*n),s<0&&(o+=s,s=0),e<c&&(o-=c-e),u<0&&(a+=u,u=0),n<h&&(a-=h-n),this.set("ratio",t),We(r,{left:s+"px",top:u+"px",width:o+"px",height:a+"px"}))},Rm.prototype.init=function(){this.initContainer()},Rm.prototype.initContainer=function(){var t=this,e=t.get("graph"),n=e.get("width"),i=e.get("height")/n,r=t.get("className"),o=t.get("container"),a=t.get("width"),n=t.get("height");(a=!a&&!n?200:a)?t.set("height",n=i*a):t.set("width",a=1/i*n);n=Ng("<div class='"+r+"' style='width: "+a+"px; height: "+n+"px; overflow: hidden; position: relative;'></div>");((o=_(o)?document.getElementById(o):o)||e.get("container")).appendChild(n),t.set("container",n);e=Ng('<div class="g6-minimap-container" style="position: relative; width: 100%; height: 100%; text-align: center; display: table;"></div>');n.appendChild(e);n=Ng('<span style="display: table-cell; vertical-align: middle; "></span>');e.appendChild(n),t.set("containerDOM",e),t.set("containerSpan",n);e=Ng('<img alt="" src="'+this.get("graphImg")+'" style="display: inline-block;" ondragstart="return false;" onselectstart="return false;"/>');t.set("imgDOM",e),t.updateImgSize(),n.appendChild(e),t.updateCanvas()},Rm.prototype.updateImgSize=function(){var o=this.get("imgDOM"),a=this.get("width"),s=this.get("height");o.onload=function(){var t,e,n,i,r,i=((t=o).naturalWidth?(n=t.naturalWidth,i=t.naturalHeight):((r=new Image).src=t.src,r.onload=function(){e&&e(r.width,r.height)}),[n,i]);i[1]<i[0]?o.width=a:o.height=s}},Rm.prototype.updateCanvas=function(){var t,e;this.get("refresh")&&((e=this.get("graph")).get("destroyed")||(this.get("viewportChange")&&(this.set("viewportChange",!1),this.updateViewport()),t=this.get("width"),e=e.get("canvas").getCanvasBBox().width,this.set("ratio",t/e),this.updateViewport()))},Rm.prototype.getViewport=function(){return this.get("viewport")},Rm.prototype.getContainer=function(){return this.get("container")},Rm.prototype.updateGraphImg=function(t){this.get("imgDOM").remove(),this.set("graphImg",t);var e=Ng('<img alt="" src="'+t+'" style="display: inline-block;" ondragstart="return false;" onselectstart="return false;"/>');this.set("imgDOM",e),e.src=t,this.updateImgSize(),this.get("containerSpan").appendChild(e),this.updateCanvas()},Rm.prototype.destroy=function(){var t=this.get("container");t.parentNode.removeChild(t)},Rm),a=(Bm=function(t,e){return(Bm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Bm(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Um=function(){return(Um=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Fm=Jo.distance,zm={stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:1,fill:"#fff"},n=(a(jm,Gm=Pn),jm.prototype.getDefaultCfgs=function(){return{type:"both",trigger:"mousemove",r:60,delegateStyle:q(zm),showLabel:"edge",scaleRBy:"wheel"}},jm.prototype.getEvents=function(){var t;switch(this.get("trigger")){case"click":t={click:"filter"};break;case"drag":t={click:"createDelegate"};break;default:t={mousemove:"filter"}}return t},jm.prototype.init=function(){var t=this.get("showLabel"),e="edge"===t||"both"===t;this.set("showNodeLabel","node"===t||"both"===t),this.set("showEdgeLabel",e),this.get("shouldShow")||this.set("shouldShow",function(){return!0})},jm.prototype.createDelegate=function(t){var e=this,n=e.get("delegate");n&&!n.destroyed||(e.filter(t),(n=e.get("delegate")).on("dragstart",function(t){}),n.on("drag",function(t){e.filter(t)}),"wheel"===this.get("scaleRBy")&&n.on("mousewheel",function(t){e.scaleRByWheel(t)}))},jm.prototype.scaleRByWheel=function(t){var e,n,i,r,o;t&&t.originalEvent&&(t.preventDefault&&t.preventDefault(),e=this.get("graph"),((o=this.get("delegate"))?{x:o.attr("x"),y:o.attr("y")}:void 0)||e.getPointByClient(t.clientX,t.clientY),n=t.originalEvent.wheelDelta<0?.95:1/.95,i=this.get("maxR"),r=this.get("minR"),((o=this.get("r"))>(i||e.get("height"))&&1<n||o<(r||.05*e.get("height"))&&n<1)&&(n=1),this.set("r",o*=n),this.filter(t))},jm.prototype.filter=function(t){var e=this.get("graph"),n=e.getNodes(),r={},o=this.get("r"),a=this.get("type"),s={x:t.x,y:t.y};this.updateDelegate(s,o);var u=this.get("shouldShow"),c=this.get("vShapes");c&&c.forEach(function(t){t.remove(),t.destroy()}),c=[],n.forEach(function(t){var e=t.getModel(),n=e.x,i=e.y;Fm({x:n,y:i},s)<o&&(r[e.id]=t)});var n=e.getEdges(),h=[];n.forEach(function(t){var e=t.getModel(),n=e.source,i=e.target;u(e)&&("only-source"===a||"one"===a?r[n]&&!r[i]&&h.push(t):"only-target"===a||"one"===a?r[i]&&!r[n]&&h.push(t):"both"===a&&r[n]&&r[i]&&h.push(t))});var i=this.get("showNodeLabel"),l=this.get("showEdgelabel"),d=e.get("group");h.forEach(function(t){t.get("group").get("children").forEach(function(t){var e=t.get("type"),t=d.addShape(e,{attrs:t.attr()});c.push(t),i&&"text"===e&&t.set("visible",!0)})}),Object.keys(r).forEach(function(t){t=r[t].get("group").clone();if(d.add(t),c.push(t),l)for(var e=t.get("children"),n=0;n<e.length;n++){var i=e[n];"text"===i.get("type")&&i.set("visible",!0)}}),this.set("vShapes",c)},jm.prototype.updateParams=function(t){var e=this,n=t.r,i=t.trigger,r=t.minR,o=t.maxR,a=t.scaleRBy,s=t.showLabel,u=t.shouldShow;isNaN(t.r)||e.set("r",n),isNaN(o)||e.set("maxR",o),isNaN(r)||e.set("minR",r),"mousemove"!==i&&"click"!==i||e.set("trigger",i),"wheel"!==a&&"unset"!==a||(e.set("scaleRBy",a),e.get("delegate").remove(),e.get("delegate").destroy(),(a=e.get("dPercentText"))&&(a.remove(),a.destroy())),"node"!==s&&"both"!==s||e.set("showNodeLabel",!0),"edge"!==s&&"both"!==s||e.set("showEdgeLabel",!0),u&&e.set("shouldShow",u)},jm.prototype.updateDelegate=function(t,e){var n,i=this,r=i.get("graph"),o=i.get("delegate");!o||o.destroyed?(n=r.get("group"),r=i.get("delegateStyle")||zm,o=n.addShape("circle",{attrs:Um({r:e,x:t.x,y:t.y},r),name:"lens-shape",draggable:!0}),"drag"!==this.get("trigger")&&"wheel"===this.get("scaleRBy")&&o.on("mousewheel",function(t){i.scaleRByWheel(t)})):o.attr({x:t.x,y:t.y,r:e}),i.set("delegate",o)},jm.prototype.clear=function(){var t=this.get("vShapes");t&&t.forEach(function(t){t.remove(),t.destroy()}),this.set("vShapes",t=[]);t=this.get("delegate");t&&!t.destroyed&&(t.remove(),t.destroy())},jm.prototype.destroy=function(){this.clear()},jm);function jm(){return null!==Gm&&Gm.apply(this,arguments)||this}var Wm,Xm,a=(Wm=function(t,e){return(Wm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Wm(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Zm=Jo.pointLineDistance,Vm={stroke:"#FA8C16",lineWidth:1};function Ym(t){return Xm.call(this,t)||this}ge={PluginBase:Pn,Menu:be,Grid:me,Minimap:ve,Bundling:ge,ToolBar:d,Tooltip:Ee,Fisheye:l,TimeBar:tn,ImageMinimap:pe,EdgeFilterLens:n,SnapLine:(a(Ym,Xm=Pn),Ym.prototype.getDefaultCfgs=function(){return{line:Vm,itemAlignType:"center",tolerance:5,horizontalLines:{},verticalLines:{},alignLines:[]}},Ym.prototype.init=function(){},Ym.prototype.getEvents=function(){return{"node:dragstart":"onDragStart","node:drag":"onDrag","node:dragend":"onDragEnd"}},Ym.prototype.onDragStart=function(){this.initBoxLine()},Ym.prototype.onDrag=function(t){var e=t.item,n=(e.get("delegateShape")||e).getBBox(),t=e.getModel(),e=t.x-n.x,t=t.y-n.y;this.show({x:n.minX+e,y:n.minY+t},{width:n.width,height:n.height})},Ym.prototype.onDragEnd=function(){this.destory()},Ym.prototype.initBoxLine=function(){var t=this._cfgs,i=t.horizontalLines,r=t.verticalLines,o=t.itemAlignType;this.get("graph").getNodes().forEach(function(t){var e=t.getBBox(),n=t.get("id");!0===o||"horizontal"===o?(i[n+"tltr"]=[e.minX,e.minY,e.maxX,e.minY,t],i[n+"lcrc"]=[e.minX,e.centerY,e.maxX,e.centerY,t],i[n+"blbr"]=[e.minX,e.maxY,e.maxX,e.maxY,t]):"center"===o&&(i[n+"lcrc"]=[e.minX,e.centerY,e.maxX,e.centerY,t]),!0===o||"vertical"===o?(r[n+"tlbl"]=[e.minX,e.minY,e.minX,e.maxY,t],r[n+"tcbc"]=[e.centerX,e.minY,e.centerX,e.maxY,t],r[n+"trbr"]=[e.maxX,e.minY,e.maxX,e.maxY,t]):"center"===o&&(r[n+"tcbc"]=[e.centerX,e.minY,e.centerX,e.maxY,t])})},Ym.prototype.show=function(t,e){var n=at({},t);return this.itemAlign(t,e,n),t},Ym.prototype.itemAlign=function(t,e,n){var i=this,r=this._cfgs,o=r.horizontalLines,a=r.verticalLines,r=r.tolerance,s={x:n.x+e.width/2,y:n.y},u={x:n.x+e.width/2,y:n.y+e.height/2},c={x:n.x+e.width/2,y:n.y+e.height},h={x:n.x,y:n.y+e.height/2},l={x:n.x+e.width,y:n.y+e.height/2},d=[],f=[],p=null;if(this.clearAlignLine(),S(o,function(t){t[4].isVisible&&(d.push(i.getLineDisObject(t,s)),d.push(i.getLineDisObject(t,u)),d.push(i.getLineDisObject(t,c)))}),S(a,function(t){t[4].isVisible&&(f.push(i.getLineDisObject(t,h)),f.push(i.getLineDisObject(t,u)),f.push(i.getLineDisObject(t,l)))}),d.sort(function(t,e){return t.dis-e.dis}),f.sort(function(t,e){return t.dis-e.dis}),0!==d.length&&d[0].dis<r){t.y=d[0].line[1]-d[0].point.y+n.y;for(var p={type:"item",horizontals:[d[0]]},g=1;g<3;g++)d[0].dis===d[g].dis&&p.horizontals.push(d[g])}if(0!==f.length&&f[0].dis<r){t.x=f[0].line[0]-f[0].point.x+n.x,p?p.verticals=[f[0]]:p={type:"item",verticals:[f[0]]};for(g=1;g<3;g++)f[0].dis===f[g].dis&&p.verticals.push(f[g])}p&&(p.bbox=e,this.addAlignLine(p))},Ym.prototype.addAlignLine=function(t){var r=t.bbox,e=t.type,n=t.horizontals,i=t.verticals,t=this._cfgs,o=t.line,a=t.alignLines,s=this.get("graph").get("group");"item"===e&&(n&&S(n,function(t){var e,n=t.line,i=t.point,t=(n[0]+n[2])/2,i=i.x<t?(e=i.x-r.width/2,Math.max(n[0],n[2])):(e=i.x+r.width/2,Math.min(n[0],n[2])),n=at({x1:e,y1:n[1],x2:i,y2:n[1]},o),n=s.addShape("line",{attrs:n,capture:!1});a.push(n)}),i&&S(i,function(t){var e,n=t.line,i=t.point,t=(n[1]+n[3])/2,i=i.y<t?(e=i.y-r.height/2,Math.max(n[1],n[3])):(e=i.y+r.height/2,Math.min(n[1],n[3])),i=at({x1:n[0],y1:e,x2:n[0],y2:i},o),i=s.addShape("line",{attrs:i,capture:!1});a.push(i)}))},Ym.prototype.getLineDisObject=function(t,e){return{line:t,point:e,dis:Zm(t,e)}},Ym.prototype.getContainer=function(){return this.get("container")},Ym.prototype.clearAlignLine=function(){var t=this._cfgs.alignLines;S(t,function(t){t.remove()}),t.length=0},Ym.prototype.destory=function(){var t=this._cfgs,e=t.horizontalLines,n=t.verticalLines;this.get("graph").getNodes().forEach(function(t){t=t.get("id");delete e[t+"tltr"],delete e[t+"lcrc"],delete e[t+"blbr"],delete n[t+"tlbl"],delete n[t+"tcbc"],delete n[t+"trbr"]}),this.clearAlignLine()},Ym)};fe("circle",{options:{size:ea.defaultNode.size,style:{x:0,y:0,stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"circle",labelPosition:"center",drawShape:function(t,e){var n=this.getOptions(t).icon,i=void 0===n?{}:n,r=this.getShapeStyle(t),o=Q({},i,t.icon),a=e.addShape("circle",{attrs:r,className:this.type+"-keyShape",draggable:!0}),s=o.width,n=o.height,i=o.show,r=o.text;return i&&(r?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},o),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}):e.addShape("image",{attrs:(0,na.pi)({x:-s/2,y:-n/2},o),className:this.type+"-icon",name:this.type+"-icon",draggable:!0})),this.drawLinkPoints(t,e),a},drawLinkPoints:function(t,e){var n=this.getOptions(t).linkPoints,i=void 0===n?{}:n,r=i.top,o=i.left,a=i.right,s=i.bottom,u=i.size,n=i.r,i=(0,na._T)(i,["top","left","right","bottom","size","r"]),t=this.getSize(t)[0]/2;o&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},i),{x:-t,y:0,r:u/2||n||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),a&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},i),{x:t,y:0,r:u/2||n||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),r&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},i),{x:0,y:-t,r:u/2||n||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),s&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},i),{x:0,y:t,r:u/2||n||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})},getShapeStyle:function(t){var e=this.getOptions(t).style,n={stroke:t.color},n=Q({},e,n),t=this.getSize(t)[0]/2;return(0,na.pi)({x:0,y:0,r:t},n)},update:function(t,e){var n=e.getContainer(),i=this.getSize(t),r={stroke:t.color,r:i[0]/2},i=e.get("keyShape"),r=Q({},i.attr(),r,t.style);this.updateShape(t,e,r,!0),this.updateLinkPoints(t,n)}},"single-node"),fe("rect",{options:{size:[100,30],style:{radius:0,stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},anchorPoints:[[0,.5],[1,.5]],stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"rect",labelPosition:"center",drawShape:function(t,e){var n=this.getShapeStyle(t),n=e.addShape("rect",{attrs:n,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0});return this.drawLinkPoints(t,e),n},drawLinkPoints:function(t,e){var n=this.getOptions(t).linkPoints,i=void 0===n?{}:n,r=i.top,o=i.left,a=i.right,s=i.bottom,u=i.size,c=i.r,n=(0,na._T)(i,["top","left","right","bottom","size","r"]),i=this.getSize(t),t=i[0],i=i[1];o&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:-t/2,y:0,r:u/2||c||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),a&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:t/2,y:0,r:u/2||c||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),r&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:-i/2,r:u/2||c||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),s&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:i/2,r:u/2||c||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),n=this.getSize(t),t=e.width||n[0],n=e.height||n[1];return(0,na.pi)({x:-t/2,y:-n/2,width:t,height:n},e)},update:function(t,e){var n=e.getContainer(),i=this.getOptions({}).style,r=this.getSize(t),o=e.get("keyShape");t.size||(r[0]=o.attr("width")||i.width,r[1]=o.attr("height")||i.height);r={stroke:t.color,x:-r[0]/2,y:-r[1]/2,width:r[0],height:r[1]},r=at({},i,o.attr(),r),r=at(r,t.style);this.updateShape(t,e,r,!1),this.updateLinkPoints(t,n)}},"single-node"),fe("ellipse",{options:{size:[80,40],style:{x:0,y:0,stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"ellipse",labelPosition:"center",drawShape:function(t,e){var n=this.getOptions(t).icon,i=void 0===n?{}:n,r=this.getShapeStyle(t),o=e.addShape("ellipse",{attrs:r,className:"ellipse-keyShape",name:"ellipse-keyShape",draggable:!0}),a=i.width,s=i.height,n=i.show,r=i.text;return n&&(r?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},i),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}):e.addShape("image",{attrs:(0,na.pi)({x:-a/2,y:-s/2},i),className:this.type+"-icon",name:this.type+"-icon",draggable:!0})),this.drawLinkPoints(t,e),o},drawLinkPoints:function(t,e){var n=this.getOptions(t).linkPoints,i=void 0===n?{}:n,r=i.top,o=i.left,a=i.right,s=i.bottom,u=i.size,c=i.r,n=(0,na._T)(i,["top","left","right","bottom","size","r"]),i=this.getSize(t),t=i[0]/2,i=i[1]/2;o&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:-t,y:0,r:u/2||c||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),a&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:t,y:0,r:u/2||c||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),r&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:-i,r:u/2||c||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),s&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:i,r:u/2||c||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),n=this.getSize(t),t=n[0]/2,n=n[1]/2;return(0,na.pi)({x:0,y:0,rx:t,ry:n},e)},update:function(t,e){var n=e.getContainer(),i=this.getOptions({}).style,r=this.getSize(t),r={stroke:t.color,rx:r[0]/2,ry:r[1]/2},r=at({},i,e.get("keyShape").attr(),r),r=at(r,t.style);this.updateShape(t,e,r,!0),this.updateLinkPoints(t,n)}},"single-node"),fe("diamond",{options:{size:[80,80],style:{stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"diamond",labelPosition:"center",drawShape:function(t,e){var n=this.getOptions(t).icon,i=void 0===n?{}:n,r=this.getShapeStyle(t),o=e.addShape("path",{attrs:r,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0}),a=i.width,s=i.height,n=i.show,r=i.text;return n&&(r?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},i),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}):e.addShape("image",{attrs:(0,na.pi)({x:-a/2,y:-s/2},i),className:this.type+"-icon",name:this.type+"-icon",draggable:!0})),this.drawLinkPoints(t,e),o},drawLinkPoints:function(t,e){var n=this.getOptions(t).linkPoints,i=void 0===n?{}:n,r=i.top,o=i.left,a=i.right,s=i.bottom,u=i.size,c=i.r,n=(0,na._T)(i,["top","left","right","bottom","size","r"]),i=this.getSize(t),t=i[0],i=i[1];o&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:-t/2,y:0,r:u/2||c||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),a&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:t/2,y:0,r:u/2||c||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),r&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:-i/2,r:u/2||c||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),s&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:i/2,r:u/2||c||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})},getPath:function(t){var e=this.getSize(t),t=e[0],e=e[1];return[["M",0,-e/2],["L",t/2,0],["L",0,e/2],["L",-t/2,0],["Z"]]},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),t=this.getPath(t);return(0,na.pi)({path:t},e)},update:function(t,e){var n=e.getContainer(),i=this.getOptions({}).style,r=this.getPath(t),r={stroke:t.color,path:r},r=at({},i,e.get("keyShape").attr(),r),r=at(r,t.style);this.updateShape(t,e,r,!0),this.updateLinkPoints(t,n)}},"single-node"),fe("triangle",{options:{size:40,direction:"up",style:{stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize},offset:15},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20,offset:6},stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"triangle",labelPosition:"bottom",drawShape:function(t,e){var n=this.getOptions(t),i=n.icon,r=void 0===i?{}:i,o=n.direction,a=this.getShapeStyle(t),s=t.direction||o,u=e.addShape("path",{attrs:a,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0}),c=r.width,i=r.height,n=r.show,o=r.offset,a=r.text;return n&&(a?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},r),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}):(c=-c/2,i=-i/2,"up"!==s&&"down"!==s||(i+=o),"left"!==s&&"right"!==s||(c+=o),e.addShape("image",{attrs:(0,na.pi)({x:c,y:i},r),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}))),this.drawLinkPoints(t,e),u},drawLinkPoints:function(t,e){var n,i,r=this.getOptions(t),o=r.linkPoints,a=void 0===o?{}:o,s=r.direction,u=t.direction||s,c=a.top,h=a.left,l=a.right,o=a.bottom,r=a.size,s=a.r,a=(0,na._T)(a,["top","left","right","bottom","size","r"]),t=this.getSize(t)[0];h&&(h=null,n=t*Math.sin(1/3*Math.PI),i=t*Math.sin(1/3*Math.PI),"up"===u?h=[-i,n]:"down"===u?h=[-i,-n]:"left"===u&&(h=[-i,i-n]),h&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},a),{x:h[0],y:h[1],r:r/2||s||5}),className:"link-point-left",name:"link-point-left"})),l&&(l=null,n=t*Math.sin(1/3*Math.PI),i=t*Math.sin(1/3*Math.PI),"up"===u?l=[i,n]:"down"===u?l=[i,-n]:"right"===u&&(l=[i,i-n]),l&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},a),{x:l[0],y:l[1],r:r/2||s||5}),className:"link-point-right",name:"link-point-right"})),c&&(c=null,n=t*Math.sin(1/3*Math.PI),i=t*Math.sin(1/3*Math.PI),"up"===u?c=[i-n,-n]:"left"===u?c=[i,-n]:"right"===u&&(c=[-i,-n]),c&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},a),{x:c[0],y:c[1],r:r/2||s||5}),className:"link-point-top",name:"link-point-top"})),o&&(o=null,n=t*Math.sin(1/3*Math.PI),i=t*Math.sin(1/3*Math.PI),"down"===u?o=[-i+n,n]:"left"===u?o=[i,n]:"right"===u&&(o=[-i,n]),o&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},a),{x:o[0],y:o[1],r:r/2||s||5}),className:"link-point-bottom",name:"link-point-bottom"}))},getPath:function(t){var e=this.getOptions(t).direction,n=t.direction||e,i=this.getSize(t)[0],e=i*Math.sin(1/3*Math.PI),t=i*Math.sin(1/3*Math.PI),i=[["M",-t,e],["L",0,-e],["L",t,e],["Z"]];return"down"===n?i=[["M",-t,-e],["L",t,-e],["L",0,e],["Z"]]:"left"===n?i=[["M",-t,t-e],["L",t,-t],["L",t,t],["Z"]]:"right"===n&&(i=[["M",t,t-e],["L",-t,t],["L",-t,-t],["Z"]]),i},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),t=this.getPath(t);return(0,na.pi)({path:t},e)},update:function(t,e){var n=e.getContainer(),i=this.getOptions({}).style,r=this.getPath(t),r={stroke:t.color,path:r},r=at({},i,e.get("keyShape").attr(),r),r=at(r,t.style);this.updateShape(t,e,r,!0),this.updateLinkPoints(t,n)},updateLinkPoints:function(t,e){var n=this.getOptions({}),i=n.linkPoints,r=n.direction,o=t.direction||r,a=e.find(function(t){return"link-point-left"===t.get("className")}),s=e.find(function(t){return"link-point-right"===t.get("className")}),u=e.find(function(t){return"link-point-top"===t.get("className")}),c=e.find(function(t){return"link-point-bottom"===t.get("className")}),h=i,l=a||s||u||c,d=at({},h=l?l.attr():h,t.linkPoints),f=d.fill,p=d.stroke,n=d.lineWidth,r=(r=d.size/2)||d.r,i=t.linkPoints||{left:void 0,right:void 0,top:void 0,bottom:void 0},l=i.left,h=i.right,d=i.top,i=i.bottom,t=this.getSize(t)[0],f={r:r,fill:f,stroke:p,lineWidth:n},p=null,n=t*Math.sin(1/3*Math.PI),t=t*Math.sin(1/3*Math.PI);"up"===o?p=[-t,n]:"down"===o?p=[-t,-n]:"left"===o&&(p=[-t,t-n]),p&&(a?l||void 0===l?a.attr((0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]})):a.remove():l&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}));p=null;"up"===o?p=[t,n]:"down"===o?p=[t,-n]:"right"===o&&(p=[t,t-n]),p&&(s?h||void 0===h?s.attr((0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]})):s.remove():h&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}));p=null;"up"===o?p=[t-n,-n]:"left"===o?p=[t,-n]:"right"===o&&(p=[-t,-n]),p&&(u?d||void 0===d?u.attr((0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]})):u.remove():d&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}));p=null;"down"===o?p=[n-t,n]:"left"===o?p=[t,n]:"right"===o&&(p=[-t,n]),p&&(c?i||void 0===i?c.attr((0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]})):c.remove():i&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},f),{x:p[0],y:p[1]}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0}))}},"single-node"),fe("modelRect",{options:{size:[185,70],style:{radius:5,stroke:"#69c0ff",fill:"#ffffff",lineWidth:ea.defaultNode.style.lineWidth,fillOpacity:1},labelCfg:{style:{fill:"#595959",fontSize:14},offset:30},descriptionCfg:{style:{fontSize:12,fill:"#bfbfbf"},paddingTop:0},preRect:{show:!0,width:4,fill:"#40a9ff",radius:2},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:10,lineWidth:1,fill:"#72CC4A",stroke:"#72CC4A"},logoIcon:{show:!0,x:0,y:0,img:"https://gw.alipayobjects.com/zos/basement_prod/4f81893c-1806-4de4-aff3-9a6b266bc8a2.svg",width:16,height:16,offset:0},stateIcon:{show:!0,x:0,y:0,img:"https://gw.alipayobjects.com/zos/basement_prod/300a2523-67e0-4cbf-9d4a-67c077b40395.svg",width:16,height:16,offset:-5},anchorPoints:[[0,.5],[1,.5]]},shapeType:"modelRect",drawShape:function(t,e){var n=this.getOptions(t).preRect,i=void 0===n?{}:n,r=this.getShapeStyle(t),o=this.getSize(t),a=o[0],n=o[1],o=e.addShape("rect",{attrs:r,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0}),r=i.show,i=(0,na._T)(i,["show"]);return r&&e.addShape("rect",{attrs:(0,na.pi)({x:-a/2,y:-n/2,height:n},i),className:"pre-rect",name:"pre-rect",draggable:!0}),this.drawLogoIcon(t,e),this.drawStateIcon(t,e),this.drawLinkPoints(t,e),o},drawLogoIcon:function(t,e){var n,i,r,o,a=this.getOptions(t).logoIcon,s=void 0===a?{}:a,u=this.getSize(t)[0];s.show&&(n=s.width,i=s.height,r=s.x,o=s.y,a=s.offset,t=s.text,s=(0,na._T)(s,["width","height","x","y","offset","text"]),t?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},s),className:"rect-logo-icon",name:"rect-logo-icon",draggable:!0}):e.addShape("image",{attrs:(0,na.pi)((0,na.pi)({},s),{x:r||-u/2+n+a,y:o||-i/2,width:n,height:i}),className:"rect-logo-icon",name:"rect-logo-icon",draggable:!0}))},drawStateIcon:function(t,e){var n,i,r,o,a=this.getOptions(t).stateIcon,s=void 0===a?{}:a,u=this.getSize(t)[0];s.show&&(n=s.width,i=s.height,r=s.x,o=s.y,a=s.offset,t=s.text,s=(0,na._T)(s,["width","height","x","y","offset","text"]),t?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},s),className:"rect-state-icon",name:"rect-state-icon",draggable:!0}):e.addShape("image",{attrs:(0,na.pi)((0,na.pi)({},s),{x:r||u/2-n+a,y:o||-i/2,width:n,height:i}),className:"rect-state-icon",name:"rect-state-icon",draggable:!0}))},drawLinkPoints:function(t,e){var n=this.getOptions(t).linkPoints,i=void 0===n?{}:n,r=i.top,o=i.left,a=i.right,s=i.bottom,u=i.size,c=i.r,n=(0,na._T)(i,["top","left","right","bottom","size","r"]),i=this.getSize(t),t=i[0],i=i[1];o&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:-t/2,y:0,r:u/2||c||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),a&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:t/2,y:0,r:u/2||c||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),r&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:-i/2,r:u/2||c||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),s&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},n),{x:0,y:i/2,r:u/2||c||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})},drawLabel:function(t,e){var n=this.getOptions(t),i=n.labelCfg,r=void 0===i?{}:i,o=n.logoIcon,a=void 0===o?{}:o,s=n.descriptionCfg,u=void 0===s?{}:s,i=this.getSize(t)[0],o=null,n=a.show,s=a.width,a=-i/2+r.offset;n&&(a=-i/2+s+r.offset);s=r.style,r=u.style,u=u.paddingTop;return _(t.description)?(o=e.addShape("text",{attrs:(0,na.pi)((0,na.pi)({},s),{x:a,y:-5,text:t.label}),className:"text-shape",name:"text-shape",draggable:!0}),e.addShape("text",{attrs:(0,na.pi)((0,na.pi)({},r),{x:a,y:17+(u||0),text:t.description}),className:"rect-description",name:"rect-description",draggable:!0})):o=e.addShape("text",{attrs:(0,na.pi)((0,na.pi)({},s),{x:a,y:7,text:t.label}),className:"text-shape",name:"text-shape",draggable:!0}),o},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),n=this.getSize(t),t=e.width||n[0],n=e.height||n[1];return(0,na.pi)({x:-t/2,y:-n/2,width:t,height:n},e)},update:function(t,e){var n=this.getOptions(t),i=n.style,r=void 0===i?{}:i,o=n.labelCfg,a=void 0===o?{}:o,s=n.descriptionCfg,u=void 0===s?{}:s,c=this.getSize(t),h=c[0],l=c[1];e.get("keyShape").attr((0,na.pi)((0,na.pi)({},r),{x:-h/2,y:-l/2,width:h,height:l}));var d=e.getContainer(),i=d.find(function(t){return"rect-logo-icon"===t.get("className")}),o=at({},i?i.attr():{},t.logoIcon),n=o.width;void 0===n&&(n=this.options.logoIcon.width);s=t.logoIcon?t.logoIcon.show:void 0,c=a.offset,r=-h/2+n+c;s||void 0===s||(r=-h/2+c);var f,e=d.find(function(t){return"node-label"===t.get("className")}),n=d.find(function(t){return"rect-description"===t.get("className")});t.label&&(e?(f=t.labelCfg?t.labelCfg.style:{},c=at({},e.attr(),f),t.label&&(c.text=t.label),c.x=r,_(t.description)&&(c.y=-5),n&&(n.resetMatrix(),n.attr({x:r})),e.resetMatrix(),e.attr(c)):d.addShape("text",{attrs:(0,na.pi)((0,na.pi)({},a.style),{x:r,y:t.description?-5:7,text:t.label}),className:"node-label",name:"node-label",draggable:!0})),_(t.description)&&(p=u.paddingTop,n?(f=t.descriptionCfg?t.descriptionCfg.style:{},f=at({},n.attr(),f),_(t.description)&&(f.text=t.description),f.x=r,n.resetMatrix(),n.attr((0,na.pi)((0,na.pi)({},f),{y:17+(p||0)}))):d.addShape("text",{attrs:(0,na.pi)((0,na.pi)({},u.style),{x:r,y:17+(p||0),text:t.description}),className:"rect-description",name:"rect-description",draggable:!0}));var p,r=d.find(function(t){return"pre-rect"===t.get("className")});r&&(p=at({},r.attr(),t.preRect),r.attr((0,na.pi)((0,na.pi)({},p),{x:-h/2,y:-l/2,height:l}))),i?s||void 0===s?(g=o.width,v=o.height,y=o.x,m=o.y,b=o.offset,x=(0,na._T)(o,["width","height","x","y","offset"]),i.attr((0,na.pi)((0,na.pi)({},x),{x:y||-h/2+g+b,y:m||-v/2,width:g,height:v}))):i.remove():s&&this.drawLogoIcon(t,d);var g,v,y,m,x=d.find(function(t){return"rect-state-icon"===t.get("className")}),b=at({},x?x.attr():{},t.stateIcon);x?(b.show||void 0===b.show||x.remove(),g=b.width,v=b.height,y=b.x,m=b.y,i=b.offset,s=(0,na._T)(b,["width","height","x","y","offset"]),x.attr((0,na.pi)((0,na.pi)({},s),{x:y||h/2-g+i,y:m||-v/2,width:g,height:v}))):b.show&&this.drawStateIcon(t,d),this.updateLinkPoints(t,d)}},"single-node"),fe("star",{options:{size:60,style:{stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"star",labelPosition:"center",drawShape:function(t,e){var n=this.getOptions(t).icon,i=void 0===n?{}:n,r=this.getShapeStyle(t),o=e.addShape("path",{attrs:r,className:this.type+"-keyShape",name:this.type+"-keyShape",draggable:!0}),a=i.width,s=i.height,n=i.show,r=i.text;return n&&(r?e.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},i),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}):e.addShape("image",{attrs:(0,na.pi)({x:-a/2,y:-s/2},i),className:this.type+"-icon",name:this.type+"-icon",draggable:!0})),this.drawLinkPoints(t,e),o},drawLinkPoints:function(t,e){var n,i,r=this.getOptions(t).linkPoints,o=void 0===r?{}:r,a=o.top,s=o.left,u=o.right,c=o.leftBottom,h=o.rightBottom,l=o.size,r=o.r,o=(0,na._T)(o,["top","left","right","leftBottom","rightBottom","size","r"]),t=this.getSize(t)[0];u&&(n=Math.cos(.1*Math.PI)*t,i=Math.sin(.1*Math.PI)*t,e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},o),{x:n,y:-i,r:l/2||r||5}),className:"link-point-right",name:"link-point-right"})),a&&(n=Math.cos(.5*Math.PI)*t,i=Math.sin(.5*Math.PI)*t,e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},o),{x:n,y:-i,r:l/2||r||5}),className:"link-point-top",name:"link-point-top"})),s&&(n=Math.cos(.9*Math.PI)*t,i=Math.sin(.9*Math.PI)*t,e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},o),{x:n,y:-i,r:l/2||r||5}),className:"link-point-left",name:"link-point-left"})),c&&(n=Math.cos(1.3*Math.PI)*t,i=Math.sin(1.3*Math.PI)*t,e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},o),{x:n,y:-i,r:l/2||r||5}),className:"link-point-left-bottom",name:"link-point-left-bottom"})),h&&(n=Math.cos(1.7*Math.PI)*t,i=Math.sin(1.7*Math.PI)*t,e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},o),{x:n,y:-i,r:l/2||r||5}),className:"link-point-right-bottom",name:"link-point-right-bottom"}))},getPath:function(t){for(var e=this.getSize(t)[0],n=t.innerR||3*e/8,i=[],r=0;r<5;r++){var o=Math.cos((18+72*r)/180*Math.PI)*e,a=Math.sin((18+72*r)/180*Math.PI)*e,s=Math.cos((54+72*r)/180*Math.PI)*n,u=Math.sin((54+72*r)/180*Math.PI)*n;0===r?i.push(["M",o,-a]):i.push(["L",o,-a]),i.push(["L",s,-u])}return i.push(["Z"]),i},getShapeStyle:function(t){var e=at({},this.getOptions(t).style,{stroke:t.color}),t=this.getPath(t);return(0,na.pi)({path:t},e)},update:function(t,e){var n=e.getContainer(),i=this.getOptions({}).style,r=this.getPath(t),r={stroke:t.color,path:r},r=at({},i,e.get("keyShape").attr(),r),r=at(r,t.style);this.updateShape(t,e,r,!0),this.updateLinkPoints(t,n)},updateLinkPoints:function(t,e){var n=this.getOptions({}).linkPoints,i=e.find(function(t){return"link-point-left"===t.get("className")}),r=e.find(function(t){return"link-point-right"===t.get("className")}),o=e.find(function(t){return"link-point-top"===t.get("className")}),a=e.find(function(t){return"link-point-left-bottom"===t.get("className")}),s=e.find(function(t){return"link-point-right-bottom"===t.get("className")}),u=n,c=i||r||o||a||s,h=at({},u=c?c.attr():u,t.linkPoints),l=h.fill,d=h.stroke,f=h.lineWidth,p=(p=h.size/2)||h.r,g=t.linkPoints||{left:void 0,right:void 0,top:void 0,leftBottom:void 0,rightBottom:void 0},n=g.left,c=g.right,u=g.top,h=g.leftBottom,g=g.rightBottom,t=this.getSize(t)[0],l={r:p,fill:l,stroke:d,lineWidth:f},d=Math.cos(.1*Math.PI)*t,f=Math.sin(.1*Math.PI)*t;r?c||void 0===c?r.attr((0,na.pi)((0,na.pi)({},l),{x:d,y:-f})):r.remove():c&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},l),{x:d,y:-f}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0}),d=Math.cos(.5*Math.PI)*t,f=Math.sin(.5*Math.PI)*t,o?u||void 0===u?o.attr((0,na.pi)((0,na.pi)({},l),{x:d,y:-f})):o.remove():u&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},l),{x:d,y:-f}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0}),d=Math.cos(.9*Math.PI)*t,f=Math.sin(.9*Math.PI)*t,i?n||void 0===n?i.attr((0,na.pi)((0,na.pi)({},l),{x:d,y:-f})):i.remove():n&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},l),{x:d,y:-f}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0}),d=Math.cos(1.3*Math.PI)*t,f=Math.sin(1.3*Math.PI)*t,a?h||void 0===h?a.attr((0,na.pi)((0,na.pi)({},l),{x:d,y:-f})):a.remove():h&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},l),{x:d,y:-f}),className:"link-point-left-bottom",name:"link-point-left-bottom",isAnchorPoint:!0}),d=Math.cos(1.7*Math.PI)*t,f=Math.sin(1.7*Math.PI)*t,s?g||void 0===g?s.attr((0,na.pi)((0,na.pi)({},l),{x:d,y:-f})):a.remove():g&&e.addShape("circle",{attrs:(0,na.pi)((0,na.pi)({},l),{x:d,y:-f}),className:"link-point-right-bottom",name:"link-point-right-bottom",isAnchorPoint:!0})}},"single-node");var Hm=Jo.defaultSubjectColors;fe("donut",{options:{size:ea.defaultNode.size,style:{x:0,y:0,stroke:ea.defaultNode.style.stroke,fill:ea.defaultNode.style.fill,lineWidth:ea.defaultNode.style.lineWidth},labelCfg:{style:{fill:ea.nodeLabel.style.fill,fontSize:ea.nodeLabel.style.fontSize}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:ea.defaultNode.linkPoints.size,lineWidth:ea.defaultNode.linkPoints.lineWidth,fill:ea.defaultNode.linkPoints.fill,stroke:ea.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,na.pi)({},ea.nodeStateStyles)},shapeType:"circle",labelPosition:"center",drawShape:function(t,i){var e=this.getOptions(t).icon,n=void 0===e?{}:e,r=this.getShapeStyle(t),o=Q({},n,t.icon),a=i.addShape("circle",{attrs:r,className:this.type+"-keyShape",draggable:!0,name:this.type+"-keyShape"}),s=o.width,e=o.height,n=o.show,r=o.text;n&&(r?i.addShape("text",{attrs:(0,na.pi)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},o),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}):i.addShape("image",{attrs:(0,na.pi)({x:-s/2,y:-e/2},o),className:this.type+"-icon",name:this.type+"-icon",draggable:!0}));var s=a.attr("r"),e=.6*s,u=(s+e)/2,o=t.donutAttrs,c=void 0===o?{}:o,o=t.donutColorMap,h=void 0===o?{}:o,o=Object.keys(c).length;if(c&&1<o){var l=[],d=0;if(Object.keys(c).forEach(function(t){var e=c[t]||0;N(e)&&(l.push({key:t,value:e,color:h[t]}),d+=e)}),d){var f=s-e;if(1===o)return void i.addShape("circle",{attrs:{r:u,x:0,y:0,stroke:l[0].color||Hm[0],lineWidth:f},name:"fan-shape-0"});var p=[u,0],g=0;l.forEach(function(t,e){var n=t.value/d;n<.001||(1!==(n=.999<n?1:n)?(t.percent=n,t.angle=n*Math.PI*2,t.beginAgnle=g,g+=t.angle,t.endAngle=g,t.arcBegin=p,t.arcEnd=[u*Math.cos(t.endAngle),-u*Math.sin(t.endAngle)],n=t.angle>Math.PI?1:0,n=[["M",t.arcBegin[0],t.arcBegin[1]],["A",u,u,0,n,0,t.arcEnd[0],t.arcEnd[1]],["L",t.arcEnd[0],t.arcEnd[1]]],i.addShape("path",{attrs:{path:n,lineWidth:f,stroke:t.color||Hm[e%Hm.length]},name:"fan-shape-"+e}),p=t.arcEnd):i.addShape("circle",{attrs:{r:u,x:0,y:0,stroke:t.color||Hm[e%Hm.length],lineWidth:f},name:"fan-shape-"+e}))})}}return this.drawLinkPoints(t,i),a},update:void 0},"circle");function qm(t){var e=t.x,t=t.y;return{x:e,y:t,centerX:e,centerY:t,minX:e,minY:t,maxX:e,maxY:t,height:0,width:0}}function Km(t){for(var e=[],n={},i=t.length-1;0<=i;i--){var r=t[i];r.id=r.x+"|||"+r.y,n[r.id]=r,e.push(r)}return e}function Jm(t,e){return t.width||t.height?{centerX:t.centerX,centerY:t.centerY,minX:t.minX-e,minY:t.minY-e,maxX:t.maxX+e,maxY:t.maxY+e,height:t.height+2*e,width:t.width+2*e}:t}function Qm(t,e,n){var i;if(0!==(o=(o=e,r=t,i=Math.abs(o.x-r.centerX),o=Math.abs(o.y-r.centerY),0===i&&0===o?0:i/r.width>o/r.height)))return o?{x:e.x>t.centerX?t.maxX:t.minX,y:e.y}:{x:e.x,y:e.y>t.centerY?t.maxY:t.minY};var r=t.centerX,o=t.centerY;return n.y<e.y?o=t.minY:n.x>e.x?r=t.maxX:n.x<e.x?r=t.minX:n.x===e.x&&(o=t.maxY),{x:r,y:o}}function $m(t,e){var n=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),r=Math.max(t.maxX,e.maxX),e=Math.max(t.maxY,e.maxY);return{centerX:(n+r)/2,centerY:(i+e)/2,minX:n,minY:i,maxX:r,maxY:e,height:e-i,width:r-n}}function tx(t){return[{x:t.minX,y:t.minY},{x:t.maxX,y:t.minY},{x:t.maxX,y:t.maxY},{x:t.minX,y:t.maxY}]}function ex(t,e){var n=t.x,t=t.y;return n<e.minX||n>e.maxX||t<e.minY||t>e.maxY}function nx(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function ix(t,e,n,i,r){return nx(t,e)+nx(t,n)+(o=t,a=0,[e,n,i,r].forEach(function(t){t&&(o.x===t.x&&(a+=-2),o.y===t.y&&(a+=-2))}),a);var o,a}function rx(t,e,n,i,r){void 0===r&&(r=0),t.unshift(e[i]),n[i]&&n[i]!==i&&r<=100&&rx(t,e,n,n[i],r+1)}function ox(t,e,n,i){var r=n.x-t.x,o=n.y-t.y,a=i.x-t.x,s=i.y-t.y,u=n.x-e.x,t=n.y-e.y,n=i.x-e.x,e=i.y-e.y;return(r*s-o*a)*(u*e-t*n)<=0&&(r*t-o*u)*(a*e-s*n)<=0}function ax(t,e,n){if(n.width||n.height){var i=tx(n),r=i[0],o=i[1],n=i[2],i=i[3];return ox(t,e,r,o)||ox(t,e,r,i)||ox(t,e,o,n)||ox(t,e,n,i)}}function sx(t,n,i,e,r,o,a){var s=[],u=[n],c={},h={},l={};h[n.id]=0,l[n.id]=ix(n,i,n);var d,f,p={};for(t.forEach(function(t){p[t.id]=t});u.length;){if(d=void 0,f=1/0,u.forEach(function(t){l[t.id]<=f&&(f=l[t.id],d=t)}),d===i){var g=[];return rx(g,p,c,i.id),g}!function(t,e){e=t.indexOf(e);-1<e&&t.splice(e,1)}(u,d),s.push(d),function(t,e,n,i){var r=[];return t.forEach(function(t){t!==e&&(t.x!==e.x&&t.y!==e.y||ax(t,e,n)||ax(t,e,i)||r.push(t))}),Km(r)}(t,d,e,r).forEach(function(t){var e;-1===s.indexOf(t)&&(-1===u.indexOf(t)&&u.push(t),e=l[d.id]+nx(d,t),h[t.id]&&e>=h[t.id]||(c[t.id]=d.id,h[t.id]=e,l[t.id]=h[t.id]+ix(t,i,n,o,a)))})}return[n,i]}function ux(s,u){var c=[],t=s[0];return c.push("M"+t.x+" "+t.y),s.forEach(function(t,e){var n,i,r,o=s[e+1],a=s[e+2];o&&a?(i=o,r=a,(n=t).x===i.x&&i.x===r.x||n.y===i.y&&i.y===r.y?c.push("L"+o.x+" "+o.y):(e=(r=(e=a,n=u,a=nx(i=t,r=o),t=nx(e,r),[{x:r.x-(n=t<(n=a<n?a:n)?t:n)/a*(r.x-i.x),y:r.y-n/a*(r.y-i.y)},{x:r.x-n/t*(r.x-e.x),y:r.y-n/t*(r.y-e.y)}]))[1],c.push("L"+(r=r[0]).x+" "+r.y),c.push("Q"+o.x+" "+o.y+" "+e.x+" "+e.y),c.push("L"+e.x+" "+e.y))):o&&c.push("L"+o.x+" "+o.y)}),c.join("")}function cx(t,e,n,i,r){var o;n&&n.getType()?"combo"===n.getType()?((o=n.getKeyShape().getCanvasBBox()||qm(t)).centerX=(o.minX+o.maxX)/2,o.centerY=(o.minY+o.maxY)/2):o=n.getBBox():o=qm(t),i&&i.getType()?"combo"===i.getType()?(c=i.getKeyShape().getBBox())?((f={x:u=(f=i.getModel()).x,y:h=f.y,width:c.width,height:c.height,minX:c.minX+u,maxX:c.maxX+u,minY:c.minY+h,maxY:c.maxY+h}).centerX=(f.minX+f.maxX)/2,f.centerY=(f.minY+f.maxY)/2):f=qm(e):f=i&&i.getBBox():f=qm(e);var a=Jm(o,r),s=Jm(f,r),u=Qm(a,t,e),c=Qm(s,e,t),h=function(t){var e=[],n=[];(t=void 0===t?[]:t).forEach(function(t){e.push(t.x),n.push(t.y)});var i=Math.min.apply(Math,e),r=Math.max.apply(Math,e),o=Math.min.apply(Math,n),t=Math.max.apply(Math,n);return{centerX:(i+r)/2,centerY:(o+t)/2,maxX:r,maxY:t,minX:i,minY:o,height:t-o,width:r-i}}([u,c]),i=$m(a,h),r=$m(s,h),l=(l=[]).concat(tx(i)).concat(tx(r)),d={x:(t.x+e.x)/2,y:(t.y+e.y)/2};[h,i,r].forEach(function(t){var e,n,i;l=l.concat((i=e=t,((t=(n=d).x)<i.minX||t>i.maxX?[]:[{x:t,y:i.minY},{x:t,y:i.maxY}]).concat((e=e,(n=n.y)<e.minY||n>e.maxY?[]:[{x:e.minX,y:n},{x:e.maxX,y:n}])).filter(function(t){return ex(t,a)&&ex(t,s)})))}),[{x:u.x,y:c.y},{x:c.x,y:u.y}].forEach(function(t){ex(t,a)&&ex(t,s)&&l.push(t)}),l.unshift(u),l.push(c),l=Km(l);var f=sx(l,u,c,o,f,t,e);return f.unshift(t),f.push(e),yx(f)}function hx(t,e){return(e=Math.round(Math.abs(t/e)))<0?0:(t<0?-1:1)*e}function lx(t,e){var n=e.x-t.x,t=e.y-t.y;return n||t?Math.atan2(t,n):0}function dx(t,e){return(e=Math.abs(t-e))>Math.PI?2*Math.PI-e:e}function fx(t,e,n){for(var i=1/0,r=0,o=e.length;r<o;r++){var a=n(t,e[r]);a<i&&(i=a)}return i}function px(t,e,n,i,r){var o=[];if(!n)return[t];var a=r.directions,s=r.offset,u=n.getBBox(),e=e.x>u.minX&&e.x<u.maxX&&e.y>u.minY&&e.y<u.maxY,c=Jm(u,s);for(p in c)c[p]=hx(c[p],r.gridSize);if(e){for(var h=0,l=a;h<l.length;h++)for(var d=l[h],f=[[{x:c.minX,y:c.minY},{x:c.maxX,y:c.minY}],[{x:c.minX,y:c.minY},{x:c.minX,y:c.maxY}],[{x:c.maxX,y:c.minY},{x:c.maxX,y:c.maxY}],[{x:c.minX,y:c.maxY},{x:c.maxX,y:c.maxY}]],p=0;p<4;p++){var g=f[p],g=Jo.getLineIntersect(t,{x:t.x+d.stepX*c.width,y:t.y+d.stepY*c.height},g[0],g[1]);g&&!ax(t,g,u)&&(g.id=g.x+"|||"+g.y,o.push(g))}return o}return(i=Qm(c,t,i)).id=i.x+"|||"+i.y,[i]}function gx(t,e,n,i){return e=lx(t,e),n[t.id]?(t=lx({x:n[t.id].x,y:n[t.id].y},t),dx(t,e)):(i=lx(i,t),dx(i,e))}function vx(t,e,n,i,r){if(isNaN(t.x)||isNaN(e.x))return[];var o=Q(mx,r);o.obstacles=o.obstacles||[];var a,s,u,c=o.gridSize,h=(r=o.obstacles.concat([n,i]),a=c,s=o.offset,u={},r.forEach(function(t){if(t)for(var e=Jm(t.getBBox(),s),n=hx(e.minX,a);n<=hx(e.maxX,a);n+=1)for(var i=hx(e.minY,a);i<=hx(e.maxY,a);i+=1)u[n+"|||"+i]=!0}),u),l={x:hx(t.x,c),y:hx(t.y,c)},d={x:hx(e.x,c),y:hx(e.y,c)};t.id=l.x+"|||"+l.y,e.id=d.x+"|||"+d.y;var f=px(l,t,n,d,o),p=px(d,e,i,l,o);f.forEach(function(t){delete h[t.id]}),p.forEach(function(t){delete h[t.id]});for(var g={},v={},y={},m={},x={},b=0;b<f.length;b++){var E=f[b];m[(g[E.id]=E).id]=0,x[E.id]=fx(E,p,o.distFunc)}for(var S,w,k,C,_,M=o.maximumLoops,I=o.penalties;0<Object.keys(g).length&&0<M&&(S=void 0,w=1/0,Object.keys(g).forEach(function(t){t=g[t].id;x[t]<=w&&(w=x[t],S=g[t])}),S);){if(-1<p.findIndex(function(t){return t.x===S.x&&t.y===S.y}))return function(t,e,n,i,r,o,a){var s=[i],u=t.id,c=t.x,h=t.y,t={x:c,y:h,id:u};for(gx(t,o,e,n)&&s.unshift({x:o.x===i.x?i.x:t.x*a,y:o.y===i.y?i.y:t.y*a});e[u]&&e[u].id!==u;){var l={x:c,y:h,id:u},d=e[u].id,f=e[u].x,p=e[u].y,g={x:f,y:p,id:d};gx(g,l,e,n)&&s.unshift({x:g.x===l.x?s[0].x:g.x*a,y:g.y===l.y?s[0].y:g.y*a}),u=d,c=f,h=p}t=h;return s[0].x=(c===n.x?r:s[0]).x,s[0].y=(t===n.y?r:s[0]).y,s.unshift(r),s}(S,y,l,e,t,d,c);delete g[S.id],v[S.id]=!0;for(b=0;b<o.directions.length;b++)C=o.directions[b],v[(k={x:S.x+C.stepX,y:S.y+C.stepY,id:Math.round(S.x)+C.stepX+"|||"+(Math.round(S.y)+C.stepY)}).id]||(_=gx(S,k,y,l))>o.maxAllowedDirectionChange||h[k.id]||(g[k.id]||(g[k.id]=k),C=o.distFunc(S,k)+(isNaN(I[_])?c:I[_]),C=m[S.id]+C,m[k.id]&&C>=m[k.id]||(y[k.id]=S,m[k.id]=C,x[k.id]=C+fx(k,p,o.distFunc)));--M}return o.fallbackRoute(t,e,n,i,o)}var yx=Km,mx={offset:20,maxAllowedDirectionChange:Math.PI/2,maximumLoops:2e3,gridSize:10,directions:[{stepX:1,stepY:0},{stepX:-1,stepY:0},{stepX:0,stepY:1},{stepX:0,stepY:-1}],get penalties(){return{0:0,45:this.gridSize/2,90:this.gridSize/2}},distFunc:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},fallbackRoute:function(t,e,n,i,r){return yx(cx(t,e,n,i,r.offset))}};Math.PI;xe("polyline",{options:{color:ea.defaultEdge.color,size:ea.defaultEdge.size,style:{radius:0,offset:15,x:0,y:0,stroke:ea.defaultEdge.style.stroke,lineAppendWidth:ea.defaultEdge.style.lineAppendWidth},labelCfg:{style:{fill:ea.edgeLabel.style.fill,fontSize:ea.edgeLabel.style.fontSize}},routeCfg:{obstacles:[],maxAllowedDirectionChange:Math.PI,maximumLoops:500,gridSize:10},stateStyles:(0,na.pi)({},ea.edgeStateStyles)},shapeType:"polyline",labelPosition:"center",drawShape:function(t,e){t=this.getShapeStyle(t);return 0===t.radius&&delete t.radius,e.addShape("path",{className:"edge-shape",name:"edge-shape",attrs:t})},getShapeStyle:function(t){var e=at({},this.options.style,{stroke:t.color},t.style);t=this.getPathPoints(t),this.radius=e.radius,this.offset=e.offset;var n=t.startPoint,i=t.endPoint,r=this.getControlPoints(t),o=[n];(o=r?o.concat(r):o).push(i);var a=t.sourceNode,s=t.targetNode,u=e.radius,r=at({},this.options.routeCfg,t.routeCfg);r.offset=e.offset;r=this.getPath(o,a,s,u,r);return(m(r)&&r.length<=1||_(r)&&-1===r.indexOf("L"))&&(r="M0 0, L0 0"),(isNaN(n.x)||isNaN(n.y)||isNaN(i.x)||isNaN(i.y))&&(r="M0 0, L0 0"),at({},ea.defaultEdge.style,e,{lineWidth:t.size,path:r})},updateShapeStyle:function(t,e){var n,i,r,o,a,s,u,c,h,l,d=e.getContainer();e.isVisible()&&(n={stroke:t.color},i=d.find(function(t){return"edge-shape"===t.get("className")})||e.getKeyShape(),r=t.size,o=(t=this.getPathPoints(t)).startPoint,a=t.endPoint,s=[o],(s=(l=this.getControlPoints(t))?s.concat(l):s).push(a),c=at({},n,u=i.attr(),t.style),h=t.sourceNode,d=t.targetNode,e=c.radius,(l=at({},this.options.routeCfg,t.routeCfg)).offset=c.offset,l=this.getPath(s,h,d,e,l),(m(l)&&l.length<=1||_(l)&&-1===l.indexOf("L"))&&(l="M0 0, L0 0"),(isNaN(o.x)||isNaN(o.y)||isNaN(a.x)||isNaN(a.y))&&(l="M0 0, L0 0"),u.endArrow&&!1===c.endArrow&&(t.style.endArrow={path:""}),u.startArrow&&!1===c.startArrow&&(t.style.startArrow={path:""}),t=at(n,i.attr(),{lineWidth:r,path:l},t.style),i&&i.attr(t))},getPath:function(t,e,n,i,r){var o=r.offset,a=r.simple;if(!o||2<t.length){if(i)return ux(t,i);var s=[];return S(t,function(t,e){0===e?s.push(["M",t.x,t.y]):s.push(["L",t.x,t.y])}),s}r=a?cx(t[t.length-1],t[0],n,e,o):vx(t[0],t[t.length-1],e,n,r);return r&&r.length?i?ux(r,i):Jo.pointsToPolygon(r):"M0 0, L0 0"}},"single-edge");function xx(t,e){if(!1!==e(t)&&t){t=t.get("combos");if(0===t.length)return!1;S(t,function(t){xx(t,e)})}}var bx=u.cloneEvent,Ex=u.isNaN,Sx=Math.abs,wx=["shift","ctrl","alt","control"],d={getDefaultCfg:function(){return{direction:"both",enableOptimize:!1,scalableRange:0,allowDragOnItem:!1}},getEvents:function(){return{dragstart:"onMouseDown",drag:"onMouseMove",dragend:"onMouseUp","canvas:click":"onMouseUp",keyup:"onKeyUp",focus:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onMouseUp"}},updateViewport:function(t){var e,n,i,r=this.origin,o=+t.clientX,a=+t.clientY;Ex(o)||Ex(a)||(e=o-r.x,n=a-r.y,"x"===this.get("direction")?n=0:"y"===this.get("direction")&&(e=0),this.origin={x:o,y:a},i=this.graph.get("width"),t=this.graph.get("height"),r=this.graph.get("canvas").getCanvasBBox(),o=this.scalableRange,a=this.scalableRange,o<1&&-1<o&&(o*=i,a*=t),(r.minX<=i+o&&r.minX+e>i+o||0<=r.maxX+o&&r.maxX+o+e<0)&&(e=0),(r.minY<=t+a&&r.minY+n>t+a||0<=r.maxY+a&&r.maxY+a+n<0)&&(n=0),this.graph.translate(e,n))},onTouchStart:function(t){var e=t.originalEvent.touches,n=e[0],e=e[1];n&&e||(t.preventDefault(),this.onMouseDown(t))},onMouseDown:function(t){var e=t.originalEvent;if((!e||t.name===$o.TOUCHSTART||0===e.button)&&(t.name===$o.TOUCHSTART||"undefined"==typeof window||!window.event||window.event.buttons||window.event.button)&&this.shouldBegin.call(this,t)&&!this.keydown){e=t.target,e=e&&e.isCanvas&&e.isCanvas();if((this.allowDragOnItem||e)&&(this.origin={x:t.clientX,y:t.clientY},this.dragging=!1,this.enableOptimize)){for(var t=this.graph,n=t.getEdges(),i=0,r=n.length;i<r;i++){var o=n[i].get("group").get("children");o&&o.forEach(function(t){t.set("ori-visibility",t.get("ori-visibility")||t.get("visible")),t.hide()})}for(var a=t.getNodes(),s=0,u=a.length;s<u;s++)for(var c=0,h=a[s].getContainer().get("children");c<h.length;c++){var l=h[c];l.get("isKeyShape")||(l.set("ori-visibility",l.get("ori-visibility")||l.get("visible")),l.hide())}}}},onTouchMove:function(t){var e=t.originalEvent.touches,n=e[0],e=e[1];n&&e?this.onMouseUp(t):(t.preventDefault(),this.onMouseMove(t))},onMouseMove:function(t){var e=this.graph;if(!this.keydown){var n=t.target,n=n&&n.isCanvas&&n.isCanvas();if((this.allowDragOnItem||n)&&(t=bx(t),this.origin)){if(this.dragging)t.type="drag",e.emit("canvas:drag",t);else{if(Sx(this.origin.x-t.clientX)+Sx(this.origin.y-t.clientY)<10)return;this.shouldBegin.call(this,t)&&(t.type="dragstart",e.emit("canvas:dragstart",t),this.dragging=!0)}this.shouldUpdate.call(this,t)&&this.updateViewport(t)}}},onMouseUp:function(t){var e=this.graph;if(!this.keydown){if(this.enableOptimize){for(var n=e.getEdges(),i=0,r=n.length;i<r;i++){var o=n[i].get("group").get("children");o&&o.forEach(function(t){t.get("ori-visibility")&&t.show()})}for(var a=e.getNodes(),s=0,u=a.length;s<u;s++)for(var c=0,h=a[s].getContainer().get("children");c<h.length;c++){var l=h[c];l.get("isKeyShape")||l.get("ori-visibility")&&l.show()}}this.dragging?(t=bx(t),this.shouldEnd.call(this,t)&&this.updateViewport(t),t.type="dragend",e.emit("canvas:dragend",t),this.endDrag()):this.origin=null}},endDrag:function(){this.origin=null,this.dragging=!1,this.dragbegin=!1},onKeyDown:function(t){t=t.key;t&&(-1<wx.indexOf(t.toLowerCase())?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.keydown=!1,this.origin=null,this.dragging=!1,this.dragbegin=!1}},Ee={getDefaultCfg:function(){return{updateEdge:!0,delegateStyle:{},enableDelegate:!1,onlyChangeComboSize:!1,comboActiveState:"",selectedState:"selected",enableOptimize:!1,enableDebounce:!1}},getEvents:function(){return{"node:dragstart":"onDragStart","node:drag":"onDrag","node:dragend":"onDragEnd","combo:dragenter":"onDragEnter","combo:dragleave":"onDragLeave","combo:drop":"onDropCombo","node:drop":"onDropNode","canvas:drop":"onDropCanvas"}},validationCombo:function(t){return!(!this.origin||!t||t.destroyed)&&"combo"===t.getType()},onDragStart:function(t){var e=this;if(this.shouldBegin.call(this,t)){var n=t.item;if(n&&!n.destroyed&&!n.hasLocked()){n.getContainer().set("capture",!1);var i=t.target;if(i)if(i.get("isAnchorPoint"))return;i=this.graph;this.targets=[],this.targetCombo=null;var i=i.findAllByState("node",this.selectedState),r=n.get("id");0!==i.filter(function(t){t=t.get("id");return r===t}).length&&1<i.length?i.forEach(function(t){t.hasLocked()||e.targets.push(t)}):this.targets.push(n);var o=[];this.targets.forEach(function(t){o.push(q(t.getModel()))}),this.set("beforeDragNodes",o),this.hidenEdge={},this.get("updateEdge")&&this.enableOptimize&&!this.enableDelegate&&this.targets.forEach(function(t){t.getEdges().forEach(function(t){t.isVisible()&&(e.hidenEdge[t.getID()]=!0,t.hide())})}),this.origin={x:t.x,y:t.y},this.point={},this.originPoint={}}}},onDrag:function(e){var n=this;this.origin&&this.shouldUpdate(this,e)&&(this.get("enableDelegate")?this.updateDelegate(e):this.enableDebounce?this.debounceUpdate({targets:this.targets,graph:this.graph,point:this.point,origin:this.origin,evt:e,updateEdge:this.get("updateEdge")}):this.targets.map(function(t){n.update(t,e)}))},onDragEnd:function(t){var e,n,i=this;this.origin&&this.shouldEnd.call(this,t)&&((e=t.item)&&e.getContainer().set("capture",!0),this.delegateRect&&(this.delegateRect.remove(),this.delegateRect=null),this.updatePositions(t),this.get("updateEdge")&&this.enableOptimize&&!this.enableDelegate&&this.targets.forEach(function(t){t.getEdges().forEach(function(t){i.hidenEdge[t.getID()]&&t.show(),t.refresh()})}),this.hidenEdge={},(t=this.graph).get("enabledStack")&&(n={before:{nodes:[],edges:[],combos:[]},after:{nodes:[],edges:[],combos:[]}},this.get("beforeDragNodes").forEach(function(t){n.before.nodes.push({id:t.id,x:t.x,y:t.y})}),this.targets.forEach(function(t){t=t.getModel();n.after.nodes.push({id:t.id,x:t.x,y:t.y})}),t.pushStack("update",q(n))),t.emit("dragnodeend",{items:this.targets,targetItem:null}),this.point={},this.origin=null,this.originPoint={},this.targets.length=0,this.targetCombo=null)},onDropCombo:function(t){var e,n,i=t.item;this.validationCombo(i)&&(this.updatePositions(t),e=this.graph,this.comboActiveState&&e.setItemState(i,this.comboActiveState,!1),this.targetCombo=i,this.onlyChangeComboSize?e.updateCombos():(n=i.getModel(),this.targets.map(function(t){t.getModel().comboId!==n.id&&e.updateComboTree(t,n.id)}),e.updateCombo(i)),e.emit("dragnodeend",{items:this.targets,targetItem:this.targetCombo}))},onDropCanvas:function(t){var e=this.graph;this.targets&&0!==this.targets.length&&(this.updatePositions(t),this.onlyChangeComboSize?e.updateCombos():this.targets.map(function(t){t.getModel().comboId&&e.updateComboTree(t)}))},onDropNode:function(t){var e,n,i;this.targets&&0!==this.targets.length&&(e=t.item,this.updatePositions(t),n=this.graph,(i=e.getModel().comboId)?this.onlyChangeComboSize?n.updateCombos():(t=n.findById(i),this.comboActiveState&&n.setItemState(t,this.comboActiveState,!1),this.targets.map(function(t){var e=t.getModel();i!==e.comboId&&n.updateComboTree(t,i)}),n.updateCombo(t)):this.targets.map(function(t){t.getModel().comboId&&n.updateComboTree(t)}),n.emit("dragnodeend",{items:this.targets,targetItem:e}))},onDragEnter:function(t){var e=t.item;this.validationCombo(e)&&(t=this.graph,this.comboActiveState&&t.setItemState(e,this.comboActiveState,!0))},onDragLeave:function(t){var e=t.item;this.validationCombo(e)&&(t=this.graph,this.comboActiveState&&t.setItemState(e,this.comboActiveState,!1))},updatePositions:function(e){var n=this;this.targets&&0!==this.targets.length&&this.get("enableDelegate")&&(this.enableDebounce?this.debounceUpdate({targets:this.targets,graph:this.graph,point:this.point,origin:this.origin,evt:e,updateEdge:this.get("updateEdge"),updateFunc:this.update}):this.targets.map(function(t){return n.update(t,e)}))},update:function(t,e){var n=this.origin,i=t.get("model"),r=t.get("id");this.point[r]||(this.point[r]={x:i.x||0,y:i.y||0});r={x:e.x-n.x+this.point[r].x,y:e.y-n.y+this.point[r].y};this.get("updateEdge")?this.graph.updateItem(t,r,!1):t.updatePosition(r)},debounceUpdate:K(function(t){var e=t.targets,i=t.graph,r=t.point,o=t.origin,a=t.evt,s=t.updateEdge;t.updateFunc;e.map(function(t){var e=t.get("model"),n=t.get("id");r[n]||(r[n]={x:e.x||0,y:e.y||0});n={x:a.x-o.x+r[n].x,y:a.y-o.y+r[n].y};s?i.updateItem(t,n,!1):t.updatePosition(n)})},50,!0),updateDelegate:function(t){var e,n,i,r,o,a,s=this.graph;this.delegateRect?(r=t.x-this.origin.x+this.originPoint.minX,o=t.y-this.origin.y+this.originPoint.minY,this.delegateRect.attr({x:r,y:o})):(e=s.get("group"),n=Q({},Ic.delegateStyle,this.delegateStyle),i=(a=this.calculationGroupPosition(t)).x,r=a.y,o=a.width,s=a.height,t=a.minX,a=a.minY,this.originPoint={x:i,y:r,width:o,height:s,minX:t,minY:a},this.delegateRect=e.addShape("rect",{attrs:(0,na.pi)({width:o,height:s,x:i,y:r},n),name:"rect-delegate-shape"}),this.delegate=this.delegateRect,this.delegateRect.set("capture",!1))},calculationGroupPosition:function(t){var e=this.targets;0===e.length&&e.push(t.item);for(var n=1/0,i=-1/0,r=1/0,o=-1/0,a=0;a<e.length;a++){var s=e[a].getBBox(),u=s.minX,c=s.minY,h=s.maxX,s=s.maxY;u<n&&(n=u),c<r&&(r=c),i<h&&(i=h),o<s&&(o=s)}return{x:Math.floor(n),y:Math.floor(r),width:Math.ceil(i)-Math.floor(n),height:Math.ceil(o)-Math.floor(r),minX:n,minY:r}}},kx=Math.min,Cx=Math.max,_x=Math.abs,Mx=["drag","shift","ctrl","alt","control"],l={getDefaultCfg:function(){return{brushStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:function(){},onDeselect:function(){},selectedState:"selected",trigger:"shift",includeEdges:!0,selectedEdges:[],selectedNodes:[]}},getEvents:function(){return-1<Mx.indexOf(this.trigger.toLowerCase())||(this.trigger="shift"),"drag"===this.trigger?{dragstart:"onMouseDown",drag:"onMouseMove",dragend:"onMouseUp","canvas:click":"clearStates"}:{dragstart:"onMouseDown",drag:"onMouseMove",dragend:"onMouseUp","canvas:click":"clearStates",keyup:"onKeyUp",keydown:"onKeyDown"}},onMouseDown:function(t){var e=t.item,n=this.brush;e||"drag"!==this.trigger&&!this.keydown||(this.selectedNodes&&0!==this.selectedNodes.length&&this.clearStates(),n=n||this.createBrush(),this.originPoint={x:t.canvasX,y:t.canvasY},n.attr({width:0,height:0}),n.show(),this.dragging=!0)},onMouseMove:function(t){this.dragging&&("drag"!==this.trigger&&!this.keydown||this.updateBrush(t))},onMouseUp:function(t){this.graph;(this.brush||this.dragging)&&("drag"!==this.trigger&&!this.keydown||(this.brush.remove(!0),this.brush=null,this.getSelectedNodes(t),this.dragging=!1))},clearStates:function(){var e=this.graph,n=this.selectedState,t=e.findAllByState("node",n),i=e.findAllByState("edge",n);t.forEach(function(t){return e.setItemState(t,n,!1)}),i.forEach(function(t){return e.setItemState(t,n,!1)}),this.selectedNodes=[],this.selectedEdges=[],this.onDeselect&&this.onDeselect(this.selectedNodes,this.selectedEdges),e.emit("nodeselectchange",{selectedItems:{nodes:[],edges:[]},select:!1})},getSelectedNodes:function(t){var i=this,r=this.graph,e=this.originPoint,o=this.shouldUpdate,n=this.selectedState,t={x:t.x,y:t.y},e=r.getPointByCanvas(e.x,e.y),a=kx(t.x,e.x),s=Cx(t.x,e.x),u=kx(t.y,e.y),c=Cx(t.y,e.y),h=[],l=[];r.getNodes().forEach(function(t){var e;!t.isVisible()||(e=t.getBBox()).centerX>=a&&e.centerX<=s&&e.centerY>=u&&e.centerY<=c&&o(t,"select")&&(h.push(t),e=t.getModel(),l.push(e.id),r.setItemState(t,n,!0))});var d=[];this.includeEdges&&h.forEach(function(t){t.getOutEdges().forEach(function(t){var e,n;t.isVisible()&&(e=(n=t.getModel()).source,n=n.target,l.includes(e)&&l.includes(n)&&o(t,"select")&&(d.push(t),r.setItemState(t,i.selectedState,!0)))})}),this.selectedEdges=d,this.selectedNodes=h,this.onSelect&&this.onSelect(h,d),r.emit("nodeselectchange",{selectedItems:{nodes:h,edges:d},select:!0})},createBrush:function(){var t=this.graph.get("canvas").addShape("rect",{attrs:this.brushStyle,capture:!1,name:"brush-shape"});return this.brush=t,this.delegate=t},updateBrush:function(t){var e=this.originPoint;this.brush.attr({width:_x(t.canvasX-e.x),height:_x(t.canvasY-e.y),x:kx(t.canvasX,e.x),y:kx(t.canvasY,e.y)})},onKeyDown:function(t){var e=t.key;e&&(t=this.trigger.toLowerCase(),e=e.toLowerCase(),this.keydown=e===t||"control"===e&&"ctrl"===t||"ctrl"===e&&"control"===t)},onKeyUp:function(){this.brush&&(this.brush.remove(!0),this.brush=null,this.dragging=!1),this.keydown=!1}},Ix=["shift","ctrl","alt","control"],tn={getDefaultCfg:function(){return{multiple:!0,trigger:"shift",selectedState:"selected"}},getEvents:function(){return-1<Ix.indexOf(this.trigger.toLowerCase())||(this.trigger="shift"),this.multiple?{"node:click":"onClick","combo:click":"onClick","canvas:click":"onCanvasClick",keyup:"onKeyUp",keydown:"onKeyDown"}:{"node:click":"onClick","combo:click":"onClick","canvas:click":"onCanvasClick"}},onClick:function(t){var e,n,i,r,o,a,s,u=this,c=t.item;c&&!c.destroyed&&(o=c.getType(),e=u.graph,n=u.keydown,i=u.multiple,r=u.shouldUpdate,u.shouldBegin.call(u,t)&&(n&&i||(o=e.findAllByState(o,u.selectedState),S(o,function(t){t!==c&&e.setItemState(t,u.selectedState,!1)})),c.hasState(u.selectedState)?(r.call(u,t)&&e.setItemState(c,u.selectedState,!1),a=e.findAllByState("node",u.selectedState),s=e.findAllByState("combo",u.selectedState),e.emit("nodeselectchange",{target:c,selectedItems:{nodes:a,combos:s},select:!1})):(r.call(u,t)&&e.setItemState(c,u.selectedState,!0),a=e.findAllByState("node",u.selectedState),s=e.findAllByState("combo",u.selectedState),e.emit("nodeselectchange",{target:c,selectedItems:{nodes:a,combos:s},select:!0}))))},onCanvasClick:function(){var e=this,n=this.graph,t=n.findAllByState("node",this.selectedState);S(t,function(t){n.setItemState(t,e.selectedState,!1)});t=n.findAllByState("combo",this.selectedState);S(t,function(t){n.setItemState(t,e.selectedState,!1)}),n.emit("nodeselectchange",{selectedItems:{nodes:[],edges:[],combos:[]},select:!1})},onKeyDown:function(t){t=t.key;t&&(t.toLowerCase()===this.trigger.toLowerCase()||"control"===t.toLowerCase()?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.keydown=!1}},Tx=sc,pe={getDefaultCfg:function(){return{sensitivity:2,minZoom:void 0,maxZoom:void 0,enableOptimize:!1,optimizeZoom:.1,fixSelectedItems:{fixAll:!1,fixLineWidth:!1,fixLabel:!1,fixState:"selected"}}},getEvents:function(){var t=this.fixSelectedItems;return t.fixState||(t.fixState="selected"),t.fixAll&&(t.fixLineWidth=!0,t.fixLabel=!0),{wheel:"onWheel",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd"}},onTouchStart:function(t){var e=t.originalEvent.touches,n=e[0],e=e[1];t.preventDefault(),e&&(this.shouldBegin&&!this.shouldBegin.call(this,t)||(this.startPoint={pageX:n.pageX,pageY:n.pageY},this.moveable=!0,e&&(this.endPoint={pageX:e.pageX,pageY:e.pageY}),this.originScale=this.graph.getZoom()||this.currentScale||1))},onTouchMove:function(t){var e,n,i;this.moveable&&(t.preventDefault(),e=(n=t.originalEvent.touches)[0],(i=n[1])&&(this.endPoint||(this.endPoint={pageX:i.pageX,pageY:i.pageY}),i=(n=function(t,e){return Math.hypot(e.x-t.x,e.y-t.y)})({x:e.pageX,y:e.pageY},{x:i.pageX,y:i.pageY})/n({x:this.startPoint.pageX,y:this.startPoint.pageY},{x:this.endPoint.pageX,y:this.endPoint.pageY}),n=this.originScale*i,this.currentScale=n,i=this.get("minZoom")||this.graph.get("minZoom"),(this.get("maxZoom")||this.graph.get("maxZoom"))<n||n<i||(i=this.graph.get("canvas").getPointByClient(t.clientX,t.clientY),this.graph.zoomTo(n,{x:i.x,y:i.y}),this.graph.emit("wheelzoom",t))))},onTouchEnd:function(){this.moveable=!1,this.endPoint=null},onWheel:function(t){var l=this,d=this.graph,e=this.fixSelectedItems;if((!this.shouldBegin||this.shouldBegin.call(this,t))&&this.shouldUpdate.call(this,t)){t.preventDefault();var n=d.get("canvas").getPointByClient(t.clientX,t.clientY),i=this.get("sensitivity"),r=d.getZoom(),o=r*(t.wheelDelta<0?1-.05*i:1/(1-.05*i)),i=this.get("minZoom")||d.get("minZoom");if(!((this.get("maxZoom")||d.get("maxZoom"))<o||o<i)){if(this.get("enableOptimize")){var f=this.get("optimizeZoom"),i=this.get("optimized"),p=d.getNodes(),g=d.getEdges(),v=p.length,y=g.length;if(!i){for(var a=0;a<v;a++)if(!(S=p[a]).destroyed)for(var s=(W=S.get("group").get("children")).length,u=0;u<s;u++)(P=W[u]).destoryed||P.get("isKeyShape")||(P.set("ori-visibility",P.get("ori-visibility")||P.get("visible")),P.hide());for(var c=0;c<y;c++)for(s=(W=(j=g[c]).get("group").get("children")).length,u=0;u<s;u++)(P=W[u]).set("ori-visibility",P.get("ori-visibility")||P.get("visible")),P.hide();this.set("optimized",!0)}clearTimeout(this.get("timeout"));i=setTimeout(function(){var t=d.getZoom();if(l.get("optimized")){l.set("optimized",!1);for(var e=0;e<v;e++){var n=p[e],i=(s=n.get("group").get("children")).length;if(t<f)(o=(u=n.getKeyShape()).get("ori-visibility"))&&u.show();else for(var r=0;r<i;r++){var o=(h=s[r]).get("ori-visibility");!h.get("visible")&&o&&o&&h.show()}}for(var a=0;a<y;a++){var s,u,c=g[a],i=(s=c.get("group").get("children")).length;if(t<f)(o=(u=c.getKeyShape()).get("ori-visibility"))&&u.show();else for(var h,r=0;r<i;r++)(h=s[r]).get("visible")||(o=h.get("ori-visibility"))&&h.show()}}},100);this.set("timeout",i)}if(r<=1)if(e.fixAll||e.fixLineWidth||e.fixLabel){for(var h=d.findAllByState("node",e.fixState),m=d.findAllByState("edge",e.fixState),x=r/o,b=h.length,E=0;E<b;E++){var S,w,k,C,_=(S=h[E]).getContainer(),M=S.getModel(),I=S.getOriginStyle(),T=S.getStateStyle(e.fixState),A=S.get("shapeFactory").getShape(M.type).getStateStyle(e.fixState,S)[e.fixState];if(e.fixAll)o<=1&&(w=(w=q(_.getMatrix()))||[1,0,0,0,1,0,0,0,1],k=(C=S.getModel()).x,C=C.y,w=Tx(w,[["t",-k,-C],["s",x,x],["t",k,C]]),_.setMatrix(w));else for(s=(W=_.get("children")).length,u=0;u<s;u++){var P=W[u],D=void 0,N=void 0;if(e.fixLabel)if("text"===P.get("type")){D=P.attr("fontSize")||12;var O=T[P.get("name")],L=A[P.get("name")],R=O?O.fontSize:12,B=L?L.fontSize:12,G=R||B||12;if(o<=1&&P.attr("fontSize",G/o),N)break}if(e.fixLineWidth&&P.get("isKeyShape")){N=P.attr("lineWidth")||0;var U=T.lineWidth||A.lineWidth||I.lineWidth||0;if(o<=1&&P.attr("lineWidth",U/o),D)break}}}for(var F=m.length,z=0;z<F;z++)for(var j,W=(_=(j=m[z]).getContainer()).get("children"),M=j.getModel(),T=j.getStateStyle(e.fixState),A=j.get("shapeFactory").getShape(M.type).getStateStyle(e.fixState,j)[e.fixState],s=W.length,u=0;u<s;u++){P=W[u],D=void 0,N=void 0;if(e.fixLabel||e.fixAll)if("text"===P.get("type")){D=P.attr("fontSize")||12;O=T[P.get("name")],L=A[P.get("name")],R=O?O.fontSize:12,B=L?L.fontSize:12,G=R||B||12;if(o<=1&&P.attr("fontSize",G/o),N)break}if((e.fixLineWidth||e.fixAll)&&P.get("isKeyShape")){N=P.attr("lineWidth")||0;U=T.lineWidth||A.lineWidth||1;if(o<=1&&P.attr("lineWidth",U/o),D)break}}}d.zoomTo(o,{x:n.x,y:n.y}),d.emit("wheelzoom",t)}}}},n={onMouseEnter:function(t){var e=t.item;this.currentTarget=e,this.showTooltip(t),this.graph.emit("tooltipchange",{item:t.item,action:"show"})},onMouseMove:function(t){this.shouldUpdate(t)?this.currentTarget&&t.item===this.currentTarget&&this.updatePosition(t):this.hideTooltip()},onMouseLeave:function(t){this.shouldEnd(t)&&(this.hideTooltip(),this.graph.emit("tooltipchange",{item:this.currentTarget,action:"hide"}),this.currentTarget=null)},showTooltip:function(t){var e,n=this.container;t.item&&!t.item.destroyed&&(n||(n=this.createTooltip(this.graph.get("canvas")),this.container=n),e=this.formatText(t.item.get("model"),t),n.innerHTML=e,We(this.container,{visibility:"visible"}),this.updatePosition(t))},hideTooltip:function(){We(this.container,{visibility:"hidden"})},updatePosition:function(t){var e=this.get("shouldBegin"),n=this.width,i=this.height,r=this.container,o=this.graph;e(t)?(e=o.getPointByClient(t.clientX,t.clientY),o=(t=o.getCanvasByPoint(e.x,e.y)).x,e=t.y,t=r.getBoundingClientRect(),n/2<o?o-=t.width:o+=this.offset,i/2<e?e-=t.height:e+=this.offset,We(this.container,{left:o+"px",top:e+"px",visibility:"visible"})):We(r,{visibility:"hidden"})},createTooltip:function(t){var e=t.get("el");e.style.position="relative";var n=Ng('<div class="g6-tooltip g6-'+this.item+'-tooltip"></div>');return e.parentNode.appendChild(n),We(n,{position:"absolute",visibility:"visible"}),this.width=t.get("width"),this.height=t.get("height"),this.container=n,this.graph.get("tooltips").push(n),n}},a=(0,na.pi)({getDefaultCfg:function(){return{item:"node",offset:12,formatText:function(t){return t.label}}},getEvents:function(){return{"node:mouseenter":"onMouseEnter","node:mouseleave":"onMouseLeave","node:mousemove":"onMouseMove",afterremoveitem:"onMouseLeave"}}},n),Pn=(0,na.pi)({getDefaultCfg:function(){return{item:"edge",offset:12,formatText:function(t){return"source: "+t.source+" target: "+t.target}}},getEvents:function(){return{"edge:mouseenter":"onMouseEnter","edge:mouseleave":"onMouseLeave","edge:mousemove":"onMouseMove",afterremoveitem:"onMouseLeave"}}},n),Ax=["click","dblclick"],Px=u.calculationItemsBBox,n={getDefaultCfg:function(){return{enableDelegate:!1,delegateStyle:{},onlyChangeComboSize:!1,activeState:"",selectedState:"selected"}},getEvents:function(){return{"combo:dragstart":"onDragStart","combo:drag":"onDrag","combo:dragend":"onDragEnd","combo:drop":"onDrop","node:drop":"onNodeDrop","combo:dragenter":"onDragEnter","combo:dragleave":"onDragLeave"}},validationCombo:function(t){var e=t.item;return!(!e||e.destroyed)&&(!!this.shouldUpdate(this,t)&&"combo"===e.getType())},onDragStart:function(t){var e,n,i=this,r=this.graph,o=t.item;this.validationCombo(t)&&(this.targets=[],e=r.findAllByState("combo",this.selectedState),n=o.get("id"),0===e.filter(function(t){t=t.get("id");return n===t}).length?this.targets.push(o):this.targets=e,this.activeState&&this.targets.map(function(t){t=t.getModel();!t.parentId||(t=r.findById(t.parentId))&&r.setItemState(t,i.activeState,!0)}),this.point={},this.originPoint={},this.origin={x:t.x,y:t.y},this.currentItemChildCombos=[],xx(o,function(t){if(t.destroyed)return!1;t=t.getModel();return i.currentItemChildCombos.push(t.id),!0}))},onDrag:function(e){var r,n,t,i,o,a,s,u=this;this.origin&&this.validationCombo(e)&&(this.enableDelegate?this.updateDelegate(e):(this.activeState&&(r=this.graph,i=e.item,n=i.getModel(),t=r.getCombos(),i=i.getBBox(),o=i.centerX,a=i.centerY,s=i.width,t.filter(function(t){t=t.getModel();return n.parentId,t.id!==n.id&&!u.currentItemChildCombos.includes(t.id)}).map(function(t){var e=t.getBBox(),n=e.centerX,i=e.centerY,e=e.width,n=o-n,i=a-i,i=2*Math.sqrt(n*n+i*i);.8*s<s+e-i?r.setItemState(t,u.activeState,!0):r.setItemState(t,u.activeState,!1)})),S(this.targets,function(t){u.updateCombo(t,e)})))},updatePositions:function(e){var n=this;this.enableDelegate&&S(this.targets,function(t){n.updateCombo(t,e)})},onDrop:function(t){var e,n,i=this,r=t.item;r&&this.targets&&!r.destroyed&&(this.updatePositions(t),e=this.graph,n=r.getModel(),this.targets.map(function(t){t.getModel().parentId!==n.id?(i.activeState&&e.setItemState(r,i.activeState,!1),i.onlyChangeComboSize?e.updateCombo(t):e.updateComboTree(t,n.id)):e.updateCombo(r)}),this.end(r,t),this.endComparison=!0)},onNodeDrop:function(t){var e,n,i,r,o=this;this.targets&&0!==this.targets.length&&(this.updatePositions(t),e=this.graph,(n=t.item.getModel().comboId)?(this.activeState&&(r=e.findById(n),e.setItemState(r,this.activeState,!1)),this.targets.map(function(t){o.onlyChangeComboSize?e.updateCombo(t):n!==t.getID()&&(i=e.findById(n),n!==t.getModel().parentId&&e.updateComboTree(t,n))})):this.targets.map(function(t){o.onlyChangeComboSize?e.updateCombo(t):t.getModel().comboId&&e.updateComboTree(t)}),this.endComparison=!0,this.end(i,t))},onDragEnter:function(t){var e;this.origin&&this.validationCombo(t)&&(e=t.item,t=this.graph,this.activeState&&t.setItemState(e,this.activeState,!0))},onDragLeave:function(t){var e;this.origin&&this.validationCombo(t)&&(e=t.item,t=this.graph,this.activeState&&t.setItemState(e,this.activeState,!1))},onDragEnd:function(t){var e,n;this.targets&&0!==this.targets.length&&(n=t.item,this.updatePositions(t),e=this.getParentCombo(n.getModel().parentId),n=this.graph,e&&this.activeState&&n.setItemState(e,this.activeState,!1),this.end(void 0,t))},end:function(t,e){var n,i=this;this.origin&&(n=this.graph,this.delegateShape&&(n.get("delegateGroup").clear(),this.delegateShape=null),t&&this.activeState&&n.setItemState(t,this.activeState,!1),t||this.targets.map(function(t){i.onlyChangeComboSize?n.updateCombo(t):n.updateComboTree(t)}),this.point=[],this.origin=null,this.originPoint=null,this.targets.length=0)},traverse:function(t,e){var n,i=this;!1!==e(t)&&t&&(n=t.get("combos"),S(n,function(t){i.traverse(t,e)}),t=t.get("nodes"),S(t,function(t){i.traverse(t,e)}))},updateCombo:function(t,e){var n=this;this.traverse(t,function(t){return!t.destroyed&&(n.updateSignleItem(t,e),!0)})},updateSignleItem:function(t,e){var n=this.origin,i=this.graph,r=t.getModel(),o=t.get("id");this.point[o]||(this.point[o]={x:r.x,y:r.y});r=e.x-n.x+this.point[o].x,o=e.y-n.y+this.point[o].y;i.updateItem(t,{x:r,y:o})},getParentCombo:function(t){var e=this.graph;if(t){t=e.findById(t);if(t)return t}},updateDelegate:function(t){var e,n,i,r,o,a,s=this.graph;this.delegateShape?(o=t.x-this.origin.x+this.originPoint.minX,a=t.y-this.origin.y+this.originPoint.minY,this.delegateShape.attr({x:o,y:a})):(e=s.get("delegateGroup"),n=null,i=(n=1<this.targets.length?Px(this.targets):this.targets[0].getBBox()).x,r=n.y,t=n.width,o=n.height,a=n.minX,s=n.minY,this.originPoint={x:i,y:r,width:t,height:o,minX:a,minY:s},s=(0,na.pi)((0,na.pi)({},Ic.delegateStyle),this.delegateStyle),this.delegateShape=e.addShape("rect",{attrs:(0,na.pi)({width:n.width,height:n.height,x:n.x,y:n.y},s),name:"combo-delegate-shape"}),this.delegate=this.delegateShape)}},Dx="dblclick",Nx=["click","dblclick"],Ox=u.isPolygonsIntersect,Lx=u.pathToPoints,Rx=["drag","shift","ctrl","alt","control"],Bx=["click","drag"],Gx=["shift","ctrl","control","alt","meta",void 0],Ux=["shift","ctrl","alt","control"],Fx=["shift","ctrl","alt","control"];S({"drag-canvas":d,"zoom-canvas":pe,"drag-node":Ee,"activate-relations":{getDefaultCfg:function(){return{trigger:"mouseenter",activeState:"active",inactiveState:"inactive",resetSelected:!1,shouldUpdate:function(){return!0}}},getEvents:function(){return"mouseenter"===this.get("trigger")?{"node:mouseenter":"setAllItemStates","combo:mouseenter":"setAllItemStates","node:mouseleave":"clearActiveState","combo:mouseleave":"clearActiveState"}:{"node:click":"setAllItemStates","combo:click":"setAllItemStates","canvas:click":"clearActiveState"}},setAllItemStates:function(t){var e=t.item,n=this.graph;if(this.item=e,this.shouldUpdate(t.item,{event:t,action:"activate"})){for(var i=this.activeState,r=this.inactiveState,o=n.getNodes(),a=n.getCombos(),s=n.getEdges(),u=n.get("vedges"),c=o.length,h=a.length,l=s.length,d=u.length,f=0;f<c;f++){var p=o[f],g=p.hasState("selected");this.resetSelected&&g&&n.setItemState(p,"selected",!1),n.setItemState(p,i,!1),r&&n.setItemState(p,r,!0)}for(f=0;f<h;f++){var v=a[f],g=v.hasState("selected");this.resetSelected&&g&&n.setItemState(v,"selected",!1),n.setItemState(v,i,!1),r&&n.setItemState(v,r,!0)}for(f=0;f<l;f++){var y=s[f];n.setItemState(y,i,!1),r&&n.setItemState(y,r,!0)}for(f=0;f<d;f++){var m=u[f];n.setItemState(m,i,!1),r&&n.setItemState(m,r,!0)}r&&n.setItemState(e,r,!1),n.setItemState(e,i,!0);for(var x=e.getEdges(),b=x.length,f=0;f<b;f++){var E=void 0,E=(y=x[f]).getSource()===e?y.getTarget():y.getSource();r&&n.setItemState(E,r,!1),n.setItemState(E,i,!0),n.setItemState(y,r,!1),n.setItemState(y,i,!0),y.toFront()}n.emit("afteractivaterelations",{item:t.item,action:"activate"})}},clearActiveState:function(t){var e=this.get("graph");if(this.shouldUpdate(t.item,{event:t,action:"deactivate"})){var n=this.activeState,i=this.inactiveState,r=e.get("autoPaint");e.setAutoPaint(!1);for(var o=e.getNodes()||[],a=e.getCombos()||[],s=e.getEdges()||[],u=e.get("vedges")||[],c=o.length,h=a.length,l=s.length,d=u.length,f=0;f<c;f++){var p=o[f];e.clearItemStates(p,[n,i])}for(f=0;f<h;f++){var g=a[f];e.clearItemStates(g,[n,i])}for(f=0;f<l;f++){var v=s[f];e.clearItemStates(v,[n,i,"deactivate"])}for(f=0;f<d;f++){var y=u[f];e.clearItemStates(y,[n,i,"deactivate"])}e.paint(),e.setAutoPaint(r),e.emit("afteractivaterelations",{item:t.item||this.get("item"),action:"deactivate"})}}},"brush-select":l,"click-select":tn,"lasso-select":{getDefaultCfg:function(){return{delegateStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:function(){},onDeselect:function(){},selectedState:"selected",trigger:"shift",includeEdges:!0,selectedEdges:[],selectedNodes:[]}},getEvents:function(){return-1<Rx.indexOf(this.trigger.toLowerCase())||(this.trigger="shift"),"drag"===this.trigger?{dragstart:"onDragStart",drag:"onDragMove",dragend:"onDragEnd","canvas:click":"clearStates"}:{dragstart:"onDragStart",drag:"onDragMove",dragend:"onDragEnd",keyup:"onKeyUp",keydown:"onKeyDown","canvas:click":"clearStates"}},onDragStart:function(t){var e=this.lasso;t.item||"drag"!==this.trigger&&!this.keydown||(this.selectedNodes&&0!==this.selectedNodes.length&&this.clearStates(),e=e||this.createLasso(),this.dragging=!0,this.originPoint={x:t.x,y:t.y},this.points.push(this.originPoint),e.show())},onDragMove:function(t){this.dragging&&("drag"!==this.trigger&&!this.keydown||(this.points.push({x:t.x,y:t.y}),this.updateLasso(t)))},onDragEnd:function(t){(this.lasso||this.dragging)&&("drag"!==this.trigger&&!this.keydown||(this.points.push(this.originPoint),this.getSelectedItems(),this.lasso.remove(!0),this.lasso=null,this.points=[],this.dragging=!1))},getLassoPath:function(){var t=this.points,n=[];return t.length&&(t.forEach(function(t,e){0===e?n.push(["M",t.x,t.y]):n.push(["L",t.x,t.y])}),n.push(["L",t[0].x,t[0].y])),n},clearStates:function(){var e=this.graph,n=this.selectedState,t=e.findAllByState("node",n),i=e.findAllByState("edge",n);t.forEach(function(t){return e.setItemState(t,n,!1)}),i.forEach(function(t){return e.setItemState(t,n,!1)}),this.onDeselect&&this.onDeselect(this.selectedNodes,this.selectedEdges),this.selectedNodes=[],this.selectedEdges=[],e.emit("nodeselectchange",{selectedItems:{nodes:[],edges:[]},select:!1})},getSelectedItems:function(){var i=this,o=this.graph,a=this.shouldUpdate,s=this.points.map(function(t){return[o.getCanvasByPoint(t.x,t.y).x,o.getCanvasByPoint(t.x,t.y).y]}),u=this.selectedState,c=[],h=[];o.getNodes().forEach(function(t){var e,n,i,r;t.isVisible()&&(n=s,r=(e=t).getKeyShape(),i="path"===e.get("type")?Lx(r.attr("path")):[[(i=r.getCanvasBBox()).minX,i.minY],[i.maxX,i.minY],[i.maxX,i.maxY],[i.minX,i.maxY]],!Ox(n,i)||a(t,"select")&&(c.push(t),i=t.getModel(),h.push(i.id),o.setItemState(t,u,!0)))});var r=[];this.includeEdges&&c.forEach(function(t){t.getOutEdges().forEach(function(t){var e,n;t.isVisible()&&(e=(n=t.getModel()).source,n=n.target,h.includes(e)&&h.includes(n)&&a(t,"select")&&(r.push(t),o.setItemState(t,i.selectedState,!0)))})}),this.selectedEdges=r,this.selectedNodes=c,this.onSelect&&this.onSelect(c,r),o.emit("nodeselectchange",{selectedItems:{nodes:c,edges:r},select:!0})},createLasso:function(){var t=this.graph.get("delegateGroup").addShape("path",{attrs:(0,na.pi)({path:[]},this.delegateStyle),capture:!1,name:"lasso-shape"});return this.lasso=t,this.delegate=t,this.points=[],t},updateLasso:function(t){this.lasso.attr({path:this.getLassoPath()})},onKeyDown:function(t){t=t.key;t&&(t.toLowerCase()===this.trigger.toLowerCase()?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.lasso&&(this.lasso.remove(!0),this.lasso=null,this.points=[],this.dragging=!1),this.keydown=!1}},tooltip:a,"edge-tooltip":Pn,"collapse-expand":{getDefaultCfg:function(){return{trigger:"click",onChange:function(){}}},getEvents:function(){var t=Ax.includes(this.trigger)?this.trigger:"click",e={};return e["node:"+t]="onNodeClick",e.touchstart="onNodeClick",e},onNodeClick:function(t){var e,n,i=t.item;i&&(!(e=this.graph.findDataById(i.get("id")))||(n=e.children)&&0!==n.length&&(n=!e.collapsed,this.shouldBegin(t,n)&&(e.collapsed=n,i.getModel().collapsed=n,this.graph.emit("itemcollapsed",{item:t.item,collapsed:n}),this.shouldUpdate(t,n)&&(this.onChange(i,n),this.graph.layout()))))}},"drag-combo":n,"collapse-expand-combo":{getDefaultCfg:function(){return{trigger:Dx,relayout:!0}},getEvents:function(){var t=Nx.includes(this.trigger)?this.trigger:Dx,e={};return e["combo:"+t]="onComboClick",e},onComboClick:function(t){var e=t.item,n=this.graph,t=this.relayout;!e||e.destroyed||"combo"!==e.getType()||(e=e.getModel().id)&&(n.collapseExpandCombo(e),t&&n.get("layout")?n.layout():n.refreshPositions())}},"create-edge":{getDefaultCfg:function(){return{trigger:"click",key:void 0,edgeConfig:{},getEdgeConfig:void 0}},getEvents:function(){var t;return-1<Bx.indexOf(this.trigger.toLowerCase())||(this.trigger="click"),this.key&&-1===Gx.indexOf(this.key.toLowerCase())&&(this.trigger=void 0),"drag"===this.trigger?t={"node:dragstart":"onClick","combo:dragstart":"onClick",drag:"updateEndPoint","node:drop":"onClick","combo:drop":"onClick",dragend:"onDragEnd"}:"click"===this.trigger&&(t={"node:click":"onClick",mousemove:"updateEndPoint","edge:click":"cancelCreating","canvas:click":"cancelCreating","combo:click":"onClick"}),this.key&&(t.keydown="onKeyDown",t.keyup="onKeyUp"),t},onDragEnd:function(t){var e;this.key&&!this.keydown||((e=t.item)&&e.getID()!==this.source&&"node"===e.getType()||this.cancelCreating({item:this.edge,x:t.x,y:t.y}))},onClick:function(t){var e,n,i,r,o,a,s=this;s.key&&!s.keydown||(r=t.item,e=s.graph,n=r.getModel(),i=s.getEdgeConfig,s.addingEdge&&s.edge?s.shouldEnd.call(s,t)&&(a=void 0,a=i&&y(i)?i({source:s.source,target:n.id}):s.edgeConfig,o=(0,na.pi)({target:n.id},a),s.source===n.id&&(o.type="loop"),e.emit("beforecreateedge",{}),e.updateItem(s.edge,o,!1),e.get("enabledStack")&&(r=(0,na.pi)((0,na.pi)({},s.edge.getModel()),{itemType:"edge"}),(o={}).edges=[r],e.pushStack("add",{before:{},after:o})),e.emit("aftercreateedge",{edge:s.edge}),s.edge.getKeyShape().set("capture",!0),s.edge=null,s.addingEdge=!1):s.shouldBegin.call(s,t)&&(a=void 0,a=i&&y(i)?i({source:n.id,target:n.id}):s.edgeConfig,s.edge=e.addItem("edge",(0,na.pi)({source:n.id,target:n.id},a),!1),s.source=n.id,s.addingEdge=!0,s.edge.getKeyShape().set("capture",!1)))},updateEndPoint:function(t){this.key&&!this.keydown||(t={x:t.x,y:t.y},this.graph.findById(this.source)?this.addingEdge&&this.edge&&this.graph.updateItem(this.edge,{target:t},!1):this.addingEdge=!1)},cancelCreating:function(t){var e=this;if(!e.key||e.keydown){var n=e.graph,i=t.item;if(e.addingEdge&&t.target&&t.target.isCanvas&&t.target.isCanvas())return n.removeItem(e.edge,!1),e.edge=null,void(e.addingEdge=!1);e.addingEdge&&e.edge===i&&(n.removeItem(e.edge,!1),e.edge=null,e.addingEdge=!1)}},onKeyDown:function(t){t=t.key;t&&(t.toLowerCase()===this.key.toLowerCase()?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.addingEdge&&this.edge&&(this.graph.removeItem(this.edge,!1),this.addingEdge=!1,this.edge=null),this.keydown=!1}},"shortcuts-call":{getDefaultCfg:function(){return{trigger:"ctrl",combinedKey:"1",functionName:"fitView",functionParams:[]}},getEvents:function(){return-1<Ux.indexOf(this.trigger.toLowerCase())||(this.trigger="ctrl"),this.combinedKey===this.trigger&&(this.combinedKey=void 0),{keyup:"onKeyUp",keydown:"onKeyDown"}},onKeyDown:function(t){var e=t.key;if(e){var n=this.trigger.toLowerCase(),t=e.toLowerCase();this.triggerKeydown||(this.triggerKeydown=t===n||"control"===t&&"ctrl"===n||"ctrl"===t&&"control"===n);e=this.graph;if(!e[this.functionName])return{};!this.triggerKeydown||this.combinedKey?(n=this.combinedKey.toLowerCase(),this.triggerKeydown&&(t===n||"control"===t&&"ctrl"===n||"ctrl"===t&&"control"===n)&&(this.functionParams&&this.functionParams.length?e[this.functionName].apply(e,this.functionParams):e[this.functionName]())):this.functionParams&&this.functionParams.length?e[this.functionName].apply(e,this.functionParams):e[this.functionName]()}},onKeyUp:function(){this.brush&&(this.brush.remove(!0),this.brush=null,this.dragging=!1),this.triggerKeydown=!1}},"scroll-canvas":{getDefaultCfg:function(){return{direction:"both",enableOptimize:!1,zoomKey:"ctrl",scalableRange:0}},getEvents:function(){return this.zoomKey&&-1!==Fx.indexOf(this.zoomKey)||(this.zoomKey="ctrl"),{wheel:"onWheel"}},onWheel:function(t){var e,n,i,r,o,a,l=this,d=this.graph,s=t[this.zoomKey+"Key"];if((s="control"===this.zoomKey?t.ctrlKey:s)?(a=d.get("canvas").getPointByClient(t.clientX,t.clientY),o=d.getZoom(),0<t.wheelDelta?o+=.05*o:o-=.05*o,d.zoomTo(o,{x:a.x,y:a.y})):(e=t.deltaX||t.movementX,!(n=t.deltaY||t.movementY)&&-1<navigator.userAgent.indexOf("Firefox")&&(n=125*-t.wheelDelta/3),i=this.graph.get("width"),r=this.graph.get("height"),s=this.graph.get("canvas").getCanvasBBox(),o=this.scalableRange,a=this.scalableRange,o<1&&-1<o&&(o*=i,a*=r),(s.minX<=i+o&&s.minX+e>i+o||0<=s.maxX+o&&s.maxX+o+e<0)&&(e=0),(s.minY<=r+a&&s.minY+n>r+a||0<=s.maxY+a&&s.maxY+a+n<0)&&(n=0),"x"===this.get("direction")?n=0:"y"===this.get("direction")&&(e=0),d.translate(-e,-n)),t.preventDefault(),this.get("enableOptimize")){var f=this.get("optimizeZoom"),t=this.get("optimized"),p=d.getNodes(),g=d.getEdges(),v=p.length,y=g.length;if(!t){for(var u=0;u<v;u++){var c=p[u];if(!c.destroyed)for(var h=(b=c.get("group").get("children")).length,m=0;m<h;m++)(E=b[m]).destoryed||E.get("isKeyShape")||(E.set("ori-visibility",E.get("ori-visibility")||E.get("visible")),E.hide())}for(var x=0;x<y;x++)for(var b,E,h=(b=g[x].get("group").get("children")).length,m=0;m<h;m++)(E=b[m]).set("ori-visibility",E.get("ori-visibility")||E.get("visible")),E.hide();this.set("optimized",!0)}clearTimeout(this.get("timeout"));t=setTimeout(function(){var t=d.getZoom();if(l.get("optimized")){l.set("optimized",!1);for(var e=0;e<v;e++){var n=p[e],i=(s=n.get("group").get("children")).length;if(t<f)(o=(u=n.getKeyShape()).get("ori-visibility"))&&u.show();else for(var r=0;r<i;r++){var o=(h=s[r]).get("ori-visibility");!h.get("visible")&&o&&o&&h.show()}}for(var a=0;a<y;a++){var s,u,c=g[a],i=(s=c.get("group").get("children")).length;if(t<f)(o=(u=c.getKeyShape()).get("ori-visibility"))&&u.show();else for(var h,r=0;r<i;r++)(h=s[r]).get("visible")||(o=h.get("ori-visibility"))&&h.show()}}},100);this.set("timeout",t)}}}},function(t,e){ta(e,t)});Wn={version:Ic.version,Graph:o,TreeGraph:i,Util:u,Layout:ug,registerLayout:function(t,e){e.isCustomLayout=!0,qc(t,e)},Global:Ic,registerBehavior:ta,registerCombo:ye,registerEdge:xe,registerNode:fe,Minimap:ge.Minimap,Grid:ge.Grid,Bundling:ge.Bundling,Menu:ge.Menu,ToolBar:ge.ToolBar,Tooltip:ge.Tooltip,TimeBar:ge.TimeBar,SnapLine:ge.SnapLine,Fisheye:ge.Fisheye,ImageMinimap:ge.ImageMinimap,EdgeFilterLens:ge.EdgeFilterLens,Algorithm:Tt,Arrow:ci,Marker:Yn,Shape:Wn};Wn.version="4.2.7";var zx=Wn},81746:function(t){var e;e=function(){return r={},i.m=n=[function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Array.isArray?Array.isArray(t):Object(i.a)(t,"Array")}},function(t,e,n){"use strict";e.a=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)}},function(t,e,n){"use strict";var o=n(0),a=n(13);e.a=function(t,e){if(t)if(Object(o.a)(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if(Object(a.a)(t))for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"Function")}},function(t,e,n){"use strict";var i={}.toString;e.a=function(t,e){return i.call(t)==="[object "+e+"]"}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"Number")}},function(t,e,n){"use strict";e.a=function(t){return null==t}},function(t,e,n){n=n(33).mix;t.exports={assign:n}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"String")}},function(t,e,n){"use strict";var i=n(15),r=n(4);e.a=function(t){if(!Object(i.a)(t)||!Object(r.a)(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}},function(t,e,n){"use strict";var i=n(6);e.a=function(t){return Object(i.a)(t)?"":t.toString()}},function(t,e,n){var i=n(18);t.exports=function(){function t(t,e){this.options=e=void 0===e?{}:e,this.rootNode=i(t,e)}return t.prototype.execute=function(){throw new Error("please override this method")},t}()},function(t,e,n){"use strict";var i=n(1);e.a=function(t,e){return!!Object(i.a)(t)&&-1<t.indexOf(e)}},function(t,e,n){"use strict";e.a=function(t){var e=typeof t;return null!==t&&"object"==e||"function"==e}},function(t,e,n){"use strict";var r=n(2),o=n(1);e.a=function(t,n){if(!Object(o.a)(t))return t;var i=[];return Object(r.a)(t,function(t,e){n(t,e)&&i.push(t)}),i}},function(t,e,n){"use strict";e.a=function(t){return"object"==typeof t&&null!==t}},function(t,e,n){"use strict";function r(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}e.a=function(t,e,n,i){e&&r(t,e);n&&r(t,n);i&&r(t,i);return t}},function(t,e,n){var o=n(30),a=["LR","RL","TB","BT","H","V"],s=["LR","RL","H"],u=a[0];t.exports=function(t,e,n){var i,r=e.direction||u;if(e.isHorizontal=(i=r,-1<s.indexOf(i)),r&&-1===a.indexOf(r))throw new TypeError("Invalid direction: "+r);r===a[0]?n(t,e):r===a[1]?(n(t,e),t.right2left()):r===a[2]?n(t,e):r===a[3]?(n(t,e),t.bottom2top()):r!==a[4]&&r!==a[5]||(r=(i=o(t,e)).left,i=i.right,n(r,e),n(i,e),e.isHorizontal?r.right2left():r.bottom2top(),i.translate(r.x-i.x,r.y-i.y),t.x=r.x,t.y=i.y,i=t.getBoundingBox(),e.isHorizontal?i.top<0&&t.translate(0,-i.top):i.left<0&&t.translate(-i.left,0));e=e.fixedRoot;return(e=void 0===e?!0:e)&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t}},function(t,e,n){var h=n(7),l={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function d(t,e){var n=this;if(n.vgap=n.hgap=0,t instanceof d)return t;n.data=t;var i=e.getHGap(t),r=e.getVGap(t);return n.preH=e.getPreH(t),n.preV=e.getPreV(t),n.width=e.getWidth(t),n.height=e.getHeight(t),n.width+=n.preH,n.height+=n.preV,n.id=e.getId(t),n.x=n.y=0,n.depth=0,n.children||(n.children=[]),n.addGap(i,r),n}h.assign(d.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){this.hgap+=t,this.vgap+=e,this.width+=2*t,this.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var e={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode(function(t){e.left=Math.min(e.left,t.x),e.top=Math.min(e.top,t.y),e.width=Math.max(e.width,t.x+t.width),e.height=Math.max(e.height,t.y+t.height)}),e},translate:function(e,n){void 0===e&&(e=0),void 0===n&&(n=0),this.eachNode(function(t){t.x+=e,t.y+=n,t.x+=t.preH,t.y+=t.preV})},right2left:function(){var e=this.getBoundingBox();this.eachNode(function(t){t.x=t.x-2*(t.x-e.left)-t.width}),this.translate(e.width,0)},bottom2top:function(){var e=this.getBoundingBox();this.eachNode(function(t){t.y=t.y-2*(t.y-e.top)-t.height}),this.translate(0,e.height)}}),t.exports=function(t,e,n){var i,r=new d(t,e=h.assign({},l,e=void 0===e?{}:e)),o=[r];if(!n&&!t.collapsed)for(;i=o.shift();)if(!i.data.collapsed){var a=e.getChildren(i.data),s=a?a.length:0;if(i.children=new Array(s),a&&s)for(var u=0;u<s;u++){var c=new d(a[u],e);i.children[u]=c,o.push(c),c.parent=i,c.depth=i.depth+1}}return r}},function(t,e,n){"use strict";var a=n(6),s=n(20);e.a=function(t,e){var n=Object(s.a)(e),i=n.length;if(Object(a.a)(t))return!i;for(var r=0;r<i;r+=1){var o=n[r];if(e[o]!==t[o]||!(o in t))return!1}return!0}},function(t,e,n){"use strict";var r=n(2),o=n(3),n=Object.keys?function(t){return Object.keys(t)}:function(n){var i=[];return Object(r.a)(n,function(t,e){Object(o.a)(n)&&"prototype"===e||i.push(e)}),i};e.a=n},function(t,e,n){"use strict";var a=n(1),s=Array.prototype.splice;e.a=function(t,e){if(!Object(a.a)(t))return[];for(var n=t?e.length:0,i=n-1;n--;){var r=void 0,o=e[n];n!==i&&o===r||s.call(t,r=o,1)}return t}},function(t,e,n){"use strict";var i=n(12),r=n(2);e.a=function(t){var e=[];return Object(r.a)(t,function(t){Object(i.a)(e,t)||e.push(t)}),e}},function(t,e,n){"use strict";var i=n(0),o=n(3),a=n(24);e.a=function(t,e){return e?(Object(o.a)(e)||(r=Object(i.a)(e)?e:e.replace(/\s+/g,"").split("*"),e=function(t){for(var e="_",n=0,i=r.length;n<i;n++)e+=t[r[n]]&&t[r[n]].toString();return e}),Object(a.a)(t,e)):{0:t};var r}},function(t,e,n){"use strict";var o=n(2),a=n(0),s=n(3),u=Object.prototype.hasOwnProperty;e.a=function(t,e){if(!e||!Object(a.a)(t))return{};var n,i={},r=Object(s.a)(e)?e:function(t){return t[e]};return Object(o.a)(t,function(t){n=r(t),u.call(i,n)?i[n].push(t):i[n]=[t]}),i}},function(t,e,n){"use strict";e.a=function(t,e){return t.hasOwnProperty(e)}},function(t,e,n){"use strict";var r=n(2),o=n(3),n=Object.values?function(t){return Object.values(t)}:function(n){var i=[];return Object(r.a)(n,function(t,e){Object(o.a)(n)&&"prototype"===e||i.push(t)}),i};e.a=n},function(t,e,n){"use strict";var i={}.toString;e.a=function(t){return i.call(t).replace(/^\[object /,"").replace(/]$/,"")}},function(t,e,n){"use strict";var i=Object.prototype;e.a=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e,n){"use strict";var a=n(15),s=n(1),u=n(8),c=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Object(u.a)(t)||Object(u.a)(e))return!1;if(Object(s.a)(t)||Object(s.a)(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=c(t[i],e[i]));i++);return n}if(Object(a.a)(t)||Object(a.a)(e)){var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(n=!0,i=0;i<r.length&&(n=c(t[r[i]],e[r[i]]));i++);return n}return!1};e.a=c},function(t,e,n){var c=n(18);t.exports=function(t,e){for(var n=c(t.data,e,!0),i=c(t.data,e,!0),r=t.children.length,o=Math.round(r/2),a=e.getSide||function(t,e){return e<o?"right":"left"},s=0;s<r;s++){var u=t.children[s];("right"===a(u,s)?i:n).children.push(u)}return n.eachNode(function(t){t.isRoot()||(t.side="left")}),i.eachNode(function(t){t.isRoot()||(t.side="right")}),{left:n,right:i}}},function(t,e,n){n={compactBox:n(32),dendrogram:n(114),indented:n(116),mindmap:n(118)};t.exports=n},function(t,e,n){var i=n(11),r=n(113),o=n(17),a=n(7),s=function(t){var e,n;function i(){return t.apply(this,arguments)||this}return n=t,(e=i).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n,i.prototype.execute=function(){return o(this.rootNode,this.options,r)},i}(i),u={};t.exports=function(t,e){return e=a.assign({},u,e),new s(t,e).execute()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12);n.d(e,"contains",function(){return i.a}),n.d(e,"includes",function(){return i.a});var r=n(34);n.d(e,"difference",function(){return r.a});var o=n(35);n.d(e,"find",function(){return o.a});var a=n(36);n.d(e,"findIndex",function(){return a.a});var s=n(37);n.d(e,"firstValue",function(){return s.a});var u=n(38);n.d(e,"flatten",function(){return u.a});var c=n(39);n.d(e,"flattenDeep",function(){return c.a});var h=n(40);n.d(e,"getRange",function(){return h.a});var l=n(41);n.d(e,"pull",function(){return l.a});var d=n(21);n.d(e,"pullAt",function(){return d.a});var f=n(42);n.d(e,"reduce",function(){return f.a});var p=n(43);n.d(e,"remove",function(){return p.a});var g=n(44);n.d(e,"sortBy",function(){return g.a});var v=n(45);n.d(e,"union",function(){return v.a});var y=n(22);n.d(e,"uniq",function(){return y.a});var m=n(46);n.d(e,"valuesOfKey",function(){return m.a});var x=n(47);n.d(e,"head",function(){return x.a});var b=n(48);n.d(e,"last",function(){return b.a});var E=n(49);n.d(e,"startsWith",function(){return E.a});var S=n(50);n.d(e,"endsWith",function(){return S.a});var w=n(14);n.d(e,"filter",function(){return w.a});var k=n(51);n.d(e,"every",function(){return k.a});var C=n(52);n.d(e,"some",function(){return C.a});var _=n(53);n.d(e,"group",function(){return _.a});var M=n(24);n.d(e,"groupBy",function(){return M.a});var I=n(23);n.d(e,"groupToMap",function(){return I.a});var T=n(54);n.d(e,"getWrapBehavior",function(){return T.a});var A=n(55);n.d(e,"wrapBehavior",function(){return A.a});var P=n(56);n.d(e,"number2color",function(){return P.a});var D=n(57);n.d(e,"parseRadius",function(){return D.a});var N=n(58);n.d(e,"clamp",function(){return N.a});var O=n(59);n.d(e,"fixedBase",function(){return O.a});var L=n(60);n.d(e,"isDecimal",function(){return L.a});var R=n(61);n.d(e,"isEven",function(){return R.a});var B=n(62);n.d(e,"isInteger",function(){return B.a});var G=n(63);n.d(e,"isNegative",function(){return G.a});var U=n(64);n.d(e,"isNumberEqual",function(){return U.a});var F=n(65);n.d(e,"isOdd",function(){return F.a});var z=n(66);n.d(e,"isPositive",function(){return z.a});var j=n(67);n.d(e,"maxBy",function(){return j.a});var W=n(68);n.d(e,"minBy",function(){return W.a});var X=n(69);n.d(e,"mod",function(){return X.a});var Z=n(70);n.d(e,"toDegree",function(){return Z.a});var V=n(71);n.d(e,"toInteger",function(){return V.a});var Y=n(72);n.d(e,"toRadian",function(){return Y.a});var H=n(73);n.d(e,"forIn",function(){return H.a});var q=n(25);n.d(e,"has",function(){return q.a});var K=n(74);n.d(e,"hasKey",function(){return K.a});var J=n(75);n.d(e,"hasValue",function(){return J.a});var Q=n(20);n.d(e,"keys",function(){return Q.a});var $=n(19);n.d(e,"isMatch",function(){return $.a});var tt=n(26);n.d(e,"values",function(){return tt.a});var et=n(76);n.d(e,"lowerCase",function(){return et.a});var nt=n(77);n.d(e,"lowerFirst",function(){return nt.a});var it=n(78);n.d(e,"substitute",function(){return it.a});var rt=n(79);n.d(e,"upperCase",function(){return rt.a});var ot=n(80);n.d(e,"upperFirst",function(){return ot.a});var at=n(27);n.d(e,"getType",function(){return at.a});var st=n(81);n.d(e,"isArguments",function(){return st.a});var ut=n(0);n.d(e,"isArray",function(){return ut.a});var ct=n(1);n.d(e,"isArrayLike",function(){return ct.a});var ht=n(82);n.d(e,"isBoolean",function(){return ht.a});var lt=n(83);n.d(e,"isDate",function(){return lt.a});var dt=n(84);n.d(e,"isError",function(){return dt.a});var ft=n(3);n.d(e,"isFunction",function(){return ft.a});var pt=n(85);n.d(e,"isFinite",function(){return pt.a});var gt=n(6);n.d(e,"isNil",function(){return gt.a});var vt=n(86);n.d(e,"isNull",function(){return vt.a});var yt=n(5);n.d(e,"isNumber",function(){return yt.a});var mt=n(13);n.d(e,"isObject",function(){return mt.a});var xt=n(15);n.d(e,"isObjectLike",function(){return xt.a});var bt=n(9);n.d(e,"isPlainObject",function(){return bt.a});var Et=n(28);n.d(e,"isPrototype",function(){return Et.a});var St=n(87);n.d(e,"isRegExp",function(){return St.a});var wt=n(8);n.d(e,"isString",function(){return wt.a});var kt=n(4);n.d(e,"isType",function(){return kt.a});var Ct=n(88);n.d(e,"isUndefined",function(){return Ct.a});var _t=n(89);n.d(e,"isElement",function(){return _t.a});var Mt=n(90);n.d(e,"requestAnimationFrame",function(){return Mt.a});var It=n(91);n.d(e,"clearAnimationFrame",function(){return It.a});var Tt=n(92);n.d(e,"augment",function(){return Tt.a});var At=n(93);n.d(e,"clone",function(){return At.a});var Pt=n(94);n.d(e,"debounce",function(){return Pt.a});var Dt=n(95);n.d(e,"memoize",function(){return Dt.a});var Nt=n(96);n.d(e,"deepMix",function(){return Nt.a});var Ot=n(2);n.d(e,"each",function(){return Ot.a});var Lt=n(97);n.d(e,"extend",function(){return Lt.a});var Rt=n(98);n.d(e,"indexOf",function(){return Rt.a});var Bt=n(99);n.d(e,"isEmpty",function(){return Bt.a});var Gt=n(29);n.d(e,"isEqual",function(){return Gt.a});var Ut=n(100);n.d(e,"isEqualWith",function(){return Ut.a});var Ft=n(101);n.d(e,"map",function(){return Ft.a});var zt=n(102);n.d(e,"mapValues",function(){return zt.a});var jt=n(16);n.d(e,"mix",function(){return jt.a}),n.d(e,"assign",function(){return jt.a});var Wt=n(103);n.d(e,"get",function(){return Wt.a});var Xt=n(104);n.d(e,"set",function(){return Xt.a});var Zt=n(105);n.d(e,"pick",function(){return Zt.a});var Vt=n(106);n.d(e,"throttle",function(){return Vt.a});var Yt=n(107);n.d(e,"toArray",function(){return Yt.a});var Ht=n(10);n.d(e,"toString",function(){return Ht.a});var qt=n(108);n.d(e,"uniqueId",function(){return qt.a});var Kt=n(109);n.d(e,"noop",function(){return Kt.a});var Jt=n(110);n.d(e,"identity",function(){return Jt.a});var Qt=n(111);n.d(e,"size",function(){return Qt.a});var $t=n(112);n.d(e,"Cache",function(){return $t.a})},function(t,e,n){"use strict";var i=n(14),r=n(12);e.a=function(t,e){return void 0===e&&(e=[]),Object(i.a)(t,function(t){return!Object(r.a)(e,t)})}},function(t,e,n){"use strict";var r=n(3),o=n(19),a=n(0),s=n(9);e.a=function(t,e){if(!Object(a.a)(t))return null;var n;if(Object(r.a)(e)&&(n=e),n=Object(s.a)(e)?function(t){return Object(o.a)(t,e)}:n)for(var i=0;i<t.length;i+=1)if(n(t[i]))return t[i];return null}},function(t,e,n){"use strict";e.a=function(t,e,n){for(var i=n=void 0===n?0:n;i<t.length;i++)if(e(t[i],i))return i;return-1}},function(t,e,n){"use strict";var o=n(6),a=n(0);e.a=function(t,e){for(var n=null,i=0;i<t.length;i++){var r=t[i][e];if(!Object(o.a)(r)){n=Object(a.a)(r)?r[0]:r;break}}return n}},function(t,e,n){"use strict";var i=n(0);e.a=function(t){if(!Object(i.a)(t))return[];for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);return e}},function(t,e,n){"use strict";var i=n(0),r=function(t,e){if(void 0===e&&(e=[]),Object(i.a)(t))for(var n=0;n<t.length;n+=1)r(t[n],e);else e.push(t);return e};e.a=r},function(t,e,n){"use strict";var r=n(0),o=n(14);e.a=function(t){if(!(t=Object(o.a)(t,function(t){return!isNaN(t)})).length)return{min:0,max:0};if(Object(r.a)(t[0])){for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);t=e}var i=Math.max.apply(null,t);return{min:Math.min.apply(null,t),max:i}}},function(t,e,n){"use strict";var i=Array.prototype,a=i.splice,s=i.indexOf;e.a=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i++)for(var r,o=e[i];-1<(r=s.call(t,o));)a.call(t,r,1);return t}},function(t,e,n){"use strict";var r=n(2),o=n(0),a=n(9);e.a=function(t,n,e){if(!Object(o.a)(t)&&!Object(a.a)(t))return t;var i=e;return Object(r.a)(t,function(t,e){i=n(i,t,e)}),i}},function(t,e,n){"use strict";var s=n(1),u=n(21);e.a=function(t,e){var n=[];if(!Object(s.a)(t))return n;for(var i=-1,r=[],o=t.length;++i<o;){var a=t[i];e(a,i,t)&&(n.push(a),r.push(i))}return Object(u.a)(t,r),n}},function(t,e,n){"use strict";var i=n(0),o=n(8),a=n(3);e.a=function(t,n){var r,e=Object(a.a)(n)?function(t,e){return n(t)-n(e)}:(r=[],Object(o.a)(n)?r.push(n):Object(i.a)(n)&&(r=n),function(t,e){for(var n=0;n<r.length;n+=1){var i=r[n];if(t[i]>e[i])return 1;if(t[i]<e[i])return-1}return 0});return t.sort(e),t}},function(t,e,n){"use strict";var i=n(22);e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(i.a)([].concat.apply([],t))}},function(t,e,n){"use strict";var r=n(2),o=n(0),a=n(6);e.a=function(t,e){var n=[],i={};return t.forEach(function(t){t=t[e];Object(a.a)(t)||(Object(o.a)(t)||(t=[t]),Object(r.a)(t,function(t){i[t]||(n.push(t),i[t]=!0)}))}),n}},function(t,e,n){"use strict";e.a=function(t){if(Object(i.a)(t))return t[0];return};var i=n(1)},function(t,e,n){"use strict";e.a=function(t){if(Object(i.a)(t))return t[t.length-1];return};var i=n(1)},function(t,e,n){"use strict";var i=n(0),r=n(8);e.a=function(t,e){return!(!Object(i.a)(t)&&!Object(r.a)(t))&&t[0]===e}},function(t,e,n){"use strict";var i=n(0),r=n(8);e.a=function(t,e){return!(!Object(i.a)(t)&&!Object(r.a)(t))&&t[t.length-1]===e}},function(t,e,n){"use strict";e.a=function(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n))return!1;return!0}},function(t,e,n){"use strict";e.a=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n))return!0;return!1}},function(t,e,n){"use strict";var o=n(23);e.a=function(t,e){if(!e)return[t];var n,i=Object(o.a)(t,e),r=[];for(n in i)r.push(i[n]);return r}},function(t,e,n){"use strict";e.a=function(t,e){return t["_wrap_"+e]}},function(t,e,n){"use strict";e.a=function(e,n){return e["_wrap_"+n]||(e["_wrap_"+n]=t);function t(t){e[n](t)}}},function(t,e,n){"use strict";var r={};e.a=function(t){var e=r[t];if(!e){for(var n=t.toString(16),i=n.length;i<6;i++)n="0"+n;r[t]=e="#"+n}return e}},function(t,e,n){"use strict";var o=n(0);e.a=function(t){var e=0,n=0,i=0,r=0;return Object(o.a)(t)?1===t.length?e=n=i=r=t[0]:2===t.length?(e=i=t[0],n=r=t[1]):3===t.length?(e=t[0],n=r=t[1],i=t[2]):(e=t[0],n=t[1],i=t[2],r=t[3]):e=n=i=r=t,{r1:e,r2:n,r3:i,r4:r}}},function(t,e,n){"use strict";e.a=function(t,e,n){return t<e?e:n<t?n:t}},function(t,e,n){"use strict";e.a=function(t,e){var n=e.toString(),e=n.indexOf(".");if(-1===e)return Math.round(t);e=n.substr(e+1).length;return 20<e&&(e=20),parseFloat(t.toFixed(e))}},function(t,e,n){"use strict";var i=n(5);e.a=function(t){return Object(i.a)(t)&&t%1!=0}},function(t,e,n){"use strict";var i=n(5);e.a=function(t){return Object(i.a)(t)&&t%2==0}},function(t,e,n){"use strict";var i=n(5),n=Number.isInteger||function(t){return Object(i.a)(t)&&t%1==0};e.a=n},function(t,e,n){"use strict";var i=n(5);e.a=function(t){return Object(i.a)(t)&&t<0}},function(t,e,n){"use strict";e.a=function(t,e,n){void 0===n&&(n=i);return Math.abs(t-e)<n};var i=1e-5},function(t,e,n){"use strict";var i=n(5);e.a=function(t){return Object(i.a)(t)&&t%2!=0}},function(t,e,n){"use strict";var i=n(5);e.a=function(t){return Object(i.a)(t)&&0<t}},function(t,e,n){"use strict";var o=n(2),a=n(0),s=n(3);e.a=function(t,e){if(Object(a.a)(t)){var n,i=t[0],r=Object(s.a)(e)?e(t[0]):t[0][e];return Object(o.a)(t,function(t){n=Object(s.a)(e)?e(t):t[e],r<n&&(i=t,r=n)}),i}}},function(t,e,n){"use strict";var o=n(2),a=n(0),s=n(3);e.a=function(t,e){if(Object(a.a)(t)){var n,i=t[0],r=Object(s.a)(e)?e(t[0]):t[0][e];return Object(o.a)(t,function(t){(n=Object(s.a)(e)?e(t):t[e])<r&&(i=t,r=n)}),i}}},function(t,e,n){"use strict";e.a=function(t,e){return(t%e+e)%e}},function(t,e,n){"use strict";var i=180/Math.PI;e.a=function(t){return i*t}},function(t,e,n){"use strict";e.a=parseInt},function(t,e,n){"use strict";var i=Math.PI/180;e.a=function(t){return i*t}},function(t,e,n){"use strict";n=n(2);e.a=n.a},function(t,e,n){"use strict";n=n(25);e.a=n.a},function(t,e,n){"use strict";var i=n(12),r=n(26);e.a=function(t,e){return Object(i.a)(Object(r.a)(t),e)}},function(t,e,n){"use strict";var i=n(10);e.a=function(t){return Object(i.a)(t).toLowerCase()}},function(t,e,n){"use strict";var i=n(10);e.a=function(t){t=Object(i.a)(t);return t.charAt(0).toLowerCase()+t.substring(1)}},function(t,e,n){"use strict";e.a=function(t,n){return t&&n?t.replace(/\\?\{([^{}]+)\}/g,function(t,e){return"\\"===t.charAt(0)?t.slice(1):void 0===n[e]?"":n[e]}):t}},function(t,e,n){"use strict";var i=n(10);e.a=function(t){return Object(i.a)(t).toUpperCase()}},function(t,e,n){"use strict";var i=n(10);e.a=function(t){t=Object(i.a)(t);return t.charAt(0).toUpperCase()+t.substring(1)}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"Arguments")}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"Boolean")}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"Date")}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"Error")}},function(t,e,n){"use strict";var i=n(5);e.a=function(t){return Object(i.a)(t)&&isFinite(t)}},function(t,e,n){"use strict";e.a=function(t){return null===t}},function(t,e,n){"use strict";var i=n(4);e.a=function(t){return Object(i.a)(t,"RegExp")}},function(t,e,n){"use strict";e.a=function(t){return void 0===t}},function(t,e,n){"use strict";e.a=function(t){return t instanceof Element||t instanceof HTMLDocument}},function(t,e,n){"use strict";e.a=function(t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)})(t)}},function(t,e,n){"use strict";e.a=function(t){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(t)}},function(t,e,n){"use strict";var o=n(16),a=n(3);e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],i=1;i<t.length;i++){var r=t[i];Object(a.a)(r)&&(r=r.prototype),Object(o.a)(n.prototype,r)}}},function(t,e,n){"use strict";var o=n(0),a=function(t){if("object"!=typeof t||null===t)return t;if(Object(o.a)(t))for(var e=[],n=0,i=t.length;n<i;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=a(t[n]):e[n]=t[n];else for(var r in e={},t)"object"==typeof t[r]&&null!=t[r]?e[r]=a(t[r]):e[r]=t[r];return e};e.a=a},function(t,e,n){"use strict";e.a=function(i,r,o){var a;return function(){var t=this,e=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||i.apply(t,e)},r),n&&i.apply(t,e)}}},function(t,e,n){"use strict";var i=n(3);e.a=function(o,a){if(!Object(i.a)(o))throw new TypeError("Expected a function");var s=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=a?a.apply(this,t):t[0],i=s.cache;if(i.has(n))return i.get(n);var r=o.apply(this,t);return i.set(n,r),r};return s.cache=new Map,s}},function(t,e,n){"use strict";var s=n(0),u=n(9),c=5;e.a=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i+=1)!function t(e,n,i,r){for(var o in i=i||0,r=r||c,n){var a;n.hasOwnProperty(o)&&(null!==(a=n[o])&&Object(u.a)(a)?(Object(u.a)(e[o])||(e[o]={}),i<r?t(e[o],a,i+1,r):e[o]=n[o]):Object(s.a)(a)?(e[o]=[],e[o]=e[o].concat(a)):void 0!==a&&(e[o]=a))}}(t,e[i]);return t}},function(t,e,n){"use strict";var a=n(16),s=n(3);e.a=function(t,e,n,i){Object(s.a)(e)||(n=e,e=t,t=function(){});var r=Object.create?function(t,e){return Object.create(t,{constructor:{value:e}})}:function(t,e){function n(){}n.prototype=t;t=new n;return t.constructor=e,t},o=r(e.prototype,t);return t.prototype=Object(a.a)(o,t.prototype),t.superclass=r(e.prototype,e),Object(a.a)(o,n),Object(a.a)(t,i),t}},function(t,e,n){"use strict";var o=n(1);e.a=function(t,e){if(!Object(o.a)(t))return-1;var n=Array.prototype.indexOf;if(n)return n.call(t,e);for(var i=-1,r=0;r<t.length;r++)if(t[r]===e){i=r;break}return i}},function(t,e,n){"use strict";var i=n(6),r=n(1),o=n(27),a=n(28),s=Object.prototype.hasOwnProperty;e.a=function(t){if(Object(i.a)(t))return!0;if(Object(r.a)(t))return!t.length;var e,n=Object(o.a)(t);if("Map"===n||"Set"===n)return!t.size;if(Object(a.a)(t))return!Object.keys(t).length;for(e in t)if(s.call(t,e))return!1;return!0}},function(t,e,n){"use strict";var i=n(3),r=n(29);e.a=function(t,e,n){return Object(i.a)(n)?!!n(t,e):Object(r.a)(t,e)}},function(t,e,n){"use strict";var r=n(2),o=n(1);e.a=function(t,n){if(!Object(o.a)(t))return t;var i=[];return Object(r.a)(t,function(t,e){i.push(n(t,e))}),i}},function(t,e,n){"use strict";function r(t){return t}var o=n(6),a=n(13);e.a=function(e,n){void 0===n&&(n=r);var i={};return Object(a.a)(e)&&!Object(o.a)(e)&&Object.keys(e).forEach(function(t){i[t]=n(e[t],t)}),i}},function(t,e,n){"use strict";var o=n(8);e.a=function(t,e,n){for(var i=0,r=Object(o.a)(e)?e.split("."):e;t&&i<r.length;)t=t[r[i++]];return void 0===t||i<r.length?n:t}},function(t,e,n){"use strict";var o=n(13),a=n(8),s=n(5);e.a=function(t,e,n){var i=t,r=Object(a.a)(e)?e.split("."):e;return r.forEach(function(t,e){e<r.length-1?(Object(o.a)(i[t])||(i[t]=Object(s.a)(r[e+1])?[]:{}),i=i[t]):i[t]=n}),t}},function(t,e,n){"use strict";var i=n(2),r=n(9),o=Object.prototype.hasOwnProperty;e.a=function(e,t){if(null===e||!Object(r.a)(e))return{};var n={};return Object(i.a)(t,function(t){o.call(e,t)&&(n[t]=e[t])}),n}},function(t,e,n){"use strict";e.a=function(n,i,r){var o,a,s,u,c=0;r=r||{};function h(){c=!1===r.leading?0:Date.now(),o=null,u=n.apply(a,s),o||(a=s=null)}function t(){var t=Date.now();c||!1!==r.leading||(c=t);var e=i-(t-c);return a=this,s=arguments,e<=0||i<e?(o&&(clearTimeout(o),o=null),c=t,u=n.apply(a,s),o||(a=s=null)):o||!1===r.trailing||(o=setTimeout(h,e)),u}return t.cancel=function(){clearTimeout(o),c=0,o=a=s=null},t}},function(t,e,n){"use strict";var i=n(1);e.a=function(t){return Object(i.a)(t)?Array.prototype.slice.call(t):[]}},function(t,e,n){"use strict";var i={};e.a=function(t){return i[t=t||"g"]?i[t]+=1:i[t]=1,t+i[t]}},function(t,e,n){"use strict";e.a=function(){}},function(t,e,n){"use strict";e.a=function(t){return t}},function(t,e,n){"use strict";e.a=function(t){if(Object(i.a)(t))return 0;if(Object(r.a)(t))return t.length;return Object.keys(t).length};var i=n(6),r=n(1)},function(t,e,n){"use strict";var i=(r.prototype.has=function(t){return void 0!==this.map[t]},r.prototype.get=function(t,e){t=this.map[t];return void 0===t?e:t},r.prototype.set=function(t,e){this.map[t]=e},r.prototype.clear=function(){this.map={}},r.prototype.delete=function(t){delete this.map[t]},r.prototype.size=function(){return Object.keys(this.map).length},r);function r(){this.map={}}e.a=i},function(t,e){function i(t,e,n,i){void 0===i&&(i=[]);var r=this;r.w=t||0,r.h=e||0,r.y=n||0,r.x=0,r.c=i||[],r.cs=i.length,r.prelim=0,r.mod=0,r.shift=0,r.change=0,r.tl=null,r.tr=null,r.el=null,r.er=null,r.msel=0,r.mser=0}function r(t,e){!function e(t,n,i){i?t.y+=n:t.x+=n,t.children.forEach(function(t){e(t,n,i)})}(t,-function e(t,n){var i=n?t.y:t.x;return t.children.forEach(function(t){i=Math.min(e(t,n),i)}),i}(t,e),e)}i.fromNode=function(t,e){if(!t)return null;var n=[];return t.children.forEach(function(t){n.push(i.fromNode(t,e))}),e?new i(t.height,t.width,t.x,n):new i(t.width,t.height,t.y,n)},t.exports=function(t,e){var n=(e=void 0===e?{}:e).isHorizontal;function a(t){0===t.cs?((t.el=t).er=t).msel=t.mser=0:(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function c(t){return t.y+t.h}function s(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}!function e(t,n,i){void 0===i&&(i=0),n?(t.x=i,i+=t.width):(t.y=i,i+=t.height),t.children.forEach(function(t){e(t,n,i)})}(t,n);e=i.fromNode(t,n);return function t(e){if(0!==e.cs){t(e.c[0]);for(var n,i=s(c(e.c[0].el),0,null),r=1;r<e.cs;++r){t(e.c[r]);var o=c(e.c[r].er);!function(t,e,n){for(var i=t.c[e-1],r=i.mod,o=t.c[e],a=o.mod;null!==i&&null!==o;){c(i)>n.low&&(n=n.nxt);var s=r+i.prelim+i.w-(a+o.prelim);0<s&&(a+=s,function(t,e,n,i){t.c[e].mod+=i,t.c[e].msel+=i,t.c[e].mser+=i,function(t,e,n,i){var r;n!==e-1&&(r=e-n,t.c[n+1].shift+=i/r,t.c[e].shift-=i/r,t.c[e].change-=i-i/r)}(t,e,n,i)}(t,e,n.index,s));var u=c(i),s=c(o);u<=s&&null!==(i=function(t){return 0===t.cs?t.tr:t.c[t.cs-1]}(i))&&(r+=i.mod),s<=u&&null!==(o=function(t){return 0===t.cs?t.tl:t.c[0]}(o))&&(a+=o.mod)}!i&&o?function(t,e,n,i){var r=t.c[0].el;r.tl=n,n=i-n.mod-t.c[0].msel,r.mod+=n,r.prelim-=n,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,o,a):i&&!o&&function(t,e,n,i){var r=t.c[e].er;r.tr=n,n=i-n.mod-t.c[e].mser,r.mod+=n,r.prelim-=n,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,i,r)}(e,r,i),i=s(o,r,i)}(n=e).prelim=(n.c[0].prelim+n.c[0].mod+n.c[n.cs-1].mod+n.c[n.cs-1].prelim+n.c[n.cs-1].w)/2-n.w/2,a(e)}else a(e)}(e),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,i=0;i<t.cs;i++)e+=t.c[i].shift,n+=e+t.c[i].change,t.c[i].mod+=n}(e);for(var i=0;i<e.cs;i++)t(e.c[i],n)}(e,0),function n(t,i,r){r?i.y=t.x:i.x=t.x,t.c.forEach(function(t,e){n(t,i.children[e],r)})}(e,t,n),r(t,n),t}},function(t,e,n){var i=n(11),r=n(115),o=n(17),a=n(7),s=function(t){var e,n;function i(){return t.apply(this,arguments)||this}return n=t,(e=i).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n,i.prototype.execute=function(){return this.rootNode.width=0,o(this.rootNode,this.options,r)},i}(i),u={};t.exports=function(t,e){return e=a.assign({},u,e),new s(t,e).execute()}},function(t,e,n){var r=n(7);function a(t,e){void 0===t&&(t=0),void 0===e&&(e=[]);this.x=this.y=0,this.leftChild=this.rightChild=null,this.height=0,this.children=e}var s={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};t.exports=function(t,n){n=r.assign({},s,n=void 0===n?{}:n);var i,o=0;var e=function n(t){if(!t)return null;t.width=0,t.depth&&t.depth>o&&(o=t.depth);var e=t.children,i=e.length,r=new a(t.height,[]);return e.forEach(function(t,e){t=n(t),r.children.push(t),0===e&&(r.leftChild=t),e===i-1&&(r.rightChild=t)}),r.originNode=t,r.isLeaf=t.isLeaf(),r}(t);return function t(e){var n;return e.isLeaf||0===e.children.length?e.drawingDepth=o:(n=e.children.map(t),n=Math.min.apply(null,n),e.drawingDepth=n-1),e.drawingDepth}(e),function e(t){t.x=t.drawingDepth*n.rankSep,t.isLeaf?(t.y=0,i&&(t.y=i.y+i.height+n.nodeSep,t.originNode.parent!==i.originNode.parent&&(t.y+=n.subTreeSep)),i=t):(t.children.forEach(function(t){e(t)}),t.y=(t.leftChild.y+t.rightChild.y)/2)}(e),function n(t,i,r){r?(i.x=t.x,i.y=t.y):(i.x=t.y,i.y=t.x),t.children.forEach(function(t,e){n(t,i.children[e],r)})}(e,t,n.isHorizontal),t}},function(t,e,n){var i=n(11),o=n(117),a=n(30),r=n(7),s=["LR","RL","H"],u=s[0],c=function(t){var e,n;function i(){return t.apply(this,arguments)||this}return n=t,(e=i).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n,i.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,i=void 0===n?20:n,r=t.dropCap,n=void 0===r||r,r=t.direction||u;if(r&&-1===s.indexOf(r))throw new TypeError("Invalid direction: "+r);return r===s[0]?o(e,i,n):r===s[1]?(o(e,i,n),e.right2left()):r===s[2]&&(t=(r=a(e,t)).left,r=r.right,o(t,i,n),t.right2left(),o(r,i,n),t=t.getBoundingBox(),r.translate(t.width,0),e.x=r.x-e.width/2),e},i}(i),h={};t.exports=function(t,e){return e=r.assign({},h,e),new c(t,e).execute()}},function(t,e){t.exports=function(t,e,n){var i=null;t.eachNode(function(t){!function(t,e,n,i){if(!i)try{if(t.id===t.parent.children[0].id)return t.x+=n*t.depth,t.y=e?e.y:0}catch(t){}t.x+=n*t.depth,t.y=e?e.y+e.height:0}(t,i,e,n),i=t})}},function(t,e,n){var i=n(11),r=n(119),o=n(17),a=n(7),s=function(t){var e,n;function i(){return t.apply(this,arguments)||this}return n=t,(e=i).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n,i.prototype.execute=function(){return o(this.rootNode,this.options,r)},i}(i),u={};t.exports=function(t,e){return e=a.assign({},u,e),new s(t,e).execute()}},function(t,e,n){var i=n(7);var r={getSubTreeSep:function(){return 0}};t.exports=function(t,e){e=i.assign({},r,e=void 0===e?{}:e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse(function(t){t.x=t.parent.x+t.parent.width}),t.parent=null,function e(t,n){var i=0;return t.children.length?t.children.forEach(function(t){i+=e(t,n)}):i=t.height,t._subTreeSep=n.getSubTreeSep(t.data),t.totalHeight=Math.max(t.height,i)+2*t._subTreeSep,t.totalHeight}(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode(function(t){var e=t.children,n=e.length;if(n){var i=e[0];if(i.startY=t.startY+t._subTreeSep,1===n)i.y=t.y+t.height/2-i.height/2;else{i.y=i.startY+i.totalHeight/2-i.height/2;for(var r=1;r<n;r++){var o=e[r];o.startY=e[r-1].startY+e[r-1].totalHeight,o.y=o.startY+o.totalHeight/2-o.height/2}}}}),function e(t){var n,i,r,o,a=t.children,s=a.length;s&&(a.forEach(function(t){e(t)}),n=a[0],s=(i=a[s-1]).y-n.y+i.height,r=0,a.forEach(function(t){r+=t.totalHeight}),s>t.height?t.y=n.y+s/2-t.height/2:1!==a.length||t.height>r?(o=t.y+(t.height-s)/2-n.y,a.forEach(function(t){t.translate(0,o)})):t.y=(n.y+n.height/2+i.y+i.height/2)/2-t.height/2)}(t)}}],i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=31);function i(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n,r},t.exports=e()}}]);