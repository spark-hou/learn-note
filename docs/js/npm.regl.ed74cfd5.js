(self.webpackChunklearn_note=self.webpackChunklearn_note||[]).push([[902],{81550:function(e){e.exports=function(){"use strict";var ne=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},ue=function(e,r){var t=Object.keys(r);for(var n=0;n<t.length;++n)e[t[n]]=r[t[n]];return e},s="\n";function c(e){if(typeof atob!=="undefined")return atob(e);return"base64:"+e}function n(e){var r=new Error("(regl) "+e);console.error(r);throw r}function p(e,r){if(!e)n(r)}function a(e){if(e)return": "+e;return""}function e(e,r,t){if(!(e in r))n("unknown parameter ("+e+")"+a(t)+". possible values: "+Object.keys(r).join())}function r(e,r){if(!ne(e))n("invalid parameter type"+a(r)+". must be a typed array")}function i(e,r){switch(r){case"number":return typeof e==="number";case"object":return typeof e==="object";case"string":return typeof e==="string";case"boolean":return typeof e==="boolean";case"function":return typeof e==="function";case"undefined":return typeof e==="undefined";case"symbol":return typeof e==="symbol"}}function t(e,r,t){if(!i(e,r))n("invalid parameter type"+a(t)+". expected "+r+", got "+typeof e)}function f(e,r){if(!(e>=0&&(e|0)===e))n("invalid parameter type, ("+e+")"+a(r)+". must be a nonnegative integer")}function o(e,r,t){if(r.indexOf(e)<0)n("invalid value"+a(t)+". must be one of: "+r)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function l(e){Object.keys(e).forEach(function(e){if(u.indexOf(e)<0)n('invalid regl constructor argument "'+e+'". must be one of '+u)})}function d(e,r){e=e+"";while(e.length<r)e=" "+e;return e}function m(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=false}function v(e,r){this.number=e;this.line=r;this.errors=[]}function h(e,r,t){this.file=e;this.line=r;this.message=t}function b(){var e=new Error;var r=(e.stack||e).toString();var t=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(r);if(t)return t[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(r);if(n)return n[1];return"unknown"}function g(){var e=new Error;var r=(e.stack||e).toString();var t=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(r);if(t)return t[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(r);if(n)return n[1];return"unknown"}function y(e,r){var t=e.split("\n");var n=1;var a=0;var i={unknown:new m,0:new m};i.unknown.name=i[0].name=r||b();i.unknown.lines.push(new v(0,""));for(var f=0;f<t.length;++f){var o=t[f];var u=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(o);if(u)switch(u[1]){case"line":var s=/(\d+)(\s+\d+)?/.exec(u[2]);if(s){n=s[1]|0;if(s[2]){a=s[2]|0;if(!(a in i))i[a]=new m}}break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);if(l)i[a].name=l[1]?c(l[2]):l[2];break}i[a].lines.push(new v(n++,o))}Object.keys(i).forEach(function(e){var r=i[e];r.lines.forEach(function(e){r.index[e.number]=e})});return i}function x(e){var t=[];e.split("\n").forEach(function(e){if(e.length<5)return;var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);if(r)t.push(new h(r[1]|0,r[2]|0,r[3].trim()));else if(e.length>0)t.push(new h("unknown",0,e))});return t}function w(n,e){e.forEach(function(e){var r=n[e.file];if(r){var t=r.index[e.line];if(t){t.errors.push(e);r.hasErrors=true;return}}n.unknown.hasErrors=true;n.unknown.lines[0].errors.push(e)})}function A(e,r,t,n,a){if(!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);var f=n===e.FRAGMENT_SHADER?"fragment":"vertex";D(t,"string",f+" shader source must be a string",a);var o=y(t,a);var u=x(i);w(o,u);Object.keys(o).forEach(function(e){var r=o[e];if(!r.hasErrors)return;var t=[""];var n=[""];function f(e,r){t.push(e);n.push(r||"")}f("file number "+e+": "+r.name+"\n","color:red;text-decoration:underline;font-weight:bold");r.lines.forEach(function(a){if(a.errors.length>0){f(d(a.number,4)+"|  ","background-color:yellow; font-weight:bold");f(a.line+s,"color:red; background-color:yellow; font-weight:bold");var i=0;a.errors.forEach(function(e){var r=e.message;var t=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(t){var n=t[1];r=t[2];switch(n){case"assign":n="=";break}i=Math.max(a.line.indexOf(n,i),0)}else i=0;f(d("| ",6));f(d("^^^",i+3)+s,"font-weight:bold");f(d("| ",6));f(r+s,"font-weight:bold")});f(d("| ",6)+s)}else{f(d(a.number,4)+"|  ");f(a.line+s,"color:red")}});if(typeof document!=="undefined"&&!window.chrome){n[0]=t.join("%c");console.log.apply(console,n)}else console.log(t.join(""))});p.raise("Error compiling "+f+" shader, "+o[0].name)}}function k(e,r,t,n,a){if(!e.getProgramParameter(r,e.LINK_STATUS)){var i=e.getProgramInfoLog(r);var f=y(t,a);var o=y(n,a);var u='Error linking program with vertex shader, "'+o[0].name+'", and fragment shader "'+f[0].name+'"';if(typeof document!=="undefined")console.log("%c"+u+s+"%c"+i,"color:red;text-decoration:underline;font-weight:bold","color:red");else console.log(u+s+i);p.raise(u)}}function _(e){e._commandRef=b()}function S(e,r,t,n){_(e);function a(e){if(e)return n.id(e);return 0}e._fragId=a(e.static.frag);e._vertId=a(e.static.vert);function i(r,e){Object.keys(e).forEach(function(e){r[n.id(e)]=true})}var f=e._uniformSet={};i(f,r.static);i(f,r.dynamic);var o=e._attributeSet={};i(o,t.static);i(o,t.dynamic);e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function O(e,r){var t=g();n(e+" in command "+(r||b())+(t==="unknown"?"":" called from "+t))}function E(e,r,t){if(!e)O(r,t||b())}function T(e,r,t,n){if(!(e in r))O("unknown parameter ("+e+")"+a(t)+". possible values: "+Object.keys(r).join(),n||b())}function D(e,r,t,n){if(!i(e,r))O("invalid parameter type"+a(t)+". expected "+r+", got "+typeof e,n||b())}function j(e){e()}function C(e,r,t){if(e.texture)o(e.texture._texture.internalformat,r,"unsupported texture format for attachment");else o(e.renderbuffer._renderbuffer.format,t,"unsupported renderbuffer format for attachment")}var z=33071,F=9728,B=9984,V=9985,I=9986,P=9987,L,R,M=5122,U=5123,W=5124,G=5125,H=5126,N=32819,q=32820,Q=33635,Y=34042,X=36193,$={};function K(e,r){if(e===q||e===N||e===Q)return 2;else if(e===Y)return 4;else return $[e]*r}function J(e){return!(e&e-1)&&!!e}function Z(e,r,t){var n;var a=r.width;var i=r.height;var f=r.channels;p(a>0&&a<=t.maxTextureSize&&i>0&&i<=t.maxTextureSize,"invalid texture shape");if(e.wrapS!==z||e.wrapT!==z)p(J(a)&&J(i),"incompatible wrap mode for texture, both width and height must be power of 2");if(r.mipmask===1){if(a!==1&&i!==1)p(e.minFilter!==B&&e.minFilter!==I&&e.minFilter!==V&&e.minFilter!==P,"min filter requires mipmap")}else{p(J(a)&&J(i),"texture must be a square power of 2 to support mipmapping");p(r.mipmask===(a<<1)-1,"missing or incomplete mipmap data")}if(r.type===H){if(t.extensions.indexOf("oes_texture_float_linear")<0)p(e.minFilter===F&&e.magFilter===F,"filter not supported, must enable oes_texture_float_linear");p(!e.genMipmaps,"mipmap generation not supported with float textures")}var o=r.images;for(n=0;n<16;++n)if(o[n]){var u=a>>n;var s=i>>n;p(r.mipmask&1<<n,"missing mipmap data");var l=o[n];p(l.width===u&&l.height===s,"invalid shape for mip images");p(l.format===r.format&&l.internalformat===r.internalformat&&l.type===r.type,"incompatible type for mip image");if(l.compressed);else if(l.data){var c=Math.ceil(K(l.type,f)*u/l.unpackAlignment)*l.unpackAlignment;p(l.data.byteLength===c*s,"invalid data for image, buffer size is inconsistent with image format")}else if(l.element);else if(l.copy);}else if(!e.genMipmaps)p((r.mipmask&1<<n)===0,"extra mipmap data");if(r.compressed)p(!e.genMipmaps,"mipmap generation for compressed images not supported")}function ee(e,r,t,n){var a=e.width;var i=e.height;var f=e.channels;p(a>0&&a<=n.maxTextureSize&&i>0&&i<=n.maxTextureSize,"invalid texture shape");p(a===i,"cube map must be square");p(r.wrapS===z&&r.wrapT===z,"wrap mode not supported by cube map");for(var o=0;o<t.length;++o){var u=t[o];p(u.width===a&&u.height===i,"inconsistent cube map face shape");if(r.genMipmaps){p(!u.compressed,"can not generate mipmap for compressed textures");p(u.mipmask===1,"can not specify mipmaps and generate mipmaps")}else;var s=u.images;for(var l=0;l<16;++l){var c=s[l];if(c){var d=a>>l;var m=i>>l;p(u.mipmask&1<<l,"missing mipmap data");p(c.width===d&&c.height===m,"invalid shape for mip images");p(c.format===e.format&&c.internalformat===e.internalformat&&c.type===e.type,"incompatible type for mip image");if(c.compressed);else if(c.data)p(c.data.byteLength===d*m*Math.max(K(c.type,f),c.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format");else if(c.element);else if(c.copy);}}}}$[5120]=$[5121]=1,$[M]=$[U]=$[X]=$[Q]=$[N]=$[q]=2,$[W]=$[G]=$[H]=$[Y]=4;var se=ue(p,{optional:j,raise:n,commandRaise:O,command:E,parameter:e,commandParameter:T,constructor:l,type:t,commandType:D,isTypedArray:r,nni:f,oneOf:o,shaderError:A,linkError:k,callSite:g,saveCommandRef:_,saveDrawInfo:S,framebufferFormat:C,guessCommand:b,texture2D:Z,textureCube:ee}),re=0,te=0,ae=5,ie=6;function fe(e,r){this.id=re++;this.type=e;this.data=r}function oe(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function le(e){if(e.length===0)return[];var r=e.charAt(0);var t=e.charAt(e.length-1);if(e.length>1&&r===t&&(r==='"'||r==="'"))return['"'+oe(e.substr(1,e.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(n)return le(e.substr(0,n.index)).concat(le(n[1])).concat(le(e.substr(n.index+n[0].length)));var a=e.split(".");if(a.length===1)return['"'+oe(e)+'"'];var i=[];for(var f=0;f<a.length;++f)i=i.concat(le(a[f]));return i}function ce(e){return"["+le(e).join("][")+"]"}function de(e,r){return new fe(e,ce(r+""))}function me(e){return typeof e==="function"&&!e._reglType||e instanceof fe}function pe(e,t){if(typeof e==="function")return new fe(te,e);else if(typeof e==="number"||typeof e==="boolean")return new fe(ae,e);else if(Array.isArray(e))return new fe(ie,e.map((e,r)=>pe(e,t+"["+r+"]")));else if(e instanceof fe)return e;se(false,"invalid option type in uniform "+t)}var ve={DynamicVariable:fe,define:de,isDynamic:me,unbox:pe,accessor:ce},he={next:typeof requestAnimationFrame==="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame==="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},be=typeof performance!=="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ge(){var t={"":0};var n=[""];return{id:function(e){var r=t[e];if(r)return r;r=t[e]=n.length;n.push(e);return r},str:function(e){return n[e]}}}function ye(n,e,a){var i=document.createElement("canvas");ue(i.style,{border:0,margin:0,padding:0,top:0,left:0});n.appendChild(i);if(n===document.body){i.style.position="absolute";ue(n.style,{margin:0,padding:0})}function r(){var e=window.innerWidth;var r=window.innerHeight;if(n!==document.body){var t=n.getBoundingClientRect();e=t.right-t.left;r=t.bottom-t.top}i.width=a*e;i.height=a*r;ue(i.style,{width:e+"px",height:r+"px"})}var t;if(n!==document.body&&typeof ResizeObserver==="function"){t=new ResizeObserver(function(){setTimeout(r)});t.observe(n)}else window.addEventListener("resize",r,false);function f(){if(t)t.disconnect();else window.removeEventListener("resize",r);n.removeChild(i)}r();return{canvas:i,onDestroy:f}}function xe(r,t){function e(e){try{return r.getContext(e,t)}catch(e){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function we(e){return typeof e.nodeName==="string"&&typeof e.appendChild==="function"&&typeof e.getBoundingClientRect==="function"}function Ae(e){return typeof e.drawArrays==="function"||typeof e.drawElements==="function"}function ke(e){if(typeof e==="string")return e.split();se(Array.isArray(e),"invalid extension array");return e}function _e(e){if(typeof e==="string"){se(typeof document!=="undefined","not supported outside of DOM");return document.querySelector(e)}return e}function Se(e){var r=e||{};var t,n,a,i;var f={};var o=[];var u=[];var s=typeof window==="undefined"?1:window.devicePixelRatio;var l=false;var c=function(e){if(e)se.raise(e)};var d=function(){};if(typeof r==="string"){se(typeof document!=="undefined","selector queries only supported in DOM enviroments");t=document.querySelector(r);se(t,"invalid query string for element")}else if(typeof r==="object")if(we(r))t=r;else if(Ae(r)){i=r;a=i.canvas}else{se.constructor(r);if("gl"in r)i=r.gl;else if("canvas"in r)a=_e(r.canvas);else if("container"in r)n=_e(r.container);if("attributes"in r){f=r.attributes;se.type(f,"object","invalid context attributes")}if("extensions"in r)o=ke(r.extensions);if("optionalExtensions"in r)u=ke(r.optionalExtensions);if("onDone"in r){se.type(r.onDone,"function","invalid or missing onDone callback");c=r.onDone}if("profile"in r)l=!!r.profile;if("pixelRatio"in r){s=+r.pixelRatio;se(s>0,"invalid pixel ratio")}}else se.raise("invalid arguments to regl");if(t)if(t.nodeName.toLowerCase()==="canvas")a=t;else n=t;if(!i){if(!a){se(typeof document!=="undefined","must manually specify webgl context outside of DOM environments");var m=ye(n||document.body,c,s);if(!m)return null;a=m.canvas;d=m.onDestroy}if(f.premultipliedAlpha===undefined)f.premultipliedAlpha=true;i=xe(a,f)}if(!i){d();c("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org");return null}return{gl:i,canvas:a,container:n,extensions:o,optionalExtensions:u,pixelRatio:s,profile:l,onDone:c,onDestroy:d}}function Oe(n,e){var a={};function r(e){se.type(e,"string","extension name must be string");var r=e.toLowerCase();var t;try{t=a[r]=n.getExtension(r)}catch(e){}return!!t}for(var t=0;t<e.extensions.length;++t){var i=e.extensions[t];if(!r(i)){e.onDestroy();e.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser');return null}}e.optionalExtensions.forEach(r);return{extensions:a,restore:function(){Object.keys(a).forEach(function(e){if(a[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)})}}}function Ee(e,r){var t=Array(e);for(var n=0;n<e;++n)t[n]=r(n);return t}var Te=5120,De=5121,je=5122,Ce=5123,ze=5124,Fe=5125,Be=5126;function Ve(e){for(var r=16;r<=1<<28;r*=16)if(e<=r)return r;return 0}function Ie(e){var r,t;r=(e>65535)<<4;e>>>=r;t=(e>255)<<3;e>>>=t;r|=t;t=(e>15)<<2;e>>>=t;r|=t;t=(e>3)<<1;e>>>=t;r|=t;return r|e>>1}function Pe(){var n=Ee(8,function(){return[]});function a(e){var r=Ve(e);var t=n[Ie(r)>>2];if(t.length>0)return t.pop();return new ArrayBuffer(r)}function r(e){n[Ie(e.byteLength)>>2].push(e)}function e(e,r){var t=null;switch(e){case Te:t=new Int8Array(a(r),0,r);break;case De:t=new Uint8Array(a(r),0,r);break;case je:t=new Int16Array(a(2*r),0,r);break;case Ce:t=new Uint16Array(a(2*r),0,r);break;case ze:t=new Int32Array(a(4*r),0,r);break;case Fe:t=new Uint32Array(a(4*r),0,r);break;case Be:t=new Float32Array(a(4*r),0,r);break;default:return null}if(t.length!==r)return t.subarray(0,r);return t}function t(e){r(e.buffer)}return{alloc:a,free:r,allocType:e,freeType:t}}var Le=Pe();Le.zero=Pe();var Re=3408,Me=3410,Ue=3411,We=3412,Ge=3413,He=3414,Ne=3415,qe=33901,Qe=33902,Ye=3379,Xe=3386,$e=34921,Ke=36347,Je=36348,Ze=35661,er=35660,rr=34930,tr=36349,nr=34076,ar=34024,ir=7936,fr=7937,or=7938,ur=35724,sr=34047,lr=36063,cr=34852,dr=3553,mr=34067,pr=34069,vr=33984,hr=6408,br=5126,gr=5121,yr=36160,xr=36053,wr=36064,Ar=16384,kr=function(e,r){var t=1;if(r.ext_texture_filter_anisotropic)t=e.getParameter(sr);var n=1;var a=1;if(r.webgl_draw_buffers){n=e.getParameter(cr);a=e.getParameter(lr)}var i=!!r.oes_texture_float;if(i){var f=e.createTexture();e.bindTexture(dr,f);e.texImage2D(dr,0,hr,1,1,0,hr,br,null);var o=e.createFramebuffer();e.bindFramebuffer(yr,o);e.framebufferTexture2D(yr,wr,dr,f,0);e.bindTexture(dr,null);if(e.checkFramebufferStatus(yr)!==xr)i=false;else{e.viewport(0,0,1,1);e.clearColor(1,0,0,1);e.clear(Ar);var u=Le.allocType(br,4);e.readPixels(0,0,1,1,hr,br,u);if(e.getError())i=false;else{e.deleteFramebuffer(o);e.deleteTexture(f);i=u[0]===1}Le.freeType(u)}}var s=typeof navigator!=="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent));var l=true;if(!s){var c=e.createTexture();var d=Le.allocType(gr,36);e.activeTexture(vr);e.bindTexture(mr,c);e.texImage2D(pr,0,hr,3,3,0,hr,gr,d);Le.freeType(d);e.bindTexture(mr,null);e.deleteTexture(c);l=!e.getError()}return{colorBits:[e.getParameter(Me),e.getParameter(Ue),e.getParameter(We),e.getParameter(Ge)],depthBits:e.getParameter(He),stencilBits:e.getParameter(Ne),subpixelBits:e.getParameter(Re),extensions:Object.keys(r).filter(function(e){return!!r[e]}),maxAnisotropic:t,maxDrawbuffers:n,maxColorAttachments:a,pointSizeDims:e.getParameter(qe),lineWidthDims:e.getParameter(Qe),maxViewportDims:e.getParameter(Xe),maxCombinedTextureUnits:e.getParameter(Ze),maxCubeMapSize:e.getParameter(nr),maxRenderbufferSize:e.getParameter(ar),maxTextureUnits:e.getParameter(rr),maxTextureSize:e.getParameter(Ye),maxAttributes:e.getParameter($e),maxVertexUniforms:e.getParameter(Ke),maxVertexTextureUnits:e.getParameter(er),maxVaryingVectors:e.getParameter(Je),maxFragmentUniforms:e.getParameter(tr),glsl:e.getParameter(ur),renderer:e.getParameter(fr),vendor:e.getParameter(ir),version:e.getParameter(or),readFloat:i,npotTextureCube:l}};function _r(e){return!!e&&typeof e==="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset==="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||ne(e.data))}var Sr=function(r){return Object.keys(r).map(function(e){return r[e]})},Or={shape:zr,flatten:Cr};function Er(e,r,t){for(var n=0;n<r;++n)t[n]=e[n]}function Tr(e,r,t,n){var a=0;for(var i=0;i<r;++i){var f=e[i];for(var o=0;o<t;++o)n[a++]=f[o]}}function Dr(e,r,t,n,a,i){var f=i;for(var o=0;o<r;++o){var u=e[o];for(var s=0;s<t;++s){var l=u[s];for(var c=0;c<n;++c)a[f++]=l[c]}}}function jr(e,r,t,n,a){var i=1;for(var f=t+1;f<r.length;++f)i*=r[f];var o=r[t];if(r.length-t===4){var u=r[t+1];var s=r[t+2];var l=r[t+3];for(f=0;f<o;++f){Dr(e[f],u,s,l,n,a);a+=i}}else for(f=0;f<o;++f){jr(e[f],r,t+1,n,a);a+=i}}function Cr(e,r,t,n){var a=1;if(r.length)for(var i=0;i<r.length;++i)a*=r[i];else a=0;var f=n||Le.allocType(t,a);switch(r.length){case 0:break;case 1:Er(e,r[0],f);break;case 2:Tr(e,r[0],r[1],f);break;case 3:Dr(e,r[0],r[1],r[2],f,0);break;default:jr(e,r,0,f,0)}return f}function zr(e){var r=[];for(var t=e;t.length;t=t[0])r.push(t.length);return r}var Fr={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Br,Vr,Ir,Pr,Lr,Rr,Mr,Ur,Wr={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Gr,Hr,Nr={dynamic:35048,stream:35040,static:35044},qr=Or.flatten,Qr=Or.shape,Yr=35044,Xr=35040,$r=5121,Kr=5126,Jr=[];function Zr(e){return Fr[Object.prototype.toString.call(e)]|0}function et(e,r){for(var t=0;t<r.length;++t)e[t]=r[t]}function rt(e,r,t,n,a,i,f){var o=0;for(var u=0;u<t;++u)for(var s=0;s<n;++s)e[o++]=r[a*u+i*s+f]}function tt(o,a,u,t){var r=0;var i={};function s(e){this.id=r++;this.buffer=o.createBuffer();this.type=e;this.usage=Yr;this.byteLength=0;this.dimension=1;this.dtype=$r;this.persistentData=null;if(u.profile)this.stats={size:0}}s.prototype.bind=function(){o.bindBuffer(this.type,this.buffer)};s.prototype.destroy=function(){c(this)};var n=[];function e(e,r){var t=n.pop();if(!t)t=new s(e);t.bind();l(t,r,Xr,0,1,false);return t}function f(e){n.push(e)}function g(e,r,t){e.byteLength=r.byteLength;o.bufferData(e.type,r,t)}function l(e,r,t,n,a,i){var f;e.usage=t;if(Array.isArray(r)){e.dtype=n||Kr;if(r.length>0){var o;if(Array.isArray(r[0])){f=Qr(r);var u=1;for(var s=1;s<f.length;++s)u*=f[s];e.dimension=u;o=qr(r,f,e.dtype);g(e,o,t);if(i)e.persistentData=o;else Le.freeType(o)}else if(typeof r[0]==="number"){e.dimension=a;var l=Le.allocType(e.dtype,r.length);et(l,r);g(e,l,t);if(i)e.persistentData=l;else Le.freeType(l)}else if(ne(r[0])){e.dimension=r[0].length;e.dtype=n||Zr(r[0])||Kr;o=qr(r,[r.length,r[0].length],e.dtype);g(e,o,t);if(i)e.persistentData=o;else Le.freeType(o)}else se.raise("invalid buffer data")}}else if(ne(r)){e.dtype=n||Zr(r);e.dimension=a;g(e,r,t);if(i)e.persistentData=new Uint8Array(new Uint8Array(r.buffer))}else if(_r(r)){f=r.shape;var c=r.stride;var d=r.offset;var m=0;var p=0;var v=0;var h=0;if(f.length===1){m=f[0];p=1;v=c[0];h=0}else if(f.length===2){m=f[0];p=f[1];v=c[0];h=c[1]}else se.raise("invalid shape");e.dtype=n||Zr(r.data)||Kr;e.dimension=p;var b=Le.allocType(e.dtype,m*p);rt(b,r.data,m,p,v,h,d);g(e,b,t);if(i)e.persistentData=b;else Le.freeType(b)}else if(r instanceof ArrayBuffer){e.dtype=$r;e.dimension=a;g(e,r,t);if(i)e.persistentData=new Uint8Array(new Uint8Array(r))}else se.raise("invalid buffer data")}function c(e){a.bufferCount--;t(e);var r=e.buffer;se(r,"buffer must not be deleted already");o.deleteBuffer(r);e.buffer=null;delete i[e.id]}function d(e,r,t,f){a.bufferCount++;var m=new s(r);i[m.id]=m;function p(e){var r=Yr;var t=null;var n=0;var a=0;var i=1;if(Array.isArray(e)||ne(e)||_r(e)||e instanceof ArrayBuffer)t=e;else if(typeof e==="number")n=e|0;else if(e){se.type(e,"object","buffer arguments must be an object, a number or an array");if("data"in e){se(t===null||Array.isArray(t)||ne(t)||_r(t),"invalid data for buffer");t=e.data}if("usage"in e){se.parameter(e.usage,Nr,"invalid buffer usage");r=Nr[e.usage]}if("type"in e){se.parameter(e.type,Wr,"invalid buffer type");a=Wr[e.type]}if("dimension"in e){se.type(e.dimension,"number","invalid dimension");i=e.dimension|0}if("length"in e){se.nni(n,"buffer length must be a nonnegative integer");n=e.length|0}}m.bind();if(!t){if(n)o.bufferData(m.type,n,r);m.dtype=a||$r;m.usage=r;m.dimension=i;m.byteLength=n}else l(m,t,r,a,i,f);if(u.profile)m.stats.size=m.byteLength*Jr[m.dtype];return p}function v(e,r){se(r+e.byteLength<=m.byteLength,"invalid buffer subdata call, buffer is too small. "+" Can't write data of size "+e.byteLength+" starting from offset "+r+" to a buffer of size "+m.byteLength);o.bufferSubData(m.type,r,e)}function n(e,r){var t=(r||0)|0;var n;m.bind();if(ne(e)||e instanceof ArrayBuffer)v(e,t);else if(Array.isArray(e)){if(e.length>0)if(typeof e[0]==="number"){var a=Le.allocType(m.dtype,e.length);et(a,e);v(a,t);Le.freeType(a)}else if(Array.isArray(e[0])||ne(e[0])){n=Qr(e);var i=qr(e,n,m.dtype);v(i,t);Le.freeType(i)}else se.raise("invalid buffer data")}else if(_r(e)){n=e.shape;var f=e.stride;var o=0;var u=0;var s=0;var l=0;if(n.length===1){o=n[0];u=1;s=f[0];l=0}else if(n.length===2){o=n[0];u=n[1];s=f[0];l=f[1]}else se.raise("invalid shape");var c=Array.isArray(e.data)?m.dtype:Zr(e.data);var d=Le.allocType(c,o*u);rt(d,e.data,o,u,s,l,e.offset);v(d,t);Le.freeType(d)}else se.raise("invalid data for buffer subdata");return p}if(!t)p(e);p._reglType="buffer";p._buffer=m;p.subdata=n;if(u.profile)p.stats=m.stats;p.destroy=function(){c(m)};return p}function m(){Sr(i).forEach(function(e){e.buffer=o.createBuffer();o.bindBuffer(e.type,e.buffer);o.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})}if(u.profile)a.getTotalBufferSize=function(){var r=0;Object.keys(i).forEach(function(e){r+=i[e].stats.size});return r};return{create:d,createStream:e,destroyStream:f,clear:function(){Sr(i).forEach(c);n.forEach(c)},getBuffer:function(e){if(e&&e._buffer instanceof s)return e._buffer;return null},restore:m,_initBuffer:l}}Jr[5120]=1,Jr[5122]=2,Jr[5124]=4,Jr[5121]=1,Jr[5123]=2,Jr[5125]=4;var nt,at,it,ft,ot,ut,st={points:0,point:0,lines:1,line:1,triangles:Jr[5126]=4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},lt=0,ct=1,dt=4,mt=5120,pt=5121,vt=5122,ht=5123,bt=5124,gt=5125,yt=34963,xt=35040,wt=35044;function At(d,m,p,t){var r={};var n=0;var l={uint8:pt,uint16:ht};if(m.oes_element_index_uint)l.uint32=gt;function a(e){this.id=n++;r[this.id]=this;this.buffer=e;this.primType=dt;this.vertCount=0;this.type=0}a.prototype.bind=function(){this.buffer.bind()};var i=[];function e(e){var r=i.pop();if(!r)r=new a(p.create(null,yt,true,false)._buffer);c(r,e,xt,-1,-1,0,0);return r}function f(e){i.push(e)}function c(e,r,t,n,a,i,f){e.buffer.bind();var o;if(r){var u=f;if(!f&&(!ne(r)||_r(r)&&!ne(r.data)))u=m.oes_element_index_uint?gt:ht;p._initBuffer(e.buffer,r,t,u,3)}else{d.bufferData(yt,i,t);e.buffer.dtype=o||pt;e.buffer.usage=t;e.buffer.dimension=3;e.buffer.byteLength=i}o=f;if(!f){switch(e.buffer.dtype){case pt:case mt:o=pt;break;case ht:case vt:o=ht;break;case gt:case bt:o=gt;break;default:se.raise("unsupported type for element array")}e.buffer.dtype=o}e.type=o;se(o!==gt||!!m.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var s=a;if(s<0){s=e.buffer.byteLength;if(o===ht)s>>=1;else if(o===gt)s>>=2}e.vertCount=s;var l=n;if(n<0){l=dt;var c=e.buffer.dimension;if(c===1)l=lt;if(c===2)l=ct;if(c===3)l=dt}e.primType=l}function v(e){t.elementsCount--;se(e.buffer!==null,"must not double destroy elements");delete r[e.id];e.buffer.destroy();e.buffer=null}function o(e,r){var o=p.create(null,yt,true);var u=new a(o._buffer);t.elementsCount++;function s(e){if(!e){o();u.primType=dt;u.vertCount=0;u.type=pt}else if(typeof e==="number"){o(e);u.primType=dt;u.vertCount=e|0;u.type=pt}else{var r=null;var t=wt;var n=-1;var a=-1;var i=0;var f=0;if(Array.isArray(e)||ne(e)||_r(e))r=e;else{se.type(e,"object","invalid arguments for elements");if("data"in e){r=e.data;se(Array.isArray(r)||ne(r)||_r(r),"invalid data for element buffer")}if("usage"in e){se.parameter(e.usage,Nr,"invalid element buffer usage");t=Nr[e.usage]}if("primitive"in e){se.parameter(e.primitive,st,"invalid element buffer primitive");n=st[e.primitive]}if("count"in e){se(typeof e.count==="number"&&e.count>=0,"invalid vertex count for elements");a=e.count|0}if("type"in e){se.parameter(e.type,l,"invalid buffer type");f=l[e.type]}if("length"in e)i=e.length|0;else{i=a;if(f===ht||f===vt)i*=2;else if(f===gt||f===bt)i*=4}}c(u,r,t,n,a,i,f)}return s}s(e);s._reglType="elements";s._elements=u;s.subdata=function(e,r){o.subdata(e,r);return s};s.destroy=function(){v(u)};return s}return{create:o,createStream:e,destroyStream:f,getElements:function(e){if(typeof e==="function"&&e._elements instanceof a)return e._elements;return null},clear:function(){Sr(r).forEach(v)}}}var kt=new Float32Array(1),_t=new Uint32Array(kt.buffer),St=5123;function Ot(e){var r=Le.allocType(St,e.length);for(var t=0;t<e.length;++t)if(isNaN(e[t]))r[t]=65535;else if(e[t]===Infinity)r[t]=31744;else if(e[t]===-Infinity)r[t]=64512;else{kt[0]=e[t];var n=_t[0];var a=n>>>31<<15;var i=(n<<1>>>24)-127;var f=n>>13&(1<<10)-1;if(i<-24)r[t]=a;else if(i<-14){var o=-14-i;r[t]=a+(f+(1<<10)>>o)}else if(i>15)r[t]=a+31744;else r[t]=a+(i+15<<10)+f}return r}function Et(e){return Array.isArray(e)||ne(e)}var Tt=function(e){return!(e&e-1)&&!!e},Dt=34467,jt=3553,Ct=34067,zt=34069,Ft=6408,Bt=6406,Vt=6407,It=6409,Pt=6410,Lt=32854,Rt=32855,Mt=36194,Ut=32819,Wt=32820,Gt=33635,Ht=34042,Nt=6402,qt=34041,Qt=35904,Yt=35906,Xt=36193,$t=33776,Kt=33777,Jt=33778,Zt=33779,en=35986,rn=35987,tn=34798,nn=35840,an=35841,fn=35842,on=35843,un=36196,sn=5121,ln=5123,cn=5125,dn=5126,mn=10242,pn=10243,vn=10497,hn=33071,bn=33648,gn=10240,yn=10241,xn=9728,wn=9729,An=9984,kn=9985,_n=9986,Sn=9987,On=33170,En=4352,Tn=4353,Dn=4354,jn=34046,Cn=3317,zn=37440,Fn=37441,Bn=37443,Vn=37444,In=33984,Pn=[An,_n,kn,Sn],Ln=[0,It,Pt,Vt,Ft],Rn={};function Mn(e){return"[object "+e+"]"}Rn[It]=Rn[Bt]=Rn[Nt]=1,Rn[qt]=Rn[Pt]=2,Rn[Vt]=Rn[Qt]=3,Rn[Ft]=Rn[Yt]=4;var Un=Mn("HTMLCanvasElement"),Wn=Mn("OffscreenCanvas"),Gn=Mn("CanvasRenderingContext2D"),Hn=Mn("ImageBitmap"),Nn=Mn("HTMLImageElement"),qn=Mn("HTMLVideoElement"),Qn=Object.keys(Fr).concat([Un,Wn,Gn,Hn,Nn,qn]),Yn=[];Yn[sn]=1,Yn[dn]=4,Yn[Xt]=2,Yn[ln]=2,Yn[cn]=4;var Xn=[];function $n(e){return Array.isArray(e)&&(e.length===0||typeof e[0]==="number")}function Kn(e){if(!Array.isArray(e))return false;var r=e.length;if(r===0||!Et(e[0]))return false;return true}function Jn(e){return Object.prototype.toString.call(e)}function Zn(e){return Jn(e)===Un}function ea(e){return Jn(e)===Wn}function ra(e){return Jn(e)===Gn}function ta(e){return Jn(e)===Hn}function na(e){return Jn(e)===Nn}function aa(e){return Jn(e)===qn}function ia(e){if(!e)return false;var r=Jn(e);if(Qn.indexOf(r)>=0)return true;return $n(e)||Kn(e)||_r(e)}function fa(e){return Fr[Object.prototype.toString.call(e)]|0}function oa(e,r){var t=r.length;switch(e.type){case sn:case ln:case cn:case dn:var n=Le.allocType(e.type,t);n.set(r);e.data=n;break;case Xt:e.data=Ot(r);break;default:se.raise("unsupported texture type, must specify a typed array")}}function ua(e,r){return Le.allocType(e.type===Xt?dn:e.type,r)}function sa(e,r){if(e.type===Xt){e.data=Ot(r);Le.freeType(r)}else e.data=r}function la(e,r,t,n,a,i){var f=e.width;var o=e.height;var u=e.channels;var s=f*o*u;var l=ua(e,s);var c=0;for(var d=0;d<o;++d)for(var m=0;m<f;++m)for(var p=0;p<u;++p)l[c++]=r[t*m+n*d+a*p+i];sa(e,l)}function ca(e,r,t,n,a,i){var f;if(typeof Xn[e]!=="undefined")f=Xn[e];else f=Rn[e]*Yn[r];if(i)f*=6;if(a){var o=0;var u=t;while(u>=1){o+=f*u*u;u/=2}return o}else return f*t*n}function da(m,l,w,d,A,p,v){var c={"don't care":En,"dont care":En,nice:Dn,fast:Tn};var h={repeat:vn,clamp:hn,mirror:bn};var b={nearest:xn,linear:wn};var g=ue({mipmap:Sn,"nearest mipmap nearest":An,"linear mipmap nearest":kn,"nearest mipmap linear":_n,"linear mipmap linear":Sn},b);var y={none:0,browser:Vn};var x={uint8:sn,rgba4:Ut,rgb565:Gt,"rgb5 a1":Wt};var k={alpha:Bt,luminance:It,"luminance alpha":Pt,rgb:Vt,rgba:Ft,rgba4:Lt,"rgb5 a1":Rt,rgb565:Mt};var _={};if(l.ext_srgb){k.srgb=Qt;k.srgba=Yt}if(l.oes_texture_float)x.float32=x.float=dn;if(l.oes_texture_half_float)x["float16"]=x["half float"]=Xt;if(l.webgl_depth_texture){ue(k,{depth:Nt,"depth stencil":qt});ue(x,{uint16:ln,uint32:cn,"depth stencil":Ht})}if(l.webgl_compressed_texture_s3tc)ue(_,{"rgb s3tc dxt1":$t,"rgba s3tc dxt1":Kt,"rgba s3tc dxt3":Jt,"rgba s3tc dxt5":Zt});if(l.webgl_compressed_texture_atc)ue(_,{"rgb atc":en,"rgba atc explicit alpha":rn,"rgba atc interpolated alpha":tn});if(l.webgl_compressed_texture_pvrtc)ue(_,{"rgb pvrtc 4bppv1":nn,"rgb pvrtc 2bppv1":an,"rgba pvrtc 4bppv1":fn,"rgba pvrtc 2bppv1":on});if(l.webgl_compressed_texture_etc1)_["rgb etc1"]=un;var t=Array.prototype.slice.call(m.getParameter(Dt));Object.keys(_).forEach(function(e){var r=_[e];if(t.indexOf(r)>=0)k[e]=r});var e=Object.keys(k);w.textureFormats=e;var S=[];Object.keys(k).forEach(function(e){var r=k[e];S[r]=e});var O=[];Object.keys(x).forEach(function(e){var r=x[e];O[r]=e});var E=[];Object.keys(b).forEach(function(e){var r=b[e];E[r]=e});var T=[];Object.keys(g).forEach(function(e){var r=g[e];T[r]=e});var D=[];Object.keys(h).forEach(function(e){var r=h[e];D[r]=e});var j=e.reduce(function(e,r){var t=k[r];if(t===It||t===Bt||t===It||t===Pt||t===Nt||t===qt||l.ext_srgb&&(t===Qt||t===Yt))e[t]=t;else if(t===Rt||r.indexOf("rgba")>=0)e[t]=Ft;else e[t]=Vt;return e},{});function n(){this.internalformat=Ft;this.format=Ft;this.type=sn;this.compressed=false;this.premultiplyAlpha=false;this.flipY=false;this.unpackAlignment=1;this.colorSpace=Vn;this.width=0;this.height=0;this.channels=0}function C(e,r){e.internalformat=r.internalformat;e.format=r.format;e.type=r.type;e.compressed=r.compressed;e.premultiplyAlpha=r.premultiplyAlpha;e.flipY=r.flipY;e.unpackAlignment=r.unpackAlignment;e.colorSpace=r.colorSpace;e.width=r.width;e.height=r.height;e.channels=r.channels}function z(e,r){if(typeof r!=="object"||!r)return;if("premultiplyAlpha"in r){se.type(r.premultiplyAlpha,"boolean","invalid premultiplyAlpha");e.premultiplyAlpha=r.premultiplyAlpha}if("flipY"in r){se.type(r.flipY,"boolean","invalid texture flip");e.flipY=r.flipY}if("alignment"in r){se.oneOf(r.alignment,[1,2,4,8],"invalid texture unpack alignment");e.unpackAlignment=r.alignment}if("colorSpace"in r){se.parameter(r.colorSpace,y,"invalid colorSpace");e.colorSpace=y[r.colorSpace]}if("type"in r){var t=r.type;se(l.oes_texture_float||!(t==="float"||t==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures.");se(l.oes_texture_half_float||!(t==="half float"||t==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");se(l.webgl_depth_texture||!(t==="uint16"||t==="uint32"||t==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");se.parameter(t,x,"invalid texture type");e.type=x[t]}var n=e.width;var a=e.height;var i=e.channels;var f=false;if("shape"in r){se(Array.isArray(r.shape)&&r.shape.length>=2,"shape must be an array");n=r.shape[0];a=r.shape[1];if(r.shape.length===3){i=r.shape[2];se(i>0&&i<=4,"invalid number of channels");f=true}se(n>=0&&n<=w.maxTextureSize,"invalid width");se(a>=0&&a<=w.maxTextureSize,"invalid height")}else{if("radius"in r){n=a=r.radius;se(n>=0&&n<=w.maxTextureSize,"invalid radius")}if("width"in r){n=r.width;se(n>=0&&n<=w.maxTextureSize,"invalid width")}if("height"in r){a=r.height;se(a>=0&&a<=w.maxTextureSize,"invalid height")}if("channels"in r){i=r.channels;se(i>0&&i<=4,"invalid number of channels");f=true}}e.width=n|0;e.height=a|0;e.channels=i|0;var o=false;if("format"in r){var u=r.format;se(l.webgl_depth_texture||!(u==="depth"||u==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");se.parameter(u,k,"invalid texture format");var s=e.internalformat=k[u];e.format=j[s];if(u in x)if(!("type"in r))e.type=x[u];if(u in _)e.compressed=true;o=true}if(!f&&o)e.channels=Rn[e.format];else if(f&&!o){if(e.channels!==Ln[e.format])e.format=e.internalformat=Ln[e.channels]}else if(o&&f)se(e.channels===Rn[e.format],"number of channels inconsistent with specified format")}function F(e){m.pixelStorei(zn,e.flipY);m.pixelStorei(Fn,e.premultiplyAlpha);m.pixelStorei(Bn,e.colorSpace);m.pixelStorei(Cn,e.unpackAlignment)}function r(){n.call(this);this.xOffset=0;this.yOffset=0;this.data=null;this.needsFree=false;this.element=null;this.needsCopy=false}function B(e,r){var t=null;if(ia(r))t=r;else if(r){se.type(r,"object","invalid pixel data type");z(e,r);if("x"in r)e.xOffset=r.x|0;if("y"in r)e.yOffset=r.y|0;if(ia(r.data))t=r.data}se(!e.compressed||t instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(r.copy){se(!t,"can not specify copy and data field for the same texture");var n=A.viewportWidth;var a=A.viewportHeight;e.width=e.width||n-e.xOffset;e.height=e.height||a-e.yOffset;e.needsCopy=true;se(e.xOffset>=0&&e.xOffset<n&&e.yOffset>=0&&e.yOffset<a&&e.width>0&&e.width<=n&&e.height>0&&e.height<=a,"copy texture read out of bounds")}else if(!t){e.width=e.width||1;e.height=e.height||1;e.channels=e.channels||4}else if(ne(t)){e.channels=e.channels||4;e.data=t;if(!("type"in r)&&e.type===sn)e.type=fa(t)}else if($n(t)){e.channels=e.channels||4;oa(e,t);e.alignment=1;e.needsFree=true}else if(_r(t)){var i=t.data;if(!Array.isArray(i)&&e.type===sn)e.type=fa(i);var f=t.shape;var o=t.stride;var u,s,l,c,d,m;if(f.length===3){l=f[2];m=o[2]}else{se(f.length===2,"invalid ndarray pixel data, must be 2 or 3D");l=1;m=1}u=f[0];s=f[1];c=o[0];d=o[1];e.alignment=1;e.width=u;e.height=s;e.channels=l;e.format=e.internalformat=Ln[l];e.needsFree=true;la(e,i,c,d,m,t.offset)}else if(Zn(t)||ea(t)||ra(t)){if(Zn(t)||ea(t))e.element=t;else e.element=t.canvas;e.width=e.element.width;e.height=e.element.height;e.channels=4}else if(ta(t)){e.element=t;e.width=t.width;e.height=t.height;e.channels=4}else if(na(t)){e.element=t;e.width=t.naturalWidth;e.height=t.naturalHeight;e.channels=4}else if(aa(t)){e.element=t;e.width=t.videoWidth;e.height=t.videoHeight;e.channels=4}else if(Kn(t)){var p=e.width||t[0].length;var v=e.height||t.length;var h=e.channels;if(Et(t[0][0]))h=h||t[0][0].length;else h=h||1;var b=Or.shape(t);var g=1;for(var y=0;y<b.length;++y)g*=b[y];var x=ua(e,g);Or.flatten(t,b,"",x);sa(e,x);e.alignment=1;e.width=p;e.height=v;e.channels=h;e.format=e.internalformat=Ln[h];e.needsFree=true}if(e.type===dn)se(w.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled");else if(e.type===Xt)se(w.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function a(e,r,t){var n=e.element;var a=e.data;var i=e.internalformat;var f=e.format;var o=e.type;var u=e.width;var s=e.height;F(e);if(n)m.texImage2D(r,t,f,f,o,n);else if(e.compressed)m.compressedTexImage2D(r,t,i,u,s,0,a);else if(e.needsCopy){d();m.copyTexImage2D(r,t,f,e.xOffset,e.yOffset,u,s,0)}else m.texImage2D(r,t,f,u,s,0,f,o,a||null)}function V(e,r,t,n,a){var i=e.element;var f=e.data;var o=e.internalformat;var u=e.format;var s=e.type;var l=e.width;var c=e.height;F(e);if(i)m.texSubImage2D(r,a,t,n,u,s,i);else if(e.compressed)m.compressedTexSubImage2D(r,a,t,n,o,l,c,f);else if(e.needsCopy){d();m.copyTexSubImage2D(r,a,t,n,e.xOffset,e.yOffset,l,c)}else m.texSubImage2D(r,a,t,n,l,c,u,s,f)}var i=[];function I(){return i.pop()||new r}function P(e){if(e.needsFree)Le.freeType(e.data);r.call(e);i.push(e)}function f(){n.call(this);this.genMipmaps=false;this.mipmapHint=En;this.mipmask=0;this.images=Array(16)}function L(e,r,t){var n=e.images[0]=I();e.mipmask=1;n.width=e.width=r;n.height=e.height=t;n.channels=e.channels=4}function R(e,r){var t=null;if(ia(r)){t=e.images[0]=I();C(t,e);B(t,r);e.mipmask=1}else{z(e,r);if(Array.isArray(r.mipmap)){var n=r.mipmap;for(var a=0;a<n.length;++a){t=e.images[a]=I();C(t,e);t.width>>=a;t.height>>=a;B(t,n[a]);e.mipmask|=1<<a}}else{t=e.images[0]=I();C(t,e);B(t,r);e.mipmask=1}}C(e,e.images[0]);if(e.compressed&&(e.internalformat===$t||e.internalformat===Kt||e.internalformat===Jt||e.internalformat===Zt))se(e.width%4===0&&e.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function M(e,r){var t=e.images;for(var n=0;n<t.length;++n){if(!t[n])return;a(t[n],r,n)}}var o=[];function U(){var e=o.pop()||new f;n.call(e);e.mipmask=0;for(var r=0;r<16;++r)e.images[r]=null;return e}function W(e){var r=e.images;for(var t=0;t<r.length;++t){if(r[t])P(r[t]);r[t]=null}o.push(e)}function G(){this.minFilter=xn;this.magFilter=xn;this.wrapS=hn;this.wrapT=hn;this.anisotropic=1;this.genMipmaps=false;this.mipmapHint=En}function H(e,r){if("min"in r){var t=r.min;se.parameter(t,g);e.minFilter=g[t];if(Pn.indexOf(e.minFilter)>=0&&!("faces"in r))e.genMipmaps=true}if("mag"in r){var n=r.mag;se.parameter(n,b);e.magFilter=b[n]}var a=e.wrapS;var i=e.wrapT;if("wrap"in r){var f=r.wrap;if(typeof f==="string"){se.parameter(f,h);a=i=h[f]}else if(Array.isArray(f)){se.parameter(f[0],h);se.parameter(f[1],h);a=h[f[0]];i=h[f[1]]}}else{if("wrapS"in r){var o=r.wrapS;se.parameter(o,h);a=h[o]}if("wrapT"in r){var u=r.wrapT;se.parameter(u,h);i=h[u]}}e.wrapS=a;e.wrapT=i;if("anisotropic"in r){var s=r.anisotropic;se(typeof s==="number"&&s>=1&&s<=w.maxAnisotropic,"aniso samples must be between 1 and ");e.anisotropic=r.anisotropic}if("mipmap"in r){var l=false;switch(typeof r.mipmap){case"string":se.parameter(r.mipmap,c,"invalid mipmap hint");e.mipmapHint=c[r.mipmap];e.genMipmaps=true;l=true;break;case"boolean":l=e.genMipmaps=r.mipmap;break;case"object":se(Array.isArray(r.mipmap),"invalid mipmap type");e.genMipmaps=false;l=true;break;default:se.raise("invalid mipmap type")}if(l&&!("min"in r))e.minFilter=An}}function N(e,r){m.texParameteri(r,yn,e.minFilter);m.texParameteri(r,gn,e.magFilter);m.texParameteri(r,mn,e.wrapS);m.texParameteri(r,pn,e.wrapT);if(l.ext_texture_filter_anisotropic)m.texParameteri(r,jn,e.anisotropic);if(e.genMipmaps){m.hint(On,e.mipmapHint);m.generateMipmap(r)}}var u=0;var q={};var s=w.maxTextureUnits;var Q=Array(s).map(function(){return null});function Y(e){n.call(this);this.mipmask=0;this.internalformat=Ft;this.id=u++;this.refCount=1;this.target=e;this.texture=m.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new G;if(v.profile)this.stats={size:0}}function X(e){m.activeTexture(In);m.bindTexture(e.target,e.texture)}function $(){var e=Q[0];if(e)m.bindTexture(e.target,e.texture);else m.bindTexture(jt,null)}function K(e){var r=e.texture;se(r,"must not double destroy texture");var t=e.unit;var n=e.target;if(t>=0){m.activeTexture(In+t);m.bindTexture(n,null);Q[t]=null}m.deleteTexture(r);e.texture=null;e.params=null;e.pixels=null;e.refCount=0;delete q[e.id];p.textureCount--}ue(Y.prototype,{bind:function(){var e=this;e.bindCount+=1;var r=e.unit;if(r<0){for(var t=0;t<s;++t){var n=Q[t];if(n){if(n.bindCount>0)continue;n.unit=-1}Q[t]=e;r=t;break}if(r>=s)se.raise("insufficient number of texture units");if(v.profile&&p.maxTextureUnits<r+1)p.maxTextureUnits=r+1;e.unit=r;m.activeTexture(In+r);m.bindTexture(e.target,e.texture)}return r},unbind:function(){this.bindCount-=1},decRef:function(){if(--this.refCount<=0)K(this)}});function J(e,r){var u=new Y(jt);q[u.id]=u;p.textureCount++;function s(e,r){var t=u.texInfo;G.call(t);var n=U();if(typeof e==="number")if(typeof r==="number")L(n,e|0,r|0);else L(n,e|0,e|0);else if(e){se.type(e,"object","invalid arguments to regl.texture");H(t,e);R(n,e)}else L(n,1,1);if(t.genMipmaps)n.mipmask=(n.width<<1)-1;u.mipmask=n.mipmask;C(u,n);se.texture2D(t,n,w);u.internalformat=n.internalformat;s.width=n.width;s.height=n.height;X(u);M(n,jt);N(t,jt);$();W(n);if(v.profile)u.stats.size=ca(u.internalformat,u.type,n.width,n.height,t.genMipmaps,false);s.format=S[u.internalformat];s.type=O[u.type];s.mag=E[t.magFilter];s.min=T[t.minFilter];s.wrapS=D[t.wrapS];s.wrapT=D[t.wrapT];return s}function t(e,r,t,n){se(!!e,"must specify image data");var a=r|0;var i=t|0;var f=n|0;var o=I();C(o,u);o.width=0;o.height=0;B(o,e);o.width=o.width||(u.width>>f)-a;o.height=o.height||(u.height>>f)-i;se(u.type===o.type&&u.format===o.format&&u.internalformat===o.internalformat,"incompatible format for texture.subimage");se(a>=0&&i>=0&&a+o.width<=u.width&&i+o.height<=u.height,"texture.subimage write out of bounds");se(u.mipmask&1<<f,"missing mipmap data");se(o.data||o.element||o.needsCopy,"missing image data");X(u);V(o,jt,a,i,f);$();P(o);return s}function n(e,r){var t=e|0;var n=r|0||t;if(t===u.width&&n===u.height)return s;s.width=u.width=t;s.height=u.height=n;X(u);for(var a=0;u.mipmask>>a;++a){var i=t>>a;var f=n>>a;if(!i||!f)break;m.texImage2D(jt,a,u.format,i,f,0,u.format,u.type,null)}$();if(v.profile)u.stats.size=ca(u.internalformat,u.type,t,n,false,false);return s}s(e,r);s.subimage=t;s.resize=n;s._reglType="texture2d";s._texture=u;if(v.profile)s.stats=u.stats;s.destroy=function(){u.decRef()};return s}function Z(e,r,t,n,a,i){var l=new Y(Ct);q[l.id]=l;p.cubeCount++;var c=new Array(6);function d(e,r,t,n,a,i){var f;var o=l.texInfo;G.call(o);for(f=0;f<6;++f)c[f]=U();if(typeof e==="number"||!e){var u=e|0||1;for(f=0;f<6;++f)L(c[f],u,u)}else if(typeof e==="object")if(r){R(c[0],e);R(c[1],r);R(c[2],t);R(c[3],n);R(c[4],a);R(c[5],i)}else{H(o,e);z(l,e);if("faces"in e){var s=e.faces;se(Array.isArray(s)&&s.length===6,"cube faces must be a length 6 array");for(f=0;f<6;++f){se(typeof s[f]==="object"&&!!s[f],"invalid input for cube map face");C(c[f],l);R(c[f],s[f])}}else for(f=0;f<6;++f)R(c[f],e)}else se.raise("invalid arguments to cube map");C(l,c[0]);if(!w.npotTextureCube)se(Tt(l.width)&&Tt(l.height),"your browser does not support non power or two texture dimensions");if(o.genMipmaps)l.mipmask=(c[0].width<<1)-1;else l.mipmask=c[0].mipmask;se.textureCube(l,o,c,w);l.internalformat=c[0].internalformat;d.width=c[0].width;d.height=c[0].height;X(l);for(f=0;f<6;++f)M(c[f],zt+f);N(o,Ct);$();if(v.profile)l.stats.size=ca(l.internalformat,l.type,d.width,d.height,o.genMipmaps,true);d.format=S[l.internalformat];d.type=O[l.type];d.mag=E[o.magFilter];d.min=T[o.minFilter];d.wrapS=D[o.wrapS];d.wrapT=D[o.wrapT];for(f=0;f<6;++f)W(c[f]);return d}function f(e,r,t,n,a){se(!!r,"must specify image data");se(typeof e==="number"&&e===(e|0)&&e>=0&&e<6,"invalid face");var i=t|0;var f=n|0;var o=a|0;var u=I();C(u,l);u.width=0;u.height=0;B(u,r);u.width=u.width||(l.width>>o)-i;u.height=u.height||(l.height>>o)-f;se(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage");se(i>=0&&f>=0&&i+u.width<=l.width&&f+u.height<=l.height,"texture.subimage write out of bounds");se(l.mipmask&1<<o,"missing mipmap data");se(u.data||u.element||u.needsCopy,"missing image data");X(l);V(u,zt+e,i,f,o);$();P(u);return d}function o(e){var r=e|0;if(r===l.width)return;d.width=l.width=r;d.height=l.height=r;X(l);for(var t=0;t<6;++t)for(var n=0;l.mipmask>>n;++n)m.texImage2D(zt+t,n,l.format,r>>n,r>>n,0,l.format,l.type,null);$();if(v.profile)l.stats.size=ca(l.internalformat,l.type,d.width,d.height,false,true);return d}d(e,r,t,n,a,i);d.subimage=f;d.resize=o;d._reglType="textureCube";d._texture=l;if(v.profile)d.stats=l.stats;d.destroy=function(){l.decRef()};return d}function ee(){for(var e=0;e<s;++e){m.activeTexture(In+e);m.bindTexture(jt,null);Q[e]=null}Sr(q).forEach(K);p.cubeCount=0;p.textureCount=0}if(v.profile)p.getTotalTextureSize=function(){var r=0;Object.keys(q).forEach(function(e){r+=q[e].stats.size});return r};function re(){for(var e=0;e<s;++e){var r=Q[e];if(r){r.bindCount=0;r.unit=-1;Q[e]=null}}Sr(q).forEach(function(e){e.texture=m.createTexture();m.bindTexture(e.target,e.texture);for(var r=0;r<32;++r){if((e.mipmask&1<<r)===0)continue;if(e.target===jt)m.texImage2D(jt,r,e.internalformat,e.width>>r,e.height>>r,0,e.internalformat,e.type,null);else for(var t=0;t<6;++t)m.texImage2D(zt+t,r,e.internalformat,e.width>>r,e.height>>r,0,e.internalformat,e.type,null)}N(e.texInfo,e.target)})}function te(){for(var e=0;e<s;++e){var r=Q[e];if(r){r.bindCount=0;r.unit=-1;Q[e]=null}m.activeTexture(In+e);m.bindTexture(jt,null);m.bindTexture(Ct,null)}}return{create2D:J,createCube:Z,clear:ee,getTexture:function(e){return null},restore:re,refresh:te}}Xn[Lt]=2,Xn[Rt]=2,Xn[Mt]=2,Xn[qt]=4,Xn[$t]=.5,Xn[Kt]=.5,Xn[Jt]=1,Xn[Zt]=1,Xn[en]=.5,Xn[rn]=1,Xn[tn]=1,Xn[nn]=.5,Xn[an]=.25,Xn[fn]=.5,Xn[on]=.25,Xn[un]=.5;var ma=36161,pa=32854,va=32855,ha=36194,ba=33189,ga=36168,ya=34041,xa=35907,wa=34836,Aa=34842,ka=34843,_a=[];function Sa(e,r,t){return _a[e]*r*t}_a[pa]=2,_a[va]=2,_a[ha]=2,_a[ba]=2,_a[ga]=1,_a[ya]=4,_a[xa]=4,_a[wa]=16,_a[Aa]=8,_a[ka]=6;var Oa=function(s,e,l,n,c){var d={rgba4:pa,rgb565:ha,"rgb5 a1":va,depth:ba,stencil:ga,"depth stencil":ya};if(e.ext_srgb)d["srgba"]=xa;if(e.ext_color_buffer_half_float){d["rgba16f"]=Aa;d["rgb16f"]=ka}if(e.webgl_color_buffer_float)d["rgba32f"]=wa;var m=[];Object.keys(d).forEach(function(e){var r=d[e];m[r]=e});var r=0;var a={};function i(e){this.id=r++;this.refCount=1;this.renderbuffer=e;this.format=pa;this.width=0;this.height=0;if(c.profile)this.stats={size:0}}i.prototype.decRef=function(){if(--this.refCount<=0)t(this)};function t(e){var r=e.renderbuffer;se(r,"must not double destroy renderbuffer");s.bindRenderbuffer(ma,null);s.deleteRenderbuffer(r);e.renderbuffer=null;e.refCount=0;delete a[e.id];n.renderbufferCount--}function f(e,r){var o=new i(s.createRenderbuffer());a[o.id]=o;n.renderbufferCount++;function u(e,r){var t=0;var n=0;var a=pa;if(typeof e==="object"&&e){var i=e;if("shape"in i){var f=i.shape;se(Array.isArray(f)&&f.length>=2,"invalid renderbuffer shape");t=f[0]|0;n=f[1]|0}else{if("radius"in i)t=n=i.radius|0;if("width"in i)t=i.width|0;if("height"in i)n=i.height|0}if("format"in i){se.parameter(i.format,d,"invalid renderbuffer format");a=d[i.format]}}else if(typeof e==="number"){t=e|0;if(typeof r==="number")n=r|0;else n=t}else if(!e)t=n=1;else se.raise("invalid arguments to renderbuffer constructor");se(t>0&&n>0&&t<=l.maxRenderbufferSize&&n<=l.maxRenderbufferSize,"invalid renderbuffer size");if(t===o.width&&n===o.height&&a===o.format)return;u.width=o.width=t;u.height=o.height=n;o.format=a;s.bindRenderbuffer(ma,o.renderbuffer);s.renderbufferStorage(ma,a,t,n);se(s.getError()===0,"invalid render buffer format");if(c.profile)o.stats.size=Sa(o.format,o.width,o.height);u.format=m[o.format];return u}function t(e,r){var t=e|0;var n=r|0||t;if(t===o.width&&n===o.height)return u;se(t>0&&n>0&&t<=l.maxRenderbufferSize&&n<=l.maxRenderbufferSize,"invalid renderbuffer size");u.width=o.width=t;u.height=o.height=n;s.bindRenderbuffer(ma,o.renderbuffer);s.renderbufferStorage(ma,o.format,t,n);se(s.getError()===0,"invalid render buffer format");if(c.profile)o.stats.size=Sa(o.format,o.width,o.height);return u}u(e,r);u.resize=t;u._reglType="renderbuffer";u._renderbuffer=o;if(c.profile)u.stats=o.stats;u.destroy=function(){o.decRef()};return u}if(c.profile)n.getTotalRenderbufferSize=function(){var r=0;Object.keys(a).forEach(function(e){r+=a[e].stats.size});return r};function o(){Sr(a).forEach(function(e){e.renderbuffer=s.createRenderbuffer();s.bindRenderbuffer(ma,e.renderbuffer);s.renderbufferStorage(ma,e.format,e.width,e.height)});s.bindRenderbuffer(ma,null)}return{create:f,clear:function(){Sr(a).forEach(t)},restore:o}},Ea=36160,Ta=36161,Da=3553,ja=34069,Ca=36064,za=36096,Fa=36128,Ba=33306,Va=36053,Ia=36054,Pa=36055,La=36057,Ra=36061,Ma=36193,Ua=5121,Wa=5126,Ga=6407,Ha=6408,Na=6402,qa=[Ga,Ha],Qa=[];Qa[Ha]=4,Qa[Ga]=3;var Ya=[];Ya[Ua]=1,Ya[Wa]=4,Ya[Ma]=2;var Xa,$a,Ka,Ja=33189,Za=36168,ei=34041,ri,ti,ni,ai,ii=[32854,32855,36194,35907,34842,34843,34836],fi={};function oi(a,O,E,h,o,n){var T={cur:null,next:null,dirty:false,setFBO:null};var D=["rgba"];var j=["rgba4","rgb565","rgb5 a1"];if(O.ext_srgb)j.push("srgba");if(O.ext_color_buffer_half_float)j.push("rgba16f","rgb16f");if(O.webgl_color_buffer_float)j.push("rgba32f");var C=["uint8"];if(O.oes_texture_half_float)C.push("half float","float16");if(O.oes_texture_float)C.push("float","float32");function u(e,r,t){this.target=e;this.texture=r;this.renderbuffer=t;var n=0;var a=0;if(r){n=r.width;a=r.height}else if(t){n=t.width;a=t.height}this.width=n;this.height=a}function r(e){if(e){if(e.texture)e.texture._texture.decRef();if(e.renderbuffer)e.renderbuffer._renderbuffer.decRef()}}function z(e,r,t){if(!e)return;if(e.texture){var n=e.texture._texture;var a=Math.max(1,n.width);var i=Math.max(1,n.height);se(a===r&&i===t,"inconsistent width/height for supplied texture");n.refCount+=1}else{var f=e.renderbuffer._renderbuffer;se(f.width===r&&f.height===t,"inconsistent width/height for renderbuffer");f.refCount+=1}}function i(e,r){if(r)if(r.texture)a.framebufferTexture2D(Ea,e,r.target,r.texture._texture.texture,0);else a.framebufferRenderbuffer(Ea,e,Ta,r.renderbuffer._renderbuffer.renderbuffer)}function F(e){var r=Da;var t=null;var n=null;var a=e;if(typeof e==="object"){a=e.data;if("target"in e)r=e.target|0}se.type(a,"function","invalid attachment data");var i=a._reglType;if(i==="texture2d"){t=a;se(r===Da)}else if(i==="textureCube"){t=a;se(r>=ja&&r<ja+6,"invalid cube map target")}else if(i==="renderbuffer"){n=a;r=Ta}else se.raise("invalid regl object for attachment");return new u(r,t,n)}function B(e,r,t,n,a){if(t){var i=h.create2D({width:e,height:r,format:n,type:a});i._texture.refCount=0;return new u(Da,i,null)}else{var f=o.create({width:e,height:r,format:n});f._renderbuffer.refCount=0;return new u(Ta,null,f)}}function V(e){return e&&(e.texture||e.renderbuffer)}function f(e,r,t){if(e){if(e.texture)e.texture.resize(r,t);else if(e.renderbuffer)e.renderbuffer.resize(r,t);e.width=r;e.height=t}}var e=0;var t={};function s(){this.id=e++;t[this.id]=this;this.framebuffer=a.createFramebuffer();this.width=0;this.height=0;this.colorAttachments=[];this.depthAttachment=null;this.stencilAttachment=null;this.depthStencilAttachment=null}function I(e){e.colorAttachments.forEach(r);r(e.depthAttachment);r(e.stencilAttachment);r(e.depthStencilAttachment)}function l(e){var r=e.framebuffer;se(r,"must not double destroy framebuffer");a.deleteFramebuffer(r);e.framebuffer=null;n.framebufferCount--;delete t[e.id]}function P(e){var r;a.bindFramebuffer(Ea,e.framebuffer);var t=e.colorAttachments;for(r=0;r<t.length;++r)i(Ca+r,t[r]);for(r=t.length;r<E.maxColorAttachments;++r)a.framebufferTexture2D(Ea,Ca+r,Da,null,0);a.framebufferTexture2D(Ea,Ba,Da,null,0);a.framebufferTexture2D(Ea,za,Da,null,0);a.framebufferTexture2D(Ea,Fa,Da,null,0);i(za,e.depthAttachment);i(Fa,e.stencilAttachment);i(Ba,e.depthStencilAttachment);var n=a.checkFramebufferStatus(Ea);if(!a.isContextLost()&&n!==Va)se.raise("framebuffer configuration not supported, status = "+fi[n]);a.bindFramebuffer(Ea,T.next?T.next.framebuffer:null);T.cur=T.next;a.getError()}function b(e,r){var _=new s;n.framebufferCount++;function S(e,r){var t;se(T.next!==_,"can not update framebuffer which is currently in use");var n=0;var a=0;var i=true;var f=true;var o=null;var u=true;var s="rgba";var l="uint8";var c=1;var d=null;var m=null;var p=null;var v=false;if(typeof e==="number"){n=e|0;a=r|0||n}else if(!e)n=a=1;else{se.type(e,"object","invalid arguments for framebuffer");var h=e;if("shape"in h){var b=h.shape;se(Array.isArray(b)&&b.length>=2,"invalid shape for framebuffer");n=b[0];a=b[1]}else{if("radius"in h)n=a=h.radius;if("width"in h)n=h.width;if("height"in h)a=h.height}if("color"in h||"colors"in h){o=h.color||h.colors;if(Array.isArray(o))se(o.length===1||O.webgl_draw_buffers,"multiple render targets not supported")}if(!o){if("colorCount"in h){c=h.colorCount|0;se(c>0,"invalid color buffer count")}if("colorTexture"in h){u=!!h.colorTexture;s="rgba4"}if("colorType"in h){l=h.colorType;if(!u){if(l==="half float"||l==="float16"){se(O.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers");s="rgba16f"}else if(l==="float"||l==="float32"){se(O.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers");s="rgba32f"}}else{se(O.oes_texture_float||!(l==="float"||l==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects");se(O.oes_texture_half_float||!(l==="half float"||l==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")}se.oneOf(l,C,"invalid color type")}if("colorFormat"in h){s=h.colorFormat;if(D.indexOf(s)>=0)u=true;else if(j.indexOf(s)>=0)u=false;else if(u)se.oneOf(h.colorFormat,D,"invalid color format for texture");else se.oneOf(h.colorFormat,j,"invalid color format for renderbuffer")}}if("depthTexture"in h||"depthStencilTexture"in h){v=!!(h.depthTexture||h.depthStencilTexture);se(!v||O.webgl_depth_texture,"webgl_depth_texture extension not supported")}if("depth"in h)if(typeof h.depth==="boolean")i=h.depth;else{d=h.depth;f=false}if("stencil"in h)if(typeof h.stencil==="boolean")f=h.stencil;else{m=h.stencil;i=false}if("depthStencil"in h)if(typeof h.depthStencil==="boolean")i=f=h.depthStencil;else{p=h.depthStencil;i=false;f=false}}var g=null;var y=null;var x=null;var w=null;if(Array.isArray(o))g=o.map(F);else if(o)g=[F(o)];else{g=new Array(c);for(t=0;t<c;++t)g[t]=B(n,a,u,s,l)}se(O.webgl_draw_buffers||g.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");se(g.length<=E.maxColorAttachments,"too many color attachments, not supported");n=n||g[0].width;a=a||g[0].height;if(d)y=F(d);else if(i&&!f)y=B(n,a,v,"depth","uint32");if(m)x=F(m);else if(f&&!i)x=B(n,a,false,"stencil","uint8");if(p)w=F(p);else if(!d&&!m&&f&&i)w=B(n,a,v,"depth stencil","depth stencil");se(!!d+!!m+!!p<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var A=null;for(t=0;t<g.length;++t){z(g[t],n,a);se(!g[t]||g[t].texture&&qa.indexOf(g[t].texture._texture.format)>=0||g[t].renderbuffer&&ii.indexOf(g[t].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+t+" is invalid");if(g[t]&&g[t].texture){var k=Qa[g[t].texture._texture.format]*Ya[g[t].texture._texture.type];if(A===null)A=k;else se(A===k,"all color attachments much have the same number of bits per pixel.")}}z(y,n,a);se(!y||y.texture&&y.texture._texture.format===Na||y.renderbuffer&&y.renderbuffer._renderbuffer.format===Ja,"invalid depth attachment for framebuffer object");z(x,n,a);se(!x||x.renderbuffer&&x.renderbuffer._renderbuffer.format===Za,"invalid stencil attachment for framebuffer object");z(w,n,a);se(!w||w.texture&&w.texture._texture.format===ei||w.renderbuffer&&w.renderbuffer._renderbuffer.format===ei,"invalid depth-stencil attachment for framebuffer object");I(_);_.width=n;_.height=a;_.colorAttachments=g;_.depthAttachment=y;_.stencilAttachment=x;_.depthStencilAttachment=w;S.color=g.map(V);S.depth=V(y);S.stencil=V(x);S.depthStencil=V(w);S.width=_.width;S.height=_.height;P(_);return S}function t(e,r){se(T.next!==_,"can not resize a framebuffer which is currently in use");var t=Math.max(e|0,1);var n=Math.max(r|0||t,1);if(t===_.width&&n===_.height)return S;var a=_.colorAttachments;for(var i=0;i<a.length;++i)f(a[i],t,n);f(_.depthAttachment,t,n);f(_.stencilAttachment,t,n);f(_.depthStencilAttachment,t,n);_.width=S.width=t;_.height=S.height=n;P(_);return S}S(e,r);return ue(S,{resize:t,_reglType:"framebuffer",_framebuffer:_,destroy:function(){l(_);I(_)},use:function(e){T.setFBO({framebuffer:S},e)}})}function c(e){var p=Array(6);function v(e){var r;se(p.indexOf(T.next)<0,"can not update framebuffer which is currently in use");var t={color:null};var n=0;var a=null;var i="rgba";var f="uint8";var o=1;if(typeof e==="number")n=e|0;else if(!e)n=1;else{se.type(e,"object","invalid arguments for framebuffer");var u=e;if("shape"in u){var s=u.shape;se(Array.isArray(s)&&s.length>=2,"invalid shape for framebuffer");se(s[0]===s[1],"cube framebuffer must be square");n=s[0]}else{if("radius"in u)n=u.radius|0;if("width"in u){n=u.width|0;if("height"in u)se(u.height===n,"must be square")}else if("height"in u)n=u.height|0}if("color"in u||"colors"in u){a=u.color||u.colors;if(Array.isArray(a))se(a.length===1||O.webgl_draw_buffers,"multiple render targets not supported")}if(!a){if("colorCount"in u){o=u.colorCount|0;se(o>0,"invalid color buffer count")}if("colorType"in u){se.oneOf(u.colorType,C,"invalid color type");f=u.colorType}if("colorFormat"in u){i=u.colorFormat;se.oneOf(u.colorFormat,D,"invalid color format for texture")}}if("depth"in u)t.depth=u.depth;if("stencil"in u)t.stencil=u.stencil;if("depthStencil"in u)t.depthStencil=u.depthStencil}var l;if(a)if(Array.isArray(a)){l=[];for(r=0;r<a.length;++r)l[r]=a[r]}else l=[a];else{l=Array(o);var c={radius:n,format:i,type:f};for(r=0;r<o;++r)l[r]=h.createCube(c)}t.color=Array(l.length);for(r=0;r<l.length;++r){var d=l[r];se(typeof d==="function"&&d._reglType==="textureCube","invalid cube map");n=n||d.width;se(d.width===n&&d.height===n,"invalid cube map shape");t.color[r]={target:ja,data:l[r]}}for(r=0;r<6;++r){for(var m=0;m<l.length;++m)t.color[m].target=ja+r;if(r>0){t.depth=p[0].depth;t.stencil=p[0].stencil;t.depthStencil=p[0].depthStencil}if(p[r])p[r](t);else p[r]=b(t)}return ue(v,{width:n,height:n,color:l})}function r(e){var r;var t=e|0;se(t>0&&t<=E.maxCubeMapSize,"invalid radius for cube fbo");if(t===v.width)return v;var n=v.color;for(r=0;r<n.length;++r)n[r].resize(t);for(r=0;r<6;++r)p[r].resize(t);v.width=v.height=t;return v}v(e);return ue(v,{faces:p,resize:r,_reglType:"framebufferCube",destroy:function(){p.forEach(function(e){e.destroy()})}})}function d(){T.cur=null;T.next=null;T.dirty=true;Sr(t).forEach(function(e){e.framebuffer=a.createFramebuffer();P(e)})}return ue(T,{getFramebuffer:function(e){if(typeof e==="function"&&e._reglType==="framebuffer"){var r=e._framebuffer;if(r instanceof s)return r}return null},create:b,createCube:c,clear:function(){Sr(t).forEach(l)},restore:d})}fi[Va]="complete",fi[Ia]="incomplete attachment",fi[La]="incomplete dimensions",fi[Pa]="incomplete, missing attachment",fi[Ra]="unsupported";var ui=5126,si=34962;function li(){this.state=0;this.x=0;this.y=0;this.z=0;this.w=0;this.buffer=null;this.size=0;this.normalized=false;this.type=ui;this.offset=0;this.stride=0;this.divisor=0}function ci(i,c,e,r,d){var m=e.maxAttributes;var a=new Array(m);for(var t=0;t<m;++t)a[t]=new li;var n=0;var f={};var o={Record:li,scope:{},state:a,currentVAO:null,targetVAO:null,restore:s()?y:function(){},createVAO:x,getVAO:p,destroyBuffer:u,setVAO:s()?v:h,clear:s()?b:function(){}};function u(e){for(var r=0;r<a.length;++r){var t=a[r];if(t.buffer===e){i.disableVertexAttribArray(r);t.buffer=null}}}function s(){return c.oes_vertex_array_object}function l(){return c.angle_instanced_arrays}function p(e){if(typeof e==="function"&&e._vao)return e._vao;return null}function v(e){if(e===o.currentVAO)return;var r=s();if(e)r.bindVertexArrayOES(e.vao);else r.bindVertexArrayOES(null);o.currentVAO=e}function h(e){if(e===o.currentVAO)return;if(e)e.bindAttrs();else{var r=l();for(var t=0;t<a.length;++t){var n=a[t];if(n.buffer){i.enableVertexAttribArray(t);i.vertexAttribPointer(t,n.size,n.type,n.normalized,n.stride,n.offfset);if(r&&n.divisor)r.vertexAttribDivisorANGLE(t,n.divisor)}else{i.disableVertexAttribArray(t);i.vertexAttrib4f(t,n.x,n.y,n.z,n.w)}}}o.currentVAO=e}function b(){Sr(f).forEach(function(e){e.destroy()})}function g(){this.id=++n;this.attributes=[];var e=s();if(e)this.vao=e.createVertexArrayOES();else this.vao=null;f[this.id]=this;this.buffers=[]}g.prototype.bindAttrs=function(){var e=l();var r=this.attributes;for(var t=0;t<r.length;++t){var n=r[t];if(n.buffer){i.enableVertexAttribArray(t);i.bindBuffer(si,n.buffer.buffer);i.vertexAttribPointer(t,n.size,n.type,n.normalized,n.stride,n.offset);if(e&&n.divisor)e.vertexAttribDivisorANGLE(t,n.divisor)}else{i.disableVertexAttribArray(t);i.vertexAttrib4f(t,n.x,n.y,n.z,n.w)}}for(var a=r.length;a<m;++a)i.disableVertexAttribArray(a)};g.prototype.refresh=function(){var e=s();if(e){e.bindVertexArrayOES(this.vao);this.bindAttrs();o.currentVAO=this}};g.prototype.destroy=function(){if(this.vao){var e=s();if(this===o.currentVAO){o.currentVAO=null;e.bindVertexArrayOES(null)}e.deleteVertexArrayOES(this.vao);this.vao=null}if(f[this.id]){delete f[this.id];r.vaoCount-=1}};function y(){var e=s();if(e)Sr(f).forEach(function(e){e.refresh()})}function x(e){var s=new g;r.vaoCount+=1;function l(e){se(Array.isArray(e),"arguments to vertex array constructor must be an array");se(e.length<m,"too many attributes");se(e.length>0,"must specify at least one attribute");var r={};var t=s.attributes;t.length=e.length;for(var n=0;n<e.length;++n){var a=e[n];var i=t[n]=new li;var f=a.data||a;if(Array.isArray(f)||ne(f)||_r(f)){var o;if(s.buffers[n]){o=s.buffers[n];if(ne(f)&&o._buffer.byteLength>=f.byteLength)o.subdata(f);else{o.destroy();s.buffers[n]=null}}if(!s.buffers[n])o=s.buffers[n]=d.create(a,si,false,true);i.buffer=d.getBuffer(o);i.size=i.buffer.dimension|0;i.normalized=false;i.type=i.buffer.dtype;i.offset=0;i.stride=0;i.divisor=0;i.state=1;r[n]=1}else if(d.getBuffer(a)){i.buffer=d.getBuffer(a);i.size=i.buffer.dimension|0;i.normalized=false;i.type=i.buffer.dtype;i.offset=0;i.stride=0;i.divisor=0;i.state=1}else if(d.getBuffer(a.buffer)){i.buffer=d.getBuffer(a.buffer);i.size=(+a.size||i.buffer.dimension)|0;i.normalized=!!a.normalized||false;if("type"in a){se.parameter(a.type,Wr,"invalid buffer type");i.type=Wr[a.type]}else i.type=i.buffer.dtype;i.offset=(a.offset||0)|0;i.stride=(a.stride||0)|0;i.divisor=(a.divisor||0)|0;i.state=1;se(i.size>=1&&i.size<=4,"size must be between 1 and 4");se(i.offset>=0,"invalid offset");se(i.stride>=0&&i.stride<=255,"stride must be between 0 and 255");se(i.divisor>=0,"divisor must be positive");se(!i.divisor||!!c.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")}else if("x"in a){se(n>0,"first attribute must not be a constant");i.x=+a.x||0;i.y=+a.y||0;i.z=+a.z||0;i.w=+a.w||0;i.state=2}else se(false,"invalid attribute spec for location "+n)}for(var u=0;u<s.buffers.length;++u)if(!r[u]&&s.buffers[u]){s.buffers[u].destroy();s.buffers[u]=null}s.refresh();return l}l.destroy=function(){for(var e=0;e<s.buffers.length;++e)if(s.buffers[e])s.buffers[e].destroy();s.buffers.length=0;s.destroy()};l._vao=s;l._reglType="vao";return l(e)}return o}var di=35632,mi=35633,pi=35718,vi=35721;function hi(v,h,o,b){var u={};var s={};function g(e,r,t,n){this.name=e;this.id=r;this.location=t;this.info=n}function y(e,r){for(var t=0;t<e.length;++t)if(e[t].id===r.id){e[t].location=r.location;return}e.push(r)}function x(e,r,t){var n=e===di?u:s;var a=n[r];if(!a){var i=h.str(r);a=v.createShader(e);v.shaderSource(a,i);v.compileShader(a);se.shaderError(v,a,i,e,t);n[r]=a}return a}var l={};var c=[];var t=0;function d(e,r){this.id=t++;this.fragId=e;this.vertId=r;this.program=null;this.uniforms=[];this.attributes=[];this.refCount=1;if(b.profile)this.stats={uniformsCount:0,attributesCount:0}}function m(e,r,t){var n,a;var i=x(di,e.fragId);var f=x(mi,e.vertId);var o=e.program=v.createProgram();v.attachShader(o,i);v.attachShader(o,f);if(t)for(n=0;n<t.length;++n){var u=t[n];v.bindAttribLocation(o,u[0],u[1])}v.linkProgram(o);se.linkError(v,o,h.str(e.fragId),h.str(e.vertId),r);var s=v.getProgramParameter(o,pi);if(b.profile)e.stats.uniformsCount=s;var l=e.uniforms;for(n=0;n<s;++n){a=v.getActiveUniform(o,n);if(a)if(a.size>1)for(var c=0;c<a.size;++c){var d=a.name.replace("[0]","["+c+"]");y(l,new g(d,h.id(d),v.getUniformLocation(o,d),a))}else y(l,new g(a.name,h.id(a.name),v.getUniformLocation(o,a.name),a))}var m=v.getProgramParameter(o,vi);if(b.profile)e.stats.attributesCount=m;var p=e.attributes;for(n=0;n<m;++n){a=v.getActiveAttrib(o,n);if(a)y(p,new g(a.name,h.id(a.name),v.getAttribLocation(o,a.name),a))}}if(b.profile){o.getMaxUniformsCount=function(){var r=0;c.forEach(function(e){if(e.stats.uniformsCount>r)r=e.stats.uniformsCount});return r};o.getMaxAttributesCount=function(){var r=0;c.forEach(function(e){if(e.stats.attributesCount>r)r=e.stats.attributesCount});return r}}function e(){u={};s={};for(var e=0;e<c.length;++e)m(c[e],null,c[e].attributes.map(function(e){return[e.location,e.name]}))}return{clear:function(){var e=v.deleteShader.bind(v);Sr(u).forEach(e);u={};Sr(s).forEach(e);s={};c.forEach(function(e){v.deleteProgram(e.program)});c.length=0;l={};o.shaderCount=0},program:function(e,r,t,n){se.command(e>=0,"missing vertex shader",t);se.command(r>=0,"missing fragment shader",t);var a=l[r];if(!a)a=l[r]={};var i=a[e];if(i){i.refCount++;if(!n)return i}var f=new d(r,e);o.shaderCount++;m(f,t,n);if(!i)a[e]=f;c.push(f);return ue(f,{destroy:function(){f.refCount--;if(f.refCount<=0){v.deleteProgram(f.program);var e=c.indexOf(f);c.splice(e,1);o.shaderCount--}if(a[f.vertId].refCount<=0){v.deleteShader(s[f.vertId]);delete s[f.vertId];delete l[f.fragId][f.vertId]}if(!Object.keys(l[f.fragId]).length){v.deleteShader(u[f.fragId]);delete u[f.fragId];delete l[f.fragId]}}})},restore:e,shader:x,frag:-1,vert:-1}}var bi=6408,gi=5121,yi=3333,xi=5126;function wi(u,s,l,c,d,m,p){function t(e){var r;if(s.next===null){se(d.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer');r=gi}else{se(s.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer");r=s.next.colorAttachments[0].texture._texture.type;if(m.oes_texture_float){se(r===gi||r===xi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'");if(r===xi)se(p.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")}else se(r===gi,"Reading from a framebuffer is only allowed for the type 'uint8'")}var t=0;var n=0;var a=c.framebufferWidth;var i=c.framebufferHeight;var f=null;if(ne(e))f=e;else if(e){se.type(e,"object","invalid arguments to regl.read()");t=e.x|0;n=e.y|0;se(t>=0&&t<c.framebufferWidth,"invalid x offset for regl.read");se(n>=0&&n<c.framebufferHeight,"invalid y offset for regl.read");a=(e.width||c.framebufferWidth-t)|0;i=(e.height||c.framebufferHeight-n)|0;f=e.data||null}if(f)if(r===gi)se(f instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'");else if(r===xi)se(f instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'");se(a>0&&a+t<=c.framebufferWidth,"invalid width for read pixels");se(i>0&&i+n<=c.framebufferHeight,"invalid height for read pixels");l();var o=a*i*4;if(!f)if(r===gi)f=new Uint8Array(o);else if(r===xi)f=f||new Float32Array(o);se.isTypedArray(f,"data buffer for regl.read() must be a typedarray");se(f.byteLength>=o,"data buffer for regl.read() too small");u.pixelStorei(yi,4);u.readPixels(t,n,a,i,bi,r,f);return f}function r(e){var r;s.setFBO({framebuffer:e.framebuffer},function(){r=t(e)});return r}function e(e){if(!e||!("framebuffer"in e))return t(e);else return r(e)}return e}function Ai(e){return Array.prototype.slice.call(e)}function ki(e){return Ai(e).join("")}function _i(){var a=0;var n=[];var i=[];function e(e){for(var r=0;r<i.length;++r)if(i[r]===e)return n[r];var t="g"+a++;n.push(t);i.push(e);return t}function f(){var r=[];function e(){r.push.apply(r,Ai(arguments))}var t=[];function n(){var e="v"+a++;t.push(e);if(arguments.length>0){r.push(e,"=");r.push.apply(r,Ai(arguments));r.push(";")}return e}return ue(e,{def:n,toString:function(){return ki([t.length>0?"var "+t.join(",")+";":"",ki(r)])}})}function u(){var n=f();var t=f();var e=n.toString;var r=t.toString;function a(e,r){t(e,r,"=",n.def(e,r),";")}return ue(function(){n.apply(n,Ai(arguments))},{def:n.def,entry:n,exit:t,save:a,set:function(e,r,t){a(e,r);n(e,r,"=",t,";")},toString:function(){return e()+r()}})}function r(){var r=ki(arguments);var e=u();var t=u();var n=e.toString;var a=t.toString;return ue(e,{then:function(){e.apply(e,Ai(arguments));return this},else:function(){t.apply(t,Ai(arguments));return this},toString:function(){var e=a();if(e)e="else{"+e+"}";return ki(["if(",r,"){",n(),"}",e])}})}var o=f();var s={};function t(e,r){var t=[];function n(){var e="a"+t.length;t.push(e);return e}r=r||0;for(var a=0;a<r;++a)n();var i=u();var f=i.toString;var o=s[e]=ue(i,{arg:n,toString:function(){return ki(["function(",t.join(),"){",f(),"}"])}});return o}function l(){var r=['"use strict";',o,"return {"];Object.keys(s).forEach(function(e){r.push('"',e,'":',s[e].toString(),",")});r.push("}");var e=ki(r).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");var t=Function.apply(null,n.concat(e));return t.apply(null,i)}return{global:o,link:e,block:f,proc:t,scope:u,cond:r,compile:l}}var Si="xyzw".split(""),Oi=5121,Ei=1,Ti=2,Di=0,ji=1,Ci=2,zi=3,Fi=4,Bi=5,Vi=6,Ii="dither",Pi="blend.enable",Li="blend.color",Ri="blend.equation",Mi="blend.func",Ui="depth.enable",Wi="depth.func",Gi="depth.range",Hi="depth.mask",Ni="colorMask",qi="cull.enable",Qi="cull.face",Yi="frontFace",Xi="lineWidth",$i="polygonOffset.enable",Ki="polygonOffset.offset",Ji="sample.alpha",Zi="sample.enable",ef="sample.coverage",rf="stencil.enable",tf="stencil.mask",nf="stencil.func",af="stencil.opFront",ff="stencil.opBack",of="scissor.enable",uf="scissor.box",sf="viewport",lf="profile",cf="framebuffer",df="vert",mf="frag",pf="elements",vf="primitive",hf="count",bf="offset",gf="instances",yf="vao",xf="Width",wf="Height",Af=cf+xf,kf=cf+wf,_f=sf+xf,Sf=sf+wf,Of="drawingBuffer",Ef=Of+xf,Tf=Of+wf,Df=[Mi,Ri,nf,af,ff,ef,sf,uf,Ki],jf=34962,Cf=34963,zf,Ff,Bf=3553,Vf=34067,If=2884,Pf=3042,Lf=3024,Rf=2960,Mf=2929,Uf=3089,Wf=32823,Gf=32926,Hf=32928,Nf=5126,qf=35664,Qf=35665,Yf=35666,Xf=5124,$f=35667,Kf=35668,Jf=35669,Zf=35670,eo=35671,ro=35672,to=35673,no=35674,ao=35675,io=35676,fo=35678,oo=35680,uo=4,so=1028,lo=1029,co=2304,mo=2305,po=32775,vo=32776,ho=519,bo=7680,go=0,yo=1,xo=32774,wo=513,Ao=36160,ko=36064,_o={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},So=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Oo={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Eo={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},To={frag:35632,vert:35633},Do={cw:co,ccw:mo};function jo(e){return Array.isArray(e)||ne(e)||_r(e)}function Co(e){return e.sort(function(e,r){if(e===sf)return-1;else if(r===sf)return 1;return e<r?-1:1})}function zo(e,r,t,n){this.thisDep=e;this.contextDep=r;this.propDep=t;this.append=n}function Fo(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Bo(e){return new zo(false,false,false,e)}function Vo(e,r){var t=e.type;if(t===Di){var n=e.data.length;return new zo(true,n>=1,n>=2,r)}else if(t===Fi){var a=e.data;return new zo(a.thisDep,a.contextDep,a.propDep,r)}else if(t===Bi)return new zo(false,false,false,r);else if(t===Vi){var i=false;var f=false;var o=false;for(var u=0;u<e.data.length;++u){var s=e.data[u];if(s.type===ji)o=true;else if(s.type===Ci)f=true;else if(s.type===zi)i=true;else if(s.type===Di){i=true;var l=s.data;if(l>=1)f=true;if(l>=2)o=true}else if(s.type===Fi){i=i||s.data.thisDep;f=f||s.data.contextDep;o=o||s.data.propDep}}return new zo(i,f,o,r)}else return new zo(t===zi,t===Ci,t===ji,r)}var Io=new zo(false,false,false,function(){});function Po(e,_,y,p,v,l,r,a,t,x,c,n,i,w,f){var h=x.Record;var s={add:32774,subtract:32778,"reverse subtract":32779};if(y.ext_blend_minmax){s.min=po;s.max=vo}var A=y.angle_instanced_arrays;var d=y.webgl_draw_buffers;var b={dirty:true,profile:f.profile};var o={};var k=[];var g={};var S={};function O(e){return e.replace(".","_")}function u(e,r,t){var n=O(e);k.push(e);o[n]=b[n]=!!t;g[n]=r}function m(e,r,t){var n=O(e);k.push(e);if(Array.isArray(t)){b[n]=t.slice();o[n]=t.slice()}else b[n]=o[n]=t;S[n]=r}u(Ii,Lf);u(Pi,Pf);m(Li,"blendColor",[0,0,0,0]);m(Ri,"blendEquationSeparate",[xo,xo]);m(Mi,"blendFuncSeparate",[yo,go,yo,go]);u(Ui,Mf,true);m(Wi,"depthFunc",wo);m(Gi,"depthRange",[0,1]);m(Hi,"depthMask",true);m(Ni,Ni,[true,true,true,true]);u(qi,If);m(Qi,"cullFace",lo);m(Yi,Yi,mo);m(Xi,Xi,1);u($i,Wf);m(Ki,"polygonOffset",[0,0]);u(Ji,Gf);u(Zi,Hf);m(ef,"sampleCoverage",[1,false]);u(rf,Rf);m(tf,"stencilMask",-1);m(nf,"stencilFunc",[ho,0,-1]);m(af,"stencilOpSeparate",[so,bo,bo,bo]);m(ff,"stencilOpSeparate",[lo,bo,bo,bo]);u(of,Uf);m(uf,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);m(sf,sf,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var E={gl:e,context:i,strings:_,next:o,current:b,draw:n,elements:l,buffer:v,shader:c,attributes:x.state,vao:x,uniforms:t,framebuffer:a,extensions:y,timer:w,isBufferArgs:jo};var T={primTypes:st,compareFuncs:Oo,blendFuncs:_o,blendEquations:s,stencilOps:Eo,glTypes:Wr,orientationType:Do};se.optional(function(){E.isArrayLike=Et});if(d){T.backBuffer=[lo];T.drawBuffer=Ee(p.maxDrawbuffers,function(e){if(e===0)return[0];return Ee(e,function(e){return ko+e})})}var D=0;function j(){var n=_i();var a=n.link;var r=n.global;n.id=D++;n.batchId="0";var t=a(E);var i=n.shared={props:"a0"};Object.keys(E).forEach(function(e){i[e]=r.def(t,".",e)});se.optional(function(){n.CHECK=a(se);n.commandStr=se.guessCommand();n.command=a(n.commandStr);n.assert=function(e,r,t){e("if(!(",r,"))",this.CHECK,".commandRaise(",a(t),",",this.command,");")};T.invalidBlendCombinations=So});var f=n.next={};var o=n.current={};Object.keys(S).forEach(function(e){if(Array.isArray(b[e])){f[e]=r.def(i.next,".",e);o[e]=r.def(i.current,".",e)}});var u=n.constants={};Object.keys(T).forEach(function(e){u[e]=r.def(JSON.stringify(T[e]))});n.invoke=function(r,e){switch(e.type){case Di:var t=["this",i.context,i.props,n.batchId];return r.def(a(e.data),".call(",t.slice(0,Math.max(e.data.length+1,4)),")");case ji:return r.def(i.props,e.data);case Ci:return r.def(i.context,e.data);case zi:return r.def("this",e.data);case Fi:e.data.append(n,r);return e.data.ref;case Bi:return e.data.toString();case Vi:return e.data.map(function(e){return n.invoke(r,e)})}};n.attribCache={};var s={};n.scopeAttrib=function(e){var r=_.id(e);if(r in s)return s[r];var t=x.scope[r];if(!t)t=x.scope[r]=new h;var n=s[r]=a(t);return n};return n}function C(e){var r=e.static;var t=e.dynamic;var n;if(lf in r){var a=!!r[lf];n=Bo(function(e,r){return a});n.enable=a}else if(lf in t){var i=t[lf];n=Vo(i,function(e,r){return e.invoke(r,i)})}return n}function z(e,r){var t=e.static;var n=e.dynamic;if(cf in t){var i=t[cf];if(i){i=a.getFramebuffer(i);se.command(i,"invalid framebuffer object");return Bo(function(e,r){var t=e.link(i);var n=e.shared;r.set(n.framebuffer,".next",t);var a=n.context;r.set(a,"."+Af,t+".width");r.set(a,"."+kf,t+".height");return t})}else return Bo(function(e,r){var t=e.shared;r.set(t.framebuffer,".next","null");var n=t.context;r.set(n,"."+Af,n+"."+Ef);r.set(n,"."+kf,n+"."+Tf);return"null"})}else if(cf in n){var o=n[cf];return Vo(o,function(e,r){var t=e.invoke(r,o);var n=e.shared;var a=n.framebuffer;var i=r.def(a,".getFramebuffer(",t,")");se.optional(function(){e.assert(r,"!"+t+"||"+i,"invalid framebuffer object")});r.set(a,".next",i);var f=n.context;r.set(f,"."+Af,i+"?"+i+".width:"+f+"."+Ef);r.set(f,"."+kf,i+"?"+i+".height:"+f+"."+Tf);return i})}else return null}function F(e,t,n){var a=e.static;var d=e.dynamic;function r(u){if(u in a){var i=a[u];se.commandType(i,"object","invalid "+u,n.commandStr);var e=true;var f=i.x|0;var o=i.y|0;var s,l;if("width"in i){s=i.width|0;se.command(s>=0,"invalid "+u,n.commandStr)}else e=false;if("height"in i){l=i.height|0;se.command(l>=0,"invalid "+u,n.commandStr)}else e=false;return new zo(!e&&t&&t.thisDep,!e&&t&&t.contextDep,!e&&t&&t.propDep,function(e,r){var t=e.shared.context;var n=s;if(!("width"in i))n=r.def(t,".",Af,"-",f);var a=l;if(!("height"in i))a=r.def(t,".",kf,"-",o);return[f,o,n,a]})}else if(u in d){var c=d[u];var r=Vo(c,function(e,r){var t=e.invoke(r,c);se.optional(function(){e.assert(r,t+"&&typeof "+t+'==="object"',"invalid "+u)});var n=e.shared.context;var a=r.def(t,".x|0");var i=r.def(t,".y|0");var f=r.def('"width" in ',t,"?",t,".width|0:","(",n,".",Af,"-",a,")");var o=r.def('"height" in ',t,"?",t,".height|0:","(",n,".",kf,"-",i,")");se.optional(function(){e.assert(r,f+">=0&&"+o+">=0","invalid "+u)});return[a,i,f,o]});if(t){r.thisDep=r.thisDep||t.thisDep;r.contextDep=r.contextDep||t.contextDep;r.propDep=r.propDep||t.propDep}return r}else if(t)return new zo(t.thisDep,t.contextDep,t.propDep,function(e,r){var t=e.shared.context;return[0,0,r.def(t,".",Af),r.def(t,".",kf)]});else return null}var i=r(sf);if(i){var f=i;i=new zo(i.thisDep,i.contextDep,i.propDep,function(e,r){var t=f.append(e,r);var n=e.shared.context;r.set(n,"."+_f,t[2]);r.set(n,"."+Sf,t[3]);return t})}return{viewport:i,scissor_box:r(uf)}}function B(e,r){var t=e.static;var n=typeof t[mf]==="string"&&typeof t[df]==="string";if(n){if(Object.keys(r.dynamic).length>0)return null;var a=r.static;var i=Object.keys(a);if(i.length>0&&typeof a[i[0]]==="number"){var f=[];for(var o=0;o<i.length;++o){se(typeof a[i[o]]==="number","must specify all vertex attribute locations when using vaos");f.push([a[i[o]]|0,i[o]])}return f}}return null}function V(e,r,t){var n=e.static;var f=e.dynamic;function a(a){if(a in n){var e=_.id(n[a]);se.optional(function(){c.shader(To[a],e,se.guessCommand())});var r=Bo(function(){return e});r.id=e;return r}else if(a in f){var i=f[a];return Vo(i,function(e,r){var t=e.invoke(r,i);var n=r.def(e.shared.strings,".id(",t,")");se.optional(function(){r(e.shared.shader,".shader(",To[a],",",n,",",e.command,");")});return n})}return null}var o=a(mf);var u=a(df);var i=null;var s;if(Fo(o)&&Fo(u)){i=c.program(u.id,o.id,null,t);s=Bo(function(e,r){return e.link(i)})}else s=new zo(o&&o.thisDep||u&&u.thisDep,o&&o.contextDep||u&&u.contextDep,o&&o.propDep||u&&u.propDep,function(e,r){var t=e.shared.shader;var n;if(o)n=o.append(e,r);else n=r.def(t,".",mf);var a;if(u)a=u.append(e,r);else a=r.def(t,".",df);var i=t+".program("+a+","+n;se.optional(function(){i+=","+e.command});return r.def(i+")")});return{frag:o,vert:u,progVar:s,program:i}}function I(e,f){var o=e.static;var u=e.dynamic;function r(){if(pf in o){var n=o[pf];if(jo(n))n=l.getElements(l.create(n,true));else if(n){n=l.getElements(n);se.command(n,"invalid elements",f.commandStr)}var e=Bo(function(e,r){if(n){var t=e.link(n);e.ELEMENTS=t;return t}e.ELEMENTS=null;return null});e.value=n;return e}else if(pf in u){var s=u[pf];return Vo(s,function(e,r){var t=e.shared;var n=t.isBufferArgs;var a=t.elements;var i=e.invoke(r,s);var f=r.def("null");var o=r.def(n,"(",i,")");var u=e.cond(o).then(f,"=",a,".createStream(",i,");").else(f,"=",a,".getElements(",i,");");se.optional(function(){e.assert(u.else,"!"+i+"||"+f,"invalid elements")});r.entry(u);r.exit(e.cond(o).then(a,".destroyStream(",f,");"));e.ELEMENTS=f;return f})}return null}var s=r();function t(){if(vf in o){var t=o[vf];se.commandParameter(t,st,"invalid primitve",f.commandStr);return Bo(function(e,r){return st[t]})}else if(vf in u){var a=u[vf];return Vo(a,function(e,r){var t=e.constants.primTypes;var n=e.invoke(r,a);se.optional(function(){e.assert(r,n+" in "+t,"invalid primitive, must be one of "+Object.keys(st))});return r.def(t,"[",n,"]")})}else if(s)if(Fo(s))if(s.value)return Bo(function(e,r){return r.def(e.ELEMENTS,".primType")});else return Bo(function(){return uo});else return new zo(s.thisDep,s.contextDep,s.propDep,function(e,r){var t=e.ELEMENTS;return r.def(t,"?",t,".primType:",uo)});return null}function n(n,a){if(n in o){var t=o[n]|0;se.command(!a||t>=0,"invalid "+n,f.commandStr);return Bo(function(e,r){if(a)e.OFFSET=t;return t})}else if(n in u){var i=u[n];return Vo(i,function(e,r){var t=e.invoke(r,i);if(a){e.OFFSET=t;se.optional(function(){e.assert(r,t+">=0","invalid "+n)})}return t})}else if(a&&s)return Bo(function(e,r){e.OFFSET="0";return 0});return null}var a=n(bf,true);function i(){if(hf in o){var e=o[hf]|0;se.command(typeof e==="number"&&e>=0,"invalid vertex count",f.commandStr);return Bo(function(){return e})}else if(hf in u){var n=u[hf];return Vo(n,function(e,r){var t=e.invoke(r,n);se.optional(function(){e.assert(r,"typeof "+t+'==="number"&&'+t+">=0&&"+t+"===("+t+"|0)","invalid vertex count")});return t})}else if(s)if(Fo(s))if(s)if(a)return new zo(a.thisDep,a.contextDep,a.propDep,function(e,r){var t=r.def(e.ELEMENTS,".vertCount-",e.OFFSET);se.optional(function(){e.assert(r,t+">=0","invalid vertex offset/element buffer too small")});return t});else return Bo(function(e,r){return r.def(e.ELEMENTS,".vertCount")});else{var r=Bo(function(){return-1});se.optional(function(){r.MISSING=true});return r}else{var t=new zo(s.thisDep||a.thisDep,s.contextDep||a.contextDep,s.propDep||a.propDep,function(e,r){var t=e.ELEMENTS;if(e.OFFSET)return r.def(t,"?",t,".vertCount-",e.OFFSET,":-1");return r.def(t,"?",t,".vertCount:-1")});se.optional(function(){t.DYNAMIC=true});return t}return null}return{elements:s,primitive:t(),count:i(),instances:n(gf,false),offset:a}}function P(e,f){var a=e.static;var o=e.dynamic;var u={};k.forEach(function(c){var i=O(c);function e(e,t){if(c in a){var r=e(a[c]);u[i]=Bo(function(){return r})}else if(c in o){var n=o[c];u[i]=Vo(n,function(e,r){return t(e,r,e.invoke(r,n))})}}switch(c){case qi:case Pi:case Ii:case rf:case Ui:case of:case $i:case Ji:case Zi:case Hi:return e(function(e){se.commandType(e,"boolean",c,f.commandStr);return e},function(e,r,t){se.optional(function(){e.assert(r,"typeof "+t+'==="boolean"',"invalid flag "+c,e.commandStr)});return t});case Wi:return e(function(e){se.commandParameter(e,Oo,"invalid "+c,f.commandStr);return Oo[e]},function(e,r,t){var n=e.constants.compareFuncs;se.optional(function(){e.assert(r,t+" in "+n,"invalid "+c+", must be one of "+Object.keys(Oo))});return r.def(n,"[",t,"]")});case Gi:return e(function(e){se.command(Et(e)&&e.length===2&&typeof e[0]==="number"&&typeof e[1]==="number"&&e[0]<=e[1],"depth range is 2d array",f.commandStr);return e},function(e,r,t){se.optional(function(){e.assert(r,e.shared.isArrayLike+"("+t+")&&"+t+".length===2&&"+"typeof "+t+'[0]==="number"&&'+"typeof "+t+'[1]==="number"&&'+t+"[0]<="+t+"[1]","depth range must be a 2d array")});var n=r.def("+",t,"[0]");var a=r.def("+",t,"[1]");return[n,a]});case Mi:return e(function(e){se.commandType(e,"object","blend.func",f.commandStr);var r="srcRGB"in e?e.srcRGB:e.src;var t="srcAlpha"in e?e.srcAlpha:e.src;var n="dstRGB"in e?e.dstRGB:e.dst;var a="dstAlpha"in e?e.dstAlpha:e.dst;se.commandParameter(r,_o,i+".srcRGB",f.commandStr);se.commandParameter(t,_o,i+".srcAlpha",f.commandStr);se.commandParameter(n,_o,i+".dstRGB",f.commandStr);se.commandParameter(a,_o,i+".dstAlpha",f.commandStr);se.command(So.indexOf(r+", "+n)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+n+")",f.commandStr);return[_o[r],_o[n],_o[t],_o[a]]},function(n,a,i){var f=n.constants.blendFuncs;se.optional(function(){n.assert(a,i+"&&typeof "+i+'==="object"',"invalid blend func, must be an object")});function e(e,r){var t=a.def('"',e,r,'" in ',i,"?",i,".",e,r,":",i,".",e);se.optional(function(){n.assert(a,t+" in "+f,"invalid "+c+"."+e+r+", must be one of "+Object.keys(_o))});return t}var r=e("src","RGB");var t=e("dst","RGB");se.optional(function(){var e=n.constants.invalidBlendCombinations;n.assert(a,e+".indexOf("+r+'+", "+'+t+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var o=a.def(f,"[",r,"]");var u=a.def(f,"[",e("src","Alpha"),"]");var s=a.def(f,"[",t,"]");var l=a.def(f,"[",e("dst","Alpha"),"]");return[o,s,u,l]});case Ri:return e(function(e){if(typeof e==="string"){se.commandParameter(e,s,"invalid "+c,f.commandStr);return[s[e],s[e]]}else if(typeof e==="object"){se.commandParameter(e.rgb,s,c+".rgb",f.commandStr);se.commandParameter(e.alpha,s,c+".alpha",f.commandStr);return[s[e.rgb],s[e.alpha]]}else se.commandRaise("invalid blend.equation",f.commandStr)},function(n,e,r){var a=n.constants.blendEquations;var t=e.def();var i=e.def();var f=n.cond("typeof ",r,'==="string"');se.optional(function(){function e(e,r,t){n.assert(e,t+" in "+a,"invalid "+r+", must be one of "+Object.keys(s))}e(f.then,c,r);n.assert(f.else,r+"&&typeof "+r+'==="object"',"invalid "+c);e(f.else,c+".rgb",r+".rgb");e(f.else,c+".alpha",r+".alpha")});f.then(t,"=",i,"=",a,"[",r,"];");f.else(t,"=",a,"[",r,".rgb];",i,"=",a,"[",r,".alpha];");e(f);return[t,i]});case Li:return e(function(r){se.command(Et(r)&&r.length===4,"blend.color must be a 4d array",f.commandStr);return Ee(4,function(e){return+r[e]})},function(e,r,t){se.optional(function(){e.assert(r,e.shared.isArrayLike+"("+t+")&&"+t+".length===4","blend.color must be a 4d array")});return Ee(4,function(e){return r.def("+",t,"[",e,"]")})});case tf:return e(function(e){se.commandType(e,"number",i,f.commandStr);return e|0},function(e,r,t){se.optional(function(){e.assert(r,"typeof "+t+'==="number"',"invalid stencil.mask")});return r.def(t,"|0")});case nf:return e(function(e){se.commandType(e,"object",i,f.commandStr);var r=e.cmp||"keep";var t=e.ref||0;var n="mask"in e?e.mask:-1;se.commandParameter(r,Oo,c+".cmp",f.commandStr);se.commandType(t,"number",c+".ref",f.commandStr);se.commandType(n,"number",c+".mask",f.commandStr);return[Oo[r],t,n]},function(r,t,n){var a=r.constants.compareFuncs;se.optional(function(){function e(){r.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}e(n+"&&typeof ",n,'==="object"');e('!("cmp" in ',n,")||(",n,".cmp in ",a,")")});var e=t.def('"cmp" in ',n,"?",a,"[",n,".cmp]",":",bo);var i=t.def(n,".ref|0");var f=t.def('"mask" in ',n,"?",n,".mask|0:-1");return[e,i,f]});case af:case ff:return e(function(e){se.commandType(e,"object",i,f.commandStr);var r=e.fail||"keep";var t=e.zfail||"keep";var n=e.zpass||"keep";se.commandParameter(r,Eo,c+".fail",f.commandStr);se.commandParameter(t,Eo,c+".zfail",f.commandStr);se.commandParameter(n,Eo,c+".zpass",f.commandStr);return[c===ff?lo:so,Eo[r],Eo[t],Eo[n]]},function(r,t,n){var a=r.constants.stencilOps;se.optional(function(){r.assert(t,n+"&&typeof "+n+'==="object"',"invalid "+c)});function e(e){se.optional(function(){r.assert(t,'!("'+e+'" in '+n+")||"+"("+n+"."+e+" in "+a+")","invalid "+c+"."+e+", must be one of "+Object.keys(Eo))});return t.def('"',e,'" in ',n,"?",a,"[",n,".",e,"]:",bo)}return[c===ff?lo:so,e("fail"),e("zfail"),e("zpass")]});case Ki:return e(function(e){se.commandType(e,"object",i,f.commandStr);var r=e.factor|0;var t=e.units|0;se.commandType(r,"number",i+".factor",f.commandStr);se.commandType(t,"number",i+".units",f.commandStr);return[r,t]},function(e,r,t){se.optional(function(){e.assert(r,t+"&&typeof "+t+'==="object"',"invalid "+c)});var n=r.def(t,".factor|0");var a=r.def(t,".units|0");return[n,a]});case Qi:return e(function(e){var r=0;if(e==="front")r=so;else if(e==="back")r=lo;se.command(!!r,i,f.commandStr);return r},function(e,r,t){se.optional(function(){e.assert(r,t+'==="front"||'+t+'==="back"',"invalid cull.face")});return r.def(t,'==="front"?',so,":",lo)});case Xi:return e(function(e){se.command(typeof e==="number"&&e>=p.lineWidthDims[0]&&e<=p.lineWidthDims[1],"invalid line width, must be a positive number between "+p.lineWidthDims[0]+" and "+p.lineWidthDims[1],f.commandStr);return e},function(e,r,t){se.optional(function(){e.assert(r,"typeof "+t+'==="number"&&'+t+">="+p.lineWidthDims[0]+"&&"+t+"<="+p.lineWidthDims[1],"invalid line width")});return t});case Yi:return e(function(e){se.commandParameter(e,Do,i,f.commandStr);return Do[e]},function(e,r,t){se.optional(function(){e.assert(r,t+'==="cw"||'+t+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return r.def(t+'==="cw"?'+co+":"+mo)});case Ni:return e(function(e){se.command(Et(e)&&e.length===4,"color.mask must be length 4 array",f.commandStr);return e.map(function(e){return!!e})},function(e,r,t){se.optional(function(){e.assert(r,e.shared.isArrayLike+"("+t+")&&"+t+".length===4","invalid color.mask")});return Ee(4,function(e){return"!!"+t+"["+e+"]"})});case ef:return e(function(e){se.command(typeof e==="object"&&e,i,f.commandStr);var r="value"in e?e.value:1;var t=!!e.invert;se.command(typeof r==="number"&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",f.commandStr);return[r,t]},function(e,r,t){se.optional(function(){e.assert(r,t+"&&typeof "+t+'==="object"',"invalid sample.coverage")});var n=r.def('"value" in ',t,"?+",t,".value:1");var a=r.def("!!",t,".invert");return[n,a]})}});return u}function L(e,a){var i=e.static;var r=e.dynamic;var f={};Object.keys(i).forEach(function(t){var n=i[t];var e;if(typeof n==="number"||typeof n==="boolean")e=Bo(function(){return n});else if(typeof n==="function"){var r=n._reglType;if(r==="texture2d"||r==="textureCube")e=Bo(function(e){return e.link(n)});else if(r==="framebuffer"||r==="framebufferCube"){se.command(n.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',a.commandStr);e=Bo(function(e){return e.link(n.color[0])})}else se.commandRaise('invalid data for uniform "'+t+'"',a.commandStr)}else if(Et(n))e=Bo(function(r){var e=r.global.def("[",Ee(n.length,function(e){se.command(typeof n[e]==="number"||typeof n[e]==="boolean","invalid uniform "+t,r.commandStr);return n[e]}),"]");return e});else se.commandRaise('invalid or missing data for uniform "'+t+'"',a.commandStr);e.value=n;f[t]=e});Object.keys(r).forEach(function(e){var t=r[e];f[e]=Vo(t,function(e,r){return e.invoke(r,t)})});return f}function R(e,d){var m=e.static;var r=e.dynamic;var p={};Object.keys(m).forEach(function(n){var e=m[n];var a=_.id(n);var i=new h;if(jo(e)){i.state=Ei;i.buffer=v.getBuffer(v.create(e,jf,false,true));i.type=0}else{var r=v.getBuffer(e);if(r){i.state=Ei;i.buffer=r;i.type=0}else{se.command(typeof e==="object"&&e,"invalid data for attribute "+n,d.commandStr);if("constant"in e){var t=e.constant;i.buffer="null";i.state=Ti;if(typeof t==="number")i.x=t;else{se.command(Et(t)&&t.length>0&&t.length<=4,"invalid constant for attribute "+n,d.commandStr);Si.forEach(function(e,r){if(r<t.length)i[e]=t[r]})}}else{if(jo(e.buffer))r=v.getBuffer(v.create(e.buffer,jf,false,true));else r=v.getBuffer(e.buffer);se.command(!!r,'missing buffer for attribute "'+n+'"',d.commandStr);var f=e.offset|0;se.command(f>=0,'invalid offset for attribute "'+n+'"',d.commandStr);var o=e.stride|0;se.command(o>=0&&o<256,'invalid stride for attribute "'+n+'", must be integer betweeen [0, 255]',d.commandStr);var u=e.size|0;se.command(!("size"in e)||u>0&&u<=4,'invalid size for attribute "'+n+'", must be 1,2,3,4',d.commandStr);var s=!!e.normalized;var l=0;if("type"in e){se.commandParameter(e.type,Wr,"invalid type for attribute "+n,d.commandStr);l=Wr[e.type]}var c=e.divisor|0;if("divisor"in e){se.command(c===0||A,'cannot specify divisor for attribute "'+n+'", instancing not supported',d.commandStr);se.command(c>=0,'invalid divisor for attribute "'+n+'"',d.commandStr)}se.optional(function(){var r=d.commandStr;var t=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(e).forEach(function(e){se.command(t.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+n+'" (valid parameters are '+t+")",r)})});i.buffer=r;i.state=Ei;i.size=u;i.normalized=s;i.type=l||r.dtype;i.offset=f;i.stride=o;i.divisor=c}}}p[n]=Bo(function(e,r){var t=e.attribCache;if(a in t)return t[a];var n={isStream:false};Object.keys(i).forEach(function(e){n[e]=i[e]});if(i.buffer){n.buffer=e.link(i.buffer);n.type=n.type||n.buffer+".dtype"}t[a]=n;return n})});Object.keys(r).forEach(function(d){var m=r[d];function e(e,r){var t=e.invoke(r,m);var n=e.shared;var a=e.constants;var i=n.isBufferArgs;var f=n.buffer;se.optional(function(){e.assert(r,t+"&&(typeof "+t+'==="object"||typeof '+t+'==="function")&&('+i+"("+t+")||"+f+".getBuffer("+t+")||"+f+".getBuffer("+t+".buffer)||"+i+"("+t+".buffer)||"+'("constant" in '+t+"&&(typeof "+t+'.constant==="number"||'+n.isArrayLike+"("+t+".constant))))",'invalid dynamic attribute "'+d+'"')});var o={isStream:r.def(false)};var u=new h;u.state=Ei;Object.keys(u).forEach(function(e){o[e]=r.def(""+u[e])});var s=o.buffer;var l=o.type;r("if(",i,"(",t,")){",o.isStream,"=true;",s,"=",f,".createStream(",jf,",",t,");",l,"=",s,".dtype;","}else{",s,"=",f,".getBuffer(",t,");","if(",s,"){",l,"=",s,".dtype;",'}else if("constant" in ',t,"){",o.state,"=",Ti,";","if(typeof "+t+'.constant === "number"){',o[Si[0]],"=",t,".constant;",Si.slice(1).map(function(e){return o[e]}).join("="),"=0;","}else{",Si.map(function(e,r){return o[e]+"="+t+".constant.length>"+r+"?"+t+".constant["+r+"]:0;"}).join(""),"}}else{","if(",i,"(",t,".buffer)){",s,"=",f,".createStream(",jf,",",t,".buffer);","}else{",s,"=",f,".getBuffer(",t,".buffer);","}",l,'="type" in ',t,"?",a.glTypes,"[",t,".type]:",s,".dtype;",o.normalized,"=!!",t,".normalized;");function c(e){r(o[e],"=",t,".",e,"|0;")}c("size");c("offset");c("stride");c("divisor");r("}}");r.exit("if(",o.isStream,"){",f,".destroyStream(",s,");","}");return o}p[d]=Vo(m,e)});return p}function M(e,r){var t=e.static;var n=e.dynamic;if(yf in t){var a=t[yf];if(a!==null&&x.getVAO(a)===null)a=x.createVAO(a);return Bo(function(e){return e.link(x.getVAO(a))})}else if(yf in n){var i=n[yf];return Vo(i,function(e,r){var t=e.invoke(r,i);return r.def(e.shared.vao+".getVAO("+t+")")})}return null}function U(e){var r=e.static;var n=e.dynamic;var a={};Object.keys(r).forEach(function(e){var t=r[e];a[e]=Bo(function(e,r){if(typeof t==="number"||typeof t==="boolean")return""+t;else return e.link(t)})});Object.keys(n).forEach(function(e){var t=n[e];a[e]=Vo(t,function(e,r){return e.invoke(r,t)})});return a}function W(e,t,r,n,a){var i=e.static;var f=e.dynamic;se.optional(function(){var r=[cf,df,mf,pf,vf,bf,hf,gf,lf,yf].concat(k);function e(e){Object.keys(e).forEach(function(e){se.command(r.indexOf(e)>=0,'unknown parameter "'+e+'"',a.commandStr)})}e(i);e(f)});var o=B(e,t);var u=z(e,a);var s=F(e,u,a);var l=I(e,a);var c=P(e,a);var d=V(e,a,o);function m(e){var r=s[e];if(r)c[e]=r}m(sf);m(O(uf));var p=Object.keys(c).length>0;var v={framebuffer:u,draw:l,shader:d,state:c,dirty:p,scopeVAO:null,drawVAO:null,useVAO:false,attributes:{}};v.profile=C(e,a);v.uniforms=L(r,a);v.drawVAO=v.scopeVAO=M(e,a);if(!v.drawVAO&&d.program&&!o&&y.angle_instanced_arrays){var h=true;var b=d.program.attributes.map(function(e){var r=t.static[e];h=h&&!!r;return r});if(h&&b.length>0){var g=x.getVAO(x.createVAO(b));v.drawVAO=new zo(null,null,null,function(e,r){return e.link(g)});v.useVAO=true}}if(o)v.useVAO=true;else v.attributes=R(t,a);v.context=U(n,a);return v}function G(n,a,i){var e=n.shared;var f=e.context;var o=n.scope();Object.keys(i).forEach(function(e){a.save(f,"."+e);var r=i[e];var t=r.append(n,a);if(Array.isArray(t))o(f,".",e,"=[",t.join(),"];");else o(f,".",e,"=",t,";")});a(o)}function H(e,r,t,n){var a=e.shared;var i=a.gl;var f=a.framebuffer;var o;if(d)o=r.def(a.extensions,".webgl_draw_buffers");var u=e.constants;var s=u.drawBuffer;var l=u.backBuffer;var c;if(t)c=t.append(e,r);else c=r.def(f,".next");if(!n)r("if(",c,"!==",f,".cur){");r("if(",c,"){",i,".bindFramebuffer(",Ao,",",c,".framebuffer);");if(d)r(o,".drawBuffersWEBGL(",s,"[",c,".colorAttachments.length]);");r("}else{",i,".bindFramebuffer(",Ao,",null);");if(d)r(o,".drawBuffersWEBGL(",l,");");r("}",f,".cur=",c,";");if(!n)r("}")}function N(f,e,o){var r=f.shared;var u=r.gl;var s=f.current;var l=f.next;var c=r.current;var d=r.next;var m=f.cond(c,".dirty");k.forEach(function(e){var r=O(e);if(r in o.state)return;var t,n;if(r in l){t=l[r];n=s[r];var a=Ee(b[r].length,function(e){return m.def(t,"[",e,"]")});m(f.cond(a.map(function(e,r){return e+"!=="+n+"["+r+"]"}).join("||")).then(u,".",S[r],"(",a,");",a.map(function(e,r){return n+"["+r+"]="+e}).join(";"),";"))}else{t=m.def(d,".",r);var i=f.cond(t,"!==",c,".",r);m(i);if(r in g)i(f.cond(t).then(u,".enable(",g[r],");").else(u,".disable(",g[r],");"),c,".",r,"=",t,";");else i(u,".",S[r],"(",t,");",c,".",r,"=",t,";")}});if(Object.keys(o.state).length===0)m(c,".dirty=false;");e(m)}function q(i,f,o,u){var e=i.shared;var s=i.current;var l=e.current;var c=e.gl;Co(Object.keys(o)).forEach(function(e){var r=o[e];if(u&&!u(r))return;var t=r.append(i,f);if(g[e]){var n=g[e];if(Fo(r))if(t)f(c,".enable(",n,");");else f(c,".disable(",n,");");else f(i.cond(t).then(c,".enable(",n,");").else(c,".disable(",n,");"));f(l,".",e,"=",t,";")}else if(Et(t)){var a=s[e];f(c,".",S[e],"(",t,");",t.map(function(e,r){return a+"["+r+"]="+e}).join(";"),";")}else f(c,".",S[e],"(",t,");",l,".",e,"=",t,";")})}function Q(e,r){if(A)e.instancing=r.def(e.shared.extensions,".angle_instanced_arrays")}function Y(e,t,r,n,a){var i=e.shared;var f=e.stats;var o=i.current;var u=i.timer;var s=r.profile;function l(){if(typeof performance==="undefined")return"Date.now()";else return"performance.now()"}var c,d;function m(e){c=t.def();e(c,"=",l(),";");if(typeof a==="string")e(f,".count+=",a,";");else e(f,".count++;");if(w)if(n){d=t.def();e(d,"=",u,".getNumPendingQueries();")}else e(u,".beginQuery(",f,");")}function p(e){e(f,".cpuTime+=",l(),"-",c,";");if(w)if(n)e(u,".pushScopeStats(",d,",",u,".getNumPendingQueries(),",f,");");else e(u,".endQuery();")}function v(e){var r=t.def(o,".profile");t(o,".profile=",e,";");t.exit(o,".profile=",r,";")}var h;if(s){if(Fo(s)){if(s.enable){m(t);p(t.exit);v("true")}else v("false");return}h=s.append(e,t);v(h)}else h=t.def(o,".profile");var b=e.block();m(b);t("if(",h,"){",b,"}");var g=e.block();p(g);t.exit("if(",h,"){",g,"}")}function X(d,m,i,e,f){var p=d.shared;function o(e){switch(e){case qf:case $f:case eo:return 2;case Qf:case Kf:case ro:return 3;case Yf:case Jf:case to:return 4;default:return 1}}function u(e,n,a){var i=p.gl;var f=m.def(e,".location");var o=m.def(p.attributes,"[",f,"]");var r=a.state;var u=a.buffer;var t=[a.x,a.y,a.z,a.w];var s=["buffer","normalized","offset","stride"];function l(){m("if(!",o,".buffer){",i,".enableVertexAttribArray(",f,");}");var e=a.type;var r;if(!a.size)r=n;else r=m.def(a.size,"||",n);m("if(",o,".type!==",e,"||",o,".size!==",r,"||",s.map(function(e){return o+"."+e+"!=="+a[e]}).join("||"),"){",i,".bindBuffer(",jf,",",u,".buffer);",i,".vertexAttribPointer(",[f,r,e,a.normalized,a.stride,a.offset],");",o,".type=",e,";",o,".size=",r,";",s.map(function(e){return o+"."+e+"="+a[e]+";"}).join(""),"}");if(A){var t=a.divisor;m("if(",o,".divisor!==",t,"){",d.instancing,".vertexAttribDivisorANGLE(",[f,t],");",o,".divisor=",t,";}")}}function c(){m("if(",o,".buffer){",i,".disableVertexAttribArray(",f,");",o,".buffer=null;","}if(",Si.map(function(e,r){return o+"."+e+"!=="+t[r]}).join("||"),"){",i,".vertexAttrib4f(",f,",",t,");",Si.map(function(e,r){return o+"."+e+"="+t[r]+";"}).join(""),"}")}if(r===Ei)l();else if(r===Ti)c();else{m("if(",r,"===",Ei,"){");l();m("}else{");c();m("}")}}e.forEach(function(e){var r=e.name;var t=i.attributes[r];var n;if(t){if(!f(t))return;n=t.append(d,m)}else{if(!f(Io))return;var a=d.scopeAttrib(r);se.optional(function(){d.assert(m,a+".state","missing attribute "+r)});n={};Object.keys(new h).forEach(function(e){n[e]=m.def(a,".",e)})}u(d.link(e),o(e.info.type),n)})}function $(a,i,e,r,t){var f=a.shared;var n=f.gl;var o;for(var u=0;u<r.length;++u){var s=r[u];var l=s.name;var c=s.info.type;var d=e.uniforms[l];var m=a.link(s);var p=m+".location";var v;if(d){if(!t(d))continue;if(Fo(d)){var h=d.value;se.command(h!==null&&typeof h!=="undefined",'missing uniform "'+l+'"',a.commandStr);if(c===fo||c===oo){se.command(typeof h==="function"&&(c===fo&&(h._reglType==="texture2d"||h._reglType==="framebuffer")||c===oo&&(h._reglType==="textureCube"||h._reglType==="framebufferCube")),"invalid texture for uniform "+l,a.commandStr);var b=a.link(h._texture||h.color[0]._texture);i(n,".uniform1i(",p,",",b+".bind());");i.exit(b,".unbind();")}else if(c===no||c===ao||c===io){se.optional(function(){se.command(Et(h),"invalid matrix for uniform "+l,a.commandStr);se.command(c===no&&h.length===4||c===ao&&h.length===9||c===io&&h.length===16,"invalid length for matrix uniform "+l,a.commandStr)});var g=a.global.def("new Float32Array(["+Array.prototype.slice.call(h)+"])");var y=2;if(c===ao)y=3;else if(c===io)y=4;i(n,".uniformMatrix",y,"fv(",p,",false,",g,");")}else{switch(c){case Nf:se.commandType(h,"number","uniform "+l,a.commandStr);o="1f";break;case qf:se.command(Et(h)&&h.length===2,"uniform "+l,a.commandStr);o="2f";break;case Qf:se.command(Et(h)&&h.length===3,"uniform "+l,a.commandStr);o="3f";break;case Yf:se.command(Et(h)&&h.length===4,"uniform "+l,a.commandStr);o="4f";break;case Zf:se.commandType(h,"boolean","uniform "+l,a.commandStr);o="1i";break;case Xf:se.commandType(h,"number","uniform "+l,a.commandStr);o="1i";break;case eo:se.command(Et(h)&&h.length===2,"uniform "+l,a.commandStr);o="2i";break;case $f:se.command(Et(h)&&h.length===2,"uniform "+l,a.commandStr);o="2i";break;case ro:se.command(Et(h)&&h.length===3,"uniform "+l,a.commandStr);o="3i";break;case Kf:se.command(Et(h)&&h.length===3,"uniform "+l,a.commandStr);o="3i";break;case to:se.command(Et(h)&&h.length===4,"uniform "+l,a.commandStr);o="4i";break;case Jf:se.command(Et(h)&&h.length===4,"uniform "+l,a.commandStr);o="4i";break}i(n,".uniform",o,"(",p,",",Et(h)?Array.prototype.slice.call(h):h,");")}continue}else v=d.append(a,i)}else{if(!t(Io))continue;v=i.def(f.uniforms,"[",_.id(l),"]")}if(c===fo){se(!Array.isArray(v),"must specify a scalar prop for textures");i("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}")}else if(c===oo){se(!Array.isArray(v),"must specify a scalar prop for cube maps");i("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}")}se.optional(function(){function t(e,r){a.assert(i,e,'bad data or missing for uniform "'+l+'".  '+r)}function e(e){se(!Array.isArray(v),"must not specify an array type for uniform");t("typeof "+v+'==="'+e+'"',"invalid type, expected "+e)}function r(e,r){if(Array.isArray(v))se(v.length===e,"must have length "+e);else t(f.isArrayLike+"("+v+")&&"+v+".length==="+e,"invalid vector, should have length "+e,a.commandStr)}function n(e){se(!Array.isArray(v),"must not specify a value type");t("typeof "+v+'==="function"&&'+v+'._reglType==="texture'+(e===Bf?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(c){case Xf:e("number");break;case $f:r(2,"number");break;case Kf:r(3,"number");break;case Jf:r(4,"number");break;case Nf:e("number");break;case qf:r(2,"number");break;case Qf:r(3,"number");break;case Yf:r(4,"number");break;case Zf:e("boolean");break;case eo:r(2,"boolean");break;case ro:r(3,"boolean");break;case to:r(4,"boolean");break;case no:r(4,"number");break;case ao:r(9,"number");break;case io:r(16,"number");break;case fo:n(Bf);break;case oo:n(Vf);break}});var x=1;switch(c){case fo:case oo:var w=i.def(v,"._texture");i(n,".uniform1i(",p,",",w,".bind());");i.exit(w,".unbind();");continue;case Xf:case Zf:o="1i";break;case $f:case eo:o="2i";x=2;break;case Kf:case ro:o="3i";x=3;break;case Jf:case to:o="4i";x=4;break;case Nf:o="1f";break;case qf:o="2f";x=2;break;case Qf:o="3f";x=3;break;case Yf:o="4f";x=4;break;case no:o="Matrix2fv";break;case ao:o="Matrix3fv";break;case io:o="Matrix4fv";break}i(n,".uniform",o,"(",p,",");if(o.charAt(0)==="M"){var A=Math.pow(c-no+2,2);var k=a.global.def("new Float32Array(",A,")");if(Array.isArray(v))i("false,(",Ee(A,function(e){return k+"["+e+"]="+v[e]}),",",k,")");else i("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",Ee(A,function(e){return k+"["+e+"]="+v+"["+e+"]"}),",",k,")")}else if(x>1)i(Ee(x,function(e){return Array.isArray(v)?v[e]:v+"["+e+"]"}));else{se(!Array.isArray(v),"uniform value must not be an array");i(v)}i(");")}}function K(n,a,i,f){var e=n.shared;var o=e.gl;var u=e.draw;var s=f.draw;function r(){var e=s.elements;var r;var t=a;if(e){if(e.contextDep&&f.contextDynamic||e.propDep)t=i;r=e.append(n,t)}else r=t.def(u,".",pf);if(r)t("if("+r+")"+o+".bindBuffer("+Cf+","+r+".buffer.buffer);");return r}function t(){var e=s.count;var r;var t=a;if(e){if(e.contextDep&&f.contextDynamic||e.propDep)t=i;r=e.append(n,t);se.optional(function(){if(e.MISSING)n.assert(a,"false","missing vertex count");if(e.DYNAMIC)n.assert(t,r+">=0","missing vertex count")})}else{r=t.def(u,".",hf);se.optional(function(){n.assert(t,r+">=0","missing vertex count")})}return r}var l=r();function c(e){var r=s[e];if(r)if(r.contextDep&&f.contextDynamic||r.propDep)return r.append(n,i);else return r.append(n,a);else return a.def(u,".",e)}var d=c(vf);var m=c(bf);var p=t();if(typeof p==="number"){if(p===0)return}else{i("if(",p,"){");i.exit("}")}var v,h;if(A){v=c(gf);h=n.instancing}var b=l+".type";var g=s.elements&&Fo(s.elements);function y(){function e(){i(h,".drawElementsInstancedANGLE(",[d,p,b,m+"<<(("+b+"-"+Oi+")>>1)",v],");")}function r(){i(h,".drawArraysInstancedANGLE(",[d,m,p,v],");")}if(l)if(!g){i("if(",l,"){");e();i("}else{");r();i("}")}else e();else r()}function x(){function e(){i(o+".drawElements("+[d,p,b,m+"<<(("+b+"-"+Oi+")>>1)"]+");")}function r(){i(o+".drawArrays("+[d,m,p]+");")}if(l)if(!g){i("if(",l,"){");e();i("}else{");r();i("}")}else e();else r()}if(A&&(typeof v!=="number"||v>=0))if(typeof v==="string"){i("if(",v,">0){");y();i("}else if(",v,"<0){");x();i("}")}else y();else x()}function J(e,r,t,n,a){var i=j();var f=i.proc("body",a);se.optional(function(){i.commandStr=r.commandStr;i.command=i.link(r.commandStr)});if(A)i.instancing=f.def(i.shared.extensions,".angle_instanced_arrays");e(i,f,t,n);return i.compile().body}function Z(e,r,t,n){Q(e,r);if(t.useVAO)if(t.drawVAO)r(e.shared.vao,".setVAO(",t.drawVAO.append(e,r),");");else r(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);");else{r(e.shared.vao,".setVAO(null);");X(e,r,t,n.attributes,function(){return true})}$(e,r,t,n.uniforms,function(){return true});K(e,r,r,t)}function ee(r,t){var e=r.proc("draw",1);Q(r,e);G(r,e,t.context);H(r,e,t.framebuffer);N(r,e,t);q(r,e,t.state);Y(r,e,t,false,true);var n=t.shader.progVar.append(r,e);e(r.shared.gl,".useProgram(",n,".program);");if(t.shader.program)Z(r,e,t,t.shader.program);else{e(r.shared.vao,".setVAO(null);");var a=r.global.def("{}");var i=e.def(n,".id");var f=e.def(a,"[",i,"]");e(r.cond(f).then(f,".call(this,a0);").else(f,"=",a,"[",i,"]=",r.link(function(e){return J(Z,r,t,e,1)}),"(",n,");",f,".call(this,a0);"))}if(Object.keys(t.state).length>0)e(r.shared.current,".dirty=true;")}function re(e,r,t,n){e.batchId="a1";Q(e,r);function a(){return true}X(e,r,t,n.attributes,a);$(e,r,t,n.uniforms,a);K(e,r,r,t)}function te(r,e,t,n){Q(r,e);var a=t.contextDep;var i=e.def();var f="a0";var o="a1";var u=e.def();r.shared.props=u;r.batchId=i;var s=r.scope();var l=r.scope();e(s.entry,"for(",i,"=0;",i,"<",o,";++",i,"){",u,"=",f,"[",i,"];",l,"}",s.exit);function c(e){return e.contextDep&&a||e.propDep}function d(e){return!c(e)}if(t.needsContext)G(r,l,t.context);if(t.needsFramebuffer)H(r,l,t.framebuffer);q(r,l,t.state,c);if(t.profile&&c(t.profile))Y(r,l,t,false,true);if(!n){var m=r.global.def("{}");var p=t.shader.progVar.append(r,l);var v=l.def(p,".id");var h=l.def(m,"[",v,"]");l(r.shared.gl,".useProgram(",p,".program);","if(!",h,"){",h,"=",m,"[",v,"]=",r.link(function(e){return J(re,r,t,e,2)}),"(",p,");}",h,".call(this,a0[",i,"],",i,");")}else{if(t.useVAO)if(t.drawVAO)if(c(t.drawVAO))l(r.shared.vao,".setVAO(",t.drawVAO.append(r,l),");");else s(r.shared.vao,".setVAO(",t.drawVAO.append(r,s),");");else s(r.shared.vao,".setVAO(",r.shared.vao,".targetVAO);");else{s(r.shared.vao,".setVAO(null);");X(r,s,t,n.attributes,d);X(r,l,t,n.attributes,c)}$(r,s,t,n.uniforms,d);$(r,l,t,n.uniforms,c);K(r,s,l,t)}}function ne(r,t){var e=r.proc("batch",2);r.batchId="0";Q(r,e);var n=false;var a=true;Object.keys(t.context).forEach(function(e){n=n||t.context[e].propDep});if(!n){G(r,e,t.context);a=false}var i=t.framebuffer;var f=false;if(i){if(i.propDep)n=f=true;else if(i.contextDep&&n)f=true;if(!f)H(r,e,i)}else H(r,e,null);if(t.state.viewport&&t.state.viewport.propDep)n=true;function o(e){return e.contextDep&&n||e.propDep}N(r,e,t);q(r,e,t.state,function(e){return!o(e)});if(!t.profile||!o(t.profile))Y(r,e,t,false,"a1");t.contextDep=n;t.needsContext=a;t.needsFramebuffer=f;var u=t.shader.progVar;if(u.contextDep&&n||u.propDep)te(r,e,t,null);else{var s=u.append(r,e);e(r.shared.gl,".useProgram(",s,".program);");if(t.shader.program)te(r,e,t,t.shader.program);else{e(r.shared.vao,".setVAO(null);");var l=r.global.def("{}");var c=e.def(s,".id");var d=e.def(l,"[",c,"]");e(r.cond(d).then(d,".call(this,a0,a1);").else(d,"=",l,"[",c,"]=",r.link(function(e){return J(te,r,t,e,2)}),"(",s,");",d,".call(this,a0,a1);"))}}if(Object.keys(t.state).length>0)e(r.shared.current,".dirty=true;")}function ae(n,a){var i=n.proc("scope",3);n.batchId="a2";var f=n.shared;var e=f.current;G(n,i,a.context);if(a.framebuffer)a.framebuffer.append(n,i);Co(Object.keys(a.state)).forEach(function(t){var e=a.state[t];var r=e.append(n,i);if(Et(r))r.forEach(function(e,r){i.set(n.next[t],"["+r+"]",e)});else i.set(f.next,"."+t,r)});Y(n,i,a,true,true);[pf,bf,hf,gf,vf].forEach(function(e){var r=a.draw[e];if(!r)return;i.set(f.draw,"."+e,""+r.append(n,i))});Object.keys(a.uniforms).forEach(function(e){var r=a.uniforms[e].append(n,i);if(Array.isArray(r))r="["+r.join()+"]";i.set(f.uniforms,"["+_.id(e)+"]",r)});Object.keys(a.attributes).forEach(function(e){var r=a.attributes[e].append(n,i);var t=n.scopeAttrib(e);Object.keys(new h).forEach(function(e){i.set(t,"."+e,r[e])})});if(a.scopeVAO)i.set(f.vao,".targetVAO",a.scopeVAO.append(n,i));function r(e){var r=a.shader[e];if(r)i.set(f.shader,"."+e,r.append(n,i))}r(df);r(mf);if(Object.keys(a.state).length>0){i(e,".dirty=true;");i.exit(e,".dirty=true;")}i("a1(",n.shared.context,",a0,",n.batchId,");")}function ie(e){if(typeof e!=="object"||Et(e))return;var r=Object.keys(e);for(var t=0;t<r.length;++t)if(ve.isDynamic(e[r[t]]))return true;return false}function fe(n,e,r){var i=e.static[r];if(!i||!ie(i))return;var a=n.global;var t=Object.keys(i);var f=false;var o=false;var u=false;var s=n.global.def("{}");t.forEach(function(e){var r=i[e];if(ve.isDynamic(r)){if(typeof r==="function")r=i[e]=ve.unbox(r);var t=Vo(r,null);f=f||t.thisDep;u=u||t.propDep;o=o||t.contextDep}else{a(s,".",e,"=");switch(typeof r){case"number":a(r);break;case"string":a('"',r,'"');break;case"object":if(Array.isArray(r))a("[",r.join(),"]");break;default:a(n.link(r));break}a(";")}});function l(n,a){t.forEach(function(e){var r=i[e];if(!ve.isDynamic(r))return;var t=n.invoke(a,r);a(s,".",e,"=",t,";")})}e.dynamic[r]=new ve.DynamicVariable(Fi,{thisDep:f,contextDep:o,propDep:u,ref:s,append:l});delete e.static[r]}function oe(r,t,e,n,a){var i=j();i.stats=i.link(a);Object.keys(t.static).forEach(function(e){fe(i,t,e)});Df.forEach(function(e){fe(i,r,e)});var f=W(r,t,e,n,i);ee(i,f);ae(i,f);ne(i,f);return ue(i.compile(),{destroy:function(){f.shader.program.destroy()}})}return{next:o,current:b,procs:function(){var o=j();var u=o.proc("poll");var s=o.proc("refresh");var l=o.block();u(l);s(l);var e=o.shared;var c=e.gl;var d=e.next;var m=e.current;l(m,".dirty=false;");H(o,u);H(o,s,null,true);var r;if(A)r=o.link(A);if(y.oes_vertex_array_object)s(o.link(y.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var t=0;t<p.maxAttributes;++t){var n=s.def(e.attributes,"[",t,"]");var a=o.cond(n,".buffer");a.then(c,".enableVertexAttribArray(",t,");",c,".bindBuffer(",jf,",",n,".buffer.buffer);",c,".vertexAttribPointer(",t,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);").else(c,".disableVertexAttribArray(",t,");",c,".vertexAttrib4f(",t,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;");s(a);if(A)s(r,".vertexAttribDivisorANGLE(",t,",",n,".divisor);")}s(o.shared.vao,".currentVAO=null;",o.shared.vao,".setVAO(",o.shared.vao,".targetVAO);");Object.keys(g).forEach(function(e){var r=g[e];var t=l.def(d,".",e);var n=o.block();n("if(",t,"){",c,".enable(",r,")}else{",c,".disable(",r,")}",m,".",e,"=",t,";");s(n);u("if(",t,"!==",m,".",e,"){",n,"}")});Object.keys(S).forEach(function(e){var r=S[e];var t=b[e];var n,a;var i=o.block();i(c,".",r,"(");if(Et(t)){var f=t.length;n=o.global.def(d,".",e);a=o.global.def(m,".",e);i(Ee(f,function(e){return n+"["+e+"]"}),");",Ee(f,function(e){return a+"["+e+"]="+n+"["+e+"];"}).join(""));u("if(",Ee(f,function(e){return n+"["+e+"]!=="+a+"["+e+"]"}).join("||"),"){",i,"}")}else{n=l.def(d,".",e);a=l.def(m,".",e);i(n,");",m,".",e,"=",n,";");u("if(",n,"!==",a,"){",i,"}")}s(i)});return o.compile()}(),compile:oe}}function Lo(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ro=34918,Mo=34919,Uo=35007,Wo=function(e,l){if(!l.ext_disjoint_timer_query)return null;var r=[];function t(){return r.pop()||l.ext_disjoint_timer_query.createQueryEXT()}function c(e){r.push(e)}var d=[];function n(e){var r=t();l.ext_disjoint_timer_query.beginQueryEXT(Uo,r);d.push(r);u(d.length-1,d.length,e)}function a(){l.ext_disjoint_timer_query.endQueryEXT(Uo)}function i(){this.startQueryIndex=-1;this.endQueryIndex=-1;this.sum=0;this.stats=null}var f=[];function o(){return f.pop()||new i}function m(e){f.push(e)}var p=[];function u(e,r,t){var n=o();n.startQueryIndex=e;n.endQueryIndex=r;n.sum=0;n.stats=t;p.push(n)}var v=[];var h=[];function s(){var e,r;var t=d.length;if(t===0)return;h.length=Math.max(h.length,t+1);v.length=Math.max(v.length,t+1);v[0]=0;h[0]=0;var n=0;e=0;for(r=0;r<d.length;++r){var a=d[r];if(l.ext_disjoint_timer_query.getQueryObjectEXT(a,Mo)){n+=l.ext_disjoint_timer_query.getQueryObjectEXT(a,Ro);c(a)}else d[e++]=a;v[r+1]=n;h[r+1]=e}d.length=e;e=0;for(r=0;r<p.length;++r){var i=p[r];var f=i.startQueryIndex;var o=i.endQueryIndex;i.sum+=v[o]-v[f];var u=h[f];var s=h[o];if(s===u){i.stats.gpuTime+=i.sum/1e6;m(i)}else{i.startQueryIndex=u;i.endQueryIndex=s;p[e++]=i}}p.length=e}return{beginQuery:n,endQuery:a,pushScopeStats:u,update:s,getNumPendingQueries:function(){return d.length},clear:function(){r.push.apply(r,d);for(var e=0;e<r.length;e++)l.ext_disjoint_timer_query.deleteQueryEXT(r[e]);d.length=0;r.length=0},restore:function(){d.length=0;r.length=0}}},Go=16384,Ho=256,No=1024,qo=34962,Qo="webglcontextlost",Yo="webglcontextrestored",Xo=1,$o=2,Ko=3;function Jo(e,r){for(var t=0;t<e.length;++t)if(e[t]===r)return t;return-1}function Zo(e){var r=Se(e);if(!r)return null;var a=r.gl;var t=a.getContextAttributes();var v=a.isContextLost();var n=Oe(a,r);if(!n)return null;var i=ge();var f=Lo();var o=n.extensions;var u=Wo(a,o);var s=be();var l=a.drawingBufferWidth;var c=a.drawingBufferHeight;var d={tick:0,time:0,viewportWidth:l,viewportHeight:c,framebufferWidth:l,framebufferHeight:c,drawingBufferWidth:l,drawingBufferHeight:c,pixelRatio:r.pixelRatio};var m={};var p={elements:null,primitive:4,count:-1,offset:0,instances:-1};var h=kr(a,o);var b=tt(a,f,r,y);var g=ci(a,o,h,f,b);function y(e){return g.destroyBuffer(e)}var x=At(a,o,b,f);var w=hi(a,i,f,r);var A=da(a,o,h,function(){S.procs.poll()},d,f,r);var k=Oa(a,o,h,f,r);var _=oi(a,o,h,A,k,f);var S=Po(a,i,o,h,b,x,A,_,m,g,w,p,d,u,r);var O=wi(a,_,S.procs.poll,d,t,o,h);var E=S.next;var T=a.canvas;var D=[];var j=[];var C=[];var z=[r.onDestroy];var F=null;function B(){if(D.length===0){if(u)u.update();F=null;return}F=he.next(B);q();for(var e=D.length-1;e>=0;--e){var r=D[e];if(r)r(d,null,0)}a.flush();if(u)u.update()}function V(){if(!F&&D.length>0)F=he.next(B)}function I(){if(F){he.cancel(B);F=null}}function P(e){e.preventDefault();v=true;I();j.forEach(function(e){e()})}function L(e){a.getError();v=false;n.restore();w.restore();b.restore();A.restore();k.restore();_.restore();g.restore();if(u)u.restore();S.procs.refresh();V();C.forEach(function(e){e()})}if(T){T.addEventListener(Qo,P,false);T.addEventListener(Yo,L,false)}function R(){D.length=0;I();if(T){T.removeEventListener(Qo,P);T.removeEventListener(Yo,L)}w.clear();_.clear();k.clear();A.clear();x.clear();b.clear();g.clear();if(u)u.clear();z.forEach(function(e){e()})}function M(e){se(!!e,"invalid args to regl({...})");se.type(e,"object","invalid args to regl({...})");function r(e){var n=ue({},e);delete n.uniforms;delete n.attributes;delete n.context;delete n.vao;if("stencil"in n&&n.stencil.op){n.stencil.opBack=n.stencil.opFront=n.stencil.op;delete n.stencil.op}function r(r){if(r in n){var t=n[r];delete n[r];Object.keys(t).forEach(function(e){n[r+"."+e]=t[e]})}}r("blend");r("depth");r("cull");r("stencil");r("polygonOffset");r("scissor");r("sample");if("vao"in e)n.vao=e.vao;return n}function t(n,a){var i={};var f={};Object.keys(n).forEach(function(e){var r=n[e];if(ve.isDynamic(r)){f[e]=ve.unbox(r,e);return}else if(a&&Array.isArray(r))for(var t=0;t<r.length;++t)if(ve.isDynamic(r[t])){f[e]=ve.unbox(r,e);return}i[e]=r});return{dynamic:f,static:i}}var n=t(e.context||{},true);var a=t(e.uniforms||{},true);var i=t(e.attributes||{},false);var f=t(r(e),false);var o={gpuTime:0,cpuTime:0,count:0};var u=S.compile(f,i,a,n,o);var s=u.draw;var l=u.batch;var c=u.scope;var d=[];function m(e){while(d.length<e)d.push(null);return d}function p(e,r){var t;if(v)se.raise("context lost");if(typeof e==="function")return c.call(this,null,e,0);else if(typeof r==="function")if(typeof e==="number")for(t=0;t<e;++t)c.call(this,null,r,t);else if(Array.isArray(e))for(t=0;t<e.length;++t)c.call(this,e[t],r,t);else return c.call(this,e,r,0);else if(typeof e==="number"){if(e>0)return l.call(this,m(e|0),e|0)}else if(Array.isArray(e)){if(e.length)return l.call(this,e,e.length)}else return s.call(this,e)}return ue(p,{stats:o,destroy:function(){u.destroy()}})}var U=_.setFBO=M({framebuffer:ve.define.call(null,Xo,"framebuffer")});function W(e,r){var t=0;S.procs.poll();var n=r.color;if(n){a.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0);t|=Go}if("depth"in r){a.clearDepth(+r.depth);t|=Ho}if("stencil"in r){a.clearStencil(r.stencil|0);t|=No}se(!!t,"called regl.clear with no buffer specified");a.clear(t)}function G(e){se(typeof e==="object"&&e,"regl.clear() takes an object as input");if("framebuffer"in e)if(e.framebuffer&&e.framebuffer_reglType==="framebufferCube")for(var r=0;r<6;++r)U(ue({framebuffer:e.framebuffer.faces[r]},e),W);else U(e,W);else W(null,e)}function H(t){se.type(t,"function","regl.frame() callback must be a function");D.push(t);function e(){var e=Jo(D,t);se(e>=0,"cannot cancel a frame twice");function r(){var e=Jo(D,r);D[e]=D[D.length-1];D.length-=1;if(D.length<=0)I()}D[e]=r}V();return{cancel:e}}function N(){var e=E.viewport;var r=E.scissor_box;e[0]=e[1]=r[0]=r[1]=0;d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=e[2]=r[2]=a.drawingBufferWidth;d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=e[3]=r[3]=a.drawingBufferHeight}function q(){d.tick+=1;d.time=Y();N();S.procs.poll()}function Q(){A.refresh();N();S.procs.refresh();if(u)u.update()}function Y(){return(be()-s)/1e3}Q();function X(e,r){se.type(r,"function","listener callback must be a function");var t;switch(e){case"frame":return H(r);case"lost":t=j;break;case"restore":t=C;break;case"destroy":t=z;break;default:se.raise("invalid event, must be one of frame,lost,restore,destroy")}t.push(r);return{cancel:function(){for(var e=0;e<t.length;++e)if(t[e]===r){t[e]=t[t.length-1];t.pop();return}}}}var $=ue(M,{clear:G,prop:ve.define.bind(null,Xo),context:ve.define.bind(null,$o),this:ve.define.bind(null,Ko),draw:M({}),buffer:function(e){return b.create(e,qo,false,false)},elements:function(e){return x.create(e,false)},texture:A.create2D,cube:A.createCube,renderbuffer:k.create,framebuffer:_.create,framebufferCube:_.createCube,vao:g.createVAO,attributes:t,frame:H,on:X,limits:h,hasExtension:function(e){return h.extensions.indexOf(e.toLowerCase())>=0},read:O,destroy:R,_gl:a,_refresh:Q,poll:function(){q();if(u)u.update()},now:Y,stats:f});r.onDone(null,$);return $}return Zo}()}}]);